!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var i;i="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,i.policiesGui=e()}}(function(){return function e(i,t,o){function n(a,l){if(!t[a]){if(!i[a]){var s="function"==typeof require&&require;if(!l&&s)return s(a,!0);if(r)return r(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var u=t[a]={exports:{}};i[a][0].call(u.exports,function(e){var t=i[a][1][e];return n(t?t:e)},u,u.exports,e,i,t,o)}return t[a].exports}for(var r="function"==typeof require&&require,a=0;a<o.length;a++)n(o[a]);return n}({1:[function(e,i,t){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function n(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,i){for(var t=0;t<i.length;t++){var o=i[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(i,t,o){return t&&e(i.prototype,t),o&&e(i,o),i}}(),a=e("./PoliciesManager"),l=o(a),s=function(){function e(i){if(n(this,e),!i)throw Error("Policy Engine is not set!");this.policiesManager=new l["default"](i),this.elements=this._setElements(),this._setListeners()}return r(e,[{key:"_addMember",value:function(e){var i=this,t=e.target.id;$(".member-new-intro").html('<h5>Add a member to a group</h5><p>Insert a user email below to add to the "'+t+'" group.</p>'),$(".member-new-modal").openModal(),$(".member-new-ok").off(),$(".member-new-ok").on("click",function(e){var o=$("#member-new").val();$("#member-new").val(""),i.policiesManager.addToGroup(t,o),$(".member-new-modal").closeModal(),i._manageGroups()})}},{key:"_createGroup",value:function(e){var i=this;$("#group-new-name").val(""),$(".group-new-modal").openModal(),$(".group-new-ok").on("click",function(e){var t=$("#group-new-name").val();i.policiesManager.createGroup(t),i._manageGroups()})}},{key:"_addPolicy",value:function(){var e=this;$("#policy-new-title").val(""),$(".combining").html("");var i=["Block overrides","Allow overrides","First applicable"];$(".combining").append(this._getOptions("comb-algorithm","Choose a combining algorithm",i)),$(".policy-new").openModal(),$(".policy-new-ok").off(),$(".policy-new-ok").on("click",function(i){var t=$("#policy-new-title").val();if(t){var o=$("#comb-algorithm").val();e.policiesManager.addPolicy(t,o),$(".help-menu").addClass("hide"),$(".policy-new").closeModal(),e._goHome()}else Materialize.toast("Invalid policy title",4e3)}),$(".help-btn").off(),$(".help-btn").on("click",function(e){$(".help-menu").removeClass("hide")})}},{key:"_decreaseRulePriority",value:function(e){var i=e.target.closest("tr").id,t=i.split(":"),o=parseInt(t[t.length-1]);t.pop();var n=t.join(":"),r=this.policiesManager.getPolicy(n).getLastPriority();if(r!=o){var a=parseInt(o+1);this.policiesManager.decreaseRulePriority(n,o,a),this._goHome()}}},{key:"_deleteMember",value:function(e){var i=e.target.closest("tr").id,t=i.split("::"),o=t[t.length-1];t.pop();var n=t.join("::");this.policiesManager.removeFromGroup(n,o),this._manageGroups()}},{key:"_deleteGroup",value:function(e){var i=e.target.closest("tr").children[0].id;this.policiesManager.deleteGroup(i),this._manageGroups()}},{key:"_deletePolicy",value:function(e){var i=e.target.closest("tr").id;this.policiesManager.deletePolicy(i),this._goHome()}},{key:"_deleteRule",value:function(e){var i=e.target.closest("tr").id,t=i.split(":"),o=t[t.length-1];t.pop();var n=t.join(":"),r=this.policiesManager.getRuleOfPolicy(n,o);this.policiesManager.deleteRule(n,r),this._goHome()}},{key:"_getActivePolicy",value:function(){var e=this;$(".policy-active").html("");var i=this.policiesManager.getActivePolicy(),t=this.policiesManager.getPoliciesTitles();t.push("Deactivate all policies"),$(".policy-active").append(this._getOptions("policies-list","Click to activate a policy",t,i)),$("#policies-list").on("click",function(i){var t=$("#policies-list").find(":selected")[0].textContent;"Deactivate all policies"===t&&(t=void 0),e.policiesManager.updateActivePolicy(t)})}},{key:"_getGroupOptions",value:function(e,i,t,o){var n="<option disabled selected>"+e+"</option>";for(var r in i){n+="<optgroup label="+i[r]+">";for(var a in o[r])n+='<option id="'+t[r]+'">'+o[r][a]+"</option>"}return n}},{key:"_getInfo",value:function(e){var i=void 0;switch(e){case"Date":if(i=$(".config").find("input").val(),i.indexOf(",")!==-1){var t=i.split(" ");t[1]=t[1].substring(0,t[1].length-1);var o=["January","February","March","April","May","June","July","August","September","October","November","December"];i=t[0]+"/"+(o.indexOf(t[1])+1)+"/"+t[2]}else{var n=i.split("-");i=n[2]+"/"+n[1]+"/"+n[0]}break;case"Group of users":i=$("#group").find(":selected").text();break;case"Subscription preferences":(i=void 0!==$("input[name='rule-new-subscription']:checked")[0])&&(i=$("input[name='rule-new-subscription']:checked")[0].id);break;case"Weekday":i=$("#weekday").find(":selected").text();break;default:i=$(".config").find("input").val()}return i}},{key:"_getList",value:function(e){for(var i="",t=e.length,o=0;o<t;o++)i+='<li class="divider"></li>',i+='<li><a class="center-align">'+e[o]+"</a></li>";return i}},{key:"_getOptions",value:function(e,i,t,o){var n='<select id="'+e+'" class="browser-default"><option disabled selected>'+i+"</option>";for(var r in t)n+=void 0!==o&o===t[r]?'<option selected id="'+e+'">'+t[r]+"</option>":'<option id="'+e+'">'+t[r]+"</option>";return n+="</select>"}},{key:"_getPoliciesTable",value:function(){var e=this;$(".policies-no").addClass("hide"),$(".policies-current").html("");var i=this.policiesManager.getFormattedPolicies(),t=[],o=[],n=[];for(var r in i)t.push(i[r].title),o.push(i[r].rulesTitles),n.push(i[r].ids);var a="<table>",l=0===t.length;for(var s in t){a+='<thead><tr id="'+t[s]+'"><td></td><td></td><th class="center-align">'+t[s]+'</th><td><i class="material-icons clickable-cell policy-delete" style="cursor: pointer; vertical-align: middle">delete_forever</i></td></tr></thead><tbody>';for(var c in o[s])a+='<tr id="'+n[s][c]+'" ><td><i class="material-icons clickable-cell rule-priority-increase" style="cursor: pointer; vertical-align: middle">arrow_upward</i></td><td><i class="material-icons clickable-cell rule-priority-decrease" style="cursor: pointer; vertical-align: middle">arrow_downward</i></td><td class="rule-show clickable-cell" style="cursor: pointer">'+o[s][c]+'</td><td><i class="material-icons clickable-cell rule-delete" style="cursor: pointer; vertical-align: middle">clear</i></td></tr>';a+='<tr id="'+t[s]+'"></td><td></td><td></td><td style="text-align:center"><i class="material-icons clickable-cell center-align rule-add" style="cursor: pointer">add_circle</i></td></tr>'}l?$(".policies-no").removeClass("hide"):(a+="</tbody></table>",$(".policies-current").append(a)),$(".rule-add").on("click",function(i){e._showVariablesTypes(i)}),$(".rule-delete").on("click",function(i){e._deleteRule(i)}),$(".rule-show").on("click",function(i){e._showRule(i)}),$(".rule-priority-increase").on("click",function(i){e._increaseRulePriority(i)}),$(".rule-priority-decrease").on("click",function(i){e._decreaseRulePriority(i)}),$(".policy-add").off(),$(".policy-add").on("click",function(i){e._addPolicy(i)}),$(".policy-delete").on("click",function(i){e._deletePolicy(i)})}},{key:"_goHome",value:function(){this._getActivePolicy(),this._getPoliciesTable()}},{key:"_increaseRulePriority",value:function(e){var i=e.target.closest("tr").id,t=i.split(":"),o=parseInt(t[t.length-1]);if(0!==o){t.pop();var n=t.join(":"),r=o-1;this.policiesManager.increaseRulePriority(n,o,r),this._goHome()}}},{key:"_manageGroups",value:function(){var e=this;$(".groups-current").html("");var i=this.policiesManager.getGroups(),t=i.groupsNames,o=i.members,n=i.ids,r="<table>",a=0===t.length;for(var l in t){r+='<thead><tr><th id="'+t[l]+'">'+t[l]+'</th><td style="text-align:right"><i class="material-icons clickable-cell group-delete" style="cursor: pointer; vertical-align: middle">delete_forever</i></td></tr></thead><tbody>';for(var s in o[l])r+='<tr id="'+n[l][s]+'" ><td style="cursor: pointer">'+o[l][s]+'</td><td style="text-align:right"><i class="material-icons clickable-cell member-delete" style="cursor: pointer; vertical-align: middle">clear</i></td></tr>';r+='<tr id="'+t[l]+'"><td><i class="material-icons clickable-cell member-add" id="'+t[l]+'" style="cursor: pointer">add_circle</i></td></tr>'}a?$(".groups-current").append("<p>There are no groups set.</p>"):(r+="</tbody></table>",$(".groups-current").append(r)),$(".member-add").off(),$(".member-add").on("click",function(i){e._addMember(i)}),$(".member-delete").on("click",function(i){e._deleteMember(i)}),$(".group-add").off(),$(".group-add").on("click",function(i){e._createGroup(i)}),$(".group-delete").on("click",function(i){e._deleteGroup(i)})}},{key:"_parseFileContent",value:function(e){var i=JSON.parse(e);for(var t in i)this.policiesManager.addPolicy(t,void 0,i[t]);$(".policy-new").closeModal()}},{key:"_setElements",value:function(){var e=this;return{date:function(e){return'<input type="date" class="datepicker">'},select:function(i){return e._getOptions(i[0],i[1],i[2])},form:function(e){return'<form><input type="text" placeholder="'+e+'"></input></form>'}}}},{key:"_showNewConfigurationPanel",value:function(e){var i=event.target.text;$(".variable").html(this._getNewConfiguration(e,i)),$(".scopes").empty().html("");var t=["Email","Hyperty","All"],o=["identity","hyperty","global"],n=[];n.push(this.policiesManager.getMyEmails()),n.push(this.policiesManager.getMyHyperties()),n.push(["All identities and hyperties"]),$(".scopes").append(this._getGroupOptions("Apply this configuration to:",t,o,n)),$(".variable").removeClass("hide")}},{key:"_showVariablesTypes",value:function(e){var i=this,t=e.target.closest("tr").id;$("#variables-types").empty().html("");var o=this.policiesManager.getVariables();$("#variables-types").append(this._getList(o)),$(".variable").addClass("hide"),$(".rule-new").openModal(),$("#variables-types").off(),$("#variables-types").on("click",function(e){i._showNewConfigurationPanel(t)})}},{key:"_getNewConfiguration",value:function(e,i){var t=this,o=this.policiesManager.getVariableInfo(i);if($(".rule-new-title").html(o.title),$(".description").html(o.description),$(".config").html(""),"Subscription preferences"===i)$(".subscription-type").removeClass("hide");else{$(".subscription-type").addClass("hide");var n=o.input;for(var r in n)"Group of users"===i&&n[r][1].push(this.policiesManager.getGroupsNames()),$(".config").append(this.elements[n[r][0]](n[r][1])),"Group of users"===i&&n[r][1].pop();"date"===i&&$(".datepicker").pickadate({selectMonths:!0,selectYears:15})}document.getElementById("allow").checked=!1,document.getElementById("block").checked=!1,$(".ok-btn").off(),$(".ok-btn").on("click",function(o){if(void 0===$("input[name='rule-new-decision']:checked")[0])throw Error("INFORMATION MISSING: please specify an authorisation decision.");var n=t._getInfo(i),r=$("input[name='rule-new-decision']:checked")[0].id;r="allow"===r;var a=$(".scopes").find(":selected")[0].id,l=$(".scopes").find(":selected")[0].textContent;l="All identities and hyperties"===l?"global":l,t.policiesManager.setInfo(i,e,n,r,a,l),$(".rule-new").closeModal(),t._goHome()})}},{key:"_deleteInfo",value:function(e){var i=event.target.closest("tr").id,t=i.split(":"),o=t[0];t.shift();var n=t.join(""),r=event.target.closest("tr").children[0].id;this.policiesManager.deleteInfo(e,o,n,r),this._goHome()}},{key:"_setListeners",value:function(){var e=this;$(".settings-btn").on("click",function(e){parent.postMessage({body:{method:"showAdminPage"},to:"runtime:gui-manager"},"*"),$(".admin-page").removeClass("hide"),document.getElementsByTagName("body")[0].style="background-color:white;"}),$(".policies-page-show").on("click",function(i){$(".policies-section").removeClass("hide"),$(".identities-section").addClass("hide"),e._goHome(),e._manageGroups()}),$(".admin-page-exit").on("click",function(e){parent.postMessage({body:{method:"hideAdminPage"},to:"runtime:gui-manager"},"*"),$(".admin-page").addClass("hide"),document.getElementsByTagName("body")[0].style="background-color:transparent;"}),$(".exit-btn").on("click",function(e){$(".subscription-type").addClass("hide"),$(".help-menu").addClass("hide")}),$("#policy-file").on("change",function(i){var t=i.target.files[0],o=new FileReader;o.readAsText(t,"UTF-8"),o.onload=function(i){e._parseFileContent(i.target.result),e._goHome()},o.onerror=function(e){throw Error("Error reading the file")}})}},{key:"_showRule",value:function(e){var i=this,t=e.target.textContent,o=e.target.closest("tr").id,n=o.split(":"),r=n[n.length-1];n.pop();var a=n.join(":"),l=this.policiesManager.getRuleOfPolicy(a,r);if("subscription"===l.condition.attribute&&"preauthorised"===l.condition.params)$(".authorise-btns").addClass("hide");else{var s=void 0;s=l.decision?document.getElementById("btn-allow"):document.getElementById("btn-block"),s.checked=!0,$(".authorise-btns").removeClass("hide")}$(".member-add").addClass("hide"),$(".member-new-btn").addClass("hide"),$(".rule-details").openModal(),$(".rule-title").html("<h5><b>"+t+"</b></h5>"),"subscription"===l.condition.attribute&&$(".subscription-type").removeClass("hide"),$(".subscription-decision").on("click",function(e){i._updateRule(e,"subscription",a,l)}),$(".decision").off(),$(".decision").on("click",function(e){i._updateRule("authorisation",a,l)})}},{key:"_updateRule",value:function(e,i,t,o){var n=$(".rule-title").text(),r=n.split(" "),a=r.indexOf("is");switch(a===-1&&(a=r.indexOf("are")),i){case"authorisation":var l=$("input[name='rule-update-decision']:checked")[0].id;"btn-allow"===l?(r[a+1]="allowed",l=!0):(r[a+1]="blocked",l=!1),n=r.join(" "),$(".rule-title").html("<h5><b>"+n+"</b></h5>"),this.policiesManager.updatePolicy(t,o,l);break;case"subscription":var s=e.target.labels[0].textContent;r[a+1];r=n.split("hyperties are"),"All subscribers"===s?($(".authorise-btns").removeClass("hide"),l=o.decision,s="*",n="Subscriptions from all hyperties are"+r[1]):($(".authorise-btns").addClass("hide"),l=!0,s="preauthorised",n="Subscriptions from previously authorised hyperties are"+r[1]),$(".rule-title").html("<h5><b>"+n+"</b></h5>"),this.policiesManager.updatePolicy(t,o,l,s)}this._goHome()}}]),e}();t["default"]=s},{"./PoliciesManager":2}],2:[function(e,i,t){"use strict";function o(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,i){for(var t=0;t<i.length;t++){var o=i[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(i,t,o){return t&&e(i.prototype,t),o&&e(i,o),i}}(),r=function(){function e(i){o(this,e),this.policyEngine=i,this.policies=this.policyEngine.context.userPolicies,this.variables=this.setVariables(),this.addition=this.setAdditionMethods(),this.validation=this.setValidationMethods()}return n(e,[{key:"addToGroup",value:function(e,i){this.policyEngine.context.addToGroup(e,i)}},{key:"createGroup",value:function(e){this.policyEngine.context.createGroup(e)}},{key:"addPolicy",value:function(e,i,t){if(void 0===t)switch(i){case"Block overrides":i="blockOverrides";break;case"Allow overrides":i="allowOverrides";break;case"First applicable":i="firstApplicable";break;default:i=void 0}this.policyEngine.addPolicy("USER",e,t,i)}},{key:"decreaseRulePriority",value:function(e,i,t){this.getRuleOfPolicy(e,t).priority=i,this.getRuleOfPolicy(e,i).priority=t,this.policyEngine.context.savePolicies("USER")}},{key:"deleteGroup",value:function(e){this.policyEngine.context.deleteGroup(e)}},{key:"deletePolicy",value:function(e){this.policyEngine.removePolicy("USER",e)}},{key:"deleteRule",value:function(e,i){var t=this.policyEngine.context.userPolicies;t[e].deleteRule(i),this.policyEngine.context.savePolicies("USER")}},{key:"getActivePolicy",value:function(){return this.policyEngine.context.activeUserPolicy}},{key:"getPolicy",value:function(e){return this.policyEngine.context.userPolicies[e]}},{key:"getPoliciesTitles",value:function(){var e=this.policyEngine.context.userPolicies,i=[];for(var t in e)i.push(t);return i}},{key:"getTargets",value:function(e){var i=[];for(var t in this.policies[e])i.indexOf(t)===-1&&i.push(t);return i}},{key:"increaseRulePriority",value:function(e,i,t){this.getRuleOfPolicy(e,i).priority=t,this.getRuleOfPolicy(e,t).priority=i,this.policyEngine.context.savePolicies("USER")}},{key:"setVariables",value:function(){return{Date:{title:"<br><h5>Updating date related configurations</h5><p>Incoming communications in the introduced date will be allowed or blocked according to your configurations, which can be changed in the preferences page.</p><br>",description:"<p>Date:</p>",input:[["date",[]]]},Domain:{title:"<br><h5>Updating domain configurations</h5><p>Incoming communications from a user whose identity is from the introduced domain allowed or blocked according to your configurations, which can be changed in the preferences page.</p><br>",description:"<p>Domain:</p>",input:[["form",[]]]},"Group of users":{title:"<br><h5>Updating groups configurations</h5><p>Incoming communications from a user whose identity is in the introduced group will be allowed or blocked according to your configurations, which can be changed in the preferences page.</p><br>",description:"<p>Group name:</p>",input:[["select",["group","Select a group:"]]]},"Subscription preferences":{title:"<br><h5>Updating subscriptions configurations</h5><p>The acceptance of subscriptions to your hyperties will be allowed or blocked according to your configurations, which can be changed in the preferences page.</p><br>",input:[]},"Time of the day":{title:'<br><h5>Updating time configurations</h5><p>Incoming communications in the introduced timeslot will be blocked, but this can be changed in the preferences page.</p><p>Please introduce a new timeslot in the following format:</p><p class="center-align">&lt;START-HOUR&gt;:&lt;START-MINUTES&gt; to &lt;END-HOUR&gt;:&lt;END-MINUTES&gt;</p><br>',description:"<p>Timeslot:</p>",input:[["form",[]]]},Weekday:{title:"<br><h5>Updating weekday configurations</h5><p>Incoming communications in the introduced weekday will be allowed or blocked according to your configurations, which can be changed in the preferences page.</p><br>",description:"<p>Weekday:</p>",input:[["select",["weekday","Select a weekday:",["Saturday","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday"]]]]}}}},{key:"setAdditionMethods",value:function(){var e=this;return{Date:function(i){var t=i[0],o=e.policyEngine.context.userPolicies;o[t].createRule(i[4],{attribute:"date",operator:"equals",params:i[3]},i[1],i[2]),e.policyEngine.context.savePolicies("USER")},Domain:function(i){var t=i[0],o=e.policyEngine.context.userPolicies;o[t].createRule(i[4],{attribute:"domain",operator:"equals",params:i[3]},i[1],i[2]),e.policyEngine.context.savePolicies("USER")},"Group of users":function(i){var t=i[0],o=e.policyEngine.context.userPolicies;o[t].createRule(i[4],{attribute:"source",operator:"in",params:i[3]},i[1],i[2]),e.policyEngine.context.savePolicies("USER")},"Subscription preferences":function(i){var t=i[0],o=e.policyEngine.context.userPolicies,n="equals";"preauthorised"===i[3]&&(n="in"),o[t].createRule(i[4],{attribute:"subscription",operator:thisOperator,params:i[3]},i[1],i[2]),e.policyEngine.context.savePolicies("USER")},"Time of the day":function(i){var t=i[0],o=e.policyEngine.context.userPolicies;i[3]=i[3].split(" to ");var n=i[3][0].split(":");n=n.join("");var r=i[3][1].split(":");r=r.join(""),o[t].createRule(i[4],{attribute:"time",operator:"between",params:[n,r]},i[1],i[2]),e.policyEngine.context.savePolicies("USER")},Weekday:function(i){var t=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];i[3]=t.indexOf(i[3]);var o=i[0],n=e.policyEngine.context.userPolicies;n[o].createRule(i[4],{attribute:"weekday",operator:"equals",params:i[3]},i[1],i[2]),e.policyEngine.context.savePolicies("USER")}}}},{key:"setValidationMethods",value:function(){var e=this;return{Date:function(i,t){return e.isValidDate(t)&e.isValidScope(i)},"Group of users":function(i,t){return e.isValidString(t)&e.isValidScope(i)},Domain:function(i,t){return e.isValidDomain(t)&e.isValidScope(i)},Weekday:function(i,t){return!0&e.isValidScope(i)},"Subscription preferences":function(i,t){return e.isValidSubscriptionType(t)&e.isValidScope(i)},"Time of the day":function(i,t){return e.isValidTimeslot(t)&e.isValidScope(i)}}}},{key:"updateActivePolicy",value:function(e){this.policyEngine.context.activeUserPolicy=e,this.policyEngine.context.saveActivePolicy()}},{key:"isValidEmail",value:function(e){var i=/[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,3}$/;return i.test(e)}},{key:"isValidDomain",value:function(e){var i=/[a-z0-9.-]+\.[a-z]{2,3}$/;return i.test(e)}},{key:"isValidString",value:function(e){var i=/[a-z0-9.-]$/;return i.test(e)}},{key:"isValidSubscriptionType",value:function(e){return!0}},{key:"isValidDate",value:function(e){var i=e.split("/"),t=parseInt(i[0]),o=parseInt(i[1]),n=parseInt(i[2]),r=new Date(n,o-1,t),a=r.getFullYear()===n&&r.getMonth()+1===o&&r.getDate()===t,l=(r.getDate()+"/"+(r.getMonth()+1)+"/"+r.getFullYear(),new Date),s=(l.getDate()+"/"+(l.getMonth()+1)+"/"+l.getFullYear(),!1);return r.getFullYear()>l.getFullYear()?s=!0:r.getFullYear()==l.getFullYear()&&(r.getMonth()+1>l.getMonth()+1?s=!0:r.getMonth()+1==l.getMonth()+1&&r.getDate()>=l.getDate()&&(s=!0)),a&&s}},{key:"isValidScope",value:function(e){return""!==e}},{key:"isValidTimeslot",value:function(e){if(!e)return!1;var i=e.split(" to "),t=2===i.length;if(!t)return!1;var o=i[0].split(":"),n=i[1].split(":");if(2!==o.length||2!==n.length)return!1;var r=2===o[0].length&&2===o[1].length&&2===n[0].length&&2===n[1].length,a=o[0]==parseInt(o[0],10)&&o[1]==parseInt(o[1],10)&&n[0]==parseInt(n[0],10)&&n[1]==parseInt(n[1],10);return t&&r&&a}},{key:"getFormattedPolicies",value:function(){var e=this.policyEngine.context.userPolicies,i=[];for(var t in e){var o={title:e[t].key,rulesTitles:[],ids:[]};if(0!==e[t].rules.length){e[t].rules=e[t].sortRules();for(var n in e[t].rules){var r=this._getTitle(e[t].rules[n]);o.rulesTitles.push(r),o.ids.push(o.title+":"+e[t].rules[n].priority)}}i.push(o)}return i}},{key:"getRuleOfPolicy",value:function(e,i){var t=this.policyEngine.context.userPolicies,o=t[e];return o.getRuleByPriority(i)}},{key:"_getTitle",value:function(e){var i=e.condition,t=e.decision?"allowed":"blocked",o="global"===e.target?"All identities and hyperties":e.target,n=i.attribute;switch(n){case"date":return"Date "+i.params+" is "+t+" ("+o+")";case"domain":return'Domain "'+i.params+'" is '+t+" ("+o+")";case"source":if("in"===i.operator)return'Group "'+i.params+'" is '+t+" ("+o+")";if("equals"===i.operator)return"User "+i.params+" is "+t+" ("+o+")";case"subscription":if("*"===i.params)return"Subscriptions from all hyperties are "+t+" ("+o+")";if("preauthorised"===i.params)return"Subscriptions from previously authorised hyperties are allowed ("+o+")";case"time":var r=i.params[0][0]+i.params[0][1]+":"+i.params[0][2]+i.params[0][3],a=i.params[1][0]+i.params[1][1]+":"+i.params[1][2]+i.params[1][3];return"Timeslot from "+r+" to "+a+" is "+t+" ("+o+")";case"weekday":var l=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],s=i.params;return'Weekday "'+l[s]+'" is '+t+" ("+o+")";default:return"Rule "+e.priority+" is "+t+" ("+o+")"}}},{key:"getVariables",value:function(){var e=[];for(var i in this.variables)e.push(i);return e}},{key:"getVariableInfo",value:function(e){return this.variables[e]}},{key:"getMyEmails",value:function(){return this.policyEngine.context.getMyEmails()}},{key:"getMyHyperties",value:function(){return this.policyEngine.context.getMyHyperties()}},{key:"setInfo",value:function(e,i,t,o,n,r){if(!this.validation[e](n,t))throw Error("Invalid configuration");this.addition[e]([i,n,r,t,o])}},{key:"getInfo",value:function(e,i){var t=this.policies[e],o={};for(var n in t)t[n].condition===i&&(o=t[n]);if(o!=={}){var r=o.condition.split(" ");return this.policyEngine.getList(e,r[2])}throw Error("Policy <"+i+"> not found!")}},{key:"deleteInfo",value:function(e,i,t,o){var n=[i,t,o];if("member"===e){var r=o.split(" "),a=r[2];n=[i,a,o]}this.deletion[e](n)}},{key:"getGroup",value:function(e,i,t){return this.policyEngine.context.getGroup(e,i,t)}},{key:"getGroups",value:function(){var e=this.policyEngine.context.groups,i={groupsNames:[],members:[],ids:[]};for(var t in e){i.groupsNames.push(t),i.members.push(e[t]);var o=[];for(var n in e[t])o.push(t+"::"+e[t][n]);i.ids.push(o)}return i}},{key:"getGroupsNames",value:function(){return this.policyEngine.context.getGroupsNames()}},{key:"removeFromGroup",value:function(e,i){this.policyEngine.context.removeFromGroup(e,i)}},{key:"updatePolicy",value:function(e,i,t,o){var n=this.policyEngine.context.userPolicies;if(n[e].deleteRule(i),o){var r="*"===o?"equals":"in";n[e].createRule(t,[{attribute:"subscription",opeator:r,params:o}],i.scope,i.target,i.priority)}else n[e].createRule(t,i.condition,i.scope,i.target,i.priority);this.policyEngine.context.savePolicies("USER")}}]),e}();t["default"]=r},{}]},{},[1])(1)});
//# sourceMappingURL=policies-gui.js.map
