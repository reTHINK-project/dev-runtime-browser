<!DOCTYPE html>

<html>
<head>
  <title>Request.spec.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>Request.spec.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">import</span> { expect } <span class="hljs-keyword">from</span> <span class="hljs-string">'chai'</span>
<span class="hljs-keyword">import</span> Request <span class="hljs-keyword">from</span> <span class="hljs-string">'../src/Request'</span>

<span class="hljs-keyword">let</span> _method, _url, _body
<span class="hljs-keyword">let</span> xhr = {
	<span class="hljs-attr">open</span>: <span class="hljs-function">(<span class="hljs-params">m, u</span>) =&gt;</span> {
		_method = m
		_url = u
	},
	<span class="hljs-attr">setRequestHeader</span>: <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {},
	<span class="hljs-attr">send</span>: <span class="hljs-function">(<span class="hljs-params">body</span>) =&gt;</span> { _body = body; xhr.onreadystatechange({<span class="hljs-attr">currentTarget</span>: xhr}); }
}
<span class="hljs-built_in">window</span>.XMLHttpRequest = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> xhr</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Usage synopsis</p>
<pre><code>request.get(url, options).then(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> {
    <span class="hljs-comment">// response text in case succesfull response</span>
}).catch(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {
    <span class="hljs-comment">// error text in case failure response</span>
})
</code></pre><p>url: The URL of the resource which is being fetched.</p>
<p>options:</p>
<ul>
<li>body (String, body types) - HTTP request body</li>
<li>headers (key/value collection) - Key: header name, Value: header value</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>describe(<span class="hljs-string">'Request'</span>, () =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <h2 id="protocols-mapping">Protocols mapping</h2>
<p>Urls are mapped to valid protocols</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	describe(<span class="hljs-string">'mapping protocols'</span>, () =&gt; {
		<span class="hljs-keyword">const</span> protocols = {
			<span class="hljs-string">'localhost://test'</span>: <span class="hljs-string">'https://test'</span>,
			<span class="hljs-string">'undefined://test'</span>: <span class="hljs-string">'https://test'</span>,
			<span class="hljs-string">'hyperty-catalogue://test'</span>: <span class="hljs-string">'https://test'</span>,
			<span class="hljs-string">'https://test'</span>: <span class="hljs-string">'https://test'</span>,
			<span class="hljs-string">'http://test'</span>: <span class="hljs-string">'http://test'</span>
		};

		<span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> prop <span class="hljs-keyword">in</span> protocols) {
			it(<span class="hljs-string">`should map <span class="hljs-subst">${prop}</span> protocol to <span class="hljs-subst">${protocols[prop]}</span>`</span>, (done) =&gt; {
				<span class="hljs-keyword">let</span> request = <span class="hljs-keyword">new</span> Request()
				<span class="hljs-keyword">let</span> url =<span class="hljs-string">'http://test.com'</span>
				xhr.readyState = <span class="hljs-number">4</span>
				xhr.status = <span class="hljs-number">200</span>
				xhr.responseText = <span class="hljs-string">'res'</span>

				request.get(prop).then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
					expect(_url).to.be.equal(protocols[prop])
					done()
				})
			})
		}

		it(<span class="hljs-string">'should throw an exception if protocol is not found'</span>, (done) =&gt; {
			<span class="hljs-keyword">let</span> request = <span class="hljs-keyword">new</span> Request()
			<span class="hljs-keyword">let</span> url =<span class="hljs-string">'test.com'</span>

			request.get(url).catch(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
				done()
			})
		})
	})</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <h2 id="get-request">Get request</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>	describe(<span class="hljs-string">'get'</span>, () =&gt; {
		it(<span class="hljs-string">'should get a response from a valid url'</span>, (done) =&gt; {
			<span class="hljs-keyword">let</span> request = <span class="hljs-keyword">new</span> Request()
			<span class="hljs-keyword">let</span> url =<span class="hljs-string">'http://localhost:9999/'</span>
			xhr.readyState = <span class="hljs-number">4</span>
			xhr.status = <span class="hljs-number">200</span>
			xhr.responseText = <span class="hljs-string">'res'</span>

			request.get(url).then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> {
				expect(res).to.be.equal(res)
				done()
			}).catch(<span class="hljs-built_in">console</span>.log)
		})
	})</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <h2 id="post-request">Post request</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>	describe(<span class="hljs-string">'post'</span>, () =&gt; {
		it(<span class="hljs-string">'should send a post and receive a response'</span>, (done) =&gt; {
			<span class="hljs-keyword">let</span> request = <span class="hljs-keyword">new</span> Request()
			<span class="hljs-keyword">let</span> url =<span class="hljs-string">'http://localhost:9999/'</span>
			<span class="hljs-keyword">let</span> options = {
				<span class="hljs-attr">body</span>: <span class="hljs-built_in">JSON</span>.stringify({<span class="hljs-attr">payload</span>:<span class="hljs-string">'test'</span>}),
				<span class="hljs-attr">headers</span>: {<span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json;charset=UTF-8'</span>}
			}
			xhr.readyState = <span class="hljs-number">4</span>
			xhr.status = <span class="hljs-number">200</span>
			xhr.responseText = <span class="hljs-string">'res'</span>

			request.post(url, options).then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> {
				expect(_method).to.be.equal(<span class="hljs-string">'POST'</span>)
				expect(_body).to.be.equal(<span class="hljs-string">'{"payload":"test"}'</span>)
				expect(res).to.be.equal(res)
				done()
			}).catch(<span class="hljs-built_in">console</span>.log)
		})
	})
})</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
