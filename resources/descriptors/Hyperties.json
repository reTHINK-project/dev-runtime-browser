{
  "HelloHyperty": {
    "cguid": "1",
    "type": "0",
    "version": "0.1",
    "description": "description of Hello Hyperty",
    "objectName": "HelloHyperty",
    "sourcePackageURL": "/sourcePackage",
    "sourcePackage": {
      "sourceCode": "KGZ1bmN0aW9uKGYpe2lmKHR5cGVvZiBleHBvcnRzPT09Im9iamVjdCImJnR5cGVvZiBtb2R1bGUhPT0idW5kZWZpbmVkIil7bW9kdWxlLmV4cG9ydHM9ZigpfWVsc2UgaWYodHlwZW9mIGRlZmluZT09PSJmdW5jdGlvbiImJmRlZmluZS5hbWQpe2RlZmluZShbXSxmKX1lbHNle3ZhciBnO2lmKHR5cGVvZiB3aW5kb3chPT0idW5kZWZpbmVkIil7Zz13aW5kb3d9ZWxzZSBpZih0eXBlb2YgZ2xvYmFsIT09InVuZGVmaW5lZCIpe2c9Z2xvYmFsfWVsc2UgaWYodHlwZW9mIHNlbGYhPT0idW5kZWZpbmVkIil7Zz1zZWxmfWVsc2V7Zz10aGlzfWcuYWN0aXZhdGUgPSBmKCl9fSkoZnVuY3Rpb24oKXt2YXIgZGVmaW5lLG1vZHVsZSxleHBvcnRzO3JldHVybiAoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PSJmdW5jdGlvbiImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoIkNhbm5vdCBmaW5kIG1vZHVsZSAnIitvKyInIik7dGhyb3cgZi5jb2RlPSJNT0RVTEVfTk9UX0ZPVU5EIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PSJmdW5jdGlvbiImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pKHsxOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKLyoKQXV0aG9yOiBHZXJhaW50IEx1ZmYgYW5kIG90aGVycwpZZWFyOiAyMDEzCgpUaGlzIGNvZGUgaXMgcmVsZWFzZWQgaW50byB0aGUgInB1YmxpYyBkb21haW4iIGJ5IGl0cyBhdXRob3IocykuICBBbnlib2R5IG1heSB1c2UsIGFsdGVyIGFuZCBkaXN0cmlidXRlIHRoZSBjb2RlIHdpdGhvdXQgcmVzdHJpY3Rpb24uICBUaGUgYXV0aG9yIG1ha2VzIG5vIGd1YXJhbnRlZXMsIGFuZCB0YWtlcyBubyBsaWFiaWxpdHkgb2YgYW55IGtpbmQgZm9yIHVzZSBvZiB0aGlzIGNvZGUuCgpJZiB5b3UgZmluZCBhIGJ1ZyBvciBtYWtlIGFuIGltcHJvdmVtZW50LCBpdCB3b3VsZCBiZSBjb3VydGVvdXMgdG8gbGV0IHRoZSBhdXRob3Iga25vdywgYnV0IGl0IGlzIG5vdCBjb21wdWxzb3J5LgoqLwooZnVuY3Rpb24gKGdsb2JhbCwgZmFjdG9yeSkgewogIGlmICh0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpIHsKICAgIC8vIEFNRC4gUmVnaXN0ZXIgYXMgYW4gYW5vbnltb3VzIG1vZHVsZS4KICAgIGRlZmluZShbXSwgZmFjdG9yeSk7CiAgfSBlbHNlIGlmICh0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJyAmJiBtb2R1bGUuZXhwb3J0cyl7CiAgICAvLyBDb21tb25KUy4gRGVmaW5lIGV4cG9ydC4KICAgIG1vZHVsZS5leHBvcnRzID0gZmFjdG9yeSgpOwogIH0gZWxzZSB7CiAgICAvLyBCcm93c2VyIGdsb2JhbHMKICAgIGdsb2JhbC50djQgPSBmYWN0b3J5KCk7CiAgfQp9KHRoaXMsIGZ1bmN0aW9uICgpIHsKCi8vIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0phdmFTY3JpcHQvUmVmZXJlbmNlL0dsb2JhbF9PYmplY3RzL09iamVjdC9rZXlzP3JlZGlyZWN0bG9jYWxlPWVuLVVTJnJlZGlyZWN0c2x1Zz1KYXZhU2NyaXB0JTJGUmVmZXJlbmNlJTJGR2xvYmFsX09iamVjdHMlMkZPYmplY3QlMkZrZXlzCmlmICghT2JqZWN0LmtleXMpIHsKCU9iamVjdC5rZXlzID0gKGZ1bmN0aW9uICgpIHsKCQl2YXIgaGFzT3duUHJvcGVydHkgPSBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LAoJCQloYXNEb250RW51bUJ1ZyA9ICEoe3RvU3RyaW5nOiBudWxsfSkucHJvcGVydHlJc0VudW1lcmFibGUoJ3RvU3RyaW5nJyksCgkJCWRvbnRFbnVtcyA9IFsKCQkJCSd0b1N0cmluZycsCgkJCQkndG9Mb2NhbGVTdHJpbmcnLAoJCQkJJ3ZhbHVlT2YnLAoJCQkJJ2hhc093blByb3BlcnR5JywKCQkJCSdpc1Byb3RvdHlwZU9mJywKCQkJCSdwcm9wZXJ0eUlzRW51bWVyYWJsZScsCgkJCQknY29uc3RydWN0b3InCgkJCV0sCgkJCWRvbnRFbnVtc0xlbmd0aCA9IGRvbnRFbnVtcy5sZW5ndGg7CgoJCXJldHVybiBmdW5jdGlvbiAob2JqKSB7CgkJCWlmICh0eXBlb2Ygb2JqICE9PSAnb2JqZWN0JyAmJiB0eXBlb2Ygb2JqICE9PSAnZnVuY3Rpb24nIHx8IG9iaiA9PT0gbnVsbCkgewoJCQkJdGhyb3cgbmV3IFR5cGVFcnJvcignT2JqZWN0LmtleXMgY2FsbGVkIG9uIG5vbi1vYmplY3QnKTsKCQkJfQoKCQkJdmFyIHJlc3VsdCA9IFtdOwoKCQkJZm9yICh2YXIgcHJvcCBpbiBvYmopIHsKCQkJCWlmIChoYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwgcHJvcCkpIHsKCQkJCQlyZXN1bHQucHVzaChwcm9wKTsKCQkJCX0KCQkJfQoKCQkJaWYgKGhhc0RvbnRFbnVtQnVnKSB7CgkJCQlmb3IgKHZhciBpPTA7IGkgPCBkb250RW51bXNMZW5ndGg7IGkrKykgewoJCQkJCWlmIChoYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwgZG9udEVudW1zW2ldKSkgewoJCQkJCQlyZXN1bHQucHVzaChkb250RW51bXNbaV0pOwoJCQkJCX0KCQkJCX0KCQkJfQoJCQlyZXR1cm4gcmVzdWx0OwoJCX07Cgl9KSgpOwp9Ci8vIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0phdmFTY3JpcHQvUmVmZXJlbmNlL0dsb2JhbF9PYmplY3RzL09iamVjdC9jcmVhdGUKaWYgKCFPYmplY3QuY3JlYXRlKSB7CglPYmplY3QuY3JlYXRlID0gKGZ1bmN0aW9uKCl7CgkJZnVuY3Rpb24gRigpe30KCgkJcmV0dXJuIGZ1bmN0aW9uKG8pewoJCQlpZiAoYXJndW1lbnRzLmxlbmd0aCAhPT0gMSkgewoJCQkJdGhyb3cgbmV3IEVycm9yKCdPYmplY3QuY3JlYXRlIGltcGxlbWVudGF0aW9uIG9ubHkgYWNjZXB0cyBvbmUgcGFyYW1ldGVyLicpOwoJCQl9CgkJCUYucHJvdG90eXBlID0gbzsKCQkJcmV0dXJuIG5ldyBGKCk7CgkJfTsKCX0pKCk7Cn0KLy8gaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2UvR2xvYmFsX09iamVjdHMvQXJyYXkvaXNBcnJheT9yZWRpcmVjdGxvY2FsZT1lbi1VUyZyZWRpcmVjdHNsdWc9SmF2YVNjcmlwdCUyRlJlZmVyZW5jZSUyRkdsb2JhbF9PYmplY3RzJTJGQXJyYXklMkZpc0FycmF5CmlmKCFBcnJheS5pc0FycmF5KSB7CglBcnJheS5pc0FycmF5ID0gZnVuY3Rpb24gKHZBcmcpIHsKCQlyZXR1cm4gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHZBcmcpID09PSAiW29iamVjdCBBcnJheV0iOwoJfTsKfQovLyBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9KYXZhU2NyaXB0L1JlZmVyZW5jZS9HbG9iYWxfT2JqZWN0cy9BcnJheS9pbmRleE9mP3JlZGlyZWN0bG9jYWxlPWVuLVVTJnJlZGlyZWN0c2x1Zz1KYXZhU2NyaXB0JTJGUmVmZXJlbmNlJTJGR2xvYmFsX09iamVjdHMlMkZBcnJheSUyRmluZGV4T2YKaWYgKCFBcnJheS5wcm90b3R5cGUuaW5kZXhPZikgewoJQXJyYXkucHJvdG90eXBlLmluZGV4T2YgPSBmdW5jdGlvbiAoc2VhcmNoRWxlbWVudCAvKiwgZnJvbUluZGV4ICovICkgewoJCWlmICh0aGlzID09PSBudWxsKSB7CgkJCXRocm93IG5ldyBUeXBlRXJyb3IoKTsKCQl9CgkJdmFyIHQgPSBPYmplY3QodGhpcyk7CgkJdmFyIGxlbiA9IHQubGVuZ3RoID4+PiAwOwoKCQlpZiAobGVuID09PSAwKSB7CgkJCXJldHVybiAtMTsKCQl9CgkJdmFyIG4gPSAwOwoJCWlmIChhcmd1bWVudHMubGVuZ3RoID4gMSkgewoJCQluID0gTnVtYmVyKGFyZ3VtZW50c1sxXSk7CgkJCWlmIChuICE9PSBuKSB7IC8vIHNob3J0Y3V0IGZvciB2ZXJpZnlpbmcgaWYgaXQncyBOYU4KCQkJCW4gPSAwOwoJCQl9IGVsc2UgaWYgKG4gIT09IDAgJiYgbiAhPT0gSW5maW5pdHkgJiYgbiAhPT0gLUluZmluaXR5KSB7CgkJCQluID0gKG4gPiAwIHx8IC0xKSAqIE1hdGguZmxvb3IoTWF0aC5hYnMobikpOwoJCQl9CgkJfQoJCWlmIChuID49IGxlbikgewoJCQlyZXR1cm4gLTE7CgkJfQoJCXZhciBrID0gbiA+PSAwID8gbiA6IE1hdGgubWF4KGxlbiAtIE1hdGguYWJzKG4pLCAwKTsKCQlmb3IgKDsgayA8IGxlbjsgaysrKSB7CgkJCWlmIChrIGluIHQgJiYgdFtrXSA9PT0gc2VhcmNoRWxlbWVudCkgewoJCQkJcmV0dXJuIGs7CgkJCX0KCQl9CgkJcmV0dXJuIC0xOwoJfTsKfQoKLy8gR3J1bmdleSBPYmplY3QuaXNGcm96ZW4gaGFjawppZiAoIU9iamVjdC5pc0Zyb3plbikgewoJT2JqZWN0LmlzRnJvemVuID0gZnVuY3Rpb24gKG9iaikgewoJCXZhciBrZXkgPSAidHY0X3Rlc3RfZnJvemVuX2tleSI7CgkJd2hpbGUgKG9iai5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7CgkJCWtleSArPSBNYXRoLnJhbmRvbSgpOwoJCX0KCQl0cnkgewoJCQlvYmpba2V5XSA9IHRydWU7CgkJCWRlbGV0ZSBvYmpba2V5XTsKCQkJcmV0dXJuIGZhbHNlOwoJCX0gY2F0Y2ggKGUpIHsKCQkJcmV0dXJuIHRydWU7CgkJfQoJfTsKfQovLyBCYXNlZCBvbjogaHR0cHM6Ly9naXRodWIuY29tL2dlcmFpbnRsdWZmL3VyaS10ZW1wbGF0ZXMsIGJ1dCB3aXRoIGFsbCB0aGUgZGUtc3Vic3RpdHV0aW9uIHN0dWZmIHJlbW92ZWQKCnZhciB1cmlUZW1wbGF0ZUdsb2JhbE1vZGlmaWVycyA9IHsKCSIrIjogdHJ1ZSwKCSIjIjogdHJ1ZSwKCSIuIjogdHJ1ZSwKCSIvIjogdHJ1ZSwKCSI7IjogdHJ1ZSwKCSI/IjogdHJ1ZSwKCSImIjogdHJ1ZQp9Owp2YXIgdXJpVGVtcGxhdGVTdWZmaWNlcyA9IHsKCSIqIjogdHJ1ZQp9OwoKZnVuY3Rpb24gbm90UmVhbGx5UGVyY2VudEVuY29kZShzdHJpbmcpIHsKCXJldHVybiBlbmNvZGVVUkkoc3RyaW5nKS5yZXBsYWNlKC8lMjVbMC05XVswLTldL2csIGZ1bmN0aW9uIChkb3VibGVFbmNvZGVkKSB7CgkJcmV0dXJuICIlIiArIGRvdWJsZUVuY29kZWQuc3Vic3RyaW5nKDMpOwoJfSk7Cn0KCmZ1bmN0aW9uIHVyaVRlbXBsYXRlU3Vic3RpdHV0aW9uKHNwZWMpIHsKCXZhciBtb2RpZmllciA9ICIiOwoJaWYgKHVyaVRlbXBsYXRlR2xvYmFsTW9kaWZpZXJzW3NwZWMuY2hhckF0KDApXSkgewoJCW1vZGlmaWVyID0gc3BlYy5jaGFyQXQoMCk7CgkJc3BlYyA9IHNwZWMuc3Vic3RyaW5nKDEpOwoJfQoJdmFyIHNlcGFyYXRvciA9ICIiOwoJdmFyIHByZWZpeCA9ICIiOwoJdmFyIHNob3VsZEVzY2FwZSA9IHRydWU7Cgl2YXIgc2hvd1ZhcmlhYmxlcyA9IGZhbHNlOwoJdmFyIHRyaW1FbXB0eVN0cmluZyA9IGZhbHNlOwoJaWYgKG1vZGlmaWVyID09PSAnKycpIHsKCQlzaG91bGRFc2NhcGUgPSBmYWxzZTsKCX0gZWxzZSBpZiAobW9kaWZpZXIgPT09ICIuIikgewoJCXByZWZpeCA9ICIuIjsKCQlzZXBhcmF0b3IgPSAiLiI7Cgl9IGVsc2UgaWYgKG1vZGlmaWVyID09PSAiLyIpIHsKCQlwcmVmaXggPSAiLyI7CgkJc2VwYXJhdG9yID0gIi8iOwoJfSBlbHNlIGlmIChtb2RpZmllciA9PT0gJyMnKSB7CgkJcHJlZml4ID0gIiMiOwoJCXNob3VsZEVzY2FwZSA9IGZhbHNlOwoJfSBlbHNlIGlmIChtb2RpZmllciA9PT0gJzsnKSB7CgkJcHJlZml4ID0gIjsiOwoJCXNlcGFyYXRvciA9ICI7IjsKCQlzaG93VmFyaWFibGVzID0gdHJ1ZTsKCQl0cmltRW1wdHlTdHJpbmcgPSB0cnVlOwoJfSBlbHNlIGlmIChtb2RpZmllciA9PT0gJz8nKSB7CgkJcHJlZml4ID0gIj8iOwoJCXNlcGFyYXRvciA9ICImIjsKCQlzaG93VmFyaWFibGVzID0gdHJ1ZTsKCX0gZWxzZSBpZiAobW9kaWZpZXIgPT09ICcmJykgewoJCXByZWZpeCA9ICImIjsKCQlzZXBhcmF0b3IgPSAiJiI7CgkJc2hvd1ZhcmlhYmxlcyA9IHRydWU7Cgl9CgoJdmFyIHZhck5hbWVzID0gW107Cgl2YXIgdmFyTGlzdCA9IHNwZWMuc3BsaXQoIiwiKTsKCXZhciB2YXJTcGVjcyA9IFtdOwoJdmFyIHZhclNwZWNNYXAgPSB7fTsKCWZvciAodmFyIGkgPSAwOyBpIDwgdmFyTGlzdC5sZW5ndGg7IGkrKykgewoJCXZhciB2YXJOYW1lID0gdmFyTGlzdFtpXTsKCQl2YXIgdHJ1bmNhdGUgPSBudWxsOwoJCWlmICh2YXJOYW1lLmluZGV4T2YoIjoiKSAhPT0gLTEpIHsKCQkJdmFyIHBhcnRzID0gdmFyTmFtZS5zcGxpdCgiOiIpOwoJCQl2YXJOYW1lID0gcGFydHNbMF07CgkJCXRydW5jYXRlID0gcGFyc2VJbnQocGFydHNbMV0sIDEwKTsKCQl9CgkJdmFyIHN1ZmZpY2VzID0ge307CgkJd2hpbGUgKHVyaVRlbXBsYXRlU3VmZmljZXNbdmFyTmFtZS5jaGFyQXQodmFyTmFtZS5sZW5ndGggLSAxKV0pIHsKCQkJc3VmZmljZXNbdmFyTmFtZS5jaGFyQXQodmFyTmFtZS5sZW5ndGggLSAxKV0gPSB0cnVlOwoJCQl2YXJOYW1lID0gdmFyTmFtZS5zdWJzdHJpbmcoMCwgdmFyTmFtZS5sZW5ndGggLSAxKTsKCQl9CgkJdmFyIHZhclNwZWMgPSB7CgkJCXRydW5jYXRlOiB0cnVuY2F0ZSwKCQkJbmFtZTogdmFyTmFtZSwKCQkJc3VmZmljZXM6IHN1ZmZpY2VzCgkJfTsKCQl2YXJTcGVjcy5wdXNoKHZhclNwZWMpOwoJCXZhclNwZWNNYXBbdmFyTmFtZV0gPSB2YXJTcGVjOwoJCXZhck5hbWVzLnB1c2godmFyTmFtZSk7Cgl9Cgl2YXIgc3ViRnVuY3Rpb24gPSBmdW5jdGlvbiAodmFsdWVGdW5jdGlvbikgewoJCXZhciByZXN1bHQgPSAiIjsKCQl2YXIgc3RhcnRJbmRleCA9IDA7CgkJZm9yICh2YXIgaSA9IDA7IGkgPCB2YXJTcGVjcy5sZW5ndGg7IGkrKykgewoJCQl2YXIgdmFyU3BlYyA9IHZhclNwZWNzW2ldOwoJCQl2YXIgdmFsdWUgPSB2YWx1ZUZ1bmN0aW9uKHZhclNwZWMubmFtZSk7CgkJCWlmICh2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZSA9PT0gdW5kZWZpbmVkIHx8IChBcnJheS5pc0FycmF5KHZhbHVlKSAmJiB2YWx1ZS5sZW5ndGggPT09IDApIHx8ICh0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIE9iamVjdC5rZXlzKHZhbHVlKS5sZW5ndGggPT09IDApKSB7CgkJCQlzdGFydEluZGV4Kys7CgkJCQljb250aW51ZTsKCQkJfQoJCQlpZiAoaSA9PT0gc3RhcnRJbmRleCkgewoJCQkJcmVzdWx0ICs9IHByZWZpeDsKCQkJfSBlbHNlIHsKCQkJCXJlc3VsdCArPSAoc2VwYXJhdG9yIHx8ICIsIik7CgkJCX0KCQkJaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSB7CgkJCQlpZiAoc2hvd1ZhcmlhYmxlcykgewoJCQkJCXJlc3VsdCArPSB2YXJTcGVjLm5hbWUgKyAiPSI7CgkJCQl9CgkJCQlmb3IgKHZhciBqID0gMDsgaiA8IHZhbHVlLmxlbmd0aDsgaisrKSB7CgkJCQkJaWYgKGogPiAwKSB7CgkJCQkJCXJlc3VsdCArPSB2YXJTcGVjLnN1ZmZpY2VzWycqJ10gPyAoc2VwYXJhdG9yIHx8ICIsIikgOiAiLCI7CgkJCQkJCWlmICh2YXJTcGVjLnN1ZmZpY2VzWycqJ10gJiYgc2hvd1ZhcmlhYmxlcykgewoJCQkJCQkJcmVzdWx0ICs9IHZhclNwZWMubmFtZSArICI9IjsKCQkJCQkJfQoJCQkJCX0KCQkJCQlyZXN1bHQgKz0gc2hvdWxkRXNjYXBlID8gZW5jb2RlVVJJQ29tcG9uZW50KHZhbHVlW2pdKS5yZXBsYWNlKC8hL2csICIlMjEiKSA6IG5vdFJlYWxseVBlcmNlbnRFbmNvZGUodmFsdWVbal0pOwoJCQkJfQoJCQl9IGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gIm9iamVjdCIpIHsKCQkJCWlmIChzaG93VmFyaWFibGVzICYmICF2YXJTcGVjLnN1ZmZpY2VzWycqJ10pIHsKCQkJCQlyZXN1bHQgKz0gdmFyU3BlYy5uYW1lICsgIj0iOwoJCQkJfQoJCQkJdmFyIGZpcnN0ID0gdHJ1ZTsKCQkJCWZvciAodmFyIGtleSBpbiB2YWx1ZSkgewoJCQkJCWlmICghZmlyc3QpIHsKCQkJCQkJcmVzdWx0ICs9IHZhclNwZWMuc3VmZmljZXNbJyonXSA/IChzZXBhcmF0b3IgfHwgIiwiKSA6ICIsIjsKCQkJCQl9CgkJCQkJZmlyc3QgPSBmYWxzZTsKCQkJCQlyZXN1bHQgKz0gc2hvdWxkRXNjYXBlID8gZW5jb2RlVVJJQ29tcG9uZW50KGtleSkucmVwbGFjZSgvIS9nLCAiJTIxIikgOiBub3RSZWFsbHlQZXJjZW50RW5jb2RlKGtleSk7CgkJCQkJcmVzdWx0ICs9IHZhclNwZWMuc3VmZmljZXNbJyonXSA/ICc9JyA6ICIsIjsKCQkJCQlyZXN1bHQgKz0gc2hvdWxkRXNjYXBlID8gZW5jb2RlVVJJQ29tcG9uZW50KHZhbHVlW2tleV0pLnJlcGxhY2UoLyEvZywgIiUyMSIpIDogbm90UmVhbGx5UGVyY2VudEVuY29kZSh2YWx1ZVtrZXldKTsKCQkJCX0KCQkJfSBlbHNlIHsKCQkJCWlmIChzaG93VmFyaWFibGVzKSB7CgkJCQkJcmVzdWx0ICs9IHZhclNwZWMubmFtZTsKCQkJCQlpZiAoIXRyaW1FbXB0eVN0cmluZyB8fCB2YWx1ZSAhPT0gIiIpIHsKCQkJCQkJcmVzdWx0ICs9ICI9IjsKCQkJCQl9CgkJCQl9CgkJCQlpZiAodmFyU3BlYy50cnVuY2F0ZSAhPSBudWxsKSB7CgkJCQkJdmFsdWUgPSB2YWx1ZS5zdWJzdHJpbmcoMCwgdmFyU3BlYy50cnVuY2F0ZSk7CgkJCQl9CgkJCQlyZXN1bHQgKz0gc2hvdWxkRXNjYXBlID8gZW5jb2RlVVJJQ29tcG9uZW50KHZhbHVlKS5yZXBsYWNlKC8hL2csICIlMjEiKTogbm90UmVhbGx5UGVyY2VudEVuY29kZSh2YWx1ZSk7CgkJCX0KCQl9CgkJcmV0dXJuIHJlc3VsdDsKCX07CglzdWJGdW5jdGlvbi52YXJOYW1lcyA9IHZhck5hbWVzOwoJcmV0dXJuIHsKCQlwcmVmaXg6IHByZWZpeCwKCQlzdWJzdGl0dXRpb246IHN1YkZ1bmN0aW9uCgl9Owp9CgpmdW5jdGlvbiBVcmlUZW1wbGF0ZSh0ZW1wbGF0ZSkgewoJaWYgKCEodGhpcyBpbnN0YW5jZW9mIFVyaVRlbXBsYXRlKSkgewoJCXJldHVybiBuZXcgVXJpVGVtcGxhdGUodGVtcGxhdGUpOwoJfQoJdmFyIHBhcnRzID0gdGVtcGxhdGUuc3BsaXQoInsiKTsKCXZhciB0ZXh0UGFydHMgPSBbcGFydHMuc2hpZnQoKV07Cgl2YXIgcHJlZml4ZXMgPSBbXTsKCXZhciBzdWJzdGl0dXRpb25zID0gW107Cgl2YXIgdmFyTmFtZXMgPSBbXTsKCXdoaWxlIChwYXJ0cy5sZW5ndGggPiAwKSB7CgkJdmFyIHBhcnQgPSBwYXJ0cy5zaGlmdCgpOwoJCXZhciBzcGVjID0gcGFydC5zcGxpdCgifSIpWzBdOwoJCXZhciByZW1haW5kZXIgPSBwYXJ0LnN1YnN0cmluZyhzcGVjLmxlbmd0aCArIDEpOwoJCXZhciBmdW5jcyA9IHVyaVRlbXBsYXRlU3Vic3RpdHV0aW9uKHNwZWMpOwoJCXN1YnN0aXR1dGlvbnMucHVzaChmdW5jcy5zdWJzdGl0dXRpb24pOwoJCXByZWZpeGVzLnB1c2goZnVuY3MucHJlZml4KTsKCQl0ZXh0UGFydHMucHVzaChyZW1haW5kZXIpOwoJCXZhck5hbWVzID0gdmFyTmFtZXMuY29uY2F0KGZ1bmNzLnN1YnN0aXR1dGlvbi52YXJOYW1lcyk7Cgl9Cgl0aGlzLmZpbGwgPSBmdW5jdGlvbiAodmFsdWVGdW5jdGlvbikgewoJCXZhciByZXN1bHQgPSB0ZXh0UGFydHNbMF07CgkJZm9yICh2YXIgaSA9IDA7IGkgPCBzdWJzdGl0dXRpb25zLmxlbmd0aDsgaSsrKSB7CgkJCXZhciBzdWJzdGl0dXRpb24gPSBzdWJzdGl0dXRpb25zW2ldOwoJCQlyZXN1bHQgKz0gc3Vic3RpdHV0aW9uKHZhbHVlRnVuY3Rpb24pOwoJCQlyZXN1bHQgKz0gdGV4dFBhcnRzW2kgKyAxXTsKCQl9CgkJcmV0dXJuIHJlc3VsdDsKCX07Cgl0aGlzLnZhck5hbWVzID0gdmFyTmFtZXM7Cgl0aGlzLnRlbXBsYXRlID0gdGVtcGxhdGU7Cn0KVXJpVGVtcGxhdGUucHJvdG90eXBlID0gewoJdG9TdHJpbmc6IGZ1bmN0aW9uICgpIHsKCQlyZXR1cm4gdGhpcy50ZW1wbGF0ZTsKCX0sCglmaWxsRnJvbU9iamVjdDogZnVuY3Rpb24gKG9iaikgewoJCXJldHVybiB0aGlzLmZpbGwoZnVuY3Rpb24gKHZhck5hbWUpIHsKCQkJcmV0dXJuIG9ialt2YXJOYW1lXTsKCQl9KTsKCX0KfTsKdmFyIFZhbGlkYXRvckNvbnRleHQgPSBmdW5jdGlvbiBWYWxpZGF0b3JDb250ZXh0KHBhcmVudCwgY29sbGVjdE11bHRpcGxlLCBlcnJvclJlcG9ydGVyLCBjaGVja1JlY3Vyc2l2ZSwgdHJhY2tVbmtub3duUHJvcGVydGllcykgewoJdGhpcy5taXNzaW5nID0gW107Cgl0aGlzLm1pc3NpbmdNYXAgPSB7fTsKCXRoaXMuZm9ybWF0VmFsaWRhdG9ycyA9IHBhcmVudCA/IE9iamVjdC5jcmVhdGUocGFyZW50LmZvcm1hdFZhbGlkYXRvcnMpIDoge307Cgl0aGlzLnNjaGVtYXMgPSBwYXJlbnQgPyBPYmplY3QuY3JlYXRlKHBhcmVudC5zY2hlbWFzKSA6IHt9OwoJdGhpcy5jb2xsZWN0TXVsdGlwbGUgPSBjb2xsZWN0TXVsdGlwbGU7Cgl0aGlzLmVycm9ycyA9IFtdOwoJdGhpcy5oYW5kbGVFcnJvciA9IGNvbGxlY3RNdWx0aXBsZSA/IHRoaXMuY29sbGVjdEVycm9yIDogdGhpcy5yZXR1cm5FcnJvcjsKCWlmIChjaGVja1JlY3Vyc2l2ZSkgewoJCXRoaXMuY2hlY2tSZWN1cnNpdmUgPSB0cnVlOwoJCXRoaXMuc2Nhbm5lZCA9IFtdOwoJCXRoaXMuc2Nhbm5lZEZyb3plbiA9IFtdOwoJCXRoaXMuc2Nhbm5lZEZyb3plblNjaGVtYXMgPSBbXTsKCQl0aGlzLnNjYW5uZWRGcm96ZW5WYWxpZGF0aW9uRXJyb3JzID0gW107CgkJdGhpcy52YWxpZGF0ZWRTY2hlbWFzS2V5ID0gJ3R2NF92YWxpZGF0aW9uX2lkJzsKCQl0aGlzLnZhbGlkYXRpb25FcnJvcnNLZXkgPSAndHY0X3ZhbGlkYXRpb25fZXJyb3JzX2lkJzsKCX0KCWlmICh0cmFja1Vua25vd25Qcm9wZXJ0aWVzKSB7CgkJdGhpcy50cmFja1Vua25vd25Qcm9wZXJ0aWVzID0gdHJ1ZTsKCQl0aGlzLmtub3duUHJvcGVydHlQYXRocyA9IHt9OwoJCXRoaXMudW5rbm93blByb3BlcnR5UGF0aHMgPSB7fTsKCX0KCXRoaXMuZXJyb3JSZXBvcnRlciA9IGVycm9yUmVwb3J0ZXIgfHwgZGVmYXVsdEVycm9yUmVwb3J0ZXIoJ2VuJyk7CglpZiAodHlwZW9mIHRoaXMuZXJyb3JSZXBvcnRlciA9PT0gJ3N0cmluZycpIHsKCQl0aHJvdyBuZXcgRXJyb3IoJ2RlYnVnJyk7Cgl9Cgl0aGlzLmRlZmluZWRLZXl3b3JkcyA9IHt9OwoJaWYgKHBhcmVudCkgewoJCWZvciAodmFyIGtleSBpbiBwYXJlbnQuZGVmaW5lZEtleXdvcmRzKSB7CgkJCXRoaXMuZGVmaW5lZEtleXdvcmRzW2tleV0gPSBwYXJlbnQuZGVmaW5lZEtleXdvcmRzW2tleV0uc2xpY2UoMCk7CgkJfQoJfQp9OwpWYWxpZGF0b3JDb250ZXh0LnByb3RvdHlwZS5kZWZpbmVLZXl3b3JkID0gZnVuY3Rpb24gKGtleXdvcmQsIGtleXdvcmRGdW5jdGlvbikgewoJdGhpcy5kZWZpbmVkS2V5d29yZHNba2V5d29yZF0gPSB0aGlzLmRlZmluZWRLZXl3b3Jkc1trZXl3b3JkXSB8fCBbXTsKCXRoaXMuZGVmaW5lZEtleXdvcmRzW2tleXdvcmRdLnB1c2goa2V5d29yZEZ1bmN0aW9uKTsKfTsKVmFsaWRhdG9yQ29udGV4dC5wcm90b3R5cGUuY3JlYXRlRXJyb3IgPSBmdW5jdGlvbiAoY29kZSwgbWVzc2FnZVBhcmFtcywgZGF0YVBhdGgsIHNjaGVtYVBhdGgsIHN1YkVycm9ycywgZGF0YSwgc2NoZW1hKSB7Cgl2YXIgZXJyb3IgPSBuZXcgVmFsaWRhdGlvbkVycm9yKGNvZGUsIG1lc3NhZ2VQYXJhbXMsIGRhdGFQYXRoLCBzY2hlbWFQYXRoLCBzdWJFcnJvcnMpOwoJZXJyb3IubWVzc2FnZSA9IHRoaXMuZXJyb3JSZXBvcnRlcihlcnJvciwgZGF0YSwgc2NoZW1hKTsKCXJldHVybiBlcnJvcjsKfTsKVmFsaWRhdG9yQ29udGV4dC5wcm90b3R5cGUucmV0dXJuRXJyb3IgPSBmdW5jdGlvbiAoZXJyb3IpIHsKCXJldHVybiBlcnJvcjsKfTsKVmFsaWRhdG9yQ29udGV4dC5wcm90b3R5cGUuY29sbGVjdEVycm9yID0gZnVuY3Rpb24gKGVycm9yKSB7CglpZiAoZXJyb3IpIHsKCQl0aGlzLmVycm9ycy5wdXNoKGVycm9yKTsKCX0KCXJldHVybiBudWxsOwp9OwpWYWxpZGF0b3JDb250ZXh0LnByb3RvdHlwZS5wcmVmaXhFcnJvcnMgPSBmdW5jdGlvbiAoc3RhcnRJbmRleCwgZGF0YVBhdGgsIHNjaGVtYVBhdGgpIHsKCWZvciAodmFyIGkgPSBzdGFydEluZGV4OyBpIDwgdGhpcy5lcnJvcnMubGVuZ3RoOyBpKyspIHsKCQl0aGlzLmVycm9yc1tpXSA9IHRoaXMuZXJyb3JzW2ldLnByZWZpeFdpdGgoZGF0YVBhdGgsIHNjaGVtYVBhdGgpOwoJfQoJcmV0dXJuIHRoaXM7Cn07ClZhbGlkYXRvckNvbnRleHQucHJvdG90eXBlLmJhblVua25vd25Qcm9wZXJ0aWVzID0gZnVuY3Rpb24gKGRhdGEsIHNjaGVtYSkgewoJZm9yICh2YXIgdW5rbm93blBhdGggaW4gdGhpcy51bmtub3duUHJvcGVydHlQYXRocykgewoJCXZhciBlcnJvciA9IHRoaXMuY3JlYXRlRXJyb3IoRXJyb3JDb2Rlcy5VTktOT1dOX1BST1BFUlRZLCB7cGF0aDogdW5rbm93blBhdGh9LCB1bmtub3duUGF0aCwgIiIsIG51bGwsIGRhdGEsIHNjaGVtYSk7CgkJdmFyIHJlc3VsdCA9IHRoaXMuaGFuZGxlRXJyb3IoZXJyb3IpOwoJCWlmIChyZXN1bHQpIHsKCQkJcmV0dXJuIHJlc3VsdDsKCQl9Cgl9CglyZXR1cm4gbnVsbDsKfTsKClZhbGlkYXRvckNvbnRleHQucHJvdG90eXBlLmFkZEZvcm1hdCA9IGZ1bmN0aW9uIChmb3JtYXQsIHZhbGlkYXRvcikgewoJaWYgKHR5cGVvZiBmb3JtYXQgPT09ICdvYmplY3QnKSB7CgkJZm9yICh2YXIga2V5IGluIGZvcm1hdCkgewoJCQl0aGlzLmFkZEZvcm1hdChrZXksIGZvcm1hdFtrZXldKTsKCQl9CgkJcmV0dXJuIHRoaXM7Cgl9Cgl0aGlzLmZvcm1hdFZhbGlkYXRvcnNbZm9ybWF0XSA9IHZhbGlkYXRvcjsKfTsKVmFsaWRhdG9yQ29udGV4dC5wcm90b3R5cGUucmVzb2x2ZVJlZnMgPSBmdW5jdGlvbiAoc2NoZW1hLCB1cmxIaXN0b3J5KSB7CglpZiAoc2NoZW1hWyckcmVmJ10gIT09IHVuZGVmaW5lZCkgewoJCXVybEhpc3RvcnkgPSB1cmxIaXN0b3J5IHx8IHt9OwoJCWlmICh1cmxIaXN0b3J5W3NjaGVtYVsnJHJlZiddXSkgewoJCQlyZXR1cm4gdGhpcy5jcmVhdGVFcnJvcihFcnJvckNvZGVzLkNJUkNVTEFSX1JFRkVSRU5DRSwge3VybHM6IE9iamVjdC5rZXlzKHVybEhpc3RvcnkpLmpvaW4oJywgJyl9LCAnJywgJycsIG51bGwsIHVuZGVmaW5lZCwgc2NoZW1hKTsKCQl9CgkJdXJsSGlzdG9yeVtzY2hlbWFbJyRyZWYnXV0gPSB0cnVlOwoJCXNjaGVtYSA9IHRoaXMuZ2V0U2NoZW1hKHNjaGVtYVsnJHJlZiddLCB1cmxIaXN0b3J5KTsKCX0KCXJldHVybiBzY2hlbWE7Cn07ClZhbGlkYXRvckNvbnRleHQucHJvdG90eXBlLmdldFNjaGVtYSA9IGZ1bmN0aW9uICh1cmwsIHVybEhpc3RvcnkpIHsKCXZhciBzY2hlbWE7CglpZiAodGhpcy5zY2hlbWFzW3VybF0gIT09IHVuZGVmaW5lZCkgewoJCXNjaGVtYSA9IHRoaXMuc2NoZW1hc1t1cmxdOwoJCXJldHVybiB0aGlzLnJlc29sdmVSZWZzKHNjaGVtYSwgdXJsSGlzdG9yeSk7Cgl9Cgl2YXIgYmFzZVVybCA9IHVybDsKCXZhciBmcmFnbWVudCA9ICIiOwoJaWYgKHVybC5pbmRleE9mKCcjJykgIT09IC0xKSB7CgkJZnJhZ21lbnQgPSB1cmwuc3Vic3RyaW5nKHVybC5pbmRleE9mKCIjIikgKyAxKTsKCQliYXNlVXJsID0gdXJsLnN1YnN0cmluZygwLCB1cmwuaW5kZXhPZigiIyIpKTsKCX0KCWlmICh0eXBlb2YgdGhpcy5zY2hlbWFzW2Jhc2VVcmxdID09PSAnb2JqZWN0JykgewoJCXNjaGVtYSA9IHRoaXMuc2NoZW1hc1tiYXNlVXJsXTsKCQl2YXIgcG9pbnRlclBhdGggPSBkZWNvZGVVUklDb21wb25lbnQoZnJhZ21lbnQpOwoJCWlmIChwb2ludGVyUGF0aCA9PT0gIiIpIHsKCQkJcmV0dXJuIHRoaXMucmVzb2x2ZVJlZnMoc2NoZW1hLCB1cmxIaXN0b3J5KTsKCQl9IGVsc2UgaWYgKHBvaW50ZXJQYXRoLmNoYXJBdCgwKSAhPT0gIi8iKSB7CgkJCXJldHVybiB1bmRlZmluZWQ7CgkJfQoJCXZhciBwYXJ0cyA9IHBvaW50ZXJQYXRoLnNwbGl0KCIvIikuc2xpY2UoMSk7CgkJZm9yICh2YXIgaSA9IDA7IGkgPCBwYXJ0cy5sZW5ndGg7IGkrKykgewoJCQl2YXIgY29tcG9uZW50ID0gcGFydHNbaV0ucmVwbGFjZSgvfjEvZywgIi8iKS5yZXBsYWNlKC9+MC9nLCAifiIpOwoJCQlpZiAoc2NoZW1hW2NvbXBvbmVudF0gPT09IHVuZGVmaW5lZCkgewoJCQkJc2NoZW1hID0gdW5kZWZpbmVkOwoJCQkJYnJlYWs7CgkJCX0KCQkJc2NoZW1hID0gc2NoZW1hW2NvbXBvbmVudF07CgkJfQoJCWlmIChzY2hlbWEgIT09IHVuZGVmaW5lZCkgewoJCQlyZXR1cm4gdGhpcy5yZXNvbHZlUmVmcyhzY2hlbWEsIHVybEhpc3RvcnkpOwoJCX0KCX0KCWlmICh0aGlzLm1pc3NpbmdbYmFzZVVybF0gPT09IHVuZGVmaW5lZCkgewoJCXRoaXMubWlzc2luZy5wdXNoKGJhc2VVcmwpOwoJCXRoaXMubWlzc2luZ1tiYXNlVXJsXSA9IGJhc2VVcmw7CgkJdGhpcy5taXNzaW5nTWFwW2Jhc2VVcmxdID0gYmFzZVVybDsKCX0KfTsKVmFsaWRhdG9yQ29udGV4dC5wcm90b3R5cGUuc2VhcmNoU2NoZW1hcyA9IGZ1bmN0aW9uIChzY2hlbWEsIHVybCkgewoJaWYgKEFycmF5LmlzQXJyYXkoc2NoZW1hKSkgewoJCWZvciAodmFyIGkgPSAwOyBpIDwgc2NoZW1hLmxlbmd0aDsgaSsrKSB7CgkJCXRoaXMuc2VhcmNoU2NoZW1hcyhzY2hlbWFbaV0sIHVybCk7CgkJfQoJfSBlbHNlIGlmIChzY2hlbWEgJiYgdHlwZW9mIHNjaGVtYSA9PT0gIm9iamVjdCIpIHsKCQlpZiAodHlwZW9mIHNjaGVtYS5pZCA9PT0gInN0cmluZyIpIHsKCQkJaWYgKGlzVHJ1c3RlZFVybCh1cmwsIHNjaGVtYS5pZCkpIHsKCQkJCWlmICh0aGlzLnNjaGVtYXNbc2NoZW1hLmlkXSA9PT0gdW5kZWZpbmVkKSB7CgkJCQkJdGhpcy5zY2hlbWFzW3NjaGVtYS5pZF0gPSBzY2hlbWE7CgkJCQl9CgkJCX0KCQl9CgkJZm9yICh2YXIga2V5IGluIHNjaGVtYSkgewoJCQlpZiAoa2V5ICE9PSAiZW51bSIpIHsKCQkJCWlmICh0eXBlb2Ygc2NoZW1hW2tleV0gPT09ICJvYmplY3QiKSB7CgkJCQkJdGhpcy5zZWFyY2hTY2hlbWFzKHNjaGVtYVtrZXldLCB1cmwpOwoJCQkJfSBlbHNlIGlmIChrZXkgPT09ICIkcmVmIikgewoJCQkJCXZhciB1cmkgPSBnZXREb2N1bWVudFVyaShzY2hlbWFba2V5XSk7CgkJCQkJaWYgKHVyaSAmJiB0aGlzLnNjaGVtYXNbdXJpXSA9PT0gdW5kZWZpbmVkICYmIHRoaXMubWlzc2luZ01hcFt1cmldID09PSB1bmRlZmluZWQpIHsKCQkJCQkJdGhpcy5taXNzaW5nTWFwW3VyaV0gPSB1cmk7CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoJfQp9OwpWYWxpZGF0b3JDb250ZXh0LnByb3RvdHlwZS5hZGRTY2hlbWEgPSBmdW5jdGlvbiAodXJsLCBzY2hlbWEpIHsKCS8vb3ZlcmxvYWQKCWlmICh0eXBlb2YgdXJsICE9PSAnc3RyaW5nJyB8fCB0eXBlb2Ygc2NoZW1hID09PSAndW5kZWZpbmVkJykgewoJCWlmICh0eXBlb2YgdXJsID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgdXJsLmlkID09PSAnc3RyaW5nJykgewoJCQlzY2hlbWEgPSB1cmw7CgkJCXVybCA9IHNjaGVtYS5pZDsKCQl9CgkJZWxzZSB7CgkJCXJldHVybjsKCQl9Cgl9CglpZiAodXJsID09PSBnZXREb2N1bWVudFVyaSh1cmwpICsgIiMiKSB7CgkJLy8gUmVtb3ZlIGVtcHR5IGZyYWdtZW50CgkJdXJsID0gZ2V0RG9jdW1lbnRVcmkodXJsKTsKCX0KCXRoaXMuc2NoZW1hc1t1cmxdID0gc2NoZW1hOwoJZGVsZXRlIHRoaXMubWlzc2luZ01hcFt1cmxdOwoJbm9ybVNjaGVtYShzY2hlbWEsIHVybCk7Cgl0aGlzLnNlYXJjaFNjaGVtYXMoc2NoZW1hLCB1cmwpOwp9OwoKVmFsaWRhdG9yQ29udGV4dC5wcm90b3R5cGUuZ2V0U2NoZW1hTWFwID0gZnVuY3Rpb24gKCkgewoJdmFyIG1hcCA9IHt9OwoJZm9yICh2YXIga2V5IGluIHRoaXMuc2NoZW1hcykgewoJCW1hcFtrZXldID0gdGhpcy5zY2hlbWFzW2tleV07Cgl9CglyZXR1cm4gbWFwOwp9OwoKVmFsaWRhdG9yQ29udGV4dC5wcm90b3R5cGUuZ2V0U2NoZW1hVXJpcyA9IGZ1bmN0aW9uIChmaWx0ZXJSZWdFeHApIHsKCXZhciBsaXN0ID0gW107Cglmb3IgKHZhciBrZXkgaW4gdGhpcy5zY2hlbWFzKSB7CgkJaWYgKCFmaWx0ZXJSZWdFeHAgfHwgZmlsdGVyUmVnRXhwLnRlc3Qoa2V5KSkgewoJCQlsaXN0LnB1c2goa2V5KTsKCQl9Cgl9CglyZXR1cm4gbGlzdDsKfTsKClZhbGlkYXRvckNvbnRleHQucHJvdG90eXBlLmdldE1pc3NpbmdVcmlzID0gZnVuY3Rpb24gKGZpbHRlclJlZ0V4cCkgewoJdmFyIGxpc3QgPSBbXTsKCWZvciAodmFyIGtleSBpbiB0aGlzLm1pc3NpbmdNYXApIHsKCQlpZiAoIWZpbHRlclJlZ0V4cCB8fCBmaWx0ZXJSZWdFeHAudGVzdChrZXkpKSB7CgkJCWxpc3QucHVzaChrZXkpOwoJCX0KCX0KCXJldHVybiBsaXN0Owp9OwoKVmFsaWRhdG9yQ29udGV4dC5wcm90b3R5cGUuZHJvcFNjaGVtYXMgPSBmdW5jdGlvbiAoKSB7Cgl0aGlzLnNjaGVtYXMgPSB7fTsKCXRoaXMucmVzZXQoKTsKfTsKVmFsaWRhdG9yQ29udGV4dC5wcm90b3R5cGUucmVzZXQgPSBmdW5jdGlvbiAoKSB7Cgl0aGlzLm1pc3NpbmcgPSBbXTsKCXRoaXMubWlzc2luZ01hcCA9IHt9OwoJdGhpcy5lcnJvcnMgPSBbXTsKfTsKClZhbGlkYXRvckNvbnRleHQucHJvdG90eXBlLnZhbGlkYXRlQWxsID0gZnVuY3Rpb24gKGRhdGEsIHNjaGVtYSwgZGF0YVBhdGhQYXJ0cywgc2NoZW1hUGF0aFBhcnRzLCBkYXRhUG9pbnRlclBhdGgpIHsKCXZhciB0b3BMZXZlbDsKCXNjaGVtYSA9IHRoaXMucmVzb2x2ZVJlZnMoc2NoZW1hKTsKCWlmICghc2NoZW1hKSB7CgkJcmV0dXJuIG51bGw7Cgl9IGVsc2UgaWYgKHNjaGVtYSBpbnN0YW5jZW9mIFZhbGlkYXRpb25FcnJvcikgewoJCXRoaXMuZXJyb3JzLnB1c2goc2NoZW1hKTsKCQlyZXR1cm4gc2NoZW1hOwoJfQoKCXZhciBzdGFydEVycm9yQ291bnQgPSB0aGlzLmVycm9ycy5sZW5ndGg7Cgl2YXIgZnJvemVuSW5kZXgsIHNjYW5uZWRGcm96ZW5TY2hlbWFJbmRleCA9IG51bGwsIHNjYW5uZWRTY2hlbWFzSW5kZXggPSBudWxsOwoJaWYgKHRoaXMuY2hlY2tSZWN1cnNpdmUgJiYgZGF0YSAmJiB0eXBlb2YgZGF0YSA9PT0gJ29iamVjdCcpIHsKCQl0b3BMZXZlbCA9ICF0aGlzLnNjYW5uZWQubGVuZ3RoOwoJCWlmIChkYXRhW3RoaXMudmFsaWRhdGVkU2NoZW1hc0tleV0pIHsKCQkJdmFyIHNjaGVtYUluZGV4ID0gZGF0YVt0aGlzLnZhbGlkYXRlZFNjaGVtYXNLZXldLmluZGV4T2Yoc2NoZW1hKTsKCQkJaWYgKHNjaGVtYUluZGV4ICE9PSAtMSkgewoJCQkJdGhpcy5lcnJvcnMgPSB0aGlzLmVycm9ycy5jb25jYXQoZGF0YVt0aGlzLnZhbGlkYXRpb25FcnJvcnNLZXldW3NjaGVtYUluZGV4XSk7CgkJCQlyZXR1cm4gbnVsbDsKCQkJfQoJCX0KCQlpZiAoT2JqZWN0LmlzRnJvemVuKGRhdGEpKSB7CgkJCWZyb3plbkluZGV4ID0gdGhpcy5zY2FubmVkRnJvemVuLmluZGV4T2YoZGF0YSk7CgkJCWlmIChmcm96ZW5JbmRleCAhPT0gLTEpIHsKCQkJCXZhciBmcm96ZW5TY2hlbWFJbmRleCA9IHRoaXMuc2Nhbm5lZEZyb3plblNjaGVtYXNbZnJvemVuSW5kZXhdLmluZGV4T2Yoc2NoZW1hKTsKCQkJCWlmIChmcm96ZW5TY2hlbWFJbmRleCAhPT0gLTEpIHsKCQkJCQl0aGlzLmVycm9ycyA9IHRoaXMuZXJyb3JzLmNvbmNhdCh0aGlzLnNjYW5uZWRGcm96ZW5WYWxpZGF0aW9uRXJyb3JzW2Zyb3plbkluZGV4XVtmcm96ZW5TY2hlbWFJbmRleF0pOwoJCQkJCXJldHVybiBudWxsOwoJCQkJfQoJCQl9CgkJfQoJCXRoaXMuc2Nhbm5lZC5wdXNoKGRhdGEpOwoJCWlmIChPYmplY3QuaXNGcm96ZW4oZGF0YSkpIHsKCQkJaWYgKGZyb3plbkluZGV4ID09PSAtMSkgewoJCQkJZnJvemVuSW5kZXggPSB0aGlzLnNjYW5uZWRGcm96ZW4ubGVuZ3RoOwoJCQkJdGhpcy5zY2FubmVkRnJvemVuLnB1c2goZGF0YSk7CgkJCQl0aGlzLnNjYW5uZWRGcm96ZW5TY2hlbWFzLnB1c2goW10pOwoJCQl9CgkJCXNjYW5uZWRGcm96ZW5TY2hlbWFJbmRleCA9IHRoaXMuc2Nhbm5lZEZyb3plblNjaGVtYXNbZnJvemVuSW5kZXhdLmxlbmd0aDsKCQkJdGhpcy5zY2FubmVkRnJvemVuU2NoZW1hc1tmcm96ZW5JbmRleF1bc2Nhbm5lZEZyb3plblNjaGVtYUluZGV4XSA9IHNjaGVtYTsKCQkJdGhpcy5zY2FubmVkRnJvemVuVmFsaWRhdGlvbkVycm9yc1tmcm96ZW5JbmRleF1bc2Nhbm5lZEZyb3plblNjaGVtYUluZGV4XSA9IFtdOwoJCX0gZWxzZSB7CgkJCWlmICghZGF0YVt0aGlzLnZhbGlkYXRlZFNjaGVtYXNLZXldKSB7CgkJCQl0cnkgewoJCQkJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShkYXRhLCB0aGlzLnZhbGlkYXRlZFNjaGVtYXNLZXksIHsKCQkJCQkJdmFsdWU6IFtdLAoJCQkJCQljb25maWd1cmFibGU6IHRydWUKCQkJCQl9KTsKCQkJCQlPYmplY3QuZGVmaW5lUHJvcGVydHkoZGF0YSwgdGhpcy52YWxpZGF0aW9uRXJyb3JzS2V5LCB7CgkJCQkJCXZhbHVlOiBbXSwKCQkJCQkJY29uZmlndXJhYmxlOiB0cnVlCgkJCQkJfSk7CgkJCQl9IGNhdGNoIChlKSB7CgkJCQkJLy9JRSA3Lzggd29ya2Fyb3VuZAoJCQkJCWRhdGFbdGhpcy52YWxpZGF0ZWRTY2hlbWFzS2V5XSA9IFtdOwoJCQkJCWRhdGFbdGhpcy52YWxpZGF0aW9uRXJyb3JzS2V5XSA9IFtdOwoJCQkJfQoJCQl9CgkJCXNjYW5uZWRTY2hlbWFzSW5kZXggPSBkYXRhW3RoaXMudmFsaWRhdGVkU2NoZW1hc0tleV0ubGVuZ3RoOwoJCQlkYXRhW3RoaXMudmFsaWRhdGVkU2NoZW1hc0tleV1bc2Nhbm5lZFNjaGVtYXNJbmRleF0gPSBzY2hlbWE7CgkJCWRhdGFbdGhpcy52YWxpZGF0aW9uRXJyb3JzS2V5XVtzY2FubmVkU2NoZW1hc0luZGV4XSA9IFtdOwoJCX0KCX0KCgl2YXIgZXJyb3JDb3VudCA9IHRoaXMuZXJyb3JzLmxlbmd0aDsKCXZhciBlcnJvciA9IHRoaXMudmFsaWRhdGVCYXNpYyhkYXRhLCBzY2hlbWEsIGRhdGFQb2ludGVyUGF0aCkKCQl8fCB0aGlzLnZhbGlkYXRlTnVtZXJpYyhkYXRhLCBzY2hlbWEsIGRhdGFQb2ludGVyUGF0aCkKCQl8fCB0aGlzLnZhbGlkYXRlU3RyaW5nKGRhdGEsIHNjaGVtYSwgZGF0YVBvaW50ZXJQYXRoKQoJCXx8IHRoaXMudmFsaWRhdGVBcnJheShkYXRhLCBzY2hlbWEsIGRhdGFQb2ludGVyUGF0aCkKCQl8fCB0aGlzLnZhbGlkYXRlT2JqZWN0KGRhdGEsIHNjaGVtYSwgZGF0YVBvaW50ZXJQYXRoKQoJCXx8IHRoaXMudmFsaWRhdGVDb21iaW5hdGlvbnMoZGF0YSwgc2NoZW1hLCBkYXRhUG9pbnRlclBhdGgpCgkJfHwgdGhpcy52YWxpZGF0ZUh5cGVybWVkaWEoZGF0YSwgc2NoZW1hLCBkYXRhUG9pbnRlclBhdGgpCgkJfHwgdGhpcy52YWxpZGF0ZUZvcm1hdChkYXRhLCBzY2hlbWEsIGRhdGFQb2ludGVyUGF0aCkKCQl8fCB0aGlzLnZhbGlkYXRlRGVmaW5lZEtleXdvcmRzKGRhdGEsIHNjaGVtYSwgZGF0YVBvaW50ZXJQYXRoKQoJCXx8IG51bGw7CgoJaWYgKHRvcExldmVsKSB7CgkJd2hpbGUgKHRoaXMuc2Nhbm5lZC5sZW5ndGgpIHsKCQkJdmFyIGl0ZW0gPSB0aGlzLnNjYW5uZWQucG9wKCk7CgkJCWRlbGV0ZSBpdGVtW3RoaXMudmFsaWRhdGVkU2NoZW1hc0tleV07CgkJfQoJCXRoaXMuc2Nhbm5lZEZyb3plbiA9IFtdOwoJCXRoaXMuc2Nhbm5lZEZyb3plblNjaGVtYXMgPSBbXTsKCX0KCglpZiAoZXJyb3IgfHwgZXJyb3JDb3VudCAhPT0gdGhpcy5lcnJvcnMubGVuZ3RoKSB7CgkJd2hpbGUgKChkYXRhUGF0aFBhcnRzICYmIGRhdGFQYXRoUGFydHMubGVuZ3RoKSB8fCAoc2NoZW1hUGF0aFBhcnRzICYmIHNjaGVtYVBhdGhQYXJ0cy5sZW5ndGgpKSB7CgkJCXZhciBkYXRhUGFydCA9IChkYXRhUGF0aFBhcnRzICYmIGRhdGFQYXRoUGFydHMubGVuZ3RoKSA/ICIiICsgZGF0YVBhdGhQYXJ0cy5wb3AoKSA6IG51bGw7CgkJCXZhciBzY2hlbWFQYXJ0ID0gKHNjaGVtYVBhdGhQYXJ0cyAmJiBzY2hlbWFQYXRoUGFydHMubGVuZ3RoKSA/ICIiICsgc2NoZW1hUGF0aFBhcnRzLnBvcCgpIDogbnVsbDsKCQkJaWYgKGVycm9yKSB7CgkJCQllcnJvciA9IGVycm9yLnByZWZpeFdpdGgoZGF0YVBhcnQsIHNjaGVtYVBhcnQpOwoJCQl9CgkJCXRoaXMucHJlZml4RXJyb3JzKGVycm9yQ291bnQsIGRhdGFQYXJ0LCBzY2hlbWFQYXJ0KTsKCQl9Cgl9CgoJaWYgKHNjYW5uZWRGcm96ZW5TY2hlbWFJbmRleCAhPT0gbnVsbCkgewoJCXRoaXMuc2Nhbm5lZEZyb3plblZhbGlkYXRpb25FcnJvcnNbZnJvemVuSW5kZXhdW3NjYW5uZWRGcm96ZW5TY2hlbWFJbmRleF0gPSB0aGlzLmVycm9ycy5zbGljZShzdGFydEVycm9yQ291bnQpOwoJfSBlbHNlIGlmIChzY2FubmVkU2NoZW1hc0luZGV4ICE9PSBudWxsKSB7CgkJZGF0YVt0aGlzLnZhbGlkYXRpb25FcnJvcnNLZXldW3NjYW5uZWRTY2hlbWFzSW5kZXhdID0gdGhpcy5lcnJvcnMuc2xpY2Uoc3RhcnRFcnJvckNvdW50KTsKCX0KCglyZXR1cm4gdGhpcy5oYW5kbGVFcnJvcihlcnJvcik7Cn07ClZhbGlkYXRvckNvbnRleHQucHJvdG90eXBlLnZhbGlkYXRlRm9ybWF0ID0gZnVuY3Rpb24gKGRhdGEsIHNjaGVtYSkgewoJaWYgKHR5cGVvZiBzY2hlbWEuZm9ybWF0ICE9PSAnc3RyaW5nJyB8fCAhdGhpcy5mb3JtYXRWYWxpZGF0b3JzW3NjaGVtYS5mb3JtYXRdKSB7CgkJcmV0dXJuIG51bGw7Cgl9Cgl2YXIgZXJyb3JNZXNzYWdlID0gdGhpcy5mb3JtYXRWYWxpZGF0b3JzW3NjaGVtYS5mb3JtYXRdLmNhbGwobnVsbCwgZGF0YSwgc2NoZW1hKTsKCWlmICh0eXBlb2YgZXJyb3JNZXNzYWdlID09PSAnc3RyaW5nJyB8fCB0eXBlb2YgZXJyb3JNZXNzYWdlID09PSAnbnVtYmVyJykgewoJCXJldHVybiB0aGlzLmNyZWF0ZUVycm9yKEVycm9yQ29kZXMuRk9STUFUX0NVU1RPTSwge21lc3NhZ2U6IGVycm9yTWVzc2FnZX0sICcnLCAnL2Zvcm1hdCcsIG51bGwsIGRhdGEsIHNjaGVtYSk7Cgl9IGVsc2UgaWYgKGVycm9yTWVzc2FnZSAmJiB0eXBlb2YgZXJyb3JNZXNzYWdlID09PSAnb2JqZWN0JykgewoJCXJldHVybiB0aGlzLmNyZWF0ZUVycm9yKEVycm9yQ29kZXMuRk9STUFUX0NVU1RPTSwge21lc3NhZ2U6IGVycm9yTWVzc2FnZS5tZXNzYWdlIHx8ICI/In0sIGVycm9yTWVzc2FnZS5kYXRhUGF0aCB8fCAnJywgZXJyb3JNZXNzYWdlLnNjaGVtYVBhdGggfHwgIi9mb3JtYXQiLCBudWxsLCBkYXRhLCBzY2hlbWEpOwoJfQoJcmV0dXJuIG51bGw7Cn07ClZhbGlkYXRvckNvbnRleHQucHJvdG90eXBlLnZhbGlkYXRlRGVmaW5lZEtleXdvcmRzID0gZnVuY3Rpb24gKGRhdGEsIHNjaGVtYSwgZGF0YVBvaW50ZXJQYXRoKSB7Cglmb3IgKHZhciBrZXkgaW4gdGhpcy5kZWZpbmVkS2V5d29yZHMpIHsKCQlpZiAodHlwZW9mIHNjaGVtYVtrZXldID09PSAndW5kZWZpbmVkJykgewoJCQljb250aW51ZTsKCQl9CgkJdmFyIHZhbGlkYXRpb25GdW5jdGlvbnMgPSB0aGlzLmRlZmluZWRLZXl3b3Jkc1trZXldOwoJCWZvciAodmFyIGkgPSAwOyBpIDwgdmFsaWRhdGlvbkZ1bmN0aW9ucy5sZW5ndGg7IGkrKykgewoJCQl2YXIgZnVuYyA9IHZhbGlkYXRpb25GdW5jdGlvbnNbaV07CgkJCXZhciByZXN1bHQgPSBmdW5jKGRhdGEsIHNjaGVtYVtrZXldLCBzY2hlbWEsIGRhdGFQb2ludGVyUGF0aCk7CgkJCWlmICh0eXBlb2YgcmVzdWx0ID09PSAnc3RyaW5nJyB8fCB0eXBlb2YgcmVzdWx0ID09PSAnbnVtYmVyJykgewoJCQkJcmV0dXJuIHRoaXMuY3JlYXRlRXJyb3IoRXJyb3JDb2Rlcy5LRVlXT1JEX0NVU1RPTSwge2tleToga2V5LCBtZXNzYWdlOiByZXN1bHR9LCAnJywgJycsIG51bGwsIGRhdGEsIHNjaGVtYSkucHJlZml4V2l0aChudWxsLCBrZXkpOwoJCQl9IGVsc2UgaWYgKHJlc3VsdCAmJiB0eXBlb2YgcmVzdWx0ID09PSAnb2JqZWN0JykgewoJCQkJdmFyIGNvZGUgPSByZXN1bHQuY29kZTsKCQkJCWlmICh0eXBlb2YgY29kZSA9PT0gJ3N0cmluZycpIHsKCQkJCQlpZiAoIUVycm9yQ29kZXNbY29kZV0pIHsKCQkJCQkJdGhyb3cgbmV3IEVycm9yKCdVbmRlZmluZWQgZXJyb3IgY29kZSAodXNlIGRlZmluZUVycm9yKTogJyArIGNvZGUpOwoJCQkJCX0KCQkJCQljb2RlID0gRXJyb3JDb2Rlc1tjb2RlXTsKCQkJCX0gZWxzZSBpZiAodHlwZW9mIGNvZGUgIT09ICdudW1iZXInKSB7CgkJCQkJY29kZSA9IEVycm9yQ29kZXMuS0VZV09SRF9DVVNUT007CgkJCQl9CgkJCQl2YXIgbWVzc2FnZVBhcmFtcyA9ICh0eXBlb2YgcmVzdWx0Lm1lc3NhZ2UgPT09ICdvYmplY3QnKSA/IHJlc3VsdC5tZXNzYWdlIDoge2tleToga2V5LCBtZXNzYWdlOiByZXN1bHQubWVzc2FnZSB8fCAiPyJ9OwoJCQkJdmFyIHNjaGVtYVBhdGggPSByZXN1bHQuc2NoZW1hUGF0aCB8fCAoIi8iICsga2V5LnJlcGxhY2UoL34vZywgJ34wJykucmVwbGFjZSgvXC8vZywgJ34xJykpOwoJCQkJcmV0dXJuIHRoaXMuY3JlYXRlRXJyb3IoY29kZSwgbWVzc2FnZVBhcmFtcywgcmVzdWx0LmRhdGFQYXRoIHx8IG51bGwsIHNjaGVtYVBhdGgsIG51bGwsIGRhdGEsIHNjaGVtYSk7CgkJCX0KCQl9Cgl9CglyZXR1cm4gbnVsbDsKfTsKCmZ1bmN0aW9uIHJlY3Vyc2l2ZUNvbXBhcmUoQSwgQikgewoJaWYgKEEgPT09IEIpIHsKCQlyZXR1cm4gdHJ1ZTsKCX0KCWlmIChBICYmIEIgJiYgdHlwZW9mIEEgPT09ICJvYmplY3QiICYmIHR5cGVvZiBCID09PSAib2JqZWN0IikgewoJCWlmIChBcnJheS5pc0FycmF5KEEpICE9PSBBcnJheS5pc0FycmF5KEIpKSB7CgkJCXJldHVybiBmYWxzZTsKCQl9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkoQSkpIHsKCQkJaWYgKEEubGVuZ3RoICE9PSBCLmxlbmd0aCkgewoJCQkJcmV0dXJuIGZhbHNlOwoJCQl9CgkJCWZvciAodmFyIGkgPSAwOyBpIDwgQS5sZW5ndGg7IGkrKykgewoJCQkJaWYgKCFyZWN1cnNpdmVDb21wYXJlKEFbaV0sIEJbaV0pKSB7CgkJCQkJcmV0dXJuIGZhbHNlOwoJCQkJfQoJCQl9CgkJfSBlbHNlIHsKCQkJdmFyIGtleTsKCQkJZm9yIChrZXkgaW4gQSkgewoJCQkJaWYgKEJba2V5XSA9PT0gdW5kZWZpbmVkICYmIEFba2V5XSAhPT0gdW5kZWZpbmVkKSB7CgkJCQkJcmV0dXJuIGZhbHNlOwoJCQkJfQoJCQl9CgkJCWZvciAoa2V5IGluIEIpIHsKCQkJCWlmIChBW2tleV0gPT09IHVuZGVmaW5lZCAmJiBCW2tleV0gIT09IHVuZGVmaW5lZCkgewoJCQkJCXJldHVybiBmYWxzZTsKCQkJCX0KCQkJfQoJCQlmb3IgKGtleSBpbiBBKSB7CgkJCQlpZiAoIXJlY3Vyc2l2ZUNvbXBhcmUoQVtrZXldLCBCW2tleV0pKSB7CgkJCQkJcmV0dXJuIGZhbHNlOwoJCQkJfQoJCQl9CgkJfQoJCXJldHVybiB0cnVlOwoJfQoJcmV0dXJuIGZhbHNlOwp9CgpWYWxpZGF0b3JDb250ZXh0LnByb3RvdHlwZS52YWxpZGF0ZUJhc2ljID0gZnVuY3Rpb24gdmFsaWRhdGVCYXNpYyhkYXRhLCBzY2hlbWEsIGRhdGFQb2ludGVyUGF0aCkgewoJdmFyIGVycm9yOwoJaWYgKGVycm9yID0gdGhpcy52YWxpZGF0ZVR5cGUoZGF0YSwgc2NoZW1hLCBkYXRhUG9pbnRlclBhdGgpKSB7CgkJcmV0dXJuIGVycm9yLnByZWZpeFdpdGgobnVsbCwgInR5cGUiKTsKCX0KCWlmIChlcnJvciA9IHRoaXMudmFsaWRhdGVFbnVtKGRhdGEsIHNjaGVtYSwgZGF0YVBvaW50ZXJQYXRoKSkgewoJCXJldHVybiBlcnJvci5wcmVmaXhXaXRoKG51bGwsICJ0eXBlIik7Cgl9CglyZXR1cm4gbnVsbDsKfTsKClZhbGlkYXRvckNvbnRleHQucHJvdG90eXBlLnZhbGlkYXRlVHlwZSA9IGZ1bmN0aW9uIHZhbGlkYXRlVHlwZShkYXRhLCBzY2hlbWEpIHsKCWlmIChzY2hlbWEudHlwZSA9PT0gdW5kZWZpbmVkKSB7CgkJcmV0dXJuIG51bGw7Cgl9Cgl2YXIgZGF0YVR5cGUgPSB0eXBlb2YgZGF0YTsKCWlmIChkYXRhID09PSBudWxsKSB7CgkJZGF0YVR5cGUgPSAibnVsbCI7Cgl9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkoZGF0YSkpIHsKCQlkYXRhVHlwZSA9ICJhcnJheSI7Cgl9Cgl2YXIgYWxsb3dlZFR5cGVzID0gc2NoZW1hLnR5cGU7CglpZiAoIUFycmF5LmlzQXJyYXkoYWxsb3dlZFR5cGVzKSkgewoJCWFsbG93ZWRUeXBlcyA9IFthbGxvd2VkVHlwZXNdOwoJfQoKCWZvciAodmFyIGkgPSAwOyBpIDwgYWxsb3dlZFR5cGVzLmxlbmd0aDsgaSsrKSB7CgkJdmFyIHR5cGUgPSBhbGxvd2VkVHlwZXNbaV07CgkJaWYgKHR5cGUgPT09IGRhdGFUeXBlIHx8ICh0eXBlID09PSAiaW50ZWdlciIgJiYgZGF0YVR5cGUgPT09ICJudW1iZXIiICYmIChkYXRhICUgMSA9PT0gMCkpKSB7CgkJCXJldHVybiBudWxsOwoJCX0KCX0KCXJldHVybiB0aGlzLmNyZWF0ZUVycm9yKEVycm9yQ29kZXMuSU5WQUxJRF9UWVBFLCB7dHlwZTogZGF0YVR5cGUsIGV4cGVjdGVkOiBhbGxvd2VkVHlwZXMuam9pbigiLyIpfSwgJycsICcnLCBudWxsLCBkYXRhLCBzY2hlbWEpOwp9OwoKVmFsaWRhdG9yQ29udGV4dC5wcm90b3R5cGUudmFsaWRhdGVFbnVtID0gZnVuY3Rpb24gdmFsaWRhdGVFbnVtKGRhdGEsIHNjaGVtYSkgewoJaWYgKHNjaGVtYVsiZW51bSJdID09PSB1bmRlZmluZWQpIHsKCQlyZXR1cm4gbnVsbDsKCX0KCWZvciAodmFyIGkgPSAwOyBpIDwgc2NoZW1hWyJlbnVtIl0ubGVuZ3RoOyBpKyspIHsKCQl2YXIgZW51bVZhbCA9IHNjaGVtYVsiZW51bSJdW2ldOwoJCWlmIChyZWN1cnNpdmVDb21wYXJlKGRhdGEsIGVudW1WYWwpKSB7CgkJCXJldHVybiBudWxsOwoJCX0KCX0KCXJldHVybiB0aGlzLmNyZWF0ZUVycm9yKEVycm9yQ29kZXMuRU5VTV9NSVNNQVRDSCwge3ZhbHVlOiAodHlwZW9mIEpTT04gIT09ICd1bmRlZmluZWQnKSA/IEpTT04uc3RyaW5naWZ5KGRhdGEpIDogZGF0YX0sICcnLCAnJywgbnVsbCwgZGF0YSwgc2NoZW1hKTsKfTsKClZhbGlkYXRvckNvbnRleHQucHJvdG90eXBlLnZhbGlkYXRlTnVtZXJpYyA9IGZ1bmN0aW9uIHZhbGlkYXRlTnVtZXJpYyhkYXRhLCBzY2hlbWEsIGRhdGFQb2ludGVyUGF0aCkgewoJcmV0dXJuIHRoaXMudmFsaWRhdGVNdWx0aXBsZU9mKGRhdGEsIHNjaGVtYSwgZGF0YVBvaW50ZXJQYXRoKQoJCXx8IHRoaXMudmFsaWRhdGVNaW5NYXgoZGF0YSwgc2NoZW1hLCBkYXRhUG9pbnRlclBhdGgpCgkJfHwgdGhpcy52YWxpZGF0ZU5hTihkYXRhLCBzY2hlbWEsIGRhdGFQb2ludGVyUGF0aCkKCQl8fCBudWxsOwp9OwoKdmFyIENMT1NFX0VOT1VHSF9MT1cgPSBNYXRoLnBvdygyLCAtNTEpOwp2YXIgQ0xPU0VfRU5PVUdIX0hJR0ggPSAxIC0gQ0xPU0VfRU5PVUdIX0xPVzsKVmFsaWRhdG9yQ29udGV4dC5wcm90b3R5cGUudmFsaWRhdGVNdWx0aXBsZU9mID0gZnVuY3Rpb24gdmFsaWRhdGVNdWx0aXBsZU9mKGRhdGEsIHNjaGVtYSkgewoJdmFyIG11bHRpcGxlT2YgPSBzY2hlbWEubXVsdGlwbGVPZiB8fCBzY2hlbWEuZGl2aXNpYmxlQnk7CglpZiAobXVsdGlwbGVPZiA9PT0gdW5kZWZpbmVkKSB7CgkJcmV0dXJuIG51bGw7Cgl9CglpZiAodHlwZW9mIGRhdGEgPT09ICJudW1iZXIiKSB7CgkJdmFyIHJlbWFpbmRlciA9IChkYXRhL211bHRpcGxlT2YpJTE7CgkJaWYgKHJlbWFpbmRlciA+PSBDTE9TRV9FTk9VR0hfTE9XICYmIHJlbWFpbmRlciA8IENMT1NFX0VOT1VHSF9ISUdIKSB7CgkJCXJldHVybiB0aGlzLmNyZWF0ZUVycm9yKEVycm9yQ29kZXMuTlVNQkVSX01VTFRJUExFX09GLCB7dmFsdWU6IGRhdGEsIG11bHRpcGxlT2Y6IG11bHRpcGxlT2Z9LCAnJywgJycsIG51bGwsIGRhdGEsIHNjaGVtYSk7CgkJfQoJfQoJcmV0dXJuIG51bGw7Cn07CgpWYWxpZGF0b3JDb250ZXh0LnByb3RvdHlwZS52YWxpZGF0ZU1pbk1heCA9IGZ1bmN0aW9uIHZhbGlkYXRlTWluTWF4KGRhdGEsIHNjaGVtYSkgewoJaWYgKHR5cGVvZiBkYXRhICE9PSAibnVtYmVyIikgewoJCXJldHVybiBudWxsOwoJfQoJaWYgKHNjaGVtYS5taW5pbXVtICE9PSB1bmRlZmluZWQpIHsKCQlpZiAoZGF0YSA8IHNjaGVtYS5taW5pbXVtKSB7CgkJCXJldHVybiB0aGlzLmNyZWF0ZUVycm9yKEVycm9yQ29kZXMuTlVNQkVSX01JTklNVU0sIHt2YWx1ZTogZGF0YSwgbWluaW11bTogc2NoZW1hLm1pbmltdW19LCAnJywgJy9taW5pbXVtJywgbnVsbCwgZGF0YSwgc2NoZW1hKTsKCQl9CgkJaWYgKHNjaGVtYS5leGNsdXNpdmVNaW5pbXVtICYmIGRhdGEgPT09IHNjaGVtYS5taW5pbXVtKSB7CgkJCXJldHVybiB0aGlzLmNyZWF0ZUVycm9yKEVycm9yQ29kZXMuTlVNQkVSX01JTklNVU1fRVhDTFVTSVZFLCB7dmFsdWU6IGRhdGEsIG1pbmltdW06IHNjaGVtYS5taW5pbXVtfSwgJycsICcvZXhjbHVzaXZlTWluaW11bScsIG51bGwsIGRhdGEsIHNjaGVtYSk7CgkJfQoJfQoJaWYgKHNjaGVtYS5tYXhpbXVtICE9PSB1bmRlZmluZWQpIHsKCQlpZiAoZGF0YSA+IHNjaGVtYS5tYXhpbXVtKSB7CgkJCXJldHVybiB0aGlzLmNyZWF0ZUVycm9yKEVycm9yQ29kZXMuTlVNQkVSX01BWElNVU0sIHt2YWx1ZTogZGF0YSwgbWF4aW11bTogc2NoZW1hLm1heGltdW19LCAnJywgJy9tYXhpbXVtJywgbnVsbCwgZGF0YSwgc2NoZW1hKTsKCQl9CgkJaWYgKHNjaGVtYS5leGNsdXNpdmVNYXhpbXVtICYmIGRhdGEgPT09IHNjaGVtYS5tYXhpbXVtKSB7CgkJCXJldHVybiB0aGlzLmNyZWF0ZUVycm9yKEVycm9yQ29kZXMuTlVNQkVSX01BWElNVU1fRVhDTFVTSVZFLCB7dmFsdWU6IGRhdGEsIG1heGltdW06IHNjaGVtYS5tYXhpbXVtfSwgJycsICcvZXhjbHVzaXZlTWF4aW11bScsIG51bGwsIGRhdGEsIHNjaGVtYSk7CgkJfQoJfQoJcmV0dXJuIG51bGw7Cn07CgpWYWxpZGF0b3JDb250ZXh0LnByb3RvdHlwZS52YWxpZGF0ZU5hTiA9IGZ1bmN0aW9uIHZhbGlkYXRlTmFOKGRhdGEsIHNjaGVtYSkgewoJaWYgKHR5cGVvZiBkYXRhICE9PSAibnVtYmVyIikgewoJCXJldHVybiBudWxsOwoJfQoJaWYgKGlzTmFOKGRhdGEpID09PSB0cnVlIHx8IGRhdGEgPT09IEluZmluaXR5IHx8IGRhdGEgPT09IC1JbmZpbml0eSkgewoJCXJldHVybiB0aGlzLmNyZWF0ZUVycm9yKEVycm9yQ29kZXMuTlVNQkVSX05PVF9BX05VTUJFUiwge3ZhbHVlOiBkYXRhfSwgJycsICcvdHlwZScsIG51bGwsIGRhdGEsIHNjaGVtYSk7Cgl9CglyZXR1cm4gbnVsbDsKfTsKClZhbGlkYXRvckNvbnRleHQucHJvdG90eXBlLnZhbGlkYXRlU3RyaW5nID0gZnVuY3Rpb24gdmFsaWRhdGVTdHJpbmcoZGF0YSwgc2NoZW1hLCBkYXRhUG9pbnRlclBhdGgpIHsKCXJldHVybiB0aGlzLnZhbGlkYXRlU3RyaW5nTGVuZ3RoKGRhdGEsIHNjaGVtYSwgZGF0YVBvaW50ZXJQYXRoKQoJCXx8IHRoaXMudmFsaWRhdGVTdHJpbmdQYXR0ZXJuKGRhdGEsIHNjaGVtYSwgZGF0YVBvaW50ZXJQYXRoKQoJCXx8IG51bGw7Cn07CgpWYWxpZGF0b3JDb250ZXh0LnByb3RvdHlwZS52YWxpZGF0ZVN0cmluZ0xlbmd0aCA9IGZ1bmN0aW9uIHZhbGlkYXRlU3RyaW5nTGVuZ3RoKGRhdGEsIHNjaGVtYSkgewoJaWYgKHR5cGVvZiBkYXRhICE9PSAic3RyaW5nIikgewoJCXJldHVybiBudWxsOwoJfQoJaWYgKHNjaGVtYS5taW5MZW5ndGggIT09IHVuZGVmaW5lZCkgewoJCWlmIChkYXRhLmxlbmd0aCA8IHNjaGVtYS5taW5MZW5ndGgpIHsKCQkJcmV0dXJuIHRoaXMuY3JlYXRlRXJyb3IoRXJyb3JDb2Rlcy5TVFJJTkdfTEVOR1RIX1NIT1JULCB7bGVuZ3RoOiBkYXRhLmxlbmd0aCwgbWluaW11bTogc2NoZW1hLm1pbkxlbmd0aH0sICcnLCAnL21pbkxlbmd0aCcsIG51bGwsIGRhdGEsIHNjaGVtYSk7CgkJfQoJfQoJaWYgKHNjaGVtYS5tYXhMZW5ndGggIT09IHVuZGVmaW5lZCkgewoJCWlmIChkYXRhLmxlbmd0aCA+IHNjaGVtYS5tYXhMZW5ndGgpIHsKCQkJcmV0dXJuIHRoaXMuY3JlYXRlRXJyb3IoRXJyb3JDb2Rlcy5TVFJJTkdfTEVOR1RIX0xPTkcsIHtsZW5ndGg6IGRhdGEubGVuZ3RoLCBtYXhpbXVtOiBzY2hlbWEubWF4TGVuZ3RofSwgJycsICcvbWF4TGVuZ3RoJywgbnVsbCwgZGF0YSwgc2NoZW1hKTsKCQl9Cgl9CglyZXR1cm4gbnVsbDsKfTsKClZhbGlkYXRvckNvbnRleHQucHJvdG90eXBlLnZhbGlkYXRlU3RyaW5nUGF0dGVybiA9IGZ1bmN0aW9uIHZhbGlkYXRlU3RyaW5nUGF0dGVybihkYXRhLCBzY2hlbWEpIHsKCWlmICh0eXBlb2YgZGF0YSAhPT0gInN0cmluZyIgfHwgKHR5cGVvZiBzY2hlbWEucGF0dGVybiAhPT0gInN0cmluZyIgJiYgIShzY2hlbWEucGF0dGVybiBpbnN0YW5jZW9mIFJlZ0V4cCkpKSB7CgkJcmV0dXJuIG51bGw7Cgl9Cgl2YXIgcmVnZXhwOwoJaWYgKHNjaGVtYS5wYXR0ZXJuIGluc3RhbmNlb2YgUmVnRXhwKSB7CgkgIHJlZ2V4cCA9IHNjaGVtYS5wYXR0ZXJuOwoJfQoJZWxzZSB7CgkgIHZhciBib2R5LCBmbGFncyA9ICcnOwoJICAvLyBDaGVjayBmb3IgcmVndWxhciBleHByZXNzaW9uIGxpdGVyYWxzCgkgIC8vIEBzZWUgaHR0cDovL3d3dy5lY21hLWludGVybmF0aW9uYWwub3JnL2VjbWEtMjYyLzUuMS8jc2VjLTcuOC41CgkgIHZhciBsaXRlcmFsID0gc2NoZW1hLnBhdHRlcm4ubWF0Y2goL15cLyguKylcLyhbaW1nXSopJC8pOwoJICBpZiAobGl0ZXJhbCkgewoJICAgIGJvZHkgPSBsaXRlcmFsWzFdOwoJICAgIGZsYWdzID0gbGl0ZXJhbFsyXTsKCSAgfQoJICBlbHNlIHsKCSAgICBib2R5ID0gc2NoZW1hLnBhdHRlcm47CgkgIH0KCSAgcmVnZXhwID0gbmV3IFJlZ0V4cChib2R5LCBmbGFncyk7Cgl9CglpZiAoIXJlZ2V4cC50ZXN0KGRhdGEpKSB7CgkJcmV0dXJuIHRoaXMuY3JlYXRlRXJyb3IoRXJyb3JDb2Rlcy5TVFJJTkdfUEFUVEVSTiwge3BhdHRlcm46IHNjaGVtYS5wYXR0ZXJufSwgJycsICcvcGF0dGVybicsIG51bGwsIGRhdGEsIHNjaGVtYSk7Cgl9CglyZXR1cm4gbnVsbDsKfTsKClZhbGlkYXRvckNvbnRleHQucHJvdG90eXBlLnZhbGlkYXRlQXJyYXkgPSBmdW5jdGlvbiB2YWxpZGF0ZUFycmF5KGRhdGEsIHNjaGVtYSwgZGF0YVBvaW50ZXJQYXRoKSB7CglpZiAoIUFycmF5LmlzQXJyYXkoZGF0YSkpIHsKCQlyZXR1cm4gbnVsbDsKCX0KCXJldHVybiB0aGlzLnZhbGlkYXRlQXJyYXlMZW5ndGgoZGF0YSwgc2NoZW1hLCBkYXRhUG9pbnRlclBhdGgpCgkJfHwgdGhpcy52YWxpZGF0ZUFycmF5VW5pcXVlSXRlbXMoZGF0YSwgc2NoZW1hLCBkYXRhUG9pbnRlclBhdGgpCgkJfHwgdGhpcy52YWxpZGF0ZUFycmF5SXRlbXMoZGF0YSwgc2NoZW1hLCBkYXRhUG9pbnRlclBhdGgpCgkJfHwgbnVsbDsKfTsKClZhbGlkYXRvckNvbnRleHQucHJvdG90eXBlLnZhbGlkYXRlQXJyYXlMZW5ndGggPSBmdW5jdGlvbiB2YWxpZGF0ZUFycmF5TGVuZ3RoKGRhdGEsIHNjaGVtYSkgewoJdmFyIGVycm9yOwoJaWYgKHNjaGVtYS5taW5JdGVtcyAhPT0gdW5kZWZpbmVkKSB7CgkJaWYgKGRhdGEubGVuZ3RoIDwgc2NoZW1hLm1pbkl0ZW1zKSB7CgkJCWVycm9yID0gdGhpcy5jcmVhdGVFcnJvcihFcnJvckNvZGVzLkFSUkFZX0xFTkdUSF9TSE9SVCwge2xlbmd0aDogZGF0YS5sZW5ndGgsIG1pbmltdW06IHNjaGVtYS5taW5JdGVtc30sICcnLCAnL21pbkl0ZW1zJywgbnVsbCwgZGF0YSwgc2NoZW1hKTsKCQkJaWYgKHRoaXMuaGFuZGxlRXJyb3IoZXJyb3IpKSB7CgkJCQlyZXR1cm4gZXJyb3I7CgkJCX0KCQl9Cgl9CglpZiAoc2NoZW1hLm1heEl0ZW1zICE9PSB1bmRlZmluZWQpIHsKCQlpZiAoZGF0YS5sZW5ndGggPiBzY2hlbWEubWF4SXRlbXMpIHsKCQkJZXJyb3IgPSB0aGlzLmNyZWF0ZUVycm9yKEVycm9yQ29kZXMuQVJSQVlfTEVOR1RIX0xPTkcsIHtsZW5ndGg6IGRhdGEubGVuZ3RoLCBtYXhpbXVtOiBzY2hlbWEubWF4SXRlbXN9LCAnJywgJy9tYXhJdGVtcycsIG51bGwsIGRhdGEsIHNjaGVtYSk7CgkJCWlmICh0aGlzLmhhbmRsZUVycm9yKGVycm9yKSkgewoJCQkJcmV0dXJuIGVycm9yOwoJCQl9CgkJfQoJfQoJcmV0dXJuIG51bGw7Cn07CgpWYWxpZGF0b3JDb250ZXh0LnByb3RvdHlwZS52YWxpZGF0ZUFycmF5VW5pcXVlSXRlbXMgPSBmdW5jdGlvbiB2YWxpZGF0ZUFycmF5VW5pcXVlSXRlbXMoZGF0YSwgc2NoZW1hKSB7CglpZiAoc2NoZW1hLnVuaXF1ZUl0ZW1zKSB7CgkJZm9yICh2YXIgaSA9IDA7IGkgPCBkYXRhLmxlbmd0aDsgaSsrKSB7CgkJCWZvciAodmFyIGogPSBpICsgMTsgaiA8IGRhdGEubGVuZ3RoOyBqKyspIHsKCQkJCWlmIChyZWN1cnNpdmVDb21wYXJlKGRhdGFbaV0sIGRhdGFbal0pKSB7CgkJCQkJdmFyIGVycm9yID0gdGhpcy5jcmVhdGVFcnJvcihFcnJvckNvZGVzLkFSUkFZX1VOSVFVRSwge21hdGNoMTogaSwgbWF0Y2gyOiBqfSwgJycsICcvdW5pcXVlSXRlbXMnLCBudWxsLCBkYXRhLCBzY2hlbWEpOwoJCQkJCWlmICh0aGlzLmhhbmRsZUVycm9yKGVycm9yKSkgewoJCQkJCQlyZXR1cm4gZXJyb3I7CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoJfQoJcmV0dXJuIG51bGw7Cn07CgpWYWxpZGF0b3JDb250ZXh0LnByb3RvdHlwZS52YWxpZGF0ZUFycmF5SXRlbXMgPSBmdW5jdGlvbiB2YWxpZGF0ZUFycmF5SXRlbXMoZGF0YSwgc2NoZW1hLCBkYXRhUG9pbnRlclBhdGgpIHsKCWlmIChzY2hlbWEuaXRlbXMgPT09IHVuZGVmaW5lZCkgewoJCXJldHVybiBudWxsOwoJfQoJdmFyIGVycm9yLCBpOwoJaWYgKEFycmF5LmlzQXJyYXkoc2NoZW1hLml0ZW1zKSkgewoJCWZvciAoaSA9IDA7IGkgPCBkYXRhLmxlbmd0aDsgaSsrKSB7CgkJCWlmIChpIDwgc2NoZW1hLml0ZW1zLmxlbmd0aCkgewoJCQkJaWYgKGVycm9yID0gdGhpcy52YWxpZGF0ZUFsbChkYXRhW2ldLCBzY2hlbWEuaXRlbXNbaV0sIFtpXSwgWyJpdGVtcyIsIGldLCBkYXRhUG9pbnRlclBhdGggKyAiLyIgKyBpKSkgewoJCQkJCXJldHVybiBlcnJvcjsKCQkJCX0KCQkJfSBlbHNlIGlmIChzY2hlbWEuYWRkaXRpb25hbEl0ZW1zICE9PSB1bmRlZmluZWQpIHsKCQkJCWlmICh0eXBlb2Ygc2NoZW1hLmFkZGl0aW9uYWxJdGVtcyA9PT0gImJvb2xlYW4iKSB7CgkJCQkJaWYgKCFzY2hlbWEuYWRkaXRpb25hbEl0ZW1zKSB7CgkJCQkJCWVycm9yID0gKHRoaXMuY3JlYXRlRXJyb3IoRXJyb3JDb2Rlcy5BUlJBWV9BRERJVElPTkFMX0lURU1TLCB7fSwgJy8nICsgaSwgJy9hZGRpdGlvbmFsSXRlbXMnLCBudWxsLCBkYXRhLCBzY2hlbWEpKTsKCQkJCQkJaWYgKHRoaXMuaGFuZGxlRXJyb3IoZXJyb3IpKSB7CgkJCQkJCQlyZXR1cm4gZXJyb3I7CgkJCQkJCX0KCQkJCQl9CgkJCQl9IGVsc2UgaWYgKGVycm9yID0gdGhpcy52YWxpZGF0ZUFsbChkYXRhW2ldLCBzY2hlbWEuYWRkaXRpb25hbEl0ZW1zLCBbaV0sIFsiYWRkaXRpb25hbEl0ZW1zIl0sIGRhdGFQb2ludGVyUGF0aCArICIvIiArIGkpKSB7CgkJCQkJcmV0dXJuIGVycm9yOwoJCQkJfQoJCQl9CgkJfQoJfSBlbHNlIHsKCQlmb3IgKGkgPSAwOyBpIDwgZGF0YS5sZW5ndGg7IGkrKykgewoJCQlpZiAoZXJyb3IgPSB0aGlzLnZhbGlkYXRlQWxsKGRhdGFbaV0sIHNjaGVtYS5pdGVtcywgW2ldLCBbIml0ZW1zIl0sIGRhdGFQb2ludGVyUGF0aCArICIvIiArIGkpKSB7CgkJCQlyZXR1cm4gZXJyb3I7CgkJCX0KCQl9Cgl9CglyZXR1cm4gbnVsbDsKfTsKClZhbGlkYXRvckNvbnRleHQucHJvdG90eXBlLnZhbGlkYXRlT2JqZWN0ID0gZnVuY3Rpb24gdmFsaWRhdGVPYmplY3QoZGF0YSwgc2NoZW1hLCBkYXRhUG9pbnRlclBhdGgpIHsKCWlmICh0eXBlb2YgZGF0YSAhPT0gIm9iamVjdCIgfHwgZGF0YSA9PT0gbnVsbCB8fCBBcnJheS5pc0FycmF5KGRhdGEpKSB7CgkJcmV0dXJuIG51bGw7Cgl9CglyZXR1cm4gdGhpcy52YWxpZGF0ZU9iamVjdE1pbk1heFByb3BlcnRpZXMoZGF0YSwgc2NoZW1hLCBkYXRhUG9pbnRlclBhdGgpCgkJfHwgdGhpcy52YWxpZGF0ZU9iamVjdFJlcXVpcmVkUHJvcGVydGllcyhkYXRhLCBzY2hlbWEsIGRhdGFQb2ludGVyUGF0aCkKCQl8fCB0aGlzLnZhbGlkYXRlT2JqZWN0UHJvcGVydGllcyhkYXRhLCBzY2hlbWEsIGRhdGFQb2ludGVyUGF0aCkKCQl8fCB0aGlzLnZhbGlkYXRlT2JqZWN0RGVwZW5kZW5jaWVzKGRhdGEsIHNjaGVtYSwgZGF0YVBvaW50ZXJQYXRoKQoJCXx8IG51bGw7Cn07CgpWYWxpZGF0b3JDb250ZXh0LnByb3RvdHlwZS52YWxpZGF0ZU9iamVjdE1pbk1heFByb3BlcnRpZXMgPSBmdW5jdGlvbiB2YWxpZGF0ZU9iamVjdE1pbk1heFByb3BlcnRpZXMoZGF0YSwgc2NoZW1hKSB7Cgl2YXIga2V5cyA9IE9iamVjdC5rZXlzKGRhdGEpOwoJdmFyIGVycm9yOwoJaWYgKHNjaGVtYS5taW5Qcm9wZXJ0aWVzICE9PSB1bmRlZmluZWQpIHsKCQlpZiAoa2V5cy5sZW5ndGggPCBzY2hlbWEubWluUHJvcGVydGllcykgewoJCQllcnJvciA9IHRoaXMuY3JlYXRlRXJyb3IoRXJyb3JDb2Rlcy5PQkpFQ1RfUFJPUEVSVElFU19NSU5JTVVNLCB7cHJvcGVydHlDb3VudDoga2V5cy5sZW5ndGgsIG1pbmltdW06IHNjaGVtYS5taW5Qcm9wZXJ0aWVzfSwgJycsICcvbWluUHJvcGVydGllcycsIG51bGwsIGRhdGEsIHNjaGVtYSk7CgkJCWlmICh0aGlzLmhhbmRsZUVycm9yKGVycm9yKSkgewoJCQkJcmV0dXJuIGVycm9yOwoJCQl9CgkJfQoJfQoJaWYgKHNjaGVtYS5tYXhQcm9wZXJ0aWVzICE9PSB1bmRlZmluZWQpIHsKCQlpZiAoa2V5cy5sZW5ndGggPiBzY2hlbWEubWF4UHJvcGVydGllcykgewoJCQllcnJvciA9IHRoaXMuY3JlYXRlRXJyb3IoRXJyb3JDb2Rlcy5PQkpFQ1RfUFJPUEVSVElFU19NQVhJTVVNLCB7cHJvcGVydHlDb3VudDoga2V5cy5sZW5ndGgsIG1heGltdW06IHNjaGVtYS5tYXhQcm9wZXJ0aWVzfSwgJycsICcvbWF4UHJvcGVydGllcycsIG51bGwsIGRhdGEsIHNjaGVtYSk7CgkJCWlmICh0aGlzLmhhbmRsZUVycm9yKGVycm9yKSkgewoJCQkJcmV0dXJuIGVycm9yOwoJCQl9CgkJfQoJfQoJcmV0dXJuIG51bGw7Cn07CgpWYWxpZGF0b3JDb250ZXh0LnByb3RvdHlwZS52YWxpZGF0ZU9iamVjdFJlcXVpcmVkUHJvcGVydGllcyA9IGZ1bmN0aW9uIHZhbGlkYXRlT2JqZWN0UmVxdWlyZWRQcm9wZXJ0aWVzKGRhdGEsIHNjaGVtYSkgewoJaWYgKHNjaGVtYS5yZXF1aXJlZCAhPT0gdW5kZWZpbmVkKSB7CgkJZm9yICh2YXIgaSA9IDA7IGkgPCBzY2hlbWEucmVxdWlyZWQubGVuZ3RoOyBpKyspIHsKCQkJdmFyIGtleSA9IHNjaGVtYS5yZXF1aXJlZFtpXTsKCQkJaWYgKGRhdGFba2V5XSA9PT0gdW5kZWZpbmVkKSB7CgkJCQl2YXIgZXJyb3IgPSB0aGlzLmNyZWF0ZUVycm9yKEVycm9yQ29kZXMuT0JKRUNUX1JFUVVJUkVELCB7a2V5OiBrZXl9LCAnJywgJy9yZXF1aXJlZC8nICsgaSwgbnVsbCwgZGF0YSwgc2NoZW1hKTsKCQkJCWlmICh0aGlzLmhhbmRsZUVycm9yKGVycm9yKSkgewoJCQkJCXJldHVybiBlcnJvcjsKCQkJCX0KCQkJfQoJCX0KCX0KCXJldHVybiBudWxsOwp9OwoKVmFsaWRhdG9yQ29udGV4dC5wcm90b3R5cGUudmFsaWRhdGVPYmplY3RQcm9wZXJ0aWVzID0gZnVuY3Rpb24gdmFsaWRhdGVPYmplY3RQcm9wZXJ0aWVzKGRhdGEsIHNjaGVtYSwgZGF0YVBvaW50ZXJQYXRoKSB7Cgl2YXIgZXJyb3I7Cglmb3IgKHZhciBrZXkgaW4gZGF0YSkgewoJCXZhciBrZXlQb2ludGVyUGF0aCA9IGRhdGFQb2ludGVyUGF0aCArICIvIiArIGtleS5yZXBsYWNlKC9+L2csICd+MCcpLnJlcGxhY2UoL1wvL2csICd+MScpOwoJCXZhciBmb3VuZE1hdGNoID0gZmFsc2U7CgkJaWYgKHNjaGVtYS5wcm9wZXJ0aWVzICE9PSB1bmRlZmluZWQgJiYgc2NoZW1hLnByb3BlcnRpZXNba2V5XSAhPT0gdW5kZWZpbmVkKSB7CgkJCWZvdW5kTWF0Y2ggPSB0cnVlOwoJCQlpZiAoZXJyb3IgPSB0aGlzLnZhbGlkYXRlQWxsKGRhdGFba2V5XSwgc2NoZW1hLnByb3BlcnRpZXNba2V5XSwgW2tleV0sIFsicHJvcGVydGllcyIsIGtleV0sIGtleVBvaW50ZXJQYXRoKSkgewoJCQkJcmV0dXJuIGVycm9yOwoJCQl9CgkJfQoJCWlmIChzY2hlbWEucGF0dGVyblByb3BlcnRpZXMgIT09IHVuZGVmaW5lZCkgewoJCQlmb3IgKHZhciBwYXR0ZXJuS2V5IGluIHNjaGVtYS5wYXR0ZXJuUHJvcGVydGllcykgewoJCQkJdmFyIHJlZ2V4cCA9IG5ldyBSZWdFeHAocGF0dGVybktleSk7CgkJCQlpZiAocmVnZXhwLnRlc3Qoa2V5KSkgewoJCQkJCWZvdW5kTWF0Y2ggPSB0cnVlOwoJCQkJCWlmIChlcnJvciA9IHRoaXMudmFsaWRhdGVBbGwoZGF0YVtrZXldLCBzY2hlbWEucGF0dGVyblByb3BlcnRpZXNbcGF0dGVybktleV0sIFtrZXldLCBbInBhdHRlcm5Qcm9wZXJ0aWVzIiwgcGF0dGVybktleV0sIGtleVBvaW50ZXJQYXRoKSkgewoJCQkJCQlyZXR1cm4gZXJyb3I7CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoJCWlmICghZm91bmRNYXRjaCkgewoJCQlpZiAoc2NoZW1hLmFkZGl0aW9uYWxQcm9wZXJ0aWVzICE9PSB1bmRlZmluZWQpIHsKCQkJCWlmICh0aGlzLnRyYWNrVW5rbm93blByb3BlcnRpZXMpIHsKCQkJCQl0aGlzLmtub3duUHJvcGVydHlQYXRoc1trZXlQb2ludGVyUGF0aF0gPSB0cnVlOwoJCQkJCWRlbGV0ZSB0aGlzLnVua25vd25Qcm9wZXJ0eVBhdGhzW2tleVBvaW50ZXJQYXRoXTsKCQkJCX0KCQkJCWlmICh0eXBlb2Ygc2NoZW1hLmFkZGl0aW9uYWxQcm9wZXJ0aWVzID09PSAiYm9vbGVhbiIpIHsKCQkJCQlpZiAoIXNjaGVtYS5hZGRpdGlvbmFsUHJvcGVydGllcykgewoJCQkJCQllcnJvciA9IHRoaXMuY3JlYXRlRXJyb3IoRXJyb3JDb2Rlcy5PQkpFQ1RfQURESVRJT05BTF9QUk9QRVJUSUVTLCB7a2V5OiBrZXl9LCAnJywgJy9hZGRpdGlvbmFsUHJvcGVydGllcycsIG51bGwsIGRhdGEsIHNjaGVtYSkucHJlZml4V2l0aChrZXksIG51bGwpOwoJCQkJCQlpZiAodGhpcy5oYW5kbGVFcnJvcihlcnJvcikpIHsKCQkJCQkJCXJldHVybiBlcnJvcjsKCQkJCQkJfQoJCQkJCX0KCQkJCX0gZWxzZSB7CgkJCQkJaWYgKGVycm9yID0gdGhpcy52YWxpZGF0ZUFsbChkYXRhW2tleV0sIHNjaGVtYS5hZGRpdGlvbmFsUHJvcGVydGllcywgW2tleV0sIFsiYWRkaXRpb25hbFByb3BlcnRpZXMiXSwga2V5UG9pbnRlclBhdGgpKSB7CgkJCQkJCXJldHVybiBlcnJvcjsKCQkJCQl9CgkJCQl9CgkJCX0gZWxzZSBpZiAodGhpcy50cmFja1Vua25vd25Qcm9wZXJ0aWVzICYmICF0aGlzLmtub3duUHJvcGVydHlQYXRoc1trZXlQb2ludGVyUGF0aF0pIHsKCQkJCXRoaXMudW5rbm93blByb3BlcnR5UGF0aHNba2V5UG9pbnRlclBhdGhdID0gdHJ1ZTsKCQkJfQoJCX0gZWxzZSBpZiAodGhpcy50cmFja1Vua25vd25Qcm9wZXJ0aWVzKSB7CgkJCXRoaXMua25vd25Qcm9wZXJ0eVBhdGhzW2tleVBvaW50ZXJQYXRoXSA9IHRydWU7CgkJCWRlbGV0ZSB0aGlzLnVua25vd25Qcm9wZXJ0eVBhdGhzW2tleVBvaW50ZXJQYXRoXTsKCQl9Cgl9CglyZXR1cm4gbnVsbDsKfTsKClZhbGlkYXRvckNvbnRleHQucHJvdG90eXBlLnZhbGlkYXRlT2JqZWN0RGVwZW5kZW5jaWVzID0gZnVuY3Rpb24gdmFsaWRhdGVPYmplY3REZXBlbmRlbmNpZXMoZGF0YSwgc2NoZW1hLCBkYXRhUG9pbnRlclBhdGgpIHsKCXZhciBlcnJvcjsKCWlmIChzY2hlbWEuZGVwZW5kZW5jaWVzICE9PSB1bmRlZmluZWQpIHsKCQlmb3IgKHZhciBkZXBLZXkgaW4gc2NoZW1hLmRlcGVuZGVuY2llcykgewoJCQlpZiAoZGF0YVtkZXBLZXldICE9PSB1bmRlZmluZWQpIHsKCQkJCXZhciBkZXAgPSBzY2hlbWEuZGVwZW5kZW5jaWVzW2RlcEtleV07CgkJCQlpZiAodHlwZW9mIGRlcCA9PT0gInN0cmluZyIpIHsKCQkJCQlpZiAoZGF0YVtkZXBdID09PSB1bmRlZmluZWQpIHsKCQkJCQkJZXJyb3IgPSB0aGlzLmNyZWF0ZUVycm9yKEVycm9yQ29kZXMuT0JKRUNUX0RFUEVOREVOQ1lfS0VZLCB7a2V5OiBkZXBLZXksIG1pc3Npbmc6IGRlcH0sICcnLCAnJywgbnVsbCwgZGF0YSwgc2NoZW1hKS5wcmVmaXhXaXRoKG51bGwsIGRlcEtleSkucHJlZml4V2l0aChudWxsLCAiZGVwZW5kZW5jaWVzIik7CgkJCQkJCWlmICh0aGlzLmhhbmRsZUVycm9yKGVycm9yKSkgewoJCQkJCQkJcmV0dXJuIGVycm9yOwoJCQkJCQl9CgkJCQkJfQoJCQkJfSBlbHNlIGlmIChBcnJheS5pc0FycmF5KGRlcCkpIHsKCQkJCQlmb3IgKHZhciBpID0gMDsgaSA8IGRlcC5sZW5ndGg7IGkrKykgewoJCQkJCQl2YXIgcmVxdWlyZWRLZXkgPSBkZXBbaV07CgkJCQkJCWlmIChkYXRhW3JlcXVpcmVkS2V5XSA9PT0gdW5kZWZpbmVkKSB7CgkJCQkJCQllcnJvciA9IHRoaXMuY3JlYXRlRXJyb3IoRXJyb3JDb2Rlcy5PQkpFQ1RfREVQRU5ERU5DWV9LRVksIHtrZXk6IGRlcEtleSwgbWlzc2luZzogcmVxdWlyZWRLZXl9LCAnJywgJy8nICsgaSwgbnVsbCwgZGF0YSwgc2NoZW1hKS5wcmVmaXhXaXRoKG51bGwsIGRlcEtleSkucHJlZml4V2l0aChudWxsLCAiZGVwZW5kZW5jaWVzIik7CgkJCQkJCQlpZiAodGhpcy5oYW5kbGVFcnJvcihlcnJvcikpIHsKCQkJCQkJCQlyZXR1cm4gZXJyb3I7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQl9CgkJCQl9IGVsc2UgewoJCQkJCWlmIChlcnJvciA9IHRoaXMudmFsaWRhdGVBbGwoZGF0YSwgZGVwLCBbXSwgWyJkZXBlbmRlbmNpZXMiLCBkZXBLZXldLCBkYXRhUG9pbnRlclBhdGgpKSB7CgkJCQkJCXJldHVybiBlcnJvcjsKCQkJCQl9CgkJCQl9CgkJCX0KCQl9Cgl9CglyZXR1cm4gbnVsbDsKfTsKClZhbGlkYXRvckNvbnRleHQucHJvdG90eXBlLnZhbGlkYXRlQ29tYmluYXRpb25zID0gZnVuY3Rpb24gdmFsaWRhdGVDb21iaW5hdGlvbnMoZGF0YSwgc2NoZW1hLCBkYXRhUG9pbnRlclBhdGgpIHsKCXJldHVybiB0aGlzLnZhbGlkYXRlQWxsT2YoZGF0YSwgc2NoZW1hLCBkYXRhUG9pbnRlclBhdGgpCgkJfHwgdGhpcy52YWxpZGF0ZUFueU9mKGRhdGEsIHNjaGVtYSwgZGF0YVBvaW50ZXJQYXRoKQoJCXx8IHRoaXMudmFsaWRhdGVPbmVPZihkYXRhLCBzY2hlbWEsIGRhdGFQb2ludGVyUGF0aCkKCQl8fCB0aGlzLnZhbGlkYXRlTm90KGRhdGEsIHNjaGVtYSwgZGF0YVBvaW50ZXJQYXRoKQoJCXx8IG51bGw7Cn07CgpWYWxpZGF0b3JDb250ZXh0LnByb3RvdHlwZS52YWxpZGF0ZUFsbE9mID0gZnVuY3Rpb24gdmFsaWRhdGVBbGxPZihkYXRhLCBzY2hlbWEsIGRhdGFQb2ludGVyUGF0aCkgewoJaWYgKHNjaGVtYS5hbGxPZiA9PT0gdW5kZWZpbmVkKSB7CgkJcmV0dXJuIG51bGw7Cgl9Cgl2YXIgZXJyb3I7Cglmb3IgKHZhciBpID0gMDsgaSA8IHNjaGVtYS5hbGxPZi5sZW5ndGg7IGkrKykgewoJCXZhciBzdWJTY2hlbWEgPSBzY2hlbWEuYWxsT2ZbaV07CgkJaWYgKGVycm9yID0gdGhpcy52YWxpZGF0ZUFsbChkYXRhLCBzdWJTY2hlbWEsIFtdLCBbImFsbE9mIiwgaV0sIGRhdGFQb2ludGVyUGF0aCkpIHsKCQkJcmV0dXJuIGVycm9yOwoJCX0KCX0KCXJldHVybiBudWxsOwp9OwoKVmFsaWRhdG9yQ29udGV4dC5wcm90b3R5cGUudmFsaWRhdGVBbnlPZiA9IGZ1bmN0aW9uIHZhbGlkYXRlQW55T2YoZGF0YSwgc2NoZW1hLCBkYXRhUG9pbnRlclBhdGgpIHsKCWlmIChzY2hlbWEuYW55T2YgPT09IHVuZGVmaW5lZCkgewoJCXJldHVybiBudWxsOwoJfQoJdmFyIGVycm9ycyA9IFtdOwoJdmFyIHN0YXJ0RXJyb3JDb3VudCA9IHRoaXMuZXJyb3JzLmxlbmd0aDsKCXZhciBvbGRVbmtub3duUHJvcGVydHlQYXRocywgb2xkS25vd25Qcm9wZXJ0eVBhdGhzOwoJaWYgKHRoaXMudHJhY2tVbmtub3duUHJvcGVydGllcykgewoJCW9sZFVua25vd25Qcm9wZXJ0eVBhdGhzID0gdGhpcy51bmtub3duUHJvcGVydHlQYXRoczsKCQlvbGRLbm93blByb3BlcnR5UGF0aHMgPSB0aGlzLmtub3duUHJvcGVydHlQYXRoczsKCX0KCXZhciBlcnJvckF0RW5kID0gdHJ1ZTsKCWZvciAodmFyIGkgPSAwOyBpIDwgc2NoZW1hLmFueU9mLmxlbmd0aDsgaSsrKSB7CgkJaWYgKHRoaXMudHJhY2tVbmtub3duUHJvcGVydGllcykgewoJCQl0aGlzLnVua25vd25Qcm9wZXJ0eVBhdGhzID0ge307CgkJCXRoaXMua25vd25Qcm9wZXJ0eVBhdGhzID0ge307CgkJfQoJCXZhciBzdWJTY2hlbWEgPSBzY2hlbWEuYW55T2ZbaV07CgoJCXZhciBlcnJvckNvdW50ID0gdGhpcy5lcnJvcnMubGVuZ3RoOwoJCXZhciBlcnJvciA9IHRoaXMudmFsaWRhdGVBbGwoZGF0YSwgc3ViU2NoZW1hLCBbXSwgWyJhbnlPZiIsIGldLCBkYXRhUG9pbnRlclBhdGgpOwoKCQlpZiAoZXJyb3IgPT09IG51bGwgJiYgZXJyb3JDb3VudCA9PT0gdGhpcy5lcnJvcnMubGVuZ3RoKSB7CgkJCXRoaXMuZXJyb3JzID0gdGhpcy5lcnJvcnMuc2xpY2UoMCwgc3RhcnRFcnJvckNvdW50KTsKCgkJCWlmICh0aGlzLnRyYWNrVW5rbm93blByb3BlcnRpZXMpIHsKCQkJCWZvciAodmFyIGtub3duS2V5IGluIHRoaXMua25vd25Qcm9wZXJ0eVBhdGhzKSB7CgkJCQkJb2xkS25vd25Qcm9wZXJ0eVBhdGhzW2tub3duS2V5XSA9IHRydWU7CgkJCQkJZGVsZXRlIG9sZFVua25vd25Qcm9wZXJ0eVBhdGhzW2tub3duS2V5XTsKCQkJCX0KCQkJCWZvciAodmFyIHVua25vd25LZXkgaW4gdGhpcy51bmtub3duUHJvcGVydHlQYXRocykgewoJCQkJCWlmICghb2xkS25vd25Qcm9wZXJ0eVBhdGhzW3Vua25vd25LZXldKSB7CgkJCQkJCW9sZFVua25vd25Qcm9wZXJ0eVBhdGhzW3Vua25vd25LZXldID0gdHJ1ZTsKCQkJCQl9CgkJCQl9CgkJCQkvLyBXZSBuZWVkIHRvIGNvbnRpbnVlIGxvb3Bpbmcgc28gd2UgY2F0Y2ggYWxsIHRoZSBwcm9wZXJ0eSBkZWZpbml0aW9ucywgYnV0IHdlIGRvbid0IHdhbnQgdG8gcmV0dXJuIGFuIGVycm9yCgkJCQllcnJvckF0RW5kID0gZmFsc2U7CgkJCQljb250aW51ZTsKCQkJfQoKCQkJcmV0dXJuIG51bGw7CgkJfQoJCWlmIChlcnJvcikgewoJCQllcnJvcnMucHVzaChlcnJvci5wcmVmaXhXaXRoKG51bGwsICIiICsgaSkucHJlZml4V2l0aChudWxsLCAiYW55T2YiKSk7CgkJfQoJfQoJaWYgKHRoaXMudHJhY2tVbmtub3duUHJvcGVydGllcykgewoJCXRoaXMudW5rbm93blByb3BlcnR5UGF0aHMgPSBvbGRVbmtub3duUHJvcGVydHlQYXRoczsKCQl0aGlzLmtub3duUHJvcGVydHlQYXRocyA9IG9sZEtub3duUHJvcGVydHlQYXRoczsKCX0KCWlmIChlcnJvckF0RW5kKSB7CgkJZXJyb3JzID0gZXJyb3JzLmNvbmNhdCh0aGlzLmVycm9ycy5zbGljZShzdGFydEVycm9yQ291bnQpKTsKCQl0aGlzLmVycm9ycyA9IHRoaXMuZXJyb3JzLnNsaWNlKDAsIHN0YXJ0RXJyb3JDb3VudCk7CgkJcmV0dXJuIHRoaXMuY3JlYXRlRXJyb3IoRXJyb3JDb2Rlcy5BTllfT0ZfTUlTU0lORywge30sICIiLCAiL2FueU9mIiwgZXJyb3JzLCBkYXRhLCBzY2hlbWEpOwoJfQp9OwoKVmFsaWRhdG9yQ29udGV4dC5wcm90b3R5cGUudmFsaWRhdGVPbmVPZiA9IGZ1bmN0aW9uIHZhbGlkYXRlT25lT2YoZGF0YSwgc2NoZW1hLCBkYXRhUG9pbnRlclBhdGgpIHsKCWlmIChzY2hlbWEub25lT2YgPT09IHVuZGVmaW5lZCkgewoJCXJldHVybiBudWxsOwoJfQoJdmFyIHZhbGlkSW5kZXggPSBudWxsOwoJdmFyIGVycm9ycyA9IFtdOwoJdmFyIHN0YXJ0RXJyb3JDb3VudCA9IHRoaXMuZXJyb3JzLmxlbmd0aDsKCXZhciBvbGRVbmtub3duUHJvcGVydHlQYXRocywgb2xkS25vd25Qcm9wZXJ0eVBhdGhzOwoJaWYgKHRoaXMudHJhY2tVbmtub3duUHJvcGVydGllcykgewoJCW9sZFVua25vd25Qcm9wZXJ0eVBhdGhzID0gdGhpcy51bmtub3duUHJvcGVydHlQYXRoczsKCQlvbGRLbm93blByb3BlcnR5UGF0aHMgPSB0aGlzLmtub3duUHJvcGVydHlQYXRoczsKCX0KCWZvciAodmFyIGkgPSAwOyBpIDwgc2NoZW1hLm9uZU9mLmxlbmd0aDsgaSsrKSB7CgkJaWYgKHRoaXMudHJhY2tVbmtub3duUHJvcGVydGllcykgewoJCQl0aGlzLnVua25vd25Qcm9wZXJ0eVBhdGhzID0ge307CgkJCXRoaXMua25vd25Qcm9wZXJ0eVBhdGhzID0ge307CgkJfQoJCXZhciBzdWJTY2hlbWEgPSBzY2hlbWEub25lT2ZbaV07CgoJCXZhciBlcnJvckNvdW50ID0gdGhpcy5lcnJvcnMubGVuZ3RoOwoJCXZhciBlcnJvciA9IHRoaXMudmFsaWRhdGVBbGwoZGF0YSwgc3ViU2NoZW1hLCBbXSwgWyJvbmVPZiIsIGldLCBkYXRhUG9pbnRlclBhdGgpOwoKCQlpZiAoZXJyb3IgPT09IG51bGwgJiYgZXJyb3JDb3VudCA9PT0gdGhpcy5lcnJvcnMubGVuZ3RoKSB7CgkJCWlmICh2YWxpZEluZGV4ID09PSBudWxsKSB7CgkJCQl2YWxpZEluZGV4ID0gaTsKCQkJfSBlbHNlIHsKCQkJCXRoaXMuZXJyb3JzID0gdGhpcy5lcnJvcnMuc2xpY2UoMCwgc3RhcnRFcnJvckNvdW50KTsKCQkJCXJldHVybiB0aGlzLmNyZWF0ZUVycm9yKEVycm9yQ29kZXMuT05FX09GX01VTFRJUExFLCB7aW5kZXgxOiB2YWxpZEluZGV4LCBpbmRleDI6IGl9LCAiIiwgIi9vbmVPZiIsIG51bGwsIGRhdGEsIHNjaGVtYSk7CgkJCX0KCQkJaWYgKHRoaXMudHJhY2tVbmtub3duUHJvcGVydGllcykgewoJCQkJZm9yICh2YXIga25vd25LZXkgaW4gdGhpcy5rbm93blByb3BlcnR5UGF0aHMpIHsKCQkJCQlvbGRLbm93blByb3BlcnR5UGF0aHNba25vd25LZXldID0gdHJ1ZTsKCQkJCQlkZWxldGUgb2xkVW5rbm93blByb3BlcnR5UGF0aHNba25vd25LZXldOwoJCQkJfQoJCQkJZm9yICh2YXIgdW5rbm93bktleSBpbiB0aGlzLnVua25vd25Qcm9wZXJ0eVBhdGhzKSB7CgkJCQkJaWYgKCFvbGRLbm93blByb3BlcnR5UGF0aHNbdW5rbm93bktleV0pIHsKCQkJCQkJb2xkVW5rbm93blByb3BlcnR5UGF0aHNbdW5rbm93bktleV0gPSB0cnVlOwoJCQkJCX0KCQkJCX0KCQkJfQoJCX0gZWxzZSBpZiAoZXJyb3IpIHsKCQkJZXJyb3JzLnB1c2goZXJyb3IpOwoJCX0KCX0KCWlmICh0aGlzLnRyYWNrVW5rbm93blByb3BlcnRpZXMpIHsKCQl0aGlzLnVua25vd25Qcm9wZXJ0eVBhdGhzID0gb2xkVW5rbm93blByb3BlcnR5UGF0aHM7CgkJdGhpcy5rbm93blByb3BlcnR5UGF0aHMgPSBvbGRLbm93blByb3BlcnR5UGF0aHM7Cgl9CglpZiAodmFsaWRJbmRleCA9PT0gbnVsbCkgewoJCWVycm9ycyA9IGVycm9ycy5jb25jYXQodGhpcy5lcnJvcnMuc2xpY2Uoc3RhcnRFcnJvckNvdW50KSk7CgkJdGhpcy5lcnJvcnMgPSB0aGlzLmVycm9ycy5zbGljZSgwLCBzdGFydEVycm9yQ291bnQpOwoJCXJldHVybiB0aGlzLmNyZWF0ZUVycm9yKEVycm9yQ29kZXMuT05FX09GX01JU1NJTkcsIHt9LCAiIiwgIi9vbmVPZiIsIGVycm9ycywgZGF0YSwgc2NoZW1hKTsKCX0gZWxzZSB7CgkJdGhpcy5lcnJvcnMgPSB0aGlzLmVycm9ycy5zbGljZSgwLCBzdGFydEVycm9yQ291bnQpOwoJfQoJcmV0dXJuIG51bGw7Cn07CgpWYWxpZGF0b3JDb250ZXh0LnByb3RvdHlwZS52YWxpZGF0ZU5vdCA9IGZ1bmN0aW9uIHZhbGlkYXRlTm90KGRhdGEsIHNjaGVtYSwgZGF0YVBvaW50ZXJQYXRoKSB7CglpZiAoc2NoZW1hLm5vdCA9PT0gdW5kZWZpbmVkKSB7CgkJcmV0dXJuIG51bGw7Cgl9Cgl2YXIgb2xkRXJyb3JDb3VudCA9IHRoaXMuZXJyb3JzLmxlbmd0aDsKCXZhciBvbGRVbmtub3duUHJvcGVydHlQYXRocywgb2xkS25vd25Qcm9wZXJ0eVBhdGhzOwoJaWYgKHRoaXMudHJhY2tVbmtub3duUHJvcGVydGllcykgewoJCW9sZFVua25vd25Qcm9wZXJ0eVBhdGhzID0gdGhpcy51bmtub3duUHJvcGVydHlQYXRoczsKCQlvbGRLbm93blByb3BlcnR5UGF0aHMgPSB0aGlzLmtub3duUHJvcGVydHlQYXRoczsKCQl0aGlzLnVua25vd25Qcm9wZXJ0eVBhdGhzID0ge307CgkJdGhpcy5rbm93blByb3BlcnR5UGF0aHMgPSB7fTsKCX0KCXZhciBlcnJvciA9IHRoaXMudmFsaWRhdGVBbGwoZGF0YSwgc2NoZW1hLm5vdCwgbnVsbCwgbnVsbCwgZGF0YVBvaW50ZXJQYXRoKTsKCXZhciBub3RFcnJvcnMgPSB0aGlzLmVycm9ycy5zbGljZShvbGRFcnJvckNvdW50KTsKCXRoaXMuZXJyb3JzID0gdGhpcy5lcnJvcnMuc2xpY2UoMCwgb2xkRXJyb3JDb3VudCk7CglpZiAodGhpcy50cmFja1Vua25vd25Qcm9wZXJ0aWVzKSB7CgkJdGhpcy51bmtub3duUHJvcGVydHlQYXRocyA9IG9sZFVua25vd25Qcm9wZXJ0eVBhdGhzOwoJCXRoaXMua25vd25Qcm9wZXJ0eVBhdGhzID0gb2xkS25vd25Qcm9wZXJ0eVBhdGhzOwoJfQoJaWYgKGVycm9yID09PSBudWxsICYmIG5vdEVycm9ycy5sZW5ndGggPT09IDApIHsKCQlyZXR1cm4gdGhpcy5jcmVhdGVFcnJvcihFcnJvckNvZGVzLk5PVF9QQVNTRUQsIHt9LCAiIiwgIi9ub3QiLCBudWxsLCBkYXRhLCBzY2hlbWEpOwoJfQoJcmV0dXJuIG51bGw7Cn07CgpWYWxpZGF0b3JDb250ZXh0LnByb3RvdHlwZS52YWxpZGF0ZUh5cGVybWVkaWEgPSBmdW5jdGlvbiB2YWxpZGF0ZUNvbWJpbmF0aW9ucyhkYXRhLCBzY2hlbWEsIGRhdGFQb2ludGVyUGF0aCkgewoJaWYgKCFzY2hlbWEubGlua3MpIHsKCQlyZXR1cm4gbnVsbDsKCX0KCXZhciBlcnJvcjsKCWZvciAodmFyIGkgPSAwOyBpIDwgc2NoZW1hLmxpbmtzLmxlbmd0aDsgaSsrKSB7CgkJdmFyIGxkbyA9IHNjaGVtYS5saW5rc1tpXTsKCQlpZiAobGRvLnJlbCA9PT0gImRlc2NyaWJlZGJ5IikgewoJCQl2YXIgdGVtcGxhdGUgPSBuZXcgVXJpVGVtcGxhdGUobGRvLmhyZWYpOwoJCQl2YXIgYWxsUHJlc2VudCA9IHRydWU7CgkJCWZvciAodmFyIGogPSAwOyBqIDwgdGVtcGxhdGUudmFyTmFtZXMubGVuZ3RoOyBqKyspIHsKCQkJCWlmICghKHRlbXBsYXRlLnZhck5hbWVzW2pdIGluIGRhdGEpKSB7CgkJCQkJYWxsUHJlc2VudCA9IGZhbHNlOwoJCQkJCWJyZWFrOwoJCQkJfQoJCQl9CgkJCWlmIChhbGxQcmVzZW50KSB7CgkJCQl2YXIgc2NoZW1hVXJsID0gdGVtcGxhdGUuZmlsbEZyb21PYmplY3QoZGF0YSk7CgkJCQl2YXIgc3ViU2NoZW1hID0geyIkcmVmIjogc2NoZW1hVXJsfTsKCQkJCWlmIChlcnJvciA9IHRoaXMudmFsaWRhdGVBbGwoZGF0YSwgc3ViU2NoZW1hLCBbXSwgWyJsaW5rcyIsIGldLCBkYXRhUG9pbnRlclBhdGgpKSB7CgkJCQkJcmV0dXJuIGVycm9yOwoJCQkJfQoJCQl9CgkJfQoJfQp9OwoKLy8gcGFyc2VVUkkoKSBhbmQgcmVzb2x2ZVVybCgpIGFyZSBmcm9tIGh0dHBzOi8vZ2lzdC5naXRodWIuY29tLzEwODg4NTAKLy8gICAtICByZWxlYXNlZCBhcyBwdWJsaWMgZG9tYWluIGJ5IGF1dGhvciAoIllhZmZsZSIpIC0gc2VlIGNvbW1lbnRzIG9uIGdpc3QKCmZ1bmN0aW9uIHBhcnNlVVJJKHVybCkgewoJdmFyIG0gPSBTdHJpbmcodXJsKS5yZXBsYWNlKC9eXHMrfFxzKyQvZywgJycpLm1hdGNoKC9eKFteOlwvPyNdKzopPyhcL1wvKD86W146QF0qKD86OlteOkBdKik/QCk/KChbXjpcLz8jXSopKD86OihcZCopKT8pKT8oW14/I10qKShcP1teI10qKT8oI1tcc1xTXSopPy8pOwoJLy8gYXV0aG9yaXR5ID0gJy8vJyArIHVzZXIgKyAnOicgKyBwYXNzICdAJyArIGhvc3RuYW1lICsgJzonIHBvcnQKCXJldHVybiAobSA/IHsKCQlocmVmICAgICA6IG1bMF0gfHwgJycsCgkJcHJvdG9jb2wgOiBtWzFdIHx8ICcnLAoJCWF1dGhvcml0eTogbVsyXSB8fCAnJywKCQlob3N0ICAgICA6IG1bM10gfHwgJycsCgkJaG9zdG5hbWUgOiBtWzRdIHx8ICcnLAoJCXBvcnQgICAgIDogbVs1XSB8fCAnJywKCQlwYXRobmFtZSA6IG1bNl0gfHwgJycsCgkJc2VhcmNoICAgOiBtWzddIHx8ICcnLAoJCWhhc2ggICAgIDogbVs4XSB8fCAnJwoJfSA6IG51bGwpOwp9CgpmdW5jdGlvbiByZXNvbHZlVXJsKGJhc2UsIGhyZWYpIHsvLyBSRkMgMzk4NgoKCWZ1bmN0aW9uIHJlbW92ZURvdFNlZ21lbnRzKGlucHV0KSB7CgkJdmFyIG91dHB1dCA9IFtdOwoJCWlucHV0LnJlcGxhY2UoL14oXC5cLj8oXC98JCkpKy8sICcnKQoJCQkucmVwbGFjZSgvXC8oXC4oXC98JCkpKy9nLCAnLycpCgkJCS5yZXBsYWNlKC9cL1wuXC4kLywgJy8uLi8nKQoJCQkucmVwbGFjZSgvXC8/W15cL10qL2csIGZ1bmN0aW9uIChwKSB7CgkJCQlpZiAocCA9PT0gJy8uLicpIHsKCQkJCQlvdXRwdXQucG9wKCk7CgkJCQl9IGVsc2UgewoJCQkJCW91dHB1dC5wdXNoKHApOwoJCQkJfQoJCX0pOwoJCXJldHVybiBvdXRwdXQuam9pbignJykucmVwbGFjZSgvXlwvLywgaW5wdXQuY2hhckF0KDApID09PSAnLycgPyAnLycgOiAnJyk7Cgl9CgoJaHJlZiA9IHBhcnNlVVJJKGhyZWYgfHwgJycpOwoJYmFzZSA9IHBhcnNlVVJJKGJhc2UgfHwgJycpOwoKCXJldHVybiAhaHJlZiB8fCAhYmFzZSA/IG51bGwgOiAoaHJlZi5wcm90b2NvbCB8fCBiYXNlLnByb3RvY29sKSArCgkJKGhyZWYucHJvdG9jb2wgfHwgaHJlZi5hdXRob3JpdHkgPyBocmVmLmF1dGhvcml0eSA6IGJhc2UuYXV0aG9yaXR5KSArCgkJcmVtb3ZlRG90U2VnbWVudHMoaHJlZi5wcm90b2NvbCB8fCBocmVmLmF1dGhvcml0eSB8fCBocmVmLnBhdGhuYW1lLmNoYXJBdCgwKSA9PT0gJy8nID8gaHJlZi5wYXRobmFtZSA6IChocmVmLnBhdGhuYW1lID8gKChiYXNlLmF1dGhvcml0eSAmJiAhYmFzZS5wYXRobmFtZSA/ICcvJyA6ICcnKSArIGJhc2UucGF0aG5hbWUuc2xpY2UoMCwgYmFzZS5wYXRobmFtZS5sYXN0SW5kZXhPZignLycpICsgMSkgKyBocmVmLnBhdGhuYW1lKSA6IGJhc2UucGF0aG5hbWUpKSArCgkJKGhyZWYucHJvdG9jb2wgfHwgaHJlZi5hdXRob3JpdHkgfHwgaHJlZi5wYXRobmFtZSA/IGhyZWYuc2VhcmNoIDogKGhyZWYuc2VhcmNoIHx8IGJhc2Uuc2VhcmNoKSkgKwoJCWhyZWYuaGFzaDsKfQoKZnVuY3Rpb24gZ2V0RG9jdW1lbnRVcmkodXJpKSB7CglyZXR1cm4gdXJpLnNwbGl0KCcjJylbMF07Cn0KZnVuY3Rpb24gbm9ybVNjaGVtYShzY2hlbWEsIGJhc2VVcmkpIHsKCWlmIChzY2hlbWEgJiYgdHlwZW9mIHNjaGVtYSA9PT0gIm9iamVjdCIpIHsKCQlpZiAoYmFzZVVyaSA9PT0gdW5kZWZpbmVkKSB7CgkJCWJhc2VVcmkgPSBzY2hlbWEuaWQ7CgkJfSBlbHNlIGlmICh0eXBlb2Ygc2NoZW1hLmlkID09PSAic3RyaW5nIikgewoJCQliYXNlVXJpID0gcmVzb2x2ZVVybChiYXNlVXJpLCBzY2hlbWEuaWQpOwoJCQlzY2hlbWEuaWQgPSBiYXNlVXJpOwoJCX0KCQlpZiAoQXJyYXkuaXNBcnJheShzY2hlbWEpKSB7CgkJCWZvciAodmFyIGkgPSAwOyBpIDwgc2NoZW1hLmxlbmd0aDsgaSsrKSB7CgkJCQlub3JtU2NoZW1hKHNjaGVtYVtpXSwgYmFzZVVyaSk7CgkJCX0KCQl9IGVsc2UgewoJCQlpZiAodHlwZW9mIHNjaGVtYVsnJHJlZiddID09PSAic3RyaW5nIikgewoJCQkJc2NoZW1hWyckcmVmJ10gPSByZXNvbHZlVXJsKGJhc2VVcmksIHNjaGVtYVsnJHJlZiddKTsKCQkJfQoJCQlmb3IgKHZhciBrZXkgaW4gc2NoZW1hKSB7CgkJCQlpZiAoa2V5ICE9PSAiZW51bSIpIHsKCQkJCQlub3JtU2NoZW1hKHNjaGVtYVtrZXldLCBiYXNlVXJpKTsKCQkJCX0KCQkJfQoJCX0KCX0KfQoKZnVuY3Rpb24gZGVmYXVsdEVycm9yUmVwb3J0ZXIobGFuZ3VhZ2UpIHsKCWxhbmd1YWdlID0gbGFuZ3VhZ2UgfHwgJ2VuJzsKCgl2YXIgZXJyb3JNZXNzYWdlcyA9IGxhbmd1YWdlc1tsYW5ndWFnZV07CgoJcmV0dXJuIGZ1bmN0aW9uIChlcnJvcikgewoJCXZhciBtZXNzYWdlVGVtcGxhdGUgPSBlcnJvck1lc3NhZ2VzW2Vycm9yLmNvZGVdIHx8IEVycm9yTWVzc2FnZXNEZWZhdWx0W2Vycm9yLmNvZGVdOwoJCWlmICh0eXBlb2YgbWVzc2FnZVRlbXBsYXRlICE9PSAnc3RyaW5nJykgewoJCQlyZXR1cm4gIlVua25vd24gZXJyb3IgY29kZSAiICsgZXJyb3IuY29kZSArICI6ICIgKyBKU09OLnN0cmluZ2lmeShlcnJvci5tZXNzYWdlUGFyYW1zKTsKCQl9CgkJdmFyIG1lc3NhZ2VQYXJhbXMgPSBlcnJvci5wYXJhbXM7CgkJLy8gQWRhcHRlZCBmcm9tIENyb2NrZm9yZCdzIHN1cHBsYW50KCkKCQlyZXR1cm4gbWVzc2FnZVRlbXBsYXRlLnJlcGxhY2UoL1x7KFtee31dKilcfS9nLCBmdW5jdGlvbiAod2hvbGUsIHZhck5hbWUpIHsKCQkJdmFyIHN1YlZhbHVlID0gbWVzc2FnZVBhcmFtc1t2YXJOYW1lXTsKCQkJcmV0dXJuIHR5cGVvZiBzdWJWYWx1ZSA9PT0gJ3N0cmluZycgfHwgdHlwZW9mIHN1YlZhbHVlID09PSAnbnVtYmVyJyA/IHN1YlZhbHVlIDogd2hvbGU7CgkJfSk7Cgl9Owp9Cgp2YXIgRXJyb3JDb2RlcyA9IHsKCUlOVkFMSURfVFlQRTogMCwKCUVOVU1fTUlTTUFUQ0g6IDEsCglBTllfT0ZfTUlTU0lORzogMTAsCglPTkVfT0ZfTUlTU0lORzogMTEsCglPTkVfT0ZfTVVMVElQTEU6IDEyLAoJTk9UX1BBU1NFRDogMTMsCgkvLyBOdW1lcmljIGVycm9ycwoJTlVNQkVSX01VTFRJUExFX09GOiAxMDAsCglOVU1CRVJfTUlOSU1VTTogMTAxLAoJTlVNQkVSX01JTklNVU1fRVhDTFVTSVZFOiAxMDIsCglOVU1CRVJfTUFYSU1VTTogMTAzLAoJTlVNQkVSX01BWElNVU1fRVhDTFVTSVZFOiAxMDQsCglOVU1CRVJfTk9UX0FfTlVNQkVSOiAxMDUsCgkvLyBTdHJpbmcgZXJyb3JzCglTVFJJTkdfTEVOR1RIX1NIT1JUOiAyMDAsCglTVFJJTkdfTEVOR1RIX0xPTkc6IDIwMSwKCVNUUklOR19QQVRURVJOOiAyMDIsCgkvLyBPYmplY3QgZXJyb3JzCglPQkpFQ1RfUFJPUEVSVElFU19NSU5JTVVNOiAzMDAsCglPQkpFQ1RfUFJPUEVSVElFU19NQVhJTVVNOiAzMDEsCglPQkpFQ1RfUkVRVUlSRUQ6IDMwMiwKCU9CSkVDVF9BRERJVElPTkFMX1BST1BFUlRJRVM6IDMwMywKCU9CSkVDVF9ERVBFTkRFTkNZX0tFWTogMzA0LAoJLy8gQXJyYXkgZXJyb3JzCglBUlJBWV9MRU5HVEhfU0hPUlQ6IDQwMCwKCUFSUkFZX0xFTkdUSF9MT05HOiA0MDEsCglBUlJBWV9VTklRVUU6IDQwMiwKCUFSUkFZX0FERElUSU9OQUxfSVRFTVM6IDQwMywKCS8vIEN1c3RvbS91c2VyLWRlZmluZWQgZXJyb3JzCglGT1JNQVRfQ1VTVE9NOiA1MDAsCglLRVlXT1JEX0NVU1RPTTogNTAxLAoJLy8gU2NoZW1hIHN0cnVjdHVyZQoJQ0lSQ1VMQVJfUkVGRVJFTkNFOiA2MDAsCgkvLyBOb24tc3RhbmRhcmQgdmFsaWRhdGlvbiBvcHRpb25zCglVTktOT1dOX1BST1BFUlRZOiAxMDAwCn07CnZhciBFcnJvckNvZGVMb29rdXAgPSB7fTsKZm9yICh2YXIga2V5IGluIEVycm9yQ29kZXMpIHsKCUVycm9yQ29kZUxvb2t1cFtFcnJvckNvZGVzW2tleV1dID0ga2V5Owp9CnZhciBFcnJvck1lc3NhZ2VzRGVmYXVsdCA9IHsKCUlOVkFMSURfVFlQRTogIkludmFsaWQgdHlwZToge3R5cGV9IChleHBlY3RlZCB7ZXhwZWN0ZWR9KSIsCglFTlVNX01JU01BVENIOiAiTm8gZW51bSBtYXRjaCBmb3I6IHt2YWx1ZX0iLAoJQU5ZX09GX01JU1NJTkc6ICJEYXRhIGRvZXMgbm90IG1hdGNoIGFueSBzY2hlbWFzIGZyb20gXCJhbnlPZlwiIiwKCU9ORV9PRl9NSVNTSU5HOiAiRGF0YSBkb2VzIG5vdCBtYXRjaCBhbnkgc2NoZW1hcyBmcm9tIFwib25lT2ZcIiIsCglPTkVfT0ZfTVVMVElQTEU6ICJEYXRhIGlzIHZhbGlkIGFnYWluc3QgbW9yZSB0aGFuIG9uZSBzY2hlbWEgZnJvbSBcIm9uZU9mXCI6IGluZGljZXMge2luZGV4MX0gYW5kIHtpbmRleDJ9IiwKCU5PVF9QQVNTRUQ6ICJEYXRhIG1hdGNoZXMgc2NoZW1hIGZyb20gXCJub3RcIiIsCgkvLyBOdW1lcmljIGVycm9ycwoJTlVNQkVSX01VTFRJUExFX09GOiAiVmFsdWUge3ZhbHVlfSBpcyBub3QgYSBtdWx0aXBsZSBvZiB7bXVsdGlwbGVPZn0iLAoJTlVNQkVSX01JTklNVU06ICJWYWx1ZSB7dmFsdWV9IGlzIGxlc3MgdGhhbiBtaW5pbXVtIHttaW5pbXVtfSIsCglOVU1CRVJfTUlOSU1VTV9FWENMVVNJVkU6ICJWYWx1ZSB7dmFsdWV9IGlzIGVxdWFsIHRvIGV4Y2x1c2l2ZSBtaW5pbXVtIHttaW5pbXVtfSIsCglOVU1CRVJfTUFYSU1VTTogIlZhbHVlIHt2YWx1ZX0gaXMgZ3JlYXRlciB0aGFuIG1heGltdW0ge21heGltdW19IiwKCU5VTUJFUl9NQVhJTVVNX0VYQ0xVU0lWRTogIlZhbHVlIHt2YWx1ZX0gaXMgZXF1YWwgdG8gZXhjbHVzaXZlIG1heGltdW0ge21heGltdW19IiwKCU5VTUJFUl9OT1RfQV9OVU1CRVI6ICJWYWx1ZSB7dmFsdWV9IGlzIG5vdCBhIHZhbGlkIG51bWJlciIsCgkvLyBTdHJpbmcgZXJyb3JzCglTVFJJTkdfTEVOR1RIX1NIT1JUOiAiU3RyaW5nIGlzIHRvbyBzaG9ydCAoe2xlbmd0aH0gY2hhcnMpLCBtaW5pbXVtIHttaW5pbXVtfSIsCglTVFJJTkdfTEVOR1RIX0xPTkc6ICJTdHJpbmcgaXMgdG9vIGxvbmcgKHtsZW5ndGh9IGNoYXJzKSwgbWF4aW11bSB7bWF4aW11bX0iLAoJU1RSSU5HX1BBVFRFUk46ICJTdHJpbmcgZG9lcyBub3QgbWF0Y2ggcGF0dGVybjoge3BhdHRlcm59IiwKCS8vIE9iamVjdCBlcnJvcnMKCU9CSkVDVF9QUk9QRVJUSUVTX01JTklNVU06ICJUb28gZmV3IHByb3BlcnRpZXMgZGVmaW5lZCAoe3Byb3BlcnR5Q291bnR9KSwgbWluaW11bSB7bWluaW11bX0iLAoJT0JKRUNUX1BST1BFUlRJRVNfTUFYSU1VTTogIlRvbyBtYW55IHByb3BlcnRpZXMgZGVmaW5lZCAoe3Byb3BlcnR5Q291bnR9KSwgbWF4aW11bSB7bWF4aW11bX0iLAoJT0JKRUNUX1JFUVVJUkVEOiAiTWlzc2luZyByZXF1aXJlZCBwcm9wZXJ0eToge2tleX0iLAoJT0JKRUNUX0FERElUSU9OQUxfUFJPUEVSVElFUzogIkFkZGl0aW9uYWwgcHJvcGVydGllcyBub3QgYWxsb3dlZCIsCglPQkpFQ1RfREVQRU5ERU5DWV9LRVk6ICJEZXBlbmRlbmN5IGZhaWxlZCAtIGtleSBtdXN0IGV4aXN0OiB7bWlzc2luZ30gKGR1ZSB0byBrZXk6IHtrZXl9KSIsCgkvLyBBcnJheSBlcnJvcnMKCUFSUkFZX0xFTkdUSF9TSE9SVDogIkFycmF5IGlzIHRvbyBzaG9ydCAoe2xlbmd0aH0pLCBtaW5pbXVtIHttaW5pbXVtfSIsCglBUlJBWV9MRU5HVEhfTE9ORzogIkFycmF5IGlzIHRvbyBsb25nICh7bGVuZ3RofSksIG1heGltdW0ge21heGltdW19IiwKCUFSUkFZX1VOSVFVRTogIkFycmF5IGl0ZW1zIGFyZSBub3QgdW5pcXVlIChpbmRpY2VzIHttYXRjaDF9IGFuZCB7bWF0Y2gyfSkiLAoJQVJSQVlfQURESVRJT05BTF9JVEVNUzogIkFkZGl0aW9uYWwgaXRlbXMgbm90IGFsbG93ZWQiLAoJLy8gRm9ybWF0IGVycm9ycwoJRk9STUFUX0NVU1RPTTogIkZvcm1hdCB2YWxpZGF0aW9uIGZhaWxlZCAoe21lc3NhZ2V9KSIsCglLRVlXT1JEX0NVU1RPTTogIktleXdvcmQgZmFpbGVkOiB7a2V5fSAoe21lc3NhZ2V9KSIsCgkvLyBTY2hlbWEgc3RydWN0dXJlCglDSVJDVUxBUl9SRUZFUkVOQ0U6ICJDaXJjdWxhciAkcmVmczoge3VybHN9IiwKCS8vIE5vbi1zdGFuZGFyZCB2YWxpZGF0aW9uIG9wdGlvbnMKCVVOS05PV05fUFJPUEVSVFk6ICJVbmtub3duIHByb3BlcnR5IChub3QgaW4gc2NoZW1hKSIKfTsKCmZ1bmN0aW9uIFZhbGlkYXRpb25FcnJvcihjb2RlLCBwYXJhbXMsIGRhdGFQYXRoLCBzY2hlbWFQYXRoLCBzdWJFcnJvcnMpIHsKCUVycm9yLmNhbGwodGhpcyk7CglpZiAoY29kZSA9PT0gdW5kZWZpbmVkKSB7CgkJdGhyb3cgbmV3IEVycm9yICgiTm8gZXJyb3IgY29kZSBzdXBwbGllZDogIiArIHNjaGVtYVBhdGgpOwoJfQoJdGhpcy5tZXNzYWdlID0gJyc7Cgl0aGlzLnBhcmFtcyA9IHBhcmFtczsKCXRoaXMuY29kZSA9IGNvZGU7Cgl0aGlzLmRhdGFQYXRoID0gZGF0YVBhdGggfHwgIiI7Cgl0aGlzLnNjaGVtYVBhdGggPSBzY2hlbWFQYXRoIHx8ICIiOwoJdGhpcy5zdWJFcnJvcnMgPSBzdWJFcnJvcnMgfHwgbnVsbDsKCgl2YXIgZXJyID0gbmV3IEVycm9yKHRoaXMubWVzc2FnZSk7Cgl0aGlzLnN0YWNrID0gZXJyLnN0YWNrIHx8IGVyci5zdGFja3RyYWNlOwoJaWYgKCF0aGlzLnN0YWNrKSB7CgkJdHJ5IHsKCQkJdGhyb3cgZXJyOwoJCX0KCQljYXRjaChlcnIpIHsKCQkJdGhpcy5zdGFjayA9IGVyci5zdGFjayB8fCBlcnIuc3RhY2t0cmFjZTsKCQl9Cgl9Cn0KVmFsaWRhdGlvbkVycm9yLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoRXJyb3IucHJvdG90eXBlKTsKVmFsaWRhdGlvbkVycm9yLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IFZhbGlkYXRpb25FcnJvcjsKVmFsaWRhdGlvbkVycm9yLnByb3RvdHlwZS5uYW1lID0gJ1ZhbGlkYXRpb25FcnJvcic7CgpWYWxpZGF0aW9uRXJyb3IucHJvdG90eXBlLnByZWZpeFdpdGggPSBmdW5jdGlvbiAoZGF0YVByZWZpeCwgc2NoZW1hUHJlZml4KSB7CglpZiAoZGF0YVByZWZpeCAhPT0gbnVsbCkgewoJCWRhdGFQcmVmaXggPSBkYXRhUHJlZml4LnJlcGxhY2UoL34vZywgIn4wIikucmVwbGFjZSgvXC8vZywgIn4xIik7CgkJdGhpcy5kYXRhUGF0aCA9ICIvIiArIGRhdGFQcmVmaXggKyB0aGlzLmRhdGFQYXRoOwoJfQoJaWYgKHNjaGVtYVByZWZpeCAhPT0gbnVsbCkgewoJCXNjaGVtYVByZWZpeCA9IHNjaGVtYVByZWZpeC5yZXBsYWNlKC9+L2csICJ+MCIpLnJlcGxhY2UoL1wvL2csICJ+MSIpOwoJCXRoaXMuc2NoZW1hUGF0aCA9ICIvIiArIHNjaGVtYVByZWZpeCArIHRoaXMuc2NoZW1hUGF0aDsKCX0KCWlmICh0aGlzLnN1YkVycm9ycyAhPT0gbnVsbCkgewoJCWZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5zdWJFcnJvcnMubGVuZ3RoOyBpKyspIHsKCQkJdGhpcy5zdWJFcnJvcnNbaV0ucHJlZml4V2l0aChkYXRhUHJlZml4LCBzY2hlbWFQcmVmaXgpOwoJCX0KCX0KCXJldHVybiB0aGlzOwp9OwoKZnVuY3Rpb24gaXNUcnVzdGVkVXJsKGJhc2VVcmwsIHRlc3RVcmwpIHsKCWlmKHRlc3RVcmwuc3Vic3RyaW5nKDAsIGJhc2VVcmwubGVuZ3RoKSA9PT0gYmFzZVVybCl7CgkJdmFyIHJlbWFpbmRlciA9IHRlc3RVcmwuc3Vic3RyaW5nKGJhc2VVcmwubGVuZ3RoKTsKCQlpZiAoKHRlc3RVcmwubGVuZ3RoID4gMCAmJiB0ZXN0VXJsLmNoYXJBdChiYXNlVXJsLmxlbmd0aCAtIDEpID09PSAiLyIpCgkJCXx8IHJlbWFpbmRlci5jaGFyQXQoMCkgPT09ICIjIgoJCQl8fCByZW1haW5kZXIuY2hhckF0KDApID09PSAiPyIpIHsKCQkJcmV0dXJuIHRydWU7CgkJfQoJfQoJcmV0dXJuIGZhbHNlOwp9Cgp2YXIgbGFuZ3VhZ2VzID0ge307CmZ1bmN0aW9uIGNyZWF0ZUFwaShsYW5ndWFnZSkgewoJdmFyIGdsb2JhbENvbnRleHQgPSBuZXcgVmFsaWRhdG9yQ29udGV4dCgpOwoJdmFyIGN1cnJlbnRMYW5ndWFnZTsKCXZhciBjdXN0b21FcnJvclJlcG9ydGVyOwoJdmFyIGFwaSA9IHsKCQlzZXRFcnJvclJlcG9ydGVyOiBmdW5jdGlvbiAocmVwb3J0ZXIpIHsKCQkJaWYgKHR5cGVvZiByZXBvcnRlciA9PT0gJ3N0cmluZycpIHsKCQkJCXJldHVybiB0aGlzLmxhbmd1YWdlKHJlcG9ydGVyKTsKCQkJfQoJCQljdXN0b21FcnJvclJlcG9ydGVyID0gcmVwb3J0ZXI7CgkJCXJldHVybiB0cnVlOwoJCX0sCgkJYWRkRm9ybWF0OiBmdW5jdGlvbiAoKSB7CgkJCWdsb2JhbENvbnRleHQuYWRkRm9ybWF0LmFwcGx5KGdsb2JhbENvbnRleHQsIGFyZ3VtZW50cyk7CgkJfSwKCQlsYW5ndWFnZTogZnVuY3Rpb24gKGNvZGUpIHsKCQkJaWYgKCFjb2RlKSB7CgkJCQlyZXR1cm4gY3VycmVudExhbmd1YWdlOwoJCQl9CgkJCWlmICghbGFuZ3VhZ2VzW2NvZGVdKSB7CgkJCQljb2RlID0gY29kZS5zcGxpdCgnLScpWzBdOyAvLyBmYWxsIGJhY2sgdG8gYmFzZSBsYW5ndWFnZQoJCQl9CgkJCWlmIChsYW5ndWFnZXNbY29kZV0pIHsKCQkJCWN1cnJlbnRMYW5ndWFnZSA9IGNvZGU7CgkJCQlyZXR1cm4gY29kZTsgLy8gc28geW91IGNhbiB0ZWxsIGlmIGZhbGwtYmFjayBoYXMgaGFwcGVuZWQKCQkJfQoJCQlyZXR1cm4gZmFsc2U7CgkJfSwKCQlhZGRMYW5ndWFnZTogZnVuY3Rpb24gKGNvZGUsIG1lc3NhZ2VNYXApIHsKCQkJdmFyIGtleTsKCQkJZm9yIChrZXkgaW4gRXJyb3JDb2RlcykgewoJCQkJaWYgKG1lc3NhZ2VNYXBba2V5XSAmJiAhbWVzc2FnZU1hcFtFcnJvckNvZGVzW2tleV1dKSB7CgkJCQkJbWVzc2FnZU1hcFtFcnJvckNvZGVzW2tleV1dID0gbWVzc2FnZU1hcFtrZXldOwoJCQkJfQoJCQl9CgkJCXZhciByb290Q29kZSA9IGNvZGUuc3BsaXQoJy0nKVswXTsKCQkJaWYgKCFsYW5ndWFnZXNbcm9vdENvZGVdKSB7IC8vIHVzZSBmb3IgYmFzZSBsYW5ndWFnZSBpZiBub3QgeWV0IGRlZmluZWQKCQkJCWxhbmd1YWdlc1tjb2RlXSA9IG1lc3NhZ2VNYXA7CgkJCQlsYW5ndWFnZXNbcm9vdENvZGVdID0gbWVzc2FnZU1hcDsKCQkJfSBlbHNlIHsKCQkJCWxhbmd1YWdlc1tjb2RlXSA9IE9iamVjdC5jcmVhdGUobGFuZ3VhZ2VzW3Jvb3RDb2RlXSk7CgkJCQlmb3IgKGtleSBpbiBtZXNzYWdlTWFwKSB7CgkJCQkJaWYgKHR5cGVvZiBsYW5ndWFnZXNbcm9vdENvZGVdW2tleV0gPT09ICd1bmRlZmluZWQnKSB7CgkJCQkJCWxhbmd1YWdlc1tyb290Q29kZV1ba2V5XSA9IG1lc3NhZ2VNYXBba2V5XTsKCQkJCQl9CgkJCQkJbGFuZ3VhZ2VzW2NvZGVdW2tleV0gPSBtZXNzYWdlTWFwW2tleV07CgkJCQl9CgkJCX0KCQkJcmV0dXJuIHRoaXM7CgkJfSwKCQlmcmVzaEFwaTogZnVuY3Rpb24gKGxhbmd1YWdlKSB7CgkJCXZhciByZXN1bHQgPSBjcmVhdGVBcGkoKTsKCQkJaWYgKGxhbmd1YWdlKSB7CgkJCQlyZXN1bHQubGFuZ3VhZ2UobGFuZ3VhZ2UpOwoJCQl9CgkJCXJldHVybiByZXN1bHQ7CgkJfSwKCQl2YWxpZGF0ZTogZnVuY3Rpb24gKGRhdGEsIHNjaGVtYSwgY2hlY2tSZWN1cnNpdmUsIGJhblVua25vd25Qcm9wZXJ0aWVzKSB7CgkJCXZhciBkZWYgPSBkZWZhdWx0RXJyb3JSZXBvcnRlcihjdXJyZW50TGFuZ3VhZ2UpOwoJCQl2YXIgZXJyb3JSZXBvcnRlciA9IGN1c3RvbUVycm9yUmVwb3J0ZXIgPyBmdW5jdGlvbiAoZXJyb3IsIGRhdGEsIHNjaGVtYSkgewoJCQkJcmV0dXJuIGN1c3RvbUVycm9yUmVwb3J0ZXIoZXJyb3IsIGRhdGEsIHNjaGVtYSkgfHwgZGVmKGVycm9yLCBkYXRhLCBzY2hlbWEpOwoJCQl9IDogZGVmOwoJCQl2YXIgY29udGV4dCA9IG5ldyBWYWxpZGF0b3JDb250ZXh0KGdsb2JhbENvbnRleHQsIGZhbHNlLCBlcnJvclJlcG9ydGVyLCBjaGVja1JlY3Vyc2l2ZSwgYmFuVW5rbm93blByb3BlcnRpZXMpOwoJCQlpZiAodHlwZW9mIHNjaGVtYSA9PT0gInN0cmluZyIpIHsKCQkJCXNjaGVtYSA9IHsiJHJlZiI6IHNjaGVtYX07CgkJCX0KCQkJY29udGV4dC5hZGRTY2hlbWEoIiIsIHNjaGVtYSk7CgkJCXZhciBlcnJvciA9IGNvbnRleHQudmFsaWRhdGVBbGwoZGF0YSwgc2NoZW1hLCBudWxsLCBudWxsLCAiIik7CgkJCWlmICghZXJyb3IgJiYgYmFuVW5rbm93blByb3BlcnRpZXMpIHsKCQkJCWVycm9yID0gY29udGV4dC5iYW5Vbmtub3duUHJvcGVydGllcyhkYXRhLCBzY2hlbWEpOwoJCQl9CgkJCXRoaXMuZXJyb3IgPSBlcnJvcjsKCQkJdGhpcy5taXNzaW5nID0gY29udGV4dC5taXNzaW5nOwoJCQl0aGlzLnZhbGlkID0gKGVycm9yID09PSBudWxsKTsKCQkJcmV0dXJuIHRoaXMudmFsaWQ7CgkJfSwKCQl2YWxpZGF0ZVJlc3VsdDogZnVuY3Rpb24gKCkgewoJCQl2YXIgcmVzdWx0ID0ge307CgkJCXRoaXMudmFsaWRhdGUuYXBwbHkocmVzdWx0LCBhcmd1bWVudHMpOwoJCQlyZXR1cm4gcmVzdWx0OwoJCX0sCgkJdmFsaWRhdGVNdWx0aXBsZTogZnVuY3Rpb24gKGRhdGEsIHNjaGVtYSwgY2hlY2tSZWN1cnNpdmUsIGJhblVua25vd25Qcm9wZXJ0aWVzKSB7CgkJCXZhciBkZWYgPSBkZWZhdWx0RXJyb3JSZXBvcnRlcihjdXJyZW50TGFuZ3VhZ2UpOwoJCQl2YXIgZXJyb3JSZXBvcnRlciA9IGN1c3RvbUVycm9yUmVwb3J0ZXIgPyBmdW5jdGlvbiAoZXJyb3IsIGRhdGEsIHNjaGVtYSkgewoJCQkJcmV0dXJuIGN1c3RvbUVycm9yUmVwb3J0ZXIoZXJyb3IsIGRhdGEsIHNjaGVtYSkgfHwgZGVmKGVycm9yLCBkYXRhLCBzY2hlbWEpOwoJCQl9IDogZGVmOwoJCQl2YXIgY29udGV4dCA9IG5ldyBWYWxpZGF0b3JDb250ZXh0KGdsb2JhbENvbnRleHQsIHRydWUsIGVycm9yUmVwb3J0ZXIsIGNoZWNrUmVjdXJzaXZlLCBiYW5Vbmtub3duUHJvcGVydGllcyk7CgkJCWlmICh0eXBlb2Ygc2NoZW1hID09PSAic3RyaW5nIikgewoJCQkJc2NoZW1hID0geyIkcmVmIjogc2NoZW1hfTsKCQkJfQoJCQljb250ZXh0LmFkZFNjaGVtYSgiIiwgc2NoZW1hKTsKCQkJY29udGV4dC52YWxpZGF0ZUFsbChkYXRhLCBzY2hlbWEsIG51bGwsIG51bGwsICIiKTsKCQkJaWYgKGJhblVua25vd25Qcm9wZXJ0aWVzKSB7CgkJCQljb250ZXh0LmJhblVua25vd25Qcm9wZXJ0aWVzKGRhdGEsIHNjaGVtYSk7CgkJCX0KCQkJdmFyIHJlc3VsdCA9IHt9OwoJCQlyZXN1bHQuZXJyb3JzID0gY29udGV4dC5lcnJvcnM7CgkJCXJlc3VsdC5taXNzaW5nID0gY29udGV4dC5taXNzaW5nOwoJCQlyZXN1bHQudmFsaWQgPSAocmVzdWx0LmVycm9ycy5sZW5ndGggPT09IDApOwoJCQlyZXR1cm4gcmVzdWx0OwoJCX0sCgkJYWRkU2NoZW1hOiBmdW5jdGlvbiAoKSB7CgkJCXJldHVybiBnbG9iYWxDb250ZXh0LmFkZFNjaGVtYS5hcHBseShnbG9iYWxDb250ZXh0LCBhcmd1bWVudHMpOwoJCX0sCgkJZ2V0U2NoZW1hOiBmdW5jdGlvbiAoKSB7CgkJCXJldHVybiBnbG9iYWxDb250ZXh0LmdldFNjaGVtYS5hcHBseShnbG9iYWxDb250ZXh0LCBhcmd1bWVudHMpOwoJCX0sCgkJZ2V0U2NoZW1hTWFwOiBmdW5jdGlvbiAoKSB7CgkJCXJldHVybiBnbG9iYWxDb250ZXh0LmdldFNjaGVtYU1hcC5hcHBseShnbG9iYWxDb250ZXh0LCBhcmd1bWVudHMpOwoJCX0sCgkJZ2V0U2NoZW1hVXJpczogZnVuY3Rpb24gKCkgewoJCQlyZXR1cm4gZ2xvYmFsQ29udGV4dC5nZXRTY2hlbWFVcmlzLmFwcGx5KGdsb2JhbENvbnRleHQsIGFyZ3VtZW50cyk7CgkJfSwKCQlnZXRNaXNzaW5nVXJpczogZnVuY3Rpb24gKCkgewoJCQlyZXR1cm4gZ2xvYmFsQ29udGV4dC5nZXRNaXNzaW5nVXJpcy5hcHBseShnbG9iYWxDb250ZXh0LCBhcmd1bWVudHMpOwoJCX0sCgkJZHJvcFNjaGVtYXM6IGZ1bmN0aW9uICgpIHsKCQkJZ2xvYmFsQ29udGV4dC5kcm9wU2NoZW1hcy5hcHBseShnbG9iYWxDb250ZXh0LCBhcmd1bWVudHMpOwoJCX0sCgkJZGVmaW5lS2V5d29yZDogZnVuY3Rpb24gKCkgewoJCQlnbG9iYWxDb250ZXh0LmRlZmluZUtleXdvcmQuYXBwbHkoZ2xvYmFsQ29udGV4dCwgYXJndW1lbnRzKTsKCQl9LAoJCWRlZmluZUVycm9yOiBmdW5jdGlvbiAoY29kZU5hbWUsIGNvZGVOdW1iZXIsIGRlZmF1bHRNZXNzYWdlKSB7CgkJCWlmICh0eXBlb2YgY29kZU5hbWUgIT09ICdzdHJpbmcnIHx8ICEvXltBLVpdKyhfW0EtWl0rKSokLy50ZXN0KGNvZGVOYW1lKSkgewoJCQkJdGhyb3cgbmV3IEVycm9yKCdDb2RlIG5hbWUgbXVzdCBiZSBhIHN0cmluZyBpbiBVUFBFUl9DQVNFX1dJVEhfVU5ERVJTQ09SRVMnKTsKCQkJfQoJCQlpZiAodHlwZW9mIGNvZGVOdW1iZXIgIT09ICdudW1iZXInIHx8IGNvZGVOdW1iZXIlMSAhPT0gMCB8fCBjb2RlTnVtYmVyIDwgMTAwMDApIHsKCQkJCXRocm93IG5ldyBFcnJvcignQ29kZSBudW1iZXIgbXVzdCBiZSBhbiBpbnRlZ2VyID4gMTAwMDAnKTsKCQkJfQoJCQlpZiAodHlwZW9mIEVycm9yQ29kZXNbY29kZU5hbWVdICE9PSAndW5kZWZpbmVkJykgewoJCQkJdGhyb3cgbmV3IEVycm9yKCdFcnJvciBhbHJlYWR5IGRlZmluZWQ6ICcgKyBjb2RlTmFtZSArICcgYXMgJyArIEVycm9yQ29kZXNbY29kZU5hbWVdKTsKCQkJfQoJCQlpZiAodHlwZW9mIEVycm9yQ29kZUxvb2t1cFtjb2RlTnVtYmVyXSAhPT0gJ3VuZGVmaW5lZCcpIHsKCQkJCXRocm93IG5ldyBFcnJvcignRXJyb3IgY29kZSBhbHJlYWR5IHVzZWQ6ICcgKyBFcnJvckNvZGVMb29rdXBbY29kZU51bWJlcl0gKyAnIGFzICcgKyBjb2RlTnVtYmVyKTsKCQkJfQoJCQlFcnJvckNvZGVzW2NvZGVOYW1lXSA9IGNvZGVOdW1iZXI7CgkJCUVycm9yQ29kZUxvb2t1cFtjb2RlTnVtYmVyXSA9IGNvZGVOYW1lOwoJCQlFcnJvck1lc3NhZ2VzRGVmYXVsdFtjb2RlTmFtZV0gPSBFcnJvck1lc3NhZ2VzRGVmYXVsdFtjb2RlTnVtYmVyXSA9IGRlZmF1bHRNZXNzYWdlOwoJCQlmb3IgKHZhciBsYW5nQ29kZSBpbiBsYW5ndWFnZXMpIHsKCQkJCXZhciBsYW5ndWFnZSA9IGxhbmd1YWdlc1tsYW5nQ29kZV07CgkJCQlpZiAobGFuZ3VhZ2VbY29kZU5hbWVdKSB7CgkJCQkJbGFuZ3VhZ2VbY29kZU51bWJlcl0gPSBsYW5ndWFnZVtjb2RlTnVtYmVyXSB8fCBsYW5ndWFnZVtjb2RlTmFtZV07CgkJCQl9CgkJCX0KCQl9LAoJCXJlc2V0OiBmdW5jdGlvbiAoKSB7CgkJCWdsb2JhbENvbnRleHQucmVzZXQoKTsKCQkJdGhpcy5lcnJvciA9IG51bGw7CgkJCXRoaXMubWlzc2luZyA9IFtdOwoJCQl0aGlzLnZhbGlkID0gdHJ1ZTsKCQl9LAoJCW1pc3Npbmc6IFtdLAoJCWVycm9yOiBudWxsLAoJCXZhbGlkOiB0cnVlLAoJCW5vcm1TY2hlbWE6IG5vcm1TY2hlbWEsCgkJcmVzb2x2ZVVybDogcmVzb2x2ZVVybCwKCQlnZXREb2N1bWVudFVyaTogZ2V0RG9jdW1lbnRVcmksCgkJZXJyb3JDb2RlczogRXJyb3JDb2RlcwoJfTsKCWFwaS5sYW5ndWFnZShsYW5ndWFnZSB8fCAnZW4nKTsKCXJldHVybiBhcGk7Cn0KCnZhciB0djQgPSBjcmVhdGVBcGkoKTsKdHY0LmFkZExhbmd1YWdlKCdlbi1nYicsIEVycm9yTWVzc2FnZXNEZWZhdWx0KTsKCi8vbGVnYWN5IHByb3BlcnR5CnR2NC50djQgPSB0djQ7CgpyZXR1cm4gdHY0OyAvLyB1c2VkIGJ5IF9oZWFkZXIuanMgdG8gZ2xvYmFsaXNlLgoKfSkpOwp9LHt9XSwyOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKLyoKICogIENvcHlyaWdodCAoYykgMjAxNCBUaGUgV2ViUlRDIHByb2plY3QgYXV0aG9ycy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC4KICoKICogIFVzZSBvZiB0aGlzIHNvdXJjZSBjb2RlIGlzIGdvdmVybmVkIGJ5IGEgQlNELXN0eWxlIGxpY2Vuc2UKICogIHRoYXQgY2FuIGJlIGZvdW5kIGluIHRoZSBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3Qgb2YgdGhlIHNvdXJjZQogKiAgdHJlZS4KICovCgovKiBNb3JlIGluZm9ybWF0aW9uIGFib3V0IHRoZXNlIG9wdGlvbnMgYXQganNoaW50LmNvbS9kb2NzL29wdGlvbnMgKi8KLyoganNoaW50IGJyb3dzZXI6IHRydWUsIGNhbWVsY2FzZTogdHJ1ZSwgY3VybHk6IHRydWUsIGRldmVsOiB0cnVlLAogICBlcWVxZXE6IHRydWUsIGZvcmluOiBmYWxzZSwgZ2xvYmFsc3RyaWN0OiB0cnVlLCBub2RlOiB0cnVlLAogICBxdW90bWFyazogc2luZ2xlLCB1bmRlZjogdHJ1ZSwgdW51c2VkOiBzdHJpY3QgKi8KLyogZ2xvYmFsIG1velJUQ0ljZUNhbmRpZGF0ZSwgbW96UlRDUGVlckNvbm5lY3Rpb24sIFByb21pc2UsCm1velJUQ1Nlc3Npb25EZXNjcmlwdGlvbiwgd2Via2l0UlRDUGVlckNvbm5lY3Rpb24sIE1lZGlhU3RyZWFtVHJhY2sgKi8KLyogZXhwb3J0ZWQgdHJhY2UscmVxdWVzdFVzZXJNZWRpYSAqLwoKJ3VzZSBzdHJpY3QnOwoKdmFyIGdldFVzZXJNZWRpYSA9IG51bGw7CnZhciBhdHRhY2hNZWRpYVN0cmVhbSA9IG51bGw7CnZhciByZWF0dGFjaE1lZGlhU3RyZWFtID0gbnVsbDsKdmFyIHdlYnJ0Y0RldGVjdGVkQnJvd3NlciA9IG51bGw7CnZhciB3ZWJydGNEZXRlY3RlZFZlcnNpb24gPSBudWxsOwp2YXIgd2VicnRjTWluaW11bVZlcnNpb24gPSBudWxsOwp2YXIgd2VicnRjVXRpbHMgPSB7CiAgbG9nOiBmdW5jdGlvbigpIHsKICAgIC8vIHN1cHByZXNzIGNvbnNvbGUubG9nIG91dHB1dCB3aGVuIGJlaW5nIGluY2x1ZGVkIGFzIGEgbW9kdWxlLgogICAgaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnIHx8CiAgICAgICAgdHlwZW9mIHJlcXVpcmUgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJykgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zb2xlLmxvZy5hcHBseShjb25zb2xlLCBhcmd1bWVudHMpOwogIH0sCiAgZXh0cmFjdFZlcnNpb246IGZ1bmN0aW9uKHVhc3RyaW5nLCBleHByLCBwb3MpIHsKICAgIHZhciBtYXRjaCA9IHVhc3RyaW5nLm1hdGNoKGV4cHIpOwogICAgcmV0dXJuIG1hdGNoICYmIG1hdGNoLmxlbmd0aCA+PSBwb3MgJiYgcGFyc2VJbnQobWF0Y2hbcG9zXSk7CiAgfQp9OwoKZnVuY3Rpb24gdHJhY2UodGV4dCkgewogIC8vIFRoaXMgZnVuY3Rpb24gaXMgdXNlZCBmb3IgbG9nZ2luZy4KICBpZiAodGV4dFt0ZXh0Lmxlbmd0aCAtIDFdID09PSAnXG4nKSB7CiAgICB0ZXh0ID0gdGV4dC5zdWJzdHJpbmcoMCwgdGV4dC5sZW5ndGggLSAxKTsKICB9CiAgaWYgKHdpbmRvdy5wZXJmb3JtYW5jZSkgewogICAgdmFyIG5vdyA9ICh3aW5kb3cucGVyZm9ybWFuY2Uubm93KCkgLyAxMDAwKS50b0ZpeGVkKDMpOwogICAgd2VicnRjVXRpbHMubG9nKG5vdyArICc6ICcgKyB0ZXh0KTsKICB9IGVsc2UgewogICAgd2VicnRjVXRpbHMubG9nKHRleHQpOwogIH0KfQoKaWYgKHR5cGVvZiB3aW5kb3cgPT09ICdvYmplY3QnKSB7CiAgaWYgKHdpbmRvdy5IVE1MTWVkaWFFbGVtZW50ICYmCiAgICAhKCdzcmNPYmplY3QnIGluIHdpbmRvdy5IVE1MTWVkaWFFbGVtZW50LnByb3RvdHlwZSkpIHsKICAgIC8vIFNoaW0gdGhlIHNyY09iamVjdCBwcm9wZXJ0eSwgb25jZSwgd2hlbiBIVE1MTWVkaWFFbGVtZW50IGlzIGZvdW5kLgogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHdpbmRvdy5IVE1MTWVkaWFFbGVtZW50LnByb3RvdHlwZSwgJ3NyY09iamVjdCcsIHsKICAgICAgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICAvLyBJZiBwcmVmaXhlZCBzcmNPYmplY3QgcHJvcGVydHkgZXhpc3RzLCByZXR1cm4gaXQuCiAgICAgICAgLy8gT3RoZXJ3aXNlIHVzZSB0aGUgc2hpbW1lZCBwcm9wZXJ0eSwgX3NyY09iamVjdAogICAgICAgIHJldHVybiAnbW96U3JjT2JqZWN0JyBpbiB0aGlzID8gdGhpcy5tb3pTcmNPYmplY3QgOiB0aGlzLl9zcmNPYmplY3Q7CiAgICAgIH0sCiAgICAgIHNldDogZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAgICAgaWYgKCdtb3pTcmNPYmplY3QnIGluIHRoaXMpIHsKICAgICAgICAgIHRoaXMubW96U3JjT2JqZWN0ID0gc3RyZWFtOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAvLyBVc2UgX3NyY09iamVjdCBhcyBhIHByaXZhdGUgcHJvcGVydHkgZm9yIHRoaXMgc2hpbQogICAgICAgICAgdGhpcy5fc3JjT2JqZWN0ID0gc3RyZWFtOwogICAgICAgICAgLy8gVE9ETzogcmV2b2tlT2JqZWN0VXJsKHRoaXMuc3JjKSB3aGVuICFzdHJlYW0gdG8gcmVsZWFzZSByZXNvdXJjZXM/CiAgICAgICAgICB0aGlzLnNyYyA9IFVSTC5jcmVhdGVPYmplY3RVUkwoc3RyZWFtKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwogIH0KICAvLyBQcm94eSBleGlzdGluZyBnbG9iYWxzCiAgZ2V0VXNlck1lZGlhID0gd2luZG93Lm5hdmlnYXRvciAmJiB3aW5kb3cubmF2aWdhdG9yLmdldFVzZXJNZWRpYTsKfQoKLy8gQXR0YWNoIGEgbWVkaWEgc3RyZWFtIHRvIGFuIGVsZW1lbnQuCmF0dGFjaE1lZGlhU3RyZWFtID0gZnVuY3Rpb24oZWxlbWVudCwgc3RyZWFtKSB7CiAgZWxlbWVudC5zcmNPYmplY3QgPSBzdHJlYW07Cn07CgpyZWF0dGFjaE1lZGlhU3RyZWFtID0gZnVuY3Rpb24odG8sIGZyb20pIHsKICB0by5zcmNPYmplY3QgPSBmcm9tLnNyY09iamVjdDsKfTsKCmlmICh0eXBlb2Ygd2luZG93ID09PSAndW5kZWZpbmVkJyB8fCAhd2luZG93Lm5hdmlnYXRvcikgewogIHdlYnJ0Y1V0aWxzLmxvZygnVGhpcyBkb2VzIG5vdCBhcHBlYXIgdG8gYmUgYSBicm93c2VyJyk7CiAgd2VicnRjRGV0ZWN0ZWRCcm93c2VyID0gJ25vdCBhIGJyb3dzZXInOwp9IGVsc2UgaWYgKG5hdmlnYXRvci5tb3pHZXRVc2VyTWVkaWEgJiYgd2luZG93Lm1velJUQ1BlZXJDb25uZWN0aW9uKSB7CiAgd2VicnRjVXRpbHMubG9nKCdUaGlzIGFwcGVhcnMgdG8gYmUgRmlyZWZveCcpOwoKICB3ZWJydGNEZXRlY3RlZEJyb3dzZXIgPSAnZmlyZWZveCc7CgogIC8vIHRoZSBkZXRlY3RlZCBmaXJlZm94IHZlcnNpb24uCiAgd2VicnRjRGV0ZWN0ZWRWZXJzaW9uID0gd2VicnRjVXRpbHMuZXh0cmFjdFZlcnNpb24obmF2aWdhdG9yLnVzZXJBZ2VudCwKICAgICAgL0ZpcmVmb3hcLyhbMC05XSspXC4vLCAxKTsKCiAgLy8gdGhlIG1pbmltdW0gZmlyZWZveCB2ZXJzaW9uIHN0aWxsIHN1cHBvcnRlZCBieSBhZGFwdGVyLgogIHdlYnJ0Y01pbmltdW1WZXJzaW9uID0gMzE7CgogIC8vIFRoZSBSVENQZWVyQ29ubmVjdGlvbiBvYmplY3QuCiAgd2luZG93LlJUQ1BlZXJDb25uZWN0aW9uID0gZnVuY3Rpb24ocGNDb25maWcsIHBjQ29uc3RyYWludHMpIHsKICAgIGlmICh3ZWJydGNEZXRlY3RlZFZlcnNpb24gPCAzOCkgewogICAgICAvLyAudXJscyBpcyBub3Qgc3VwcG9ydGVkIGluIEZGIDwgMzguCiAgICAgIC8vIGNyZWF0ZSBSVENJY2VTZXJ2ZXJzIHdpdGggYSBzaW5nbGUgdXJsLgogICAgICBpZiAocGNDb25maWcgJiYgcGNDb25maWcuaWNlU2VydmVycykgewogICAgICAgIHZhciBuZXdJY2VTZXJ2ZXJzID0gW107CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwY0NvbmZpZy5pY2VTZXJ2ZXJzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICB2YXIgc2VydmVyID0gcGNDb25maWcuaWNlU2VydmVyc1tpXTsKICAgICAgICAgIGlmIChzZXJ2ZXIuaGFzT3duUHJvcGVydHkoJ3VybHMnKSkgewogICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHNlcnZlci51cmxzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAgdmFyIG5ld1NlcnZlciA9IHsKICAgICAgICAgICAgICAgIHVybDogc2VydmVyLnVybHNbal0KICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIGlmIChzZXJ2ZXIudXJsc1tqXS5pbmRleE9mKCd0dXJuJykgPT09IDApIHsKICAgICAgICAgICAgICAgIG5ld1NlcnZlci51c2VybmFtZSA9IHNlcnZlci51c2VybmFtZTsKICAgICAgICAgICAgICAgIG5ld1NlcnZlci5jcmVkZW50aWFsID0gc2VydmVyLmNyZWRlbnRpYWw7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIG5ld0ljZVNlcnZlcnMucHVzaChuZXdTZXJ2ZXIpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBuZXdJY2VTZXJ2ZXJzLnB1c2gocGNDb25maWcuaWNlU2VydmVyc1tpXSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHBjQ29uZmlnLmljZVNlcnZlcnMgPSBuZXdJY2VTZXJ2ZXJzOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gbmV3IG1velJUQ1BlZXJDb25uZWN0aW9uKHBjQ29uZmlnLCBwY0NvbnN0cmFpbnRzKTsgLy8ganNjczppZ25vcmUgcmVxdWlyZUNhcGl0YWxpemVkQ29uc3RydWN0b3JzCiAgfTsKCiAgLy8gVGhlIFJUQ1Nlc3Npb25EZXNjcmlwdGlvbiBvYmplY3QuCiAgaWYgKCF3aW5kb3cuUlRDU2Vzc2lvbkRlc2NyaXB0aW9uKSB7CiAgICB3aW5kb3cuUlRDU2Vzc2lvbkRlc2NyaXB0aW9uID0gbW96UlRDU2Vzc2lvbkRlc2NyaXB0aW9uOwogIH0KCiAgLy8gVGhlIFJUQ0ljZUNhbmRpZGF0ZSBvYmplY3QuCiAgaWYgKCF3aW5kb3cuUlRDSWNlQ2FuZGlkYXRlKSB7CiAgICB3aW5kb3cuUlRDSWNlQ2FuZGlkYXRlID0gbW96UlRDSWNlQ2FuZGlkYXRlOwogIH0KCiAgLy8gZ2V0VXNlck1lZGlhIGNvbnN0cmFpbnRzIHNoaW0uCiAgZ2V0VXNlck1lZGlhID0gZnVuY3Rpb24oY29uc3RyYWludHMsIG9uU3VjY2Vzcywgb25FcnJvcikgewogICAgdmFyIGNvbnN0cmFpbnRzVG9GRjM3ID0gZnVuY3Rpb24oYykgewogICAgICBpZiAodHlwZW9mIGMgIT09ICdvYmplY3QnIHx8IGMucmVxdWlyZSkgewogICAgICAgIHJldHVybiBjOwogICAgICB9CiAgICAgIHZhciByZXF1aXJlID0gW107CiAgICAgIE9iamVjdC5rZXlzKGMpLmZvckVhY2goZnVuY3Rpb24oa2V5KSB7CiAgICAgICAgaWYgKGtleSA9PT0gJ3JlcXVpcmUnIHx8IGtleSA9PT0gJ2FkdmFuY2VkJyB8fCBrZXkgPT09ICdtZWRpYVNvdXJjZScpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgdmFyIHIgPSBjW2tleV0gPSAodHlwZW9mIGNba2V5XSA9PT0gJ29iamVjdCcpID8KICAgICAgICAgICAgY1trZXldIDoge2lkZWFsOiBjW2tleV19OwogICAgICAgIGlmIChyLm1pbiAhPT0gdW5kZWZpbmVkIHx8CiAgICAgICAgICAgIHIubWF4ICE9PSB1bmRlZmluZWQgfHwgci5leGFjdCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICByZXF1aXJlLnB1c2goa2V5KTsKICAgICAgICB9CiAgICAgICAgaWYgKHIuZXhhY3QgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgaWYgKHR5cGVvZiByLmV4YWN0ID09PSAnbnVtYmVyJykgewogICAgICAgICAgICByLm1pbiA9IHIubWF4ID0gci5leGFjdDsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNba2V5XSA9IHIuZXhhY3Q7CiAgICAgICAgICB9CiAgICAgICAgICBkZWxldGUgci5leGFjdDsKICAgICAgICB9CiAgICAgICAgaWYgKHIuaWRlYWwgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgYy5hZHZhbmNlZCA9IGMuYWR2YW5jZWQgfHwgW107CiAgICAgICAgICB2YXIgb2MgPSB7fTsKICAgICAgICAgIGlmICh0eXBlb2Ygci5pZGVhbCA9PT0gJ251bWJlcicpIHsKICAgICAgICAgICAgb2Nba2V5XSA9IHttaW46IHIuaWRlYWwsIG1heDogci5pZGVhbH07CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBvY1trZXldID0gci5pZGVhbDsKICAgICAgICAgIH0KICAgICAgICAgIGMuYWR2YW5jZWQucHVzaChvYyk7CiAgICAgICAgICBkZWxldGUgci5pZGVhbDsKICAgICAgICAgIGlmICghT2JqZWN0LmtleXMocikubGVuZ3RoKSB7CiAgICAgICAgICAgIGRlbGV0ZSBjW2tleV07CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KTsKICAgICAgaWYgKHJlcXVpcmUubGVuZ3RoKSB7CiAgICAgICAgYy5yZXF1aXJlID0gcmVxdWlyZTsKICAgICAgfQogICAgICByZXR1cm4gYzsKICAgIH07CiAgICBpZiAod2VicnRjRGV0ZWN0ZWRWZXJzaW9uIDwgMzgpIHsKICAgICAgd2VicnRjVXRpbHMubG9nKCdzcGVjOiAnICsgSlNPTi5zdHJpbmdpZnkoY29uc3RyYWludHMpKTsKICAgICAgaWYgKGNvbnN0cmFpbnRzLmF1ZGlvKSB7CiAgICAgICAgY29uc3RyYWludHMuYXVkaW8gPSBjb25zdHJhaW50c1RvRkYzNyhjb25zdHJhaW50cy5hdWRpbyk7CiAgICAgIH0KICAgICAgaWYgKGNvbnN0cmFpbnRzLnZpZGVvKSB7CiAgICAgICAgY29uc3RyYWludHMudmlkZW8gPSBjb25zdHJhaW50c1RvRkYzNyhjb25zdHJhaW50cy52aWRlbyk7CiAgICAgIH0KICAgICAgd2VicnRjVXRpbHMubG9nKCdmZjM3OiAnICsgSlNPTi5zdHJpbmdpZnkoY29uc3RyYWludHMpKTsKICAgIH0KICAgIHJldHVybiBuYXZpZ2F0b3IubW96R2V0VXNlck1lZGlhKGNvbnN0cmFpbnRzLCBvblN1Y2Nlc3MsIG9uRXJyb3IpOwogIH07CgogIG5hdmlnYXRvci5nZXRVc2VyTWVkaWEgPSBnZXRVc2VyTWVkaWE7CgogIC8vIFNoaW0gZm9yIG1lZGlhRGV2aWNlcyBvbiBvbGRlciB2ZXJzaW9ucy4KICBpZiAoIW5hdmlnYXRvci5tZWRpYURldmljZXMpIHsKICAgIG5hdmlnYXRvci5tZWRpYURldmljZXMgPSB7Z2V0VXNlck1lZGlhOiByZXF1ZXN0VXNlck1lZGlhLAogICAgICBhZGRFdmVudExpc3RlbmVyOiBmdW5jdGlvbigpIHsgfSwKICAgICAgcmVtb3ZlRXZlbnRMaXN0ZW5lcjogZnVuY3Rpb24oKSB7IH0KICAgIH07CiAgfQogIG5hdmlnYXRvci5tZWRpYURldmljZXMuZW51bWVyYXRlRGV2aWNlcyA9CiAgICAgIG5hdmlnYXRvci5tZWRpYURldmljZXMuZW51bWVyYXRlRGV2aWNlcyB8fCBmdW5jdGlvbigpIHsKICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlKSB7CiAgICAgIHZhciBpbmZvcyA9IFsKICAgICAgICB7a2luZDogJ2F1ZGlvaW5wdXQnLCBkZXZpY2VJZDogJ2RlZmF1bHQnLCBsYWJlbDogJycsIGdyb3VwSWQ6ICcnfSwKICAgICAgICB7a2luZDogJ3ZpZGVvaW5wdXQnLCBkZXZpY2VJZDogJ2RlZmF1bHQnLCBsYWJlbDogJycsIGdyb3VwSWQ6ICcnfQogICAgICBdOwogICAgICByZXNvbHZlKGluZm9zKTsKICAgIH0pOwogIH07CgogIGlmICh3ZWJydGNEZXRlY3RlZFZlcnNpb24gPCA0MSkgewogICAgLy8gV29yayBhcm91bmQgaHR0cDovL2J1Z3ppbC5sYS8xMTY5NjY1CiAgICB2YXIgb3JnRW51bWVyYXRlRGV2aWNlcyA9CiAgICAgICAgbmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5lbnVtZXJhdGVEZXZpY2VzLmJpbmQobmF2aWdhdG9yLm1lZGlhRGV2aWNlcyk7CiAgICBuYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmVudW1lcmF0ZURldmljZXMgPSBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIG9yZ0VudW1lcmF0ZURldmljZXMoKS50aGVuKHVuZGVmaW5lZCwgZnVuY3Rpb24oZSkgewogICAgICAgIGlmIChlLm5hbWUgPT09ICdOb3RGb3VuZEVycm9yJykgewogICAgICAgICAgcmV0dXJuIFtdOwogICAgICAgIH0KICAgICAgICB0aHJvdyBlOwogICAgICB9KTsKICAgIH07CiAgfQp9IGVsc2UgaWYgKG5hdmlnYXRvci53ZWJraXRHZXRVc2VyTWVkaWEgJiYgd2luZG93LndlYmtpdFJUQ1BlZXJDb25uZWN0aW9uKSB7CiAgd2VicnRjVXRpbHMubG9nKCdUaGlzIGFwcGVhcnMgdG8gYmUgQ2hyb21lJyk7CgogIHdlYnJ0Y0RldGVjdGVkQnJvd3NlciA9ICdjaHJvbWUnOwoKICAvLyB0aGUgZGV0ZWN0ZWQgY2hyb21lIHZlcnNpb24uCiAgd2VicnRjRGV0ZWN0ZWRWZXJzaW9uID0gd2VicnRjVXRpbHMuZXh0cmFjdFZlcnNpb24obmF2aWdhdG9yLnVzZXJBZ2VudCwKICAgICAgL0Nocm9tKGV8aXVtKVwvKFswLTldKylcLi8sIDIpOwoKICAvLyB0aGUgbWluaW11bSBjaHJvbWUgdmVyc2lvbiBzdGlsbCBzdXBwb3J0ZWQgYnkgYWRhcHRlci4KICB3ZWJydGNNaW5pbXVtVmVyc2lvbiA9IDM4OwoKICAvLyBUaGUgUlRDUGVlckNvbm5lY3Rpb24gb2JqZWN0LgogIHdpbmRvdy5SVENQZWVyQ29ubmVjdGlvbiA9IGZ1bmN0aW9uKHBjQ29uZmlnLCBwY0NvbnN0cmFpbnRzKSB7CiAgICAvLyBUcmFuc2xhdGUgaWNlVHJhbnNwb3J0UG9saWN5IHRvIGljZVRyYW5zcG9ydHMsCiAgICAvLyBzZWUgaHR0cHM6Ly9jb2RlLmdvb2dsZS5jb20vcC93ZWJydGMvaXNzdWVzL2RldGFpbD9pZD00ODY5CiAgICBpZiAocGNDb25maWcgJiYgcGNDb25maWcuaWNlVHJhbnNwb3J0UG9saWN5KSB7CiAgICAgIHBjQ29uZmlnLmljZVRyYW5zcG9ydHMgPSBwY0NvbmZpZy5pY2VUcmFuc3BvcnRQb2xpY3k7CiAgICB9CgogICAgdmFyIHBjID0gbmV3IHdlYmtpdFJUQ1BlZXJDb25uZWN0aW9uKHBjQ29uZmlnLCBwY0NvbnN0cmFpbnRzKTsgLy8ganNjczppZ25vcmUgcmVxdWlyZUNhcGl0YWxpemVkQ29uc3RydWN0b3JzCiAgICB2YXIgb3JpZ0dldFN0YXRzID0gcGMuZ2V0U3RhdHMuYmluZChwYyk7CiAgICBwYy5nZXRTdGF0cyA9IGZ1bmN0aW9uKHNlbGVjdG9yLCBzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2spIHsgLy8ganNoaW50IGlnbm9yZTogbGluZQogICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgIHZhciBhcmdzID0gYXJndW1lbnRzOwoKICAgICAgLy8gSWYgc2VsZWN0b3IgaXMgYSBmdW5jdGlvbiB0aGVuIHdlIGFyZSBpbiB0aGUgb2xkIHN0eWxlIHN0YXRzIHNvIGp1c3QKICAgICAgLy8gcGFzcyBiYWNrIHRoZSBvcmlnaW5hbCBnZXRTdGF0cyBmb3JtYXQgdG8gYXZvaWQgYnJlYWtpbmcgb2xkIHVzZXJzLgogICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgdHlwZW9mIHNlbGVjdG9yID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgcmV0dXJuIG9yaWdHZXRTdGF0cyhzZWxlY3Rvciwgc3VjY2Vzc0NhbGxiYWNrKTsKICAgICAgfQoKICAgICAgdmFyIGZpeENocm9tZVN0YXRzID0gZnVuY3Rpb24ocmVzcG9uc2UpIHsKICAgICAgICB2YXIgc3RhbmRhcmRSZXBvcnQgPSB7fTsKICAgICAgICB2YXIgcmVwb3J0cyA9IHJlc3BvbnNlLnJlc3VsdCgpOwogICAgICAgIHJlcG9ydHMuZm9yRWFjaChmdW5jdGlvbihyZXBvcnQpIHsKICAgICAgICAgIHZhciBzdGFuZGFyZFN0YXRzID0gewogICAgICAgICAgICBpZDogcmVwb3J0LmlkLAogICAgICAgICAgICB0aW1lc3RhbXA6IHJlcG9ydC50aW1lc3RhbXAsCiAgICAgICAgICAgIHR5cGU6IHJlcG9ydC50eXBlCiAgICAgICAgICB9OwogICAgICAgICAgcmVwb3J0Lm5hbWVzKCkuZm9yRWFjaChmdW5jdGlvbihuYW1lKSB7CiAgICAgICAgICAgIHN0YW5kYXJkU3RhdHNbbmFtZV0gPSByZXBvcnQuc3RhdChuYW1lKTsKICAgICAgICAgIH0pOwogICAgICAgICAgc3RhbmRhcmRSZXBvcnRbc3RhbmRhcmRTdGF0cy5pZF0gPSBzdGFuZGFyZFN0YXRzOwogICAgICAgIH0pOwoKICAgICAgICByZXR1cm4gc3RhbmRhcmRSZXBvcnQ7CiAgICAgIH07CgogICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA+PSAyKSB7CiAgICAgICAgdmFyIHN1Y2Nlc3NDYWxsYmFja1dyYXBwZXIgPSBmdW5jdGlvbihyZXNwb25zZSkgewogICAgICAgICAgYXJnc1sxXShmaXhDaHJvbWVTdGF0cyhyZXNwb25zZSkpOwogICAgICAgIH07CgogICAgICAgIHJldHVybiBvcmlnR2V0U3RhdHMuYXBwbHkodGhpcywgW3N1Y2Nlc3NDYWxsYmFja1dyYXBwZXIsIGFyZ3VtZW50c1swXV0pOwogICAgICB9CgogICAgICAvLyBwcm9taXNlLXN1cHBvcnQKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgIGlmIChhcmdzLmxlbmd0aCA9PT0gMSAmJiBzZWxlY3RvciA9PT0gbnVsbCkgewogICAgICAgICAgb3JpZ0dldFN0YXRzLmFwcGx5KHNlbGYsIFsKICAgICAgICAgICAgICBmdW5jdGlvbihyZXNwb25zZSkgewogICAgICAgICAgICAgICAgcmVzb2x2ZS5hcHBseShudWxsLCBbZml4Q2hyb21lU3RhdHMocmVzcG9uc2UpXSk7CiAgICAgICAgICAgICAgfSwgcmVqZWN0XSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG9yaWdHZXRTdGF0cy5hcHBseShzZWxmLCBbcmVzb2x2ZSwgcmVqZWN0XSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH07CgogICAgcmV0dXJuIHBjOwogIH07CgogIC8vIGFkZCBwcm9taXNlIHN1cHBvcnQKICBbJ2NyZWF0ZU9mZmVyJywgJ2NyZWF0ZUFuc3dlciddLmZvckVhY2goZnVuY3Rpb24obWV0aG9kKSB7CiAgICB2YXIgbmF0aXZlTWV0aG9kID0gd2Via2l0UlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlW21ldGhvZF07CiAgICB3ZWJraXRSVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGVbbWV0aG9kXSA9IGZ1bmN0aW9uKCkgewogICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoIDwgMSB8fCAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMSAmJgogICAgICAgICAgdHlwZW9mKGFyZ3VtZW50c1swXSkgPT09ICdvYmplY3QnKSkgewogICAgICAgIHZhciBvcHRzID0gYXJndW1lbnRzLmxlbmd0aCA9PT0gMSA/IGFyZ3VtZW50c1swXSA6IHVuZGVmaW5lZDsKICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgICBuYXRpdmVNZXRob2QuYXBwbHkoc2VsZiwgW3Jlc29sdmUsIHJlamVjdCwgb3B0c10pOwogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBuYXRpdmVNZXRob2QuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQogICAgfTsKICB9KTsKCiAgWydzZXRMb2NhbERlc2NyaXB0aW9uJywgJ3NldFJlbW90ZURlc2NyaXB0aW9uJywKICAgICAgJ2FkZEljZUNhbmRpZGF0ZSddLmZvckVhY2goZnVuY3Rpb24obWV0aG9kKSB7CiAgICB2YXIgbmF0aXZlTWV0aG9kID0gd2Via2l0UlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlW21ldGhvZF07CiAgICB3ZWJraXRSVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGVbbWV0aG9kXSA9IGZ1bmN0aW9uKCkgewogICAgICB2YXIgYXJncyA9IGFyZ3VtZW50czsKICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgbmF0aXZlTWV0aG9kLmFwcGx5KHNlbGYsIFthcmdzWzBdLAogICAgICAgICAgICBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICByZXNvbHZlKCk7CiAgICAgICAgICAgICAgaWYgKGFyZ3MubGVuZ3RoID49IDIpIHsKICAgICAgICAgICAgICAgIGFyZ3NbMV0uYXBwbHkobnVsbCwgW10pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgZnVuY3Rpb24oZXJyKSB7CiAgICAgICAgICAgICAgcmVqZWN0KGVycik7CiAgICAgICAgICAgICAgaWYgKGFyZ3MubGVuZ3RoID49IDMpIHsKICAgICAgICAgICAgICAgIGFyZ3NbMl0uYXBwbHkobnVsbCwgW2Vycl0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfV0KICAgICAgICAgICk7CiAgICAgIH0pOwogICAgfTsKICB9KTsKCiAgLy8gZ2V0VXNlck1lZGlhIGNvbnN0cmFpbnRzIHNoaW0uCiAgdmFyIGNvbnN0cmFpbnRzVG9DaHJvbWUgPSBmdW5jdGlvbihjKSB7CiAgICBpZiAodHlwZW9mIGMgIT09ICdvYmplY3QnIHx8IGMubWFuZGF0b3J5IHx8IGMub3B0aW9uYWwpIHsKICAgICAgcmV0dXJuIGM7CiAgICB9CiAgICB2YXIgY2MgPSB7fTsKICAgIE9iamVjdC5rZXlzKGMpLmZvckVhY2goZnVuY3Rpb24oa2V5KSB7CiAgICAgIGlmIChrZXkgPT09ICdyZXF1aXJlJyB8fCBrZXkgPT09ICdhZHZhbmNlZCcgfHwga2V5ID09PSAnbWVkaWFTb3VyY2UnKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIHZhciByID0gKHR5cGVvZiBjW2tleV0gPT09ICdvYmplY3QnKSA/IGNba2V5XSA6IHtpZGVhbDogY1trZXldfTsKICAgICAgaWYgKHIuZXhhY3QgIT09IHVuZGVmaW5lZCAmJiB0eXBlb2Ygci5leGFjdCA9PT0gJ251bWJlcicpIHsKICAgICAgICByLm1pbiA9IHIubWF4ID0gci5leGFjdDsKICAgICAgfQogICAgICB2YXIgb2xkbmFtZSA9IGZ1bmN0aW9uKHByZWZpeCwgbmFtZSkgewogICAgICAgIGlmIChwcmVmaXgpIHsKICAgICAgICAgIHJldHVybiBwcmVmaXggKyBuYW1lLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgbmFtZS5zbGljZSgxKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIChuYW1lID09PSAnZGV2aWNlSWQnKSA/ICdzb3VyY2VJZCcgOiBuYW1lOwogICAgICB9OwogICAgICBpZiAoci5pZGVhbCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgY2Mub3B0aW9uYWwgPSBjYy5vcHRpb25hbCB8fCBbXTsKICAgICAgICB2YXIgb2MgPSB7fTsKICAgICAgICBpZiAodHlwZW9mIHIuaWRlYWwgPT09ICdudW1iZXInKSB7CiAgICAgICAgICBvY1tvbGRuYW1lKCdtaW4nLCBrZXkpXSA9IHIuaWRlYWw7CiAgICAgICAgICBjYy5vcHRpb25hbC5wdXNoKG9jKTsKICAgICAgICAgIG9jID0ge307CiAgICAgICAgICBvY1tvbGRuYW1lKCdtYXgnLCBrZXkpXSA9IHIuaWRlYWw7CiAgICAgICAgICBjYy5vcHRpb25hbC5wdXNoKG9jKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgb2Nbb2xkbmFtZSgnJywga2V5KV0gPSByLmlkZWFsOwogICAgICAgICAgY2Mub3B0aW9uYWwucHVzaChvYyk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChyLmV4YWN0ICE9PSB1bmRlZmluZWQgJiYgdHlwZW9mIHIuZXhhY3QgIT09ICdudW1iZXInKSB7CiAgICAgICAgY2MubWFuZGF0b3J5ID0gY2MubWFuZGF0b3J5IHx8IHt9OwogICAgICAgIGNjLm1hbmRhdG9yeVtvbGRuYW1lKCcnLCBrZXkpXSA9IHIuZXhhY3Q7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgWydtaW4nLCAnbWF4J10uZm9yRWFjaChmdW5jdGlvbihtaXgpIHsKICAgICAgICAgIGlmIChyW21peF0gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBjYy5tYW5kYXRvcnkgPSBjYy5tYW5kYXRvcnkgfHwge307CiAgICAgICAgICAgIGNjLm1hbmRhdG9yeVtvbGRuYW1lKG1peCwga2V5KV0gPSByW21peF07CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0pOwogICAgaWYgKGMuYWR2YW5jZWQpIHsKICAgICAgY2Mub3B0aW9uYWwgPSAoY2Mub3B0aW9uYWwgfHwgW10pLmNvbmNhdChjLmFkdmFuY2VkKTsKICAgIH0KICAgIHJldHVybiBjYzsKICB9OwoKICBnZXRVc2VyTWVkaWEgPSBmdW5jdGlvbihjb25zdHJhaW50cywgb25TdWNjZXNzLCBvbkVycm9yKSB7CiAgICBpZiAoY29uc3RyYWludHMuYXVkaW8pIHsKICAgICAgY29uc3RyYWludHMuYXVkaW8gPSBjb25zdHJhaW50c1RvQ2hyb21lKGNvbnN0cmFpbnRzLmF1ZGlvKTsKICAgIH0KICAgIGlmIChjb25zdHJhaW50cy52aWRlbykgewogICAgICBjb25zdHJhaW50cy52aWRlbyA9IGNvbnN0cmFpbnRzVG9DaHJvbWUoY29uc3RyYWludHMudmlkZW8pOwogICAgfQogICAgd2VicnRjVXRpbHMubG9nKCdjaHJvbWU6ICcgKyBKU09OLnN0cmluZ2lmeShjb25zdHJhaW50cykpOwogICAgcmV0dXJuIG5hdmlnYXRvci53ZWJraXRHZXRVc2VyTWVkaWEoY29uc3RyYWludHMsIG9uU3VjY2Vzcywgb25FcnJvcik7CiAgfTsKICBuYXZpZ2F0b3IuZ2V0VXNlck1lZGlhID0gZ2V0VXNlck1lZGlhOwoKICBpZiAoIW5hdmlnYXRvci5tZWRpYURldmljZXMpIHsKICAgIG5hdmlnYXRvci5tZWRpYURldmljZXMgPSB7Z2V0VXNlck1lZGlhOiByZXF1ZXN0VXNlck1lZGlhLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbnVtZXJhdGVEZXZpY2VzOiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUpIHsKICAgICAgICB2YXIga2luZHMgPSB7YXVkaW86ICdhdWRpb2lucHV0JywgdmlkZW86ICd2aWRlb2lucHV0J307CiAgICAgICAgcmV0dXJuIE1lZGlhU3RyZWFtVHJhY2suZ2V0U291cmNlcyhmdW5jdGlvbihkZXZpY2VzKSB7CiAgICAgICAgICByZXNvbHZlKGRldmljZXMubWFwKGZ1bmN0aW9uKGRldmljZSkgewogICAgICAgICAgICByZXR1cm4ge2xhYmVsOiBkZXZpY2UubGFiZWwsCiAgICAgICAgICAgICAgICAgICAga2luZDoga2luZHNbZGV2aWNlLmtpbmRdLAogICAgICAgICAgICAgICAgICAgIGRldmljZUlkOiBkZXZpY2UuaWQsCiAgICAgICAgICAgICAgICAgICAgZ3JvdXBJZDogJyd9OwogICAgICAgICAgfSkpOwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH19OwogIH0KCiAgLy8gQSBzaGltIGZvciBnZXRVc2VyTWVkaWEgbWV0aG9kIG9uIHRoZSBtZWRpYURldmljZXMgb2JqZWN0LgogIC8vIFRPRE8oS2FwdGVuSmFuc3NvbikgcmVtb3ZlIG9uY2UgaW1wbGVtZW50ZWQgaW4gQ2hyb21lIHN0YWJsZS4KICBpZiAoIW5hdmlnYXRvci5tZWRpYURldmljZXMuZ2V0VXNlck1lZGlhKSB7CiAgICBuYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmdldFVzZXJNZWRpYSA9IGZ1bmN0aW9uKGNvbnN0cmFpbnRzKSB7CiAgICAgIHJldHVybiByZXF1ZXN0VXNlck1lZGlhKGNvbnN0cmFpbnRzKTsKICAgIH07CiAgfSBlbHNlIHsKICAgIC8vIEV2ZW4gdGhvdWdoIENocm9tZSA0NSBoYXMgbmF2aWdhdG9yLm1lZGlhRGV2aWNlcyBhbmQgYSBnZXRVc2VyTWVkaWEKICAgIC8vIGZ1bmN0aW9uIHdoaWNoIHJldHVybnMgYSBQcm9taXNlLCBpdCBkb2VzIG5vdCBhY2NlcHQgc3BlYy1zdHlsZQogICAgLy8gY29uc3RyYWludHMuCiAgICB2YXIgb3JpZ0dldFVzZXJNZWRpYSA9IG5hdmlnYXRvci5tZWRpYURldmljZXMuZ2V0VXNlck1lZGlhLgogICAgICAgIGJpbmQobmF2aWdhdG9yLm1lZGlhRGV2aWNlcyk7CiAgICBuYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmdldFVzZXJNZWRpYSA9IGZ1bmN0aW9uKGMpIHsKICAgICAgd2VicnRjVXRpbHMubG9nKCdzcGVjOiAgICcgKyBKU09OLnN0cmluZ2lmeShjKSk7IC8vIHdoaXRlc3BhY2UgZm9yIGFsaWdubWVudAogICAgICBjLmF1ZGlvID0gY29uc3RyYWludHNUb0Nocm9tZShjLmF1ZGlvKTsKICAgICAgYy52aWRlbyA9IGNvbnN0cmFpbnRzVG9DaHJvbWUoYy52aWRlbyk7CiAgICAgIHdlYnJ0Y1V0aWxzLmxvZygnY2hyb21lOiAnICsgSlNPTi5zdHJpbmdpZnkoYykpOwogICAgICByZXR1cm4gb3JpZ0dldFVzZXJNZWRpYShjKTsKICAgIH07CiAgfQoKICAvLyBEdW1teSBkZXZpY2VjaGFuZ2UgZXZlbnQgbWV0aG9kcy4KICAvLyBUT0RPKEthcHRlbkphbnNzb24pIHJlbW92ZSBvbmNlIGltcGxlbWVudGVkIGluIENocm9tZSBzdGFibGUuCiAgaWYgKHR5cGVvZiBuYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmFkZEV2ZW50TGlzdGVuZXIgPT09ICd1bmRlZmluZWQnKSB7CiAgICBuYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmFkZEV2ZW50TGlzdGVuZXIgPSBmdW5jdGlvbigpIHsKICAgICAgd2VicnRjVXRpbHMubG9nKCdEdW1teSBtZWRpYURldmljZXMuYWRkRXZlbnRMaXN0ZW5lciBjYWxsZWQuJyk7CiAgICB9OwogIH0KICBpZiAodHlwZW9mIG5hdmlnYXRvci5tZWRpYURldmljZXMucmVtb3ZlRXZlbnRMaXN0ZW5lciA9PT0gJ3VuZGVmaW5lZCcpIHsKICAgIG5hdmlnYXRvci5tZWRpYURldmljZXMucmVtb3ZlRXZlbnRMaXN0ZW5lciA9IGZ1bmN0aW9uKCkgewogICAgICB3ZWJydGNVdGlscy5sb2coJ0R1bW15IG1lZGlhRGV2aWNlcy5yZW1vdmVFdmVudExpc3RlbmVyIGNhbGxlZC4nKTsKICAgIH07CiAgfQoKICAvLyBBdHRhY2ggYSBtZWRpYSBzdHJlYW0gdG8gYW4gZWxlbWVudC4KICBhdHRhY2hNZWRpYVN0cmVhbSA9IGZ1bmN0aW9uKGVsZW1lbnQsIHN0cmVhbSkgewogICAgaWYgKHdlYnJ0Y0RldGVjdGVkVmVyc2lvbiA+PSA0MykgewogICAgICBlbGVtZW50LnNyY09iamVjdCA9IHN0cmVhbTsKICAgIH0gZWxzZSBpZiAodHlwZW9mIGVsZW1lbnQuc3JjICE9PSAndW5kZWZpbmVkJykgewogICAgICBlbGVtZW50LnNyYyA9IFVSTC5jcmVhdGVPYmplY3RVUkwoc3RyZWFtKTsKICAgIH0gZWxzZSB7CiAgICAgIHdlYnJ0Y1V0aWxzLmxvZygnRXJyb3IgYXR0YWNoaW5nIHN0cmVhbSB0byBlbGVtZW50LicpOwogICAgfQogIH07CiAgcmVhdHRhY2hNZWRpYVN0cmVhbSA9IGZ1bmN0aW9uKHRvLCBmcm9tKSB7CiAgICBpZiAod2VicnRjRGV0ZWN0ZWRWZXJzaW9uID49IDQzKSB7CiAgICAgIHRvLnNyY09iamVjdCA9IGZyb20uc3JjT2JqZWN0OwogICAgfSBlbHNlIHsKICAgICAgdG8uc3JjID0gZnJvbS5zcmM7CiAgICB9CiAgfTsKCn0gZWxzZSBpZiAobmF2aWdhdG9yLm1lZGlhRGV2aWNlcyAmJiBuYXZpZ2F0b3IudXNlckFnZW50Lm1hdGNoKAogICAgL0VkZ2VcLyhcZCspLihcZCspJC8pKSB7CiAgd2VicnRjVXRpbHMubG9nKCdUaGlzIGFwcGVhcnMgdG8gYmUgRWRnZScpOwogIHdlYnJ0Y0RldGVjdGVkQnJvd3NlciA9ICdlZGdlJzsKCiAgd2VicnRjRGV0ZWN0ZWRWZXJzaW9uID0gd2VicnRjVXRpbHMuZXh0cmFjdFZlcnNpb24obmF2aWdhdG9yLnVzZXJBZ2VudCwKICAgICAgL0VkZ2VcLyhcZCspLihcZCspJC8sIDIpOwoKICAvLyB0aGUgbWluaW11bSB2ZXJzaW9uIHN0aWxsIHN1cHBvcnRlZCBieSBhZGFwdGVyLgogIHdlYnJ0Y01pbmltdW1WZXJzaW9uID0gMTI7Cn0gZWxzZSB7CiAgd2VicnRjVXRpbHMubG9nKCdCcm93c2VyIGRvZXMgbm90IGFwcGVhciB0byBiZSBXZWJSVEMtY2FwYWJsZScpOwp9CgovLyBSZXR1cm5zIHRoZSByZXN1bHQgb2YgZ2V0VXNlck1lZGlhIGFzIGEgUHJvbWlzZS4KZnVuY3Rpb24gcmVxdWVzdFVzZXJNZWRpYShjb25zdHJhaW50cykgewogIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHsKICAgIGdldFVzZXJNZWRpYShjb25zdHJhaW50cywgcmVzb2x2ZSwgcmVqZWN0KTsKICB9KTsKfQoKdmFyIHdlYnJ0Y1Rlc3RpbmcgPSB7fTsKdHJ5IHsKICBPYmplY3QuZGVmaW5lUHJvcGVydHkod2VicnRjVGVzdGluZywgJ3ZlcnNpb24nLCB7CiAgICBzZXQ6IGZ1bmN0aW9uKHZlcnNpb24pIHsKICAgICAgd2VicnRjRGV0ZWN0ZWRWZXJzaW9uID0gdmVyc2lvbjsKICAgIH0KICB9KTsKfSBjYXRjaCAoZSkge30KCmlmICh0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJykgewogIHZhciBSVENQZWVyQ29ubmVjdGlvbjsKICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgIFJUQ1BlZXJDb25uZWN0aW9uID0gd2luZG93LlJUQ1BlZXJDb25uZWN0aW9uOwogIH0KICBtb2R1bGUuZXhwb3J0cyA9IHsKICAgIFJUQ1BlZXJDb25uZWN0aW9uOiBSVENQZWVyQ29ubmVjdGlvbiwKICAgIGdldFVzZXJNZWRpYTogZ2V0VXNlck1lZGlhLAogICAgYXR0YWNoTWVkaWFTdHJlYW06IGF0dGFjaE1lZGlhU3RyZWFtLAogICAgcmVhdHRhY2hNZWRpYVN0cmVhbTogcmVhdHRhY2hNZWRpYVN0cmVhbSwKICAgIHdlYnJ0Y0RldGVjdGVkQnJvd3Nlcjogd2VicnRjRGV0ZWN0ZWRCcm93c2VyLAogICAgd2VicnRjRGV0ZWN0ZWRWZXJzaW9uOiB3ZWJydGNEZXRlY3RlZFZlcnNpb24sCiAgICB3ZWJydGNNaW5pbXVtVmVyc2lvbjogd2VicnRjTWluaW11bVZlcnNpb24sCiAgICB3ZWJydGNUZXN0aW5nOiB3ZWJydGNUZXN0aW5nLAogICAgd2VicnRjVXRpbHM6IHdlYnJ0Y1V0aWxzCiAgICAvL3JlcXVlc3RVc2VyTWVkaWE6IG5vdCBleHBvc2VkIG9uIHB1cnBvc2UuCiAgICAvL3RyYWNlOiBub3QgZXhwb3NlZCBvbiBwdXJwb3NlLgogIH07Cn0gZWxzZSBpZiAoKHR5cGVvZiByZXF1aXJlID09PSAnZnVuY3Rpb24nKSAmJiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJykpIHsKICAvLyBFeHBvc2Ugb2JqZWN0cyBhbmQgZnVuY3Rpb25zIHdoZW4gUmVxdWlyZUpTIGlzIGRvaW5nIHRoZSBsb2FkaW5nLgogIGRlZmluZShbXSwgZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gewogICAgICBSVENQZWVyQ29ubmVjdGlvbjogd2luZG93LlJUQ1BlZXJDb25uZWN0aW9uLAogICAgICBnZXRVc2VyTWVkaWE6IGdldFVzZXJNZWRpYSwKICAgICAgYXR0YWNoTWVkaWFTdHJlYW06IGF0dGFjaE1lZGlhU3RyZWFtLAogICAgICByZWF0dGFjaE1lZGlhU3RyZWFtOiByZWF0dGFjaE1lZGlhU3RyZWFtLAogICAgICB3ZWJydGNEZXRlY3RlZEJyb3dzZXI6IHdlYnJ0Y0RldGVjdGVkQnJvd3NlciwKICAgICAgd2VicnRjRGV0ZWN0ZWRWZXJzaW9uOiB3ZWJydGNEZXRlY3RlZFZlcnNpb24sCiAgICAgIHdlYnJ0Y01pbmltdW1WZXJzaW9uOiB3ZWJydGNNaW5pbXVtVmVyc2lvbiwKICAgICAgd2VicnRjVGVzdGluZzogd2VicnRjVGVzdGluZywKICAgICAgd2VicnRjVXRpbHM6IHdlYnJ0Y1V0aWxzCiAgICAgIC8vcmVxdWVzdFVzZXJNZWRpYTogbm90IGV4cG9zZWQgb24gcHVycG9zZS4KICAgICAgLy90cmFjZTogbm90IGV4cG9zZWQgb24gcHVycG9zZS4KICAgIH07CiAgfSk7Cn0KCn0se31dLDM6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewondXNlIHN0cmljdCc7CgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7CiAgdmFsdWU6IHRydWUKfSk7Cgp2YXIgX2NyZWF0ZUNsYXNzID0gKGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmICgndmFsdWUnIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfSByZXR1cm4gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9OyB9KSgpOwoKZXhwb3J0c1snZGVmYXVsdCddID0gYWN0aXZhdGU7CgpmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyAnZGVmYXVsdCc6IG9iaiB9OyB9CgpmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoJ0Nhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbicpOyB9IH0KCnZhciBfc3JjU2VydmljZUZyYW1ld29yayA9IHJlcXVpcmUoJy4uL3NyYy9zZXJ2aWNlLWZyYW1ld29yaycpOwoKdmFyIF9zcmNIeXBlcnR5SHlwZXJ0eUNvbm5lY3RvciA9IHJlcXVpcmUoJy4uL3NyYy9oeXBlcnR5L0h5cGVydHlDb25uZWN0b3InKTsKCnZhciBfc3JjSHlwZXJ0eUh5cGVydHlDb25uZWN0b3IyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfc3JjSHlwZXJ0eUh5cGVydHlDb25uZWN0b3IpOwoKdmFyIEhlbGxvSHlwZXJ0eSA9IChmdW5jdGlvbiAoKSB7CiAgZnVuY3Rpb24gSGVsbG9IeXBlcnR5KGh5cGVydHlVUkwsIGJ1cywgY29uZmlndXJhdGlvbikgewogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEhlbGxvSHlwZXJ0eSk7CgogICAgY29uc29sZS5sb2coJ1dvcmxkIEh5cGVydHkgSW5zdGFuY2UnKTsKCiAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgX3RoaXMuYnVzID0gYnVzOwogICAgX3RoaXMuY29uZmlndXJhdGlvbiA9IGNvbmZpZ3VyYXRpb247CiAgICBfdGhpcy5oeXBlcnR5VVJMID0gaHlwZXJ0eVVSTDsKCiAgICB2YXIgc3luY2hlciA9IG5ldyBfc3JjU2VydmljZUZyYW1ld29yay5TeW5jaGVyKGh5cGVydHlVUkwsIGJ1cywgY29uZmlndXJhdGlvbik7CiAgICBfdGhpcy5zeW5jaGVyID0gc3luY2hlcjsKCiAgICBfdGhpcy5zeW5jaGVyLm9uTm90aWZpY2F0aW9uKGZ1bmN0aW9uIChldmVudCkgewogICAgICBjb25zb2xlLmxvZygnaHlwZXJ0eSBoZWxsbyBoYXZlIGFuIG5vdGlmaWNhdGlvbjogJywgZXZlbnQpOwogICAgICBfdGhpcy5oeXBlcnR5Q29ubmVjdG9yLl9vbk5vdGlmaWNhdGlvbihldmVudCwgaHlwZXJ0eVVSTCk7CiAgICB9KTsKCiAgICBfdGhpcy5oeXBlcnR5Q29ubmVjdG9yID0gbmV3IF9zcmNIeXBlcnR5SHlwZXJ0eUNvbm5lY3RvcjJbJ2RlZmF1bHQnXShzeW5jaGVyKTsKICAgIF90aGlzLmh5cGVydHlDb25uZWN0b3IubmFtZSA9ICdIZWxsbyBIeXBlcnR5JzsKICB9CgogIF9jcmVhdGVDbGFzcyhIZWxsb0h5cGVydHksIFt7CiAgICBrZXk6ICdjb25uZWN0JywKICAgIHZhbHVlOiBmdW5jdGlvbiBjb25uZWN0KGh5cGVydHlVUkwsIG9wdGlvbnMpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgX3RoaXMudG8gPSBoeXBlcnR5VVJMOwoKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKCiAgICAgICAgY29uc29sZS5pbmZvKCdDb25uZWN0aW5nIHRvOiAnLCBoeXBlcnR5VVJMKTsKICAgICAgICBfdGhpcy5oeXBlcnR5Q29ubmVjdG9yLmNvbm5lY3QoaHlwZXJ0eVVSTCwgb3B0aW9ucykudGhlbihmdW5jdGlvbiAoY29udHJvbGxlcikgewogICAgICAgICAgY29uc29sZS5pbmZvKCdDb25uZWN0ZWQgdG86ICcsIGh5cGVydHlVUkwsIGNvbnRyb2xsZXIpOwogICAgICAgICAgcmVzb2x2ZShjb250cm9sbGVyKTsKICAgICAgICB9KVsnY2F0Y2gnXShmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgICAgICByZWplY3QocmVhc29uKTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAnYWNjZXB0JywKICAgIHZhbHVlOiBmdW5jdGlvbiBhY2NlcHQoKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewoKICAgICAgICBjb25zb2xlLmluZm8oJ1N1YnNjcmliaW5nIG9iamVjdCcpOwogICAgICAgIF90aGlzLmh5cGVydHlDb25uZWN0b3IuYWNjZXB0KCkudGhlbihmdW5jdGlvbiAoY29udHJvbGxlcikgewogICAgICAgICAgY29uc29sZS5pbmZvKCdzdWJzY3JpYmVkIHRvOiAnLCBjb250cm9sbGVyKTsKICAgICAgICAgIHJlc29sdmUoY29udHJvbGxlcik7CiAgICAgICAgfSlbJ2NhdGNoJ10oZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgICAgY29uc29sZS5lcnJvcihyZWFzb24pOwogICAgICAgICAgcmVqZWN0KHJlYXNvbik7CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogJ2Rpc2Nvbm5lY3QnLAogICAgdmFsdWU6IGZ1bmN0aW9uIGRpc2Nvbm5lY3QoKSB7CgogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKCiAgICAgICAgY29uc29sZS5pbmZvKCdkaXNjb25uZWN0aW5nIG9iamVjdCcpOwogICAgICAgIF90aGlzLmh5cGVydHlDb25uZWN0b3IuZGlzY29ubmVjdCgpLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgICAgY29uc29sZS5pbmZvKCdkaXNjb25uZWN0ZWQnKTsKICAgICAgICAgIHJlc29sdmUocmVzdWx0KTsKICAgICAgICB9KVsnY2F0Y2gnXShmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgICAgICBjb25zb2xlLmVycm9yKHJlYXNvbik7CiAgICAgICAgICByZWplY3QocmVhc29uKTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAnc2VuZE1lc3NhZ2UnLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNlbmRNZXNzYWdlKCkgewoKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIF90aGlzLmJ1cy5wb3N0TWVzc2FnZSh7CiAgICAgICAgZnJvbTogX3RoaXMuaHlwZXJ0eVVSTCwKICAgICAgICB0bzogJ2h5cGVydHktcnVudGltZTovL3NwMS9Xb3JsZEh5cGVydHknLAogICAgICAgIGJvZHk6IHsKICAgICAgICAgIHZhbHVlOiAnSGVsbG8gZnJvbSB3b3JsZCBoeXBlcnR5IGluc3RhbmNlJwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgfV0pOwoKICByZXR1cm4gSGVsbG9IeXBlcnR5Owp9KSgpOwoKZnVuY3Rpb24gYWN0aXZhdGUoaHlwZXJ0eVVSTCwgYnVzLCBjb25maWd1cmF0aW9uKSB7CgogIHJldHVybiB7CiAgICBoeXBlcnR5TmFtZTogJ0hlbGxvSHlwZXJ0eScsCiAgICBoeXBlcnR5Q29kZTogbmV3IEhlbGxvSHlwZXJ0eShoeXBlcnR5VVJMLCBidXMsIGNvbmZpZ3VyYXRpb24pCiAgfTsKfQoKbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWydkZWZhdWx0J107Cgp9LHsiLi4vc3JjL2h5cGVydHkvSHlwZXJ0eUNvbm5lY3RvciI6MTMsIi4uL3NyYy9zZXJ2aWNlLWZyYW1ld29yayI6MTh9XSw0OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKLyoqCiAqIENyZWF0ZWQgYnkgYW1vIG9uIDE0LzExLzIwMTUuCiAqLwondXNlIHN0cmljdCc7CgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7CiAgICB2YWx1ZTogdHJ1ZQp9KTsKCnZhciBfY3JlYXRlQ2xhc3MgPSAoZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKCd2YWx1ZScgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9IHJldHVybiBmdW5jdGlvbiAoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH07IH0pKCk7CgpmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoJ0Nhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbicpOyB9IH0KCnZhciBDYXRhbG9ndWVEYXRhT2JqZWN0ID0gKGZ1bmN0aW9uICgpIHsKICAgIC8qKgogICAgICogQ3JlYXRlcyB0aGUgQ2F0YWxvZ3VlIERhdGEgT2JqZWN0CiAgICAgKiBAcGFyYW0gZ3VpZCAtIEdsb2JhbCBVbmlxdWUgaWRlbnRpZmllciBvZiB0aGUgQ2F0YWxvZ3VlIE9iamVjdCAoZS5nLiBIeXBlcnR5IGRlc2NyaXB0b3IsIFByb3RvY29sU3R1YiBkZXNjcmlwdG9yLAogICAgICogZXRjKSBlbmFibGluZyB0aGUgc2FtZSBvYmplY3QgdG8gYmUgc3RvcmVkIGFuZCBkaXNjb3ZlcmVkIGluIGRpZmZlcmVudCBDYXRhbG9ndWVzLiBUaGF0IG1lYW5zLCBndWlkIGNvcnJlc3BvbmRzIHRvCiAgICAgKiA8cmVzb3VyY2UtdHlwZS1pZD4gcGVyIEJORiBvZiBSZXNvdXJjZSBQYXRoLiBDb3VsZG4ndCB3ZSBoYXZlIHByb2JsZW1zIHdpdGggdG9vIGxvbmcgVVJMIHBhdGhzPwogICAgICogQHBhcmFtIHR5cGUgLSBpbmRpY2F0ZXMgdGhlIHR5cGUgb2YgQ2F0YWxvZ3VlIERhdGEgT2JqZWN0IGUuZy4gSHlwZXJ0eSwgUHJvdG9jb2xTdHViLCBldGMKICAgICAqIEBwYXJhbSBvYmplY3ROYW1lIC0gaHVtYW4tdW5kZXJzdGFuZGFibGUgbmFtZSBvZiB0aGUgY2F0YWxvZ3VlIG9iamVjdCBlLmcuICJNeSBBd2Vzb21lIEh5cGVydHkiCiAgICAgKiBAcGFyYW0gZGVzY3JpcHRpb24gLSBkZXNjcmlwdGlvbiBvZiB0aGUgc291cmNlIHBhY2thZ2UKICAgICAqIEBwYXJhbSBsYW5ndWFnZSAtIHRoZSBwcm9ncmFtbWluZyBsYW5ndWFnZSB1c2VkIGluIHRoZSBTb3VyY2VQYWNrYWdlLlNvdXJjZUNvZGUKICAgICAqIEBwYXJhbSBzb3VyY2VQYWNrYWdlVVJMIC0gQSBzdHJpbmcgY29udGFpbmluZyB0aGUgVVJMIGZyb20gd2hlcmUgdGhlIHNvdXJjZSBjb2RlIHBhY2thZ2Ugb2YgdGhlIGNvcnJlc3BvbmRpbmcKICAgICAqIGNhdGFsb2d1ZSBvYmplY3QsIGUuZy4gZGVwbG95YWJsZSBwYWNrYWdlcyBjb250YWluaW5nIGV4ZWN1dGFibGUgY29kZSBmb3IgSHlwZXJ0aWVzIG9yIFByb3RvU3R1YnMsIGNhbiBiZSBkb3dubG9hZGVkCiAgICAgKi8KCiAgICBmdW5jdGlvbiBDYXRhbG9ndWVEYXRhT2JqZWN0KGd1aWQsIHR5cGUsIG9iamVjdE5hbWUsIGRlc2NyaXB0aW9uLCBsYW5ndWFnZSwgc291cmNlUGFja2FnZVVSTCkgewogICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBDYXRhbG9ndWVEYXRhT2JqZWN0KTsKCiAgICAgICAgdGhpcy5fZ3VpZCA9IGd1aWQ7CiAgICAgICAgdGhpcy5fdHlwZSA9IHR5cGU7CiAgICAgICAgdGhpcy5fb2JqZWN0TmFtZSA9IG9iamVjdE5hbWU7CiAgICAgICAgdGhpcy5fZGVzY3JpcHRpb24gPSBkZXNjcmlwdGlvbjsKICAgICAgICB0aGlzLl9sYW5ndWFnZSA9IGxhbmd1YWdlOwogICAgICAgIHRoaXMuX3NvdXJjZVBhY2thZ2VVUkwgPSBzb3VyY2VQYWNrYWdlVVJMOwoKICAgICAgICB0aGlzLl9zaWduYXR1cmUgPSBudWxsOwogICAgICAgIHRoaXMuX3NvdXJjZVBhY2thZ2UgPSBudWxsOwogICAgfQoKICAgIC8vIEdldHRlcnMKCiAgICBfY3JlYXRlQ2xhc3MoQ2F0YWxvZ3VlRGF0YU9iamVjdCwgW3sKICAgICAgICBrZXk6ICdndWlkJywKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2d1aWQ7CiAgICAgICAgfQogICAgfSwgewogICAgICAgIGtleTogJ3R5cGUnLAogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fdHlwZTsKICAgICAgICB9CiAgICB9LCB7CiAgICAgICAga2V5OiAnb2JqZWN0TmFtZScsCiAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9vYmplY3ROYW1lOwogICAgICAgIH0KICAgIH0sIHsKICAgICAgICBrZXk6ICdkZXNjcmlwdGlvbicsCiAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9kZXNjcmlwdGlvbjsKICAgICAgICB9CiAgICB9LCB7CiAgICAgICAga2V5OiAnbGFuZ3VhZ2UnLAogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fbGFuZ3VhZ2U7CiAgICAgICAgfQogICAgfSwgewogICAgICAgIGtleTogJ3NpZ25hdHVyZScsCiAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zaWduYXR1cmU7CiAgICAgICAgfSwKCiAgICAgICAgLy8gU2V0dGVycwogICAgICAgIC8qKgogICAgICAgICAqIFNldCB0aGUgc2lnbmF0dXJlIHRvIGVuYWJsZXMgaW50ZWdyaXR5IGFuZCBhdXRoZW50aWNpdHkgdmVyaWZpY2F0aW9uCiAgICAgICAgICogQHBhcmFtIHNpZ25hdHVyZQogICAgICAgICAqLwogICAgICAgIHNldDogZnVuY3Rpb24gc2V0KHNpZ25hdHVyZSkgewogICAgICAgICAgICBpZiAoc2lnbmF0dXJlKSB0aGlzLl9zaWduYXR1cmUgPSBzaWduYXR1cmU7CiAgICAgICAgfQogICAgfSwgewogICAgICAgIGtleTogJ3NvdXJjZVBhY2thZ2UnLAogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fc291cmNlUGFja2FnZTsKICAgICAgICB9LAogICAgICAgIHNldDogZnVuY3Rpb24gc2V0KHNyY1BhY2thZ2UpIHsKICAgICAgICAgICAgaWYgKHNyY1BhY2thZ2UpIHRoaXMuX3NvdXJjZVBhY2thZ2UgPSBzcmNQYWNrYWdlOwogICAgICAgIH0KICAgIH0sIHsKICAgICAgICBrZXk6ICdzb3VyY2VQYWNrYWdlVVJMJywKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3NvdXJjZVBhY2thZ2VVUkw7CiAgICAgICAgfQogICAgfV0pOwoKICAgIHJldHVybiBDYXRhbG9ndWVEYXRhT2JqZWN0Owp9KSgpOwoKdmFyIENhdGFsb2d1ZU9iamVjdFR5cGUgPSB7CiAgICBIWVBFUlRZOiAnaHlwZXJ0eScsIFBST1RPU1RVQjogJ3Byb3Rvc3R1YicsIEhZUEVSVFlfUlVOVElNRTogJ2h5cGVydHlfcnVudGltZScsCiAgICBIWVBFUlRZX0lOVEVSQ0VQVE9SOiAnaHlwZXJ0eV9pbnNwZWN0b3InLCBIWVBFUlRZX0RBVEFfT0JKRUNUOiAnaHlwZXJ0eV9kYXRhX29iamVjdCcsCiAgICBQT0xJQ1lfRU5GT1JDRVI6ICdwb2xpY3lfZW5mb3JjZXInCn07CmV4cG9ydHMuQ2F0YWxvZ3VlT2JqZWN0VHlwZSA9IENhdGFsb2d1ZU9iamVjdFR5cGU7CnZhciBEYXRhT2JqZWN0U291cmNlTGFuZ3VhZ2UgPSB7CiAgICBKQVZBU0NSSVBUX0VDTUE2OiAnamF2YXNjcmlwdF9lY21hNicsIEpBVkFTQ1JJUFRfRUNNQTU6ICdqYXZhc2NyaXB0X2VjbWE1JywKICAgIEpTT05fU0NIRU1BX1Y0OiAnanNvbl9zY2hlbWFfdjQnLCBQWVRIT046ICdweXRob24nLCBUWVBFU0NSSVBUOiAndHlwZXNjcmlwdCcKfTsKZXhwb3J0cy5EYXRhT2JqZWN0U291cmNlTGFuZ3VhZ2UgPSBEYXRhT2JqZWN0U291cmNlTGFuZ3VhZ2U7CmV4cG9ydHNbJ2RlZmF1bHQnXSA9IENhdGFsb2d1ZURhdGFPYmplY3Q7Cgp9LHt9XSw1OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKJ3VzZSBzdHJpY3QnOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgewogICAgdmFsdWU6IHRydWUKfSk7Cgp2YXIgX2NyZWF0ZUNsYXNzID0gKGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmICgndmFsdWUnIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfSByZXR1cm4gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9OyB9KSgpOwoKdmFyIF9nZXQgPSBmdW5jdGlvbiBnZXQoX3gsIF94MiwgX3gzKSB7IHZhciBfYWdhaW4gPSB0cnVlOyBfZnVuY3Rpb246IHdoaWxlIChfYWdhaW4pIHsgdmFyIG9iamVjdCA9IF94LCBwcm9wZXJ0eSA9IF94MiwgcmVjZWl2ZXIgPSBfeDM7IF9hZ2FpbiA9IGZhbHNlOyBpZiAob2JqZWN0ID09PSBudWxsKSBvYmplY3QgPSBGdW5jdGlvbi5wcm90b3R5cGU7IHZhciBkZXNjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmplY3QsIHByb3BlcnR5KTsgaWYgKGRlc2MgPT09IHVuZGVmaW5lZCkgeyB2YXIgcGFyZW50ID0gT2JqZWN0LmdldFByb3RvdHlwZU9mKG9iamVjdCk7IGlmIChwYXJlbnQgPT09IG51bGwpIHsgcmV0dXJuIHVuZGVmaW5lZDsgfSBlbHNlIHsgX3ggPSBwYXJlbnQ7IF94MiA9IHByb3BlcnR5OyBfeDMgPSByZWNlaXZlcjsgX2FnYWluID0gdHJ1ZTsgZGVzYyA9IHBhcmVudCA9IHVuZGVmaW5lZDsgY29udGludWUgX2Z1bmN0aW9uOyB9IH0gZWxzZSBpZiAoJ3ZhbHVlJyBpbiBkZXNjKSB7IHJldHVybiBkZXNjLnZhbHVlOyB9IGVsc2UgeyB2YXIgZ2V0dGVyID0gZGVzYy5nZXQ7IGlmIChnZXR0ZXIgPT09IHVuZGVmaW5lZCkgeyByZXR1cm4gdW5kZWZpbmVkOyB9IHJldHVybiBnZXR0ZXIuY2FsbChyZWNlaXZlcik7IH0gfSB9OwoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgJ2RlZmF1bHQnOiBvYmogfTsgfQoKZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCdDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24nKTsgfSB9CgpmdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHsgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSAnZnVuY3Rpb24nICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcignU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24sIG5vdCAnICsgdHlwZW9mIHN1cGVyQ2xhc3MpOyB9IHN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgeyBjb25zdHJ1Y3RvcjogeyB2YWx1ZTogc3ViQ2xhc3MsIGVudW1lcmFibGU6IGZhbHNlLCB3cml0YWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0gfSk7IGlmIChzdXBlckNsYXNzKSBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3Quc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIDogc3ViQ2xhc3MuX19wcm90b19fID0gc3VwZXJDbGFzczsgfQoKdmFyIF9yZVRISU5LT2JqZWN0UmV0aGlua09iamVjdCA9IHJlcXVpcmUoJy4uL3JlVEhJTktPYmplY3QvUmV0aGlua09iamVjdCcpOwoKdmFyIF9yZVRISU5LT2JqZWN0UmV0aGlua09iamVjdDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9yZVRISU5LT2JqZWN0UmV0aGlua09iamVjdCk7Cgp2YXIgX0NhdGFsb2d1ZURhdGFPYmplY3QgPSByZXF1aXJlKCcuL0NhdGFsb2d1ZURhdGFPYmplY3QnKTsKCnZhciBfQ2F0YWxvZ3VlRGF0YU9iamVjdDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9DYXRhbG9ndWVEYXRhT2JqZWN0KTsKCnZhciBfU291cmNlUGFja2FnZSA9IHJlcXVpcmUoJy4vU291cmNlUGFja2FnZScpOwoKdmFyIF9Tb3VyY2VQYWNrYWdlMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX1NvdXJjZVBhY2thZ2UpOwoKdmFyIF9IeXBlcnR5RGVzY3JpcHRvciA9IHJlcXVpcmUoJy4vSHlwZXJ0eURlc2NyaXB0b3InKTsKCnZhciBfSHlwZXJ0eURlc2NyaXB0b3IyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfSHlwZXJ0eURlc2NyaXB0b3IpOwoKdmFyIF9Qcm90b2NvbFN0dWJEZXNjcmlwdG9yID0gcmVxdWlyZSgnLi9Qcm90b2NvbFN0dWJEZXNjcmlwdG9yJyk7Cgp2YXIgX1Byb3RvY29sU3R1YkRlc2NyaXB0b3IyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfUHJvdG9jb2xTdHViRGVzY3JpcHRvcik7Cgp2YXIgX0h5cGVydHlSdW50aW1lRGVzY3JpcHRvciA9IHJlcXVpcmUoJy4vSHlwZXJ0eVJ1bnRpbWVEZXNjcmlwdG9yJyk7Cgp2YXIgX0h5cGVydHlSdW50aW1lRGVzY3JpcHRvcjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9IeXBlcnR5UnVudGltZURlc2NyaXB0b3IpOwoKdmFyIF9Qb2xpY3lFbmZvcmNlckRlc2NyaXB0b3IgPSByZXF1aXJlKCcuL1BvbGljeUVuZm9yY2VyRGVzY3JpcHRvcicpOwoKdmFyIF9Qb2xpY3lFbmZvcmNlckRlc2NyaXB0b3IyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfUG9saWN5RW5mb3JjZXJEZXNjcmlwdG9yKTsKCnZhciBfRGF0YU9iamVjdFNjaGVtYSA9IHJlcXVpcmUoJy4vRGF0YU9iamVjdFNjaGVtYScpOwoKdmFyIF9EYXRhT2JqZWN0U2NoZW1hMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX0RhdGFPYmplY3RTY2hlbWEpOwoKdmFyIENhdGFsb2d1ZURhdGFPYmplY3RGYWN0b3J5ID0gKGZ1bmN0aW9uIChfUmV0aGlua09iamVjdCkgewogICAgX2luaGVyaXRzKENhdGFsb2d1ZURhdGFPYmplY3RGYWN0b3J5LCBfUmV0aGlua09iamVjdCk7CgogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3RvcgogICAgICogQHBhcmFtIHtib29sZWFufSB2YWxpZGF0aW9uCiAgICAgKiBAcGFyYW0ge1VSTC5VUkwgfSBzY2hlbWEgLSBsaW5rIHRvIHRoZSBzY2hlbWEKICAgICAqLwoKICAgIGZ1bmN0aW9uIENhdGFsb2d1ZURhdGFPYmplY3RGYWN0b3J5KHZhbGlkYXRpb24sIHNjaGVtYSkgewogICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBDYXRhbG9ndWVEYXRhT2JqZWN0RmFjdG9yeSk7CgogICAgICAgIF9nZXQoT2JqZWN0LmdldFByb3RvdHlwZU9mKENhdGFsb2d1ZURhdGFPYmplY3RGYWN0b3J5LnByb3RvdHlwZSksICdjb25zdHJ1Y3RvcicsIHRoaXMpLmNhbGwodGhpcywgdmFsaWRhdGlvbiwgc2NoZW1hKTsKICAgIH0KCiAgICBfY3JlYXRlQ2xhc3MoQ2F0YWxvZ3VlRGF0YU9iamVjdEZhY3RvcnksIFt7CiAgICAgICAga2V5OiAnY3JlYXRlQ2F0YWxvZ3VlRGF0YU9iamVjdCcsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGNyZWF0ZUNhdGFsb2d1ZURhdGFPYmplY3QodHlwZSwgb2JqZWN0TmFtZSwgZGVzY3JpcHRpb24sIGxhbmd1YWdlLCBzb3VyY2VQYWNrYWdlVVJMKSB7CiAgICAgICAgICAgIGlmICh0eXBlb2YgdHlwZSA9PT0gInVuZGVmaW5lZCIgfHwgdHlwZW9mIG9iamVjdE5hbWUgPT09ICJ1bmRlZmluZWQiIHx8IHR5cGVvZiBkZXNjcmlwdGlvbiA9PT0gInVuZGVmaW5lZCIgfHwgdHlwZW9mIGxhbmd1YWdlID09PSAidW5kZWZpbmVkIiB8fCB0eXBlb2Ygc291cmNlUGFja2FnZVVSTCA9PT0gInVuZGVmaW5lZCIpIHRocm93IG5ldyBFcnJvcigiSW52YWxpZCBwYXJhbWV0ZXJzISIpOwogICAgICAgICAgICByZXR1cm4gbmV3IF9DYXRhbG9ndWVEYXRhT2JqZWN0MlsnZGVmYXVsdCddKHRoaXMuX2dlbmVyYXRlR3VpZCgpLCB0eXBlLCBvYmplY3ROYW1lLCBkZXNjcmlwdGlvbiwgbGFuZ3VhZ2UsIHNvdXJjZVBhY2thZ2VVUkwpOwogICAgICAgIH0KICAgIH0sIHsKICAgICAgICBrZXk6ICdjcmVhdGVIeXBlcnR5RGVzY3JpcHRvck9iamVjdCcsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGNyZWF0ZUh5cGVydHlEZXNjcmlwdG9yT2JqZWN0KG9iamVjdE5hbWUsIGRlc2NyaXB0aW9uLCBsYW5ndWFnZSwgc291cmNlUGFja2FnZVVSTCwgaHlwZXJ0eVR5cGUsIGRhdGFPYmplY3RzKSB7CiAgICAgICAgICAgIGlmICh0eXBlb2Ygb2JqZWN0TmFtZSA9PT0gInVuZGVmaW5lZCIgfHwgdHlwZW9mIGRlc2NyaXB0aW9uID09PSAidW5kZWZpbmVkIiB8fCB0eXBlb2YgbGFuZ3VhZ2UgPT09ICJ1bmRlZmluZWQiIHx8IHR5cGVvZiBzb3VyY2VQYWNrYWdlVVJMID09PSAidW5kZWZpbmVkIiB8fCB0eXBlb2YgaHlwZXJ0eVR5cGUgPT09ICJ1bmRlZmluZWQiIHx8IHR5cGVvZiBkYXRhT2JqZWN0cyA9PT0gInVuZGVmaW5lZCIpIHRocm93IG5ldyBFcnJvcigiSW52YWxpZCBwYXJhbWV0ZXJzISIpOwogICAgICAgICAgICByZXR1cm4gbmV3IF9IeXBlcnR5RGVzY3JpcHRvcjJbJ2RlZmF1bHQnXSh0aGlzLl9nZW5lcmF0ZUd1aWQoKSwgX0NhdGFsb2d1ZURhdGFPYmplY3QuQ2F0YWxvZ3VlT2JqZWN0VHlwZS5IWVBFUlRZLCBvYmplY3ROYW1lLCBkZXNjcmlwdGlvbiwgbGFuZ3VhZ2UsIHNvdXJjZVBhY2thZ2VVUkwsIGh5cGVydHlUeXBlLCBkYXRhT2JqZWN0cyk7CiAgICAgICAgfQogICAgfSwgewogICAgICAgIGtleTogJ2NyZWF0ZVByb3RvU3R1YkRlc2NyaXB0b3JPYmplY3QnLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBjcmVhdGVQcm90b1N0dWJEZXNjcmlwdG9yT2JqZWN0KG9iamVjdE5hbWUsIGRlc2NyaXB0aW9uLCBsYW5ndWFnZSwgc291cmNlUGFja2FnZVVSTCwgbWVzc2FnZVNjaGVtYXMsIGNvbmZpZ3VyYXRpb25MaXN0LCBjb25zdHJhaW50TGlzdCkgewogICAgICAgICAgICBpZiAodHlwZW9mIG9iamVjdE5hbWUgPT09ICJ1bmRlZmluZWQiIHx8IHR5cGVvZiBkZXNjcmlwdGlvbiA9PT0gInVuZGVmaW5lZCIgfHwgdHlwZW9mIGxhbmd1YWdlID09PSAidW5kZWZpbmVkIiB8fCB0eXBlb2Ygc291cmNlUGFja2FnZVVSTCA9PT0gInVuZGVmaW5lZCIgfHwgdHlwZW9mIG1lc3NhZ2VTY2hlbWFzID09PSAidW5kZWZpbmVkIiB8fCB0eXBlb2YgY29uZmlndXJhdGlvbkxpc3QgPT09ICJ1bmRlZmluZWQiIHx8IHR5cGVvZiBjb25zdHJhaW50TGlzdCA9PT0gInVuZGVmaW5lZCIpIHRocm93IG5ldyBFcnJvcigiSW52YWxpZCBwYXJhbWV0ZXJzISIpOwogICAgICAgICAgICByZXR1cm4gbmV3IF9Qcm90b2NvbFN0dWJEZXNjcmlwdG9yMlsnZGVmYXVsdCddKHRoaXMuX2dlbmVyYXRlR3VpZCgpLCBfQ2F0YWxvZ3VlRGF0YU9iamVjdC5DYXRhbG9ndWVPYmplY3RUeXBlLlBST1RPU1RVQiwgb2JqZWN0TmFtZSwgZGVzY3JpcHRpb24sIGxhbmd1YWdlLCBzb3VyY2VQYWNrYWdlVVJMLCBtZXNzYWdlU2NoZW1hcywgY29uZmlndXJhdGlvbkxpc3QsIGNvbnN0cmFpbnRMaXN0KTsKICAgICAgICB9CiAgICB9LCB7CiAgICAgICAga2V5OiAnY3JlYXRlSHlwZXJ0eVJ1bnRpbWVEZXNjcmlwdG9yT2JqZWN0JywKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gY3JlYXRlSHlwZXJ0eVJ1bnRpbWVEZXNjcmlwdG9yT2JqZWN0KG9iamVjdE5hbWUsIGRlc2NyaXB0aW9uLCBsYW5ndWFnZSwgc291cmNlUGFja2FnZVVSTCwgcnVudGltZVR5cGUsIGh5cGVydHlDYXBhYmlsaXRpZXMsIHByb3RvY29sQ2FwYWJpbGl0aWVzKSB7CiAgICAgICAgICAgIGlmICh0eXBlb2Ygb2JqZWN0TmFtZSA9PT0gInVuZGVmaW5lZCIgfHwgdHlwZW9mIGRlc2NyaXB0aW9uID09PSAidW5kZWZpbmVkIiB8fCB0eXBlb2YgbGFuZ3VhZ2UgPT09ICJ1bmRlZmluZWQiIHx8IHR5cGVvZiBzb3VyY2VQYWNrYWdlVVJMID09PSAidW5kZWZpbmVkIiB8fCB0eXBlb2YgcnVudGltZVR5cGUgPT09ICJ1bmRlZmluZWQiIHx8IHR5cGVvZiBoeXBlcnR5Q2FwYWJpbGl0aWVzID09PSAidW5kZWZpbmVkIiB8fCB0eXBlb2YgcHJvdG9jb2xDYXBhYmlsaXRpZXMgPT09ICJ1bmRlZmluZWQiKSB0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgcGFyYW1ldGVycyEiKTsKCiAgICAgICAgICAgIHJldHVybiBuZXcgX0h5cGVydHlSdW50aW1lRGVzY3JpcHRvcjJbJ2RlZmF1bHQnXSh0aGlzLl9nZW5lcmF0ZUd1aWQoKSwgX0NhdGFsb2d1ZURhdGFPYmplY3QuQ2F0YWxvZ3VlT2JqZWN0VHlwZS5IWVBFUlRZX1JVTlRJTUUsIG9iamVjdE5hbWUsIGRlc2NyaXB0aW9uLCBsYW5ndWFnZSwgc291cmNlUGFja2FnZVVSTCwgcnVudGltZVR5cGUsIGh5cGVydHlDYXBhYmlsaXRpZXMsIHByb3RvY29sQ2FwYWJpbGl0aWVzKTsKICAgICAgICB9CiAgICB9LCB7CiAgICAgICAga2V5OiAnY3JlYXRlUG9saWN5RW5mb3JjZXJEZXNjcmlwdG9yT2JqZWN0JywKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gY3JlYXRlUG9saWN5RW5mb3JjZXJEZXNjcmlwdG9yT2JqZWN0KG9iamVjdE5hbWUsIGRlc2NyaXB0aW9uLCBsYW5ndWFnZSwgc291cmNlUGFja2FnZVVSTCwgY29uZmlndXJhdGlvbiwgcG9saWNpZXMpIHsKICAgICAgICAgICAgaWYgKHR5cGVvZiBvYmplY3ROYW1lID09PSAidW5kZWZpbmVkIiB8fCB0eXBlb2YgZGVzY3JpcHRpb24gPT09ICJ1bmRlZmluZWQiIHx8IHR5cGVvZiBsYW5ndWFnZSA9PT0gInVuZGVmaW5lZCIgfHwgdHlwZW9mIHNvdXJjZVBhY2thZ2VVUkwgPT09ICJ1bmRlZmluZWQiIHx8IHR5cGVvZiBjb25maWd1cmF0aW9uID09PSAidW5kZWZpbmVkIiB8fCB0eXBlb2YgcG9saWNpZXMgPT09ICJ1bmRlZmluZWQiKSB0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgcGFyYW1ldGVycyEiKTsKCiAgICAgICAgICAgIHJldHVybiBuZXcgX1BvbGljeUVuZm9yY2VyRGVzY3JpcHRvcjJbJ2RlZmF1bHQnXSh0aGlzLl9nZW5lcmF0ZUd1aWQoKSwgX0NhdGFsb2d1ZURhdGFPYmplY3QuQ2F0YWxvZ3VlT2JqZWN0VHlwZS5QT0xJQ1lfRU5GT1JDRVIsIG9iamVjdE5hbWUsIGRlc2NyaXB0aW9uLCBsYW5ndWFnZSwgc291cmNlUGFja2FnZVVSTCwgY29uZmlndXJhdGlvbiwgcG9saWNpZXMpOwogICAgICAgIH0KICAgIH0sIHsKICAgICAgICBrZXk6ICdjcmVhdGVEYXRhT2JqZWN0U2NoZW1hJywKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gY3JlYXRlRGF0YU9iamVjdFNjaGVtYSh0eXBlLCBvYmplY3ROYW1lLCBkZXNjcmlwdGlvbiwgbGFuZ3VhZ2UsIHNvdXJjZVBhY2thZ2VVUkwpIHsKICAgICAgICAgICAgaWYgKHR5cGVvZiB0eXBlID09PSAidW5kZWZpbmVkIiB8fCB0eXBlb2Ygb2JqZWN0TmFtZSA9PT0gInVuZGVmaW5lZCIgfHwgdHlwZW9mIGRlc2NyaXB0aW9uID09PSAidW5kZWZpbmVkIiB8fCB0eXBlb2YgbGFuZ3VhZ2UgPT09ICJ1bmRlZmluZWQiIHx8IHR5cGVvZiBzb3VyY2VQYWNrYWdlVVJMID09PSAidW5kZWZpbmVkIikgdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIHBhcmFtZXRlcnMhIik7CgogICAgICAgICAgICByZXR1cm4gbmV3IF9EYXRhT2JqZWN0U2NoZW1hMlsnZGVmYXVsdCddKHRoaXMuX2dlbmVyYXRlR3VpZCgpLCB0eXBlLCBvYmplY3ROYW1lLCBkZXNjcmlwdGlvbiwgbGFuZ3VhZ2UsIHNvdXJjZVBhY2thZ2VVUkwpOwogICAgICAgIH0KICAgIH0sIHsKICAgICAgICBrZXk6ICdjcmVhdGVTb3VyY2VQYWNrYWdlJywKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gY3JlYXRlU291cmNlUGFja2FnZShzb3VyY2VDb2RlLCBzb3VyY2VDb2RlQ2xhc3NuYW1lKSB7CiAgICAgICAgICAgIGlmICh0eXBlb2Ygc291cmNlQ29kZSA9PT0gInVuZGVmaW5lZCIgfHwgdHlwZW9mIHNvdXJjZUNvZGVDbGFzc25hbWUgPT09ICJ1bmRlZmluZWQiKSB0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgcGFyYW1ldGVycyEiKTsKCiAgICAgICAgICAgIHJldHVybiBuZXcgX1NvdXJjZVBhY2thZ2UyWydkZWZhdWx0J10oc291cmNlQ29kZSwgc291cmNlQ29kZUNsYXNzbmFtZSk7CiAgICAgICAgfQogICAgfSwgewogICAgICAgIGtleTogJ19nZW5lcmF0ZUd1aWQnLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBfZ2VuZXJhdGVHdWlkKCkgewogICAgICAgICAgICB2YXIgZCA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpOwoKICAgICAgICAgICAgcmV0dXJuICd4eHh4eHh4eC14eHh4LTR4eHgteXh4eC14eHh4eHh4eHh4eHgnLnJlcGxhY2UoL1t4eV0vZywgZnVuY3Rpb24gKGMpIHsKICAgICAgICAgICAgICAgIHZhciByID0gKGQgKyBNYXRoLnJhbmRvbSgpICogMTYpICUgMTYgfCAwOwogICAgICAgICAgICAgICAgZCA9IE1hdGguZmxvb3IoZCAvIDE2KTsKICAgICAgICAgICAgICAgIHJldHVybiAoYyA9PSAneCcgPyByIDogciAmIDB4MyB8IDB4OCkudG9TdHJpbmcoMTYpOwogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICB9XSk7CgogICAgcmV0dXJuIENhdGFsb2d1ZURhdGFPYmplY3RGYWN0b3J5Owp9KShfcmVUSElOS09iamVjdFJldGhpbmtPYmplY3QyWydkZWZhdWx0J10pOwoKZXhwb3J0c1snZGVmYXVsdCddID0gQ2F0YWxvZ3VlRGF0YU9iamVjdEZhY3Rvcnk7Cm1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1snZGVmYXVsdCddOwoKfSx7Ii4uL3JlVEhJTktPYmplY3QvUmV0aGlua09iamVjdCI6MTcsIi4vQ2F0YWxvZ3VlRGF0YU9iamVjdCI6NCwiLi9EYXRhT2JqZWN0U2NoZW1hIjo2LCIuL0h5cGVydHlEZXNjcmlwdG9yIjo3LCIuL0h5cGVydHlSdW50aW1lRGVzY3JpcHRvciI6OCwiLi9Qb2xpY3lFbmZvcmNlckRlc2NyaXB0b3IiOjksIi4vUHJvdG9jb2xTdHViRGVzY3JpcHRvciI6MTAsIi4vU291cmNlUGFja2FnZSI6MTF9XSw2OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKLyoqCiAqIENyZWF0ZWQgYnkgcHp1IG9uIDE5LjExLjE1LgogKi8KCid1c2Ugc3RyaWN0JzsKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsKICAgIHZhbHVlOiB0cnVlCn0pOwoKdmFyIF9nZXQgPSBmdW5jdGlvbiBnZXQoX3gsIF94MiwgX3gzKSB7IHZhciBfYWdhaW4gPSB0cnVlOyBfZnVuY3Rpb246IHdoaWxlIChfYWdhaW4pIHsgdmFyIG9iamVjdCA9IF94LCBwcm9wZXJ0eSA9IF94MiwgcmVjZWl2ZXIgPSBfeDM7IF9hZ2FpbiA9IGZhbHNlOyBpZiAob2JqZWN0ID09PSBudWxsKSBvYmplY3QgPSBGdW5jdGlvbi5wcm90b3R5cGU7IHZhciBkZXNjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmplY3QsIHByb3BlcnR5KTsgaWYgKGRlc2MgPT09IHVuZGVmaW5lZCkgeyB2YXIgcGFyZW50ID0gT2JqZWN0LmdldFByb3RvdHlwZU9mKG9iamVjdCk7IGlmIChwYXJlbnQgPT09IG51bGwpIHsgcmV0dXJuIHVuZGVmaW5lZDsgfSBlbHNlIHsgX3ggPSBwYXJlbnQ7IF94MiA9IHByb3BlcnR5OyBfeDMgPSByZWNlaXZlcjsgX2FnYWluID0gdHJ1ZTsgZGVzYyA9IHBhcmVudCA9IHVuZGVmaW5lZDsgY29udGludWUgX2Z1bmN0aW9uOyB9IH0gZWxzZSBpZiAoJ3ZhbHVlJyBpbiBkZXNjKSB7IHJldHVybiBkZXNjLnZhbHVlOyB9IGVsc2UgeyB2YXIgZ2V0dGVyID0gZGVzYy5nZXQ7IGlmIChnZXR0ZXIgPT09IHVuZGVmaW5lZCkgeyByZXR1cm4gdW5kZWZpbmVkOyB9IHJldHVybiBnZXR0ZXIuY2FsbChyZWNlaXZlcik7IH0gfSB9OwoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgJ2RlZmF1bHQnOiBvYmogfTsgfQoKZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCdDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24nKTsgfSB9CgpmdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHsgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSAnZnVuY3Rpb24nICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcignU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24sIG5vdCAnICsgdHlwZW9mIHN1cGVyQ2xhc3MpOyB9IHN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgeyBjb25zdHJ1Y3RvcjogeyB2YWx1ZTogc3ViQ2xhc3MsIGVudW1lcmFibGU6IGZhbHNlLCB3cml0YWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0gfSk7IGlmIChzdXBlckNsYXNzKSBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3Quc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIDogc3ViQ2xhc3MuX19wcm90b19fID0gc3VwZXJDbGFzczsgfQoKdmFyIF9DYXRhbG9ndWVEYXRhT2JqZWN0MiA9IHJlcXVpcmUoJy4vQ2F0YWxvZ3VlRGF0YU9iamVjdCcpOwoKdmFyIF9DYXRhbG9ndWVEYXRhT2JqZWN0MyA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX0NhdGFsb2d1ZURhdGFPYmplY3QyKTsKCnZhciBEYXRhT2JqZWN0U2NoZW1hID0gKGZ1bmN0aW9uIChfQ2F0YWxvZ3VlRGF0YU9iamVjdCkgewogICAgX2luaGVyaXRzKERhdGFPYmplY3RTY2hlbWEsIF9DYXRhbG9ndWVEYXRhT2JqZWN0KTsKCiAgICBmdW5jdGlvbiBEYXRhT2JqZWN0U2NoZW1hKGd1aWQsIHR5cGUsIG9iamVjdE5hbWUsIGRlc2NyaXB0aW9uLCBsYW5ndWFnZSwgc291cmNlUGFja2FnZVVSTCkgewogICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBEYXRhT2JqZWN0U2NoZW1hKTsKCiAgICAgICAgX2dldChPYmplY3QuZ2V0UHJvdG90eXBlT2YoRGF0YU9iamVjdFNjaGVtYS5wcm90b3R5cGUpLCAnY29uc3RydWN0b3InLCB0aGlzKS5jYWxsKHRoaXMsIGd1aWQsIHR5cGUsIG9iamVjdE5hbWUsIGRlc2NyaXB0aW9uLCBsYW5ndWFnZSwgc291cmNlUGFja2FnZVVSTCk7CiAgICB9CgogICAgLy9DaGlsZHJlbgogICAgcmV0dXJuIERhdGFPYmplY3RTY2hlbWE7Cn0pKF9DYXRhbG9ndWVEYXRhT2JqZWN0M1snZGVmYXVsdCddKTsKCnZhciBNZXNzYWdlRGF0YU9iamVjdFNjaGVtYSA9IChmdW5jdGlvbiAoX0RhdGFPYmplY3RTY2hlbWEpIHsKICAgIF9pbmhlcml0cyhNZXNzYWdlRGF0YU9iamVjdFNjaGVtYSwgX0RhdGFPYmplY3RTY2hlbWEpOwoKICAgIGZ1bmN0aW9uIE1lc3NhZ2VEYXRhT2JqZWN0U2NoZW1hKGd1aWQsIHR5cGUsIG9iamVjdE5hbWUsIGRlc2NyaXB0aW9uLCBsYW5ndWFnZSwgc291cmNlUGFja2FnZVVSTCkgewogICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBNZXNzYWdlRGF0YU9iamVjdFNjaGVtYSk7CgogICAgICAgIF9nZXQoT2JqZWN0LmdldFByb3RvdHlwZU9mKE1lc3NhZ2VEYXRhT2JqZWN0U2NoZW1hLnByb3RvdHlwZSksICdjb25zdHJ1Y3RvcicsIHRoaXMpLmNhbGwodGhpcywgZ3VpZCwgdHlwZSwgb2JqZWN0TmFtZSwgZGVzY3JpcHRpb24sIGxhbmd1YWdlLCBzb3VyY2VQYWNrYWdlVVJMKTsKICAgIH0KCiAgICByZXR1cm4gTWVzc2FnZURhdGFPYmplY3RTY2hlbWE7Cn0pKERhdGFPYmplY3RTY2hlbWEpOwoKZXhwb3J0cy5NZXNzYWdlRGF0YU9iamVjdFNjaGVtYSA9IE1lc3NhZ2VEYXRhT2JqZWN0U2NoZW1hOwoKdmFyIEh5cGVydHlEYXRhT2JqZWN0U2NoZW1hID0gKGZ1bmN0aW9uIChfRGF0YU9iamVjdFNjaGVtYTIpIHsKICAgIF9pbmhlcml0cyhIeXBlcnR5RGF0YU9iamVjdFNjaGVtYSwgX0RhdGFPYmplY3RTY2hlbWEyKTsKCiAgICBmdW5jdGlvbiBIeXBlcnR5RGF0YU9iamVjdFNjaGVtYShndWlkLCB0eXBlLCBvYmplY3ROYW1lLCBkZXNjcmlwdGlvbiwgbGFuZ3VhZ2UsIHNvdXJjZVBhY2thZ2VVUkwsIGFjY2Vzc0NvbnRyb2xQb2xpY3kpIHsKICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgSHlwZXJ0eURhdGFPYmplY3RTY2hlbWEpOwoKICAgICAgICBfZ2V0KE9iamVjdC5nZXRQcm90b3R5cGVPZihIeXBlcnR5RGF0YU9iamVjdFNjaGVtYS5wcm90b3R5cGUpLCAnY29uc3RydWN0b3InLCB0aGlzKS5jYWxsKHRoaXMsIGd1aWQsIHR5cGUsIG9iamVjdE5hbWUsIGRlc2NyaXB0aW9uLCBsYW5ndWFnZSwgc291cmNlUGFja2FnZVVSTCk7CiAgICAgICAgdGhpcy5fYWNjZXNzQ29udHJvbFBvbGljeSA9IGFjY2Vzc0NvbnRyb2xQb2xpY3k7CiAgICB9CgogICAgLy9DaGlsZHJlbgogICAgcmV0dXJuIEh5cGVydHlEYXRhT2JqZWN0U2NoZW1hOwp9KShEYXRhT2JqZWN0U2NoZW1hKTsKCmV4cG9ydHMuSHlwZXJ0eURhdGFPYmplY3RTY2hlbWEgPSBIeXBlcnR5RGF0YU9iamVjdFNjaGVtYTsKCnZhciBDb21tdW5pY2F0aW9uRGF0YU9iamVjdFNjaGVtYSA9IChmdW5jdGlvbiAoX0h5cGVydHlEYXRhT2JqZWN0U2NoZW1hKSB7CiAgICBfaW5oZXJpdHMoQ29tbXVuaWNhdGlvbkRhdGFPYmplY3RTY2hlbWEsIF9IeXBlcnR5RGF0YU9iamVjdFNjaGVtYSk7CgogICAgZnVuY3Rpb24gQ29tbXVuaWNhdGlvbkRhdGFPYmplY3RTY2hlbWEoZ3VpZCwgdHlwZSwgb2JqZWN0TmFtZSwgZGVzY3JpcHRpb24sIGxhbmd1YWdlLCBzb3VyY2VQYWNrYWdlVVJMLCBhY2Nlc3NDb250cm9sUG9saWN5KSB7CiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIENvbW11bmljYXRpb25EYXRhT2JqZWN0U2NoZW1hKTsKCiAgICAgICAgX2dldChPYmplY3QuZ2V0UHJvdG90eXBlT2YoQ29tbXVuaWNhdGlvbkRhdGFPYmplY3RTY2hlbWEucHJvdG90eXBlKSwgJ2NvbnN0cnVjdG9yJywgdGhpcykuY2FsbCh0aGlzLCBndWlkLCB0eXBlLCBvYmplY3ROYW1lLCBkZXNjcmlwdGlvbiwgbGFuZ3VhZ2UsIHNvdXJjZVBhY2thZ2VVUkwsIGFjY2Vzc0NvbnRyb2xQb2xpY3kpOwogICAgfQoKICAgIHJldHVybiBDb21tdW5pY2F0aW9uRGF0YU9iamVjdFNjaGVtYTsKfSkoSHlwZXJ0eURhdGFPYmplY3RTY2hlbWEpOwoKZXhwb3J0cy5Db21tdW5pY2F0aW9uRGF0YU9iamVjdFNjaGVtYSA9IENvbW11bmljYXRpb25EYXRhT2JqZWN0U2NoZW1hOwoKdmFyIENvbm5lY3Rpb25EYXRhT2JqZWN0U2NoZW1hID0gKGZ1bmN0aW9uIChfSHlwZXJ0eURhdGFPYmplY3RTY2hlbWEyKSB7CiAgICBfaW5oZXJpdHMoQ29ubmVjdGlvbkRhdGFPYmplY3RTY2hlbWEsIF9IeXBlcnR5RGF0YU9iamVjdFNjaGVtYTIpOwoKICAgIGZ1bmN0aW9uIENvbm5lY3Rpb25EYXRhT2JqZWN0U2NoZW1hKGd1aWQsIHR5cGUsIG9iamVjdE5hbWUsIGRlc2NyaXB0aW9uLCBsYW5ndWFnZSwgc291cmNlUGFja2FnZVVSTCwgYWNjZXNzQ29udHJvbFBvbGljeSkgewogICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBDb25uZWN0aW9uRGF0YU9iamVjdFNjaGVtYSk7CgogICAgICAgIF9nZXQoT2JqZWN0LmdldFByb3RvdHlwZU9mKENvbm5lY3Rpb25EYXRhT2JqZWN0U2NoZW1hLnByb3RvdHlwZSksICdjb25zdHJ1Y3RvcicsIHRoaXMpLmNhbGwodGhpcywgZ3VpZCwgdHlwZSwgb2JqZWN0TmFtZSwgZGVzY3JpcHRpb24sIGxhbmd1YWdlLCBzb3VyY2VQYWNrYWdlVVJMLCBhY2Nlc3NDb250cm9sUG9saWN5KTsKICAgIH0KCiAgICByZXR1cm4gQ29ubmVjdGlvbkRhdGFPYmplY3RTY2hlbWE7Cn0pKEh5cGVydHlEYXRhT2JqZWN0U2NoZW1hKTsKCmV4cG9ydHMuQ29ubmVjdGlvbkRhdGFPYmplY3RTY2hlbWEgPSBDb25uZWN0aW9uRGF0YU9iamVjdFNjaGVtYTsKCnZhciBJZGVudGlmeURhdGFPYmplY3RTY2hlbWEgPSAoZnVuY3Rpb24gKF9IeXBlcnR5RGF0YU9iamVjdFNjaGVtYTMpIHsKICAgIF9pbmhlcml0cyhJZGVudGlmeURhdGFPYmplY3RTY2hlbWEsIF9IeXBlcnR5RGF0YU9iamVjdFNjaGVtYTMpOwoKICAgIGZ1bmN0aW9uIElkZW50aWZ5RGF0YU9iamVjdFNjaGVtYShndWlkLCB0eXBlLCBvYmplY3ROYW1lLCBkZXNjcmlwdGlvbiwgbGFuZ3VhZ2UsIHNvdXJjZVBhY2thZ2VVUkwsIGFjY2Vzc0NvbnRyb2xQb2xpY3kpIHsKICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgSWRlbnRpZnlEYXRhT2JqZWN0U2NoZW1hKTsKCiAgICAgICAgX2dldChPYmplY3QuZ2V0UHJvdG90eXBlT2YoSWRlbnRpZnlEYXRhT2JqZWN0U2NoZW1hLnByb3RvdHlwZSksICdjb25zdHJ1Y3RvcicsIHRoaXMpLmNhbGwodGhpcywgZ3VpZCwgdHlwZSwgb2JqZWN0TmFtZSwgZGVzY3JpcHRpb24sIGxhbmd1YWdlLCBzb3VyY2VQYWNrYWdlVVJMLCBhY2Nlc3NDb250cm9sUG9saWN5KTsKICAgIH0KCiAgICByZXR1cm4gSWRlbnRpZnlEYXRhT2JqZWN0U2NoZW1hOwp9KShIeXBlcnR5RGF0YU9iamVjdFNjaGVtYSk7CgpleHBvcnRzLklkZW50aWZ5RGF0YU9iamVjdFNjaGVtYSA9IElkZW50aWZ5RGF0YU9iamVjdFNjaGVtYTsKCnZhciBDb250ZXh0RGF0YU9iamVjdFNjaGVtYSA9IChmdW5jdGlvbiAoX0h5cGVydHlEYXRhT2JqZWN0U2NoZW1hNCkgewogICAgX2luaGVyaXRzKENvbnRleHREYXRhT2JqZWN0U2NoZW1hLCBfSHlwZXJ0eURhdGFPYmplY3RTY2hlbWE0KTsKCiAgICBmdW5jdGlvbiBDb250ZXh0RGF0YU9iamVjdFNjaGVtYShndWlkLCB0eXBlLCBvYmplY3ROYW1lLCBkZXNjcmlwdGlvbiwgbGFuZ3VhZ2UsIHNvdXJjZVBhY2thZ2VVUkwsIGFjY2Vzc0NvbnRyb2xQb2xpY3kpIHsKICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgQ29udGV4dERhdGFPYmplY3RTY2hlbWEpOwoKICAgICAgICBfZ2V0KE9iamVjdC5nZXRQcm90b3R5cGVPZihDb250ZXh0RGF0YU9iamVjdFNjaGVtYS5wcm90b3R5cGUpLCAnY29uc3RydWN0b3InLCB0aGlzKS5jYWxsKHRoaXMsIGd1aWQsIHR5cGUsIG9iamVjdE5hbWUsIGRlc2NyaXB0aW9uLCBsYW5ndWFnZSwgc291cmNlUGFja2FnZVVSTCwgYWNjZXNzQ29udHJvbFBvbGljeSk7CiAgICB9CgogICAgcmV0dXJuIENvbnRleHREYXRhT2JqZWN0U2NoZW1hOwp9KShIeXBlcnR5RGF0YU9iamVjdFNjaGVtYSk7CgpleHBvcnRzLkNvbnRleHREYXRhT2JqZWN0U2NoZW1hID0gQ29udGV4dERhdGFPYmplY3RTY2hlbWE7CmV4cG9ydHNbJ2RlZmF1bHQnXSA9IERhdGFPYmplY3RTY2hlbWE7Cgp9LHsiLi9DYXRhbG9ndWVEYXRhT2JqZWN0Ijo0fV0sNzpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Ci8qKgogKiBDcmVhdGVkIGJ5IGFtbyBvbiAxNC8xMS8yMDE1LgogKi8KJ3VzZSBzdHJpY3QnOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgewogICAgdmFsdWU6IHRydWUKfSk7Cgp2YXIgX2NyZWF0ZUNsYXNzID0gKGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmICgndmFsdWUnIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfSByZXR1cm4gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9OyB9KSgpOwoKdmFyIF9nZXQgPSBmdW5jdGlvbiBnZXQoX3gsIF94MiwgX3gzKSB7IHZhciBfYWdhaW4gPSB0cnVlOyBfZnVuY3Rpb246IHdoaWxlIChfYWdhaW4pIHsgdmFyIG9iamVjdCA9IF94LCBwcm9wZXJ0eSA9IF94MiwgcmVjZWl2ZXIgPSBfeDM7IF9hZ2FpbiA9IGZhbHNlOyBpZiAob2JqZWN0ID09PSBudWxsKSBvYmplY3QgPSBGdW5jdGlvbi5wcm90b3R5cGU7IHZhciBkZXNjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmplY3QsIHByb3BlcnR5KTsgaWYgKGRlc2MgPT09IHVuZGVmaW5lZCkgeyB2YXIgcGFyZW50ID0gT2JqZWN0LmdldFByb3RvdHlwZU9mKG9iamVjdCk7IGlmIChwYXJlbnQgPT09IG51bGwpIHsgcmV0dXJuIHVuZGVmaW5lZDsgfSBlbHNlIHsgX3ggPSBwYXJlbnQ7IF94MiA9IHByb3BlcnR5OyBfeDMgPSByZWNlaXZlcjsgX2FnYWluID0gdHJ1ZTsgZGVzYyA9IHBhcmVudCA9IHVuZGVmaW5lZDsgY29udGludWUgX2Z1bmN0aW9uOyB9IH0gZWxzZSBpZiAoJ3ZhbHVlJyBpbiBkZXNjKSB7IHJldHVybiBkZXNjLnZhbHVlOyB9IGVsc2UgeyB2YXIgZ2V0dGVyID0gZGVzYy5nZXQ7IGlmIChnZXR0ZXIgPT09IHVuZGVmaW5lZCkgeyByZXR1cm4gdW5kZWZpbmVkOyB9IHJldHVybiBnZXR0ZXIuY2FsbChyZWNlaXZlcik7IH0gfSB9OwoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgJ2RlZmF1bHQnOiBvYmogfTsgfQoKZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCdDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24nKTsgfSB9CgpmdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHsgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSAnZnVuY3Rpb24nICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcignU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24sIG5vdCAnICsgdHlwZW9mIHN1cGVyQ2xhc3MpOyB9IHN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgeyBjb25zdHJ1Y3RvcjogeyB2YWx1ZTogc3ViQ2xhc3MsIGVudW1lcmFibGU6IGZhbHNlLCB3cml0YWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0gfSk7IGlmIChzdXBlckNsYXNzKSBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3Quc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIDogc3ViQ2xhc3MuX19wcm90b19fID0gc3VwZXJDbGFzczsgfQoKdmFyIF9DYXRhbG9ndWVEYXRhT2JqZWN0MiA9IHJlcXVpcmUoJy4vQ2F0YWxvZ3VlRGF0YU9iamVjdCcpOwoKdmFyIF9DYXRhbG9ndWVEYXRhT2JqZWN0MyA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX0NhdGFsb2d1ZURhdGFPYmplY3QyKTsKCnZhciBIeXBlcnR5RGVzY3JpcHRvciA9IChmdW5jdGlvbiAoX0NhdGFsb2d1ZURhdGFPYmplY3QpIHsKICAgIF9pbmhlcml0cyhIeXBlcnR5RGVzY3JpcHRvciwgX0NhdGFsb2d1ZURhdGFPYmplY3QpOwoKICAgIGZ1bmN0aW9uIEh5cGVydHlEZXNjcmlwdG9yKGd1aWQsIGNhdGFsb2d1ZVR5cGUsIG9iamVjdE5hbWUsIGRlc2NyaXB0aW9uLCBsYW5ndWFnZSwgc291cmNlUGFja2FnZVVSTCwgaHlwZXJ0eVR5cGUsIGRhdGFPYmplY3RzKSB7CiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEh5cGVydHlEZXNjcmlwdG9yKTsKCiAgICAgICAgX2dldChPYmplY3QuZ2V0UHJvdG90eXBlT2YoSHlwZXJ0eURlc2NyaXB0b3IucHJvdG90eXBlKSwgJ2NvbnN0cnVjdG9yJywgdGhpcykuY2FsbCh0aGlzLCBndWlkLCBjYXRhbG9ndWVUeXBlLCBvYmplY3ROYW1lLCBkZXNjcmlwdGlvbiwgbGFuZ3VhZ2UsIHNvdXJjZVBhY2thZ2VVUkwpOwoKICAgICAgICB0aGlzLl9jb25maWd1cmF0aW9uRGF0YUxpc3QgPSB7fTsKICAgICAgICB0aGlzLl9ydW50aW1lQ29uc3RyYWludExpc3QgPSB7fTsKICAgICAgICB0aGlzLl9wb2xpY2llcyA9IHt9OwogICAgICAgIHRoaXMuX21lc3NhZ2VTY2hlbWEgPSBudWxsOwoKICAgICAgICB0aGlzLl9oeXBlcnR5VHlwZSA9IGh5cGVydHlUeXBlOwogICAgICAgIHRoaXMuX2RhdGFPYmplY3RzID0gZGF0YU9iamVjdHM7CiAgICB9CgogICAgX2NyZWF0ZUNsYXNzKEh5cGVydHlEZXNjcmlwdG9yLCBbewogICAgICAgIGtleTogJ2h5cGVydHlUeXBlJywKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2h5cGVydHlUeXBlOwogICAgICAgIH0sCiAgICAgICAgc2V0OiBmdW5jdGlvbiBzZXQoaFR5cGUpIHsKICAgICAgICAgICAgaWYgKGhUeXBlKSB0aGlzLl9oeXBlcnR5VHlwZSA9IGhUeXBlOwogICAgICAgIH0KICAgIH0sIHsKICAgICAgICBrZXk6ICdkYXRhT2JqZWN0cycsCiAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9kYXRhT2JqZWN0czsKICAgICAgICB9LAogICAgICAgIHNldDogZnVuY3Rpb24gc2V0KGRhdGFPYmplY3RVcmwpIHsKICAgICAgICAgICAgaWYgKGRhdGFPYmplY3RVcmwpIHRoaXMuX2RhdGFPYmplY3RzID0gZGF0YU9iamVjdFVybDsKICAgICAgICB9CiAgICB9LCB7CiAgICAgICAga2V5OiAnY29uZmlndXJhdGlvbkRhdGFMaXN0JywKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NvbmZpZ3VyYXRpb25EYXRhTGlzdDsKICAgICAgICB9LAogICAgICAgIHNldDogZnVuY3Rpb24gc2V0KGNvbmZpZ0RhdGFMaXN0KSB7CiAgICAgICAgICAgIGlmIChjb25maWdEYXRhTGlzdCkgdGhpcy5fY29uZmlndXJhdGlvbkRhdGFMaXN0ID0gY29uZmlnRGF0YUxpc3Q7CiAgICAgICAgfQogICAgfSwgewogICAgICAgIGtleTogJ3J1bnRpbWVDb25zdHJhaW50TGlzdCcsCiAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lQ29uc3RyYWludExpc3Q7CiAgICAgICAgfSwKICAgICAgICBzZXQ6IGZ1bmN0aW9uIHNldChydW50aW1lQ29uc3RMaXN0KSB7CiAgICAgICAgICAgIGlmIChydW50aW1lQ29uc3RMaXN0KSB0aGlzLl9ydW50aW1lQ29uc3RyYWludExpc3QgPSBydW50aW1lQ29uc3RMaXN0OwogICAgICAgIH0KICAgIH0sIHsKICAgICAgICBrZXk6ICdtZXNzYWdlU2NoZW1hJywKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX21lc3NhZ2VTY2hlbWE7CiAgICAgICAgfSwKICAgICAgICBzZXQ6IGZ1bmN0aW9uIHNldChtc2dTY2hlbWEpIHsKICAgICAgICAgICAgaWYgKG1zZ1NjaGVtYSkgdGhpcy5fbWVzc2FnZVNjaGVtYSA9IG1zZ1NjaGVtYTsKICAgICAgICB9CiAgICB9LCB7CiAgICAgICAga2V5OiAncG9saWNpZXMnLAogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fcG9saWNpZXM7CiAgICAgICAgfSwKICAgICAgICBzZXQ6IGZ1bmN0aW9uIHNldChwb2xpY3lMaXN0KSB7CiAgICAgICAgICAgIGlmIChwb2xpY3lMaXN0KSB0aGlzLl9wb2xpY2llcyA9IHBvbGljeUxpc3Q7CiAgICAgICAgfQogICAgfV0pOwoKICAgIHJldHVybiBIeXBlcnR5RGVzY3JpcHRvcjsKfSkoX0NhdGFsb2d1ZURhdGFPYmplY3QzWydkZWZhdWx0J10pOwoKdmFyIFJ1bnRpbWVIeXBlcnR5Q2FwYWJpbGl0eVR5cGUgPSB7fTsKZXhwb3J0cy5SdW50aW1lSHlwZXJ0eUNhcGFiaWxpdHlUeXBlID0gUnVudGltZUh5cGVydHlDYXBhYmlsaXR5VHlwZTsKdmFyIEh5cGVydHlUeXBlID0geyBDT01NVU5JQ0FUT1I6ICdjb21tdW5pY2F0b3InLCBJREVOVElUWTogJ2lkZW50aXR5JywgQ09OVEVYVDogJ2NvbnRleHQnIH07CmV4cG9ydHMuSHlwZXJ0eVR5cGUgPSBIeXBlcnR5VHlwZTsKZXhwb3J0c1snZGVmYXVsdCddID0gSHlwZXJ0eURlc2NyaXB0b3I7Cgp9LHsiLi9DYXRhbG9ndWVEYXRhT2JqZWN0Ijo0fV0sODpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Ci8qKgogKiBDcmVhdGVkIGJ5IGFtbyBvbiAxNC8xMS8yMDE1LgogKi8KCid1c2Ugc3RyaWN0JzsKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsKICAgIHZhbHVlOiB0cnVlCn0pOwoKdmFyIF9jcmVhdGVDbGFzcyA9IChmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoJ3ZhbHVlJyBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0gcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfTsgfSkoKTsKCnZhciBfZ2V0ID0gZnVuY3Rpb24gZ2V0KF94LCBfeDIsIF94MykgeyB2YXIgX2FnYWluID0gdHJ1ZTsgX2Z1bmN0aW9uOiB3aGlsZSAoX2FnYWluKSB7IHZhciBvYmplY3QgPSBfeCwgcHJvcGVydHkgPSBfeDIsIHJlY2VpdmVyID0gX3gzOyBfYWdhaW4gPSBmYWxzZTsgaWYgKG9iamVjdCA9PT0gbnVsbCkgb2JqZWN0ID0gRnVuY3Rpb24ucHJvdG90eXBlOyB2YXIgZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBwcm9wZXJ0eSk7IGlmIChkZXNjID09PSB1bmRlZmluZWQpIHsgdmFyIHBhcmVudCA9IE9iamVjdC5nZXRQcm90b3R5cGVPZihvYmplY3QpOyBpZiAocGFyZW50ID09PSBudWxsKSB7IHJldHVybiB1bmRlZmluZWQ7IH0gZWxzZSB7IF94ID0gcGFyZW50OyBfeDIgPSBwcm9wZXJ0eTsgX3gzID0gcmVjZWl2ZXI7IF9hZ2FpbiA9IHRydWU7IGRlc2MgPSBwYXJlbnQgPSB1bmRlZmluZWQ7IGNvbnRpbnVlIF9mdW5jdGlvbjsgfSB9IGVsc2UgaWYgKCd2YWx1ZScgaW4gZGVzYykgeyByZXR1cm4gZGVzYy52YWx1ZTsgfSBlbHNlIHsgdmFyIGdldHRlciA9IGRlc2MuZ2V0OyBpZiAoZ2V0dGVyID09PSB1bmRlZmluZWQpIHsgcmV0dXJuIHVuZGVmaW5lZDsgfSByZXR1cm4gZ2V0dGVyLmNhbGwocmVjZWl2ZXIpOyB9IH0gfTsKCmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7ICdkZWZhdWx0Jzogb2JqIH07IH0KCmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcignQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uJyk7IH0gfQoKZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7IGlmICh0eXBlb2Ygc3VwZXJDbGFzcyAhPT0gJ2Z1bmN0aW9uJyAmJiBzdXBlckNsYXNzICE9PSBudWxsKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoJ1N1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uLCBub3QgJyArIHR5cGVvZiBzdXBlckNsYXNzKTsgfSBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IHN1YkNsYXNzLCBlbnVtZXJhYmxlOiBmYWxzZSwgd3JpdGFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9IH0pOyBpZiAoc3VwZXJDbGFzcykgT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LnNldFByb3RvdHlwZU9mKHN1YkNsYXNzLCBzdXBlckNsYXNzKSA6IHN1YkNsYXNzLl9fcHJvdG9fXyA9IHN1cGVyQ2xhc3M7IH0KCnZhciBfQ2F0YWxvZ3VlRGF0YU9iamVjdDIgPSByZXF1aXJlKCcuL0NhdGFsb2d1ZURhdGFPYmplY3QnKTsKCnZhciBfQ2F0YWxvZ3VlRGF0YU9iamVjdDMgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9DYXRhbG9ndWVEYXRhT2JqZWN0Mik7Cgp2YXIgSHlwZXJ0eVJ1bnRpbWVEZXNjcmlwdG9yID0gKGZ1bmN0aW9uIChfQ2F0YWxvZ3VlRGF0YU9iamVjdCkgewogICAgX2luaGVyaXRzKEh5cGVydHlSdW50aW1lRGVzY3JpcHRvciwgX0NhdGFsb2d1ZURhdGFPYmplY3QpOwoKICAgIGZ1bmN0aW9uIEh5cGVydHlSdW50aW1lRGVzY3JpcHRvcihndWlkLCBjYXRhbG9ndWVUeXBlLCBvYmplY3ROYW1lLCBkZXNjcmlwdGlvbiwgbGFuZ3VhZ2UsIHNvdXJjZVBhY2thZ2VVUkwsIHJ1bnRpbWVUeXBlLCBoeXBlcnR5Q2FwYWJpbGl0aWVzLCBwcm90b2NvbENhcGFiaWxpdGllcykgewogICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBIeXBlcnR5UnVudGltZURlc2NyaXB0b3IpOwoKICAgICAgICBfZ2V0KE9iamVjdC5nZXRQcm90b3R5cGVPZihIeXBlcnR5UnVudGltZURlc2NyaXB0b3IucHJvdG90eXBlKSwgJ2NvbnN0cnVjdG9yJywgdGhpcykuY2FsbCh0aGlzLCBndWlkLCBjYXRhbG9ndWVUeXBlLCBvYmplY3ROYW1lLCBkZXNjcmlwdGlvbiwgbGFuZ3VhZ2UsIHNvdXJjZVBhY2thZ2VVUkwpOwoKICAgICAgICB0aGlzLl9ydW50aW1lVHlwZSA9IHJ1bnRpbWVUeXBlOwogICAgICAgIGlmIChoeXBlcnR5Q2FwYWJpbGl0aWVzKSB0aGlzLl9oeXBlcnR5Q2FwYWJpbGl0aWVzID0gaHlwZXJ0eUNhcGFiaWxpdGllcztlbHNlIHRoaXMuX2h5cGVydHlDYXBhYmlsaXRpZXMgPSB7fTsKICAgICAgICBpZiAocHJvdG9jb2xDYXBhYmlsaXRpZXMpIHRoaXMuX3Byb3RvY29sQ2FwYWJpbGl0aWVzID0gcHJvdG9jb2xDYXBhYmlsaXRpZXM7ZWxzZSB0aGlzLl9wcm90b2NvbENhcGFiaWxpdGllcyA9IHt9OwogICAgfQoKICAgIF9jcmVhdGVDbGFzcyhIeXBlcnR5UnVudGltZURlc2NyaXB0b3IsIFt7CiAgICAgICAga2V5OiAncnVudGltZVR5cGUnLAogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fcnVudGltZVR5cGU7CiAgICAgICAgfQogICAgfSwgewogICAgICAgIGtleTogJ2h5cGVydHlDYXBhYmlsaXRpZXMnLAogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5faHlwZXJ0eUNhcGFiaWxpdGllczsKICAgICAgICB9CiAgICB9LCB7CiAgICAgICAga2V5OiAncHJvdG9jb2xDYXBhYmlsaXRpZXMnLAogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5faHlwZXJ0eUNhcGFiaWxpdGllczsKICAgICAgICB9CiAgICB9XSk7CgogICAgcmV0dXJuIEh5cGVydHlSdW50aW1lRGVzY3JpcHRvcjsKfSkoX0NhdGFsb2d1ZURhdGFPYmplY3QzWydkZWZhdWx0J10pOwoKdmFyIFJ1bnRpbWVUeXBlID0geyBCUk9XU0VSOiAnYnJvd3NlcicsIFNUQU5EQUxPTkU6ICdzdGFuZGFsb25lJywgU0VSVkVSOiAnc2VydmVyJywgR0FURVdBWTogJ2dhdGV3YXknIH07CmV4cG9ydHMuUnVudGltZVR5cGUgPSBSdW50aW1lVHlwZTsKdmFyIFJ1bnRpbWVIeXBlcnR5Q2FwYWJpbGl0eVR5cGUgPSB7IE1JQzogJ21pYycsIENBTUVSQTogJ2NhbWVyYScsIFNFTlNPUjogJ3NlbnNvcicsIFdFQlJUQzogJ3dlYnJ0YycsCiAgICBPUlRDOiAnb3J0YycgfTsKZXhwb3J0cy5SdW50aW1lSHlwZXJ0eUNhcGFiaWxpdHlUeXBlID0gUnVudGltZUh5cGVydHlDYXBhYmlsaXR5VHlwZTsKdmFyIFJ1bnRpbWVQcm90b2NvbENhcGFiaWxpdHlUeXBlID0geyBIVFRQOiAnaHR0cCcsIEhUVFBTOiAnaHR0cHMnLCBXUzogJ3dzJywgV1NTOiAnd3NzJywgQ09BUDogJ2NvYXAnLAogICAgREFUQUNIQU5FTDogJ2RhdGFjaGFubmVsJyB9OwpleHBvcnRzLlJ1bnRpbWVQcm90b2NvbENhcGFiaWxpdHlUeXBlID0gUnVudGltZVByb3RvY29sQ2FwYWJpbGl0eVR5cGU7CmV4cG9ydHNbJ2RlZmF1bHQnXSA9IEh5cGVydHlSdW50aW1lRGVzY3JpcHRvcjsKCn0seyIuL0NhdGFsb2d1ZURhdGFPYmplY3QiOjR9XSw5OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKLyoqCiAqIENyZWF0ZWQgYnkgcHp1IG9uIDE5LjExLjE1LgogKi8KJ3VzZSBzdHJpY3QnOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgewogICAgdmFsdWU6IHRydWUKfSk7Cgp2YXIgX2NyZWF0ZUNsYXNzID0gKGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmICgndmFsdWUnIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfSByZXR1cm4gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9OyB9KSgpOwoKdmFyIF9nZXQgPSBmdW5jdGlvbiBnZXQoX3gsIF94MiwgX3gzKSB7IHZhciBfYWdhaW4gPSB0cnVlOyBfZnVuY3Rpb246IHdoaWxlIChfYWdhaW4pIHsgdmFyIG9iamVjdCA9IF94LCBwcm9wZXJ0eSA9IF94MiwgcmVjZWl2ZXIgPSBfeDM7IF9hZ2FpbiA9IGZhbHNlOyBpZiAob2JqZWN0ID09PSBudWxsKSBvYmplY3QgPSBGdW5jdGlvbi5wcm90b3R5cGU7IHZhciBkZXNjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmplY3QsIHByb3BlcnR5KTsgaWYgKGRlc2MgPT09IHVuZGVmaW5lZCkgeyB2YXIgcGFyZW50ID0gT2JqZWN0LmdldFByb3RvdHlwZU9mKG9iamVjdCk7IGlmIChwYXJlbnQgPT09IG51bGwpIHsgcmV0dXJuIHVuZGVmaW5lZDsgfSBlbHNlIHsgX3ggPSBwYXJlbnQ7IF94MiA9IHByb3BlcnR5OyBfeDMgPSByZWNlaXZlcjsgX2FnYWluID0gdHJ1ZTsgZGVzYyA9IHBhcmVudCA9IHVuZGVmaW5lZDsgY29udGludWUgX2Z1bmN0aW9uOyB9IH0gZWxzZSBpZiAoJ3ZhbHVlJyBpbiBkZXNjKSB7IHJldHVybiBkZXNjLnZhbHVlOyB9IGVsc2UgeyB2YXIgZ2V0dGVyID0gZGVzYy5nZXQ7IGlmIChnZXR0ZXIgPT09IHVuZGVmaW5lZCkgeyByZXR1cm4gdW5kZWZpbmVkOyB9IHJldHVybiBnZXR0ZXIuY2FsbChyZWNlaXZlcik7IH0gfSB9OwoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgJ2RlZmF1bHQnOiBvYmogfTsgfQoKZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCdDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24nKTsgfSB9CgpmdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHsgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSAnZnVuY3Rpb24nICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcignU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24sIG5vdCAnICsgdHlwZW9mIHN1cGVyQ2xhc3MpOyB9IHN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgeyBjb25zdHJ1Y3RvcjogeyB2YWx1ZTogc3ViQ2xhc3MsIGVudW1lcmFibGU6IGZhbHNlLCB3cml0YWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0gfSk7IGlmIChzdXBlckNsYXNzKSBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3Quc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIDogc3ViQ2xhc3MuX19wcm90b19fID0gc3VwZXJDbGFzczsgfQoKdmFyIF9DYXRhbG9ndWVEYXRhT2JqZWN0MiA9IHJlcXVpcmUoJy4vQ2F0YWxvZ3VlRGF0YU9iamVjdCcpOwoKdmFyIF9DYXRhbG9ndWVEYXRhT2JqZWN0MyA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX0NhdGFsb2d1ZURhdGFPYmplY3QyKTsKCnZhciBQb2xpY3lFbmZvcmNlckRlc2NyaXB0b3IgPSAoZnVuY3Rpb24gKF9DYXRhbG9ndWVEYXRhT2JqZWN0KSB7CiAgICBfaW5oZXJpdHMoUG9saWN5RW5mb3JjZXJEZXNjcmlwdG9yLCBfQ2F0YWxvZ3VlRGF0YU9iamVjdCk7CgogICAgZnVuY3Rpb24gUG9saWN5RW5mb3JjZXJEZXNjcmlwdG9yKGd1aWQsIHR5cGUsIG9iamVjdE5hbWUsIGRlc2NyaXB0aW9uLCBsYW5ndWFnZSwgc291cmNlUGFja2FnZVVSTCwgY29uZmlndXJhdGlvbiwgcG9saWNpZXMpIHsKICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgUG9saWN5RW5mb3JjZXJEZXNjcmlwdG9yKTsKCiAgICAgICAgX2dldChPYmplY3QuZ2V0UHJvdG90eXBlT2YoUG9saWN5RW5mb3JjZXJEZXNjcmlwdG9yLnByb3RvdHlwZSksICdjb25zdHJ1Y3RvcicsIHRoaXMpLmNhbGwodGhpcywgZ3VpZCwgdHlwZSwgb2JqZWN0TmFtZSwgZGVzY3JpcHRpb24sIGxhbmd1YWdlLCBzb3VyY2VQYWNrYWdlVVJMKTsKCiAgICAgICAgdGhpcy5fY29uZmlndXJhdGlvbiA9IGNvbmZpZ3VyYXRpb247CiAgICAgICAgdGhpcy5fcG9saWNpZXMgPSBwb2xpY2llczsKICAgIH0KCiAgICBfY3JlYXRlQ2xhc3MoUG9saWN5RW5mb3JjZXJEZXNjcmlwdG9yLCBbewogICAgICAgIGtleTogJ2NvbmZpZ3VyYXRpb24nLAogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fY29uZmlndXJhdGlvbjsKICAgICAgICB9LAogICAgICAgIHNldDogZnVuY3Rpb24gc2V0KGNvbmZpZ3VyYXRpb24pIHsKICAgICAgICAgICAgdGhpcy5fY29uZmlndXJhdGlvbiA9IGNvbmZpZ3VyYXRpb247CiAgICAgICAgfQogICAgfSwgewogICAgICAgIGtleTogJ3BvbGljaWVzJywKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3BvbGljaWVzOwogICAgICAgIH0sCiAgICAgICAgc2V0OiBmdW5jdGlvbiBzZXQocG9saWNpZXMpIHsKICAgICAgICAgICAgdGhpcy5fcG9saWNpZXMgPSBwb2xpY2llczsKICAgICAgICB9CiAgICB9XSk7CgogICAgcmV0dXJuIFBvbGljeUVuZm9yY2VyRGVzY3JpcHRvcjsKfSkoX0NhdGFsb2d1ZURhdGFPYmplY3QzWydkZWZhdWx0J10pOwoKZXhwb3J0c1snZGVmYXVsdCddID0gUG9saWN5RW5mb3JjZXJEZXNjcmlwdG9yOwptb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbJ2RlZmF1bHQnXTsKCn0seyIuL0NhdGFsb2d1ZURhdGFPYmplY3QiOjR9XSwxMDpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Ci8qKgogKiBDcmVhdGVkIGJ5IGFtbyBvbiAxNC8xMS8yMDE1LgogKi8KCid1c2Ugc3RyaWN0JzsKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsKICAgIHZhbHVlOiB0cnVlCn0pOwoKdmFyIF9jcmVhdGVDbGFzcyA9IChmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoJ3ZhbHVlJyBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0gcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfTsgfSkoKTsKCnZhciBfZ2V0ID0gZnVuY3Rpb24gZ2V0KF94LCBfeDIsIF94MykgeyB2YXIgX2FnYWluID0gdHJ1ZTsgX2Z1bmN0aW9uOiB3aGlsZSAoX2FnYWluKSB7IHZhciBvYmplY3QgPSBfeCwgcHJvcGVydHkgPSBfeDIsIHJlY2VpdmVyID0gX3gzOyBfYWdhaW4gPSBmYWxzZTsgaWYgKG9iamVjdCA9PT0gbnVsbCkgb2JqZWN0ID0gRnVuY3Rpb24ucHJvdG90eXBlOyB2YXIgZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBwcm9wZXJ0eSk7IGlmIChkZXNjID09PSB1bmRlZmluZWQpIHsgdmFyIHBhcmVudCA9IE9iamVjdC5nZXRQcm90b3R5cGVPZihvYmplY3QpOyBpZiAocGFyZW50ID09PSBudWxsKSB7IHJldHVybiB1bmRlZmluZWQ7IH0gZWxzZSB7IF94ID0gcGFyZW50OyBfeDIgPSBwcm9wZXJ0eTsgX3gzID0gcmVjZWl2ZXI7IF9hZ2FpbiA9IHRydWU7IGRlc2MgPSBwYXJlbnQgPSB1bmRlZmluZWQ7IGNvbnRpbnVlIF9mdW5jdGlvbjsgfSB9IGVsc2UgaWYgKCd2YWx1ZScgaW4gZGVzYykgeyByZXR1cm4gZGVzYy52YWx1ZTsgfSBlbHNlIHsgdmFyIGdldHRlciA9IGRlc2MuZ2V0OyBpZiAoZ2V0dGVyID09PSB1bmRlZmluZWQpIHsgcmV0dXJuIHVuZGVmaW5lZDsgfSByZXR1cm4gZ2V0dGVyLmNhbGwocmVjZWl2ZXIpOyB9IH0gfTsKCmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7ICdkZWZhdWx0Jzogb2JqIH07IH0KCmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcignQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uJyk7IH0gfQoKZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7IGlmICh0eXBlb2Ygc3VwZXJDbGFzcyAhPT0gJ2Z1bmN0aW9uJyAmJiBzdXBlckNsYXNzICE9PSBudWxsKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoJ1N1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uLCBub3QgJyArIHR5cGVvZiBzdXBlckNsYXNzKTsgfSBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IHN1YkNsYXNzLCBlbnVtZXJhYmxlOiBmYWxzZSwgd3JpdGFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9IH0pOyBpZiAoc3VwZXJDbGFzcykgT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LnNldFByb3RvdHlwZU9mKHN1YkNsYXNzLCBzdXBlckNsYXNzKSA6IHN1YkNsYXNzLl9fcHJvdG9fXyA9IHN1cGVyQ2xhc3M7IH0KCnZhciBfQ2F0YWxvZ3VlRGF0YU9iamVjdDIgPSByZXF1aXJlKCcuL0NhdGFsb2d1ZURhdGFPYmplY3QnKTsKCnZhciBfQ2F0YWxvZ3VlRGF0YU9iamVjdDMgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9DYXRhbG9ndWVEYXRhT2JqZWN0Mik7Cgp2YXIgX0h5cGVydHlSdW50aW1lRGVzY3JpcHRvciA9IHJlcXVpcmUoJy4vSHlwZXJ0eVJ1bnRpbWVEZXNjcmlwdG9yJyk7Cgp2YXIgX0h5cGVydHlSdW50aW1lRGVzY3JpcHRvcjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9IeXBlcnR5UnVudGltZURlc2NyaXB0b3IpOwoKdmFyIFByb3RvY29sU3R1YkRlc2NyaXB0b3IgPSAoZnVuY3Rpb24gKF9DYXRhbG9ndWVEYXRhT2JqZWN0KSB7CiAgICBfaW5oZXJpdHMoUHJvdG9jb2xTdHViRGVzY3JpcHRvciwgX0NhdGFsb2d1ZURhdGFPYmplY3QpOwoKICAgIGZ1bmN0aW9uIFByb3RvY29sU3R1YkRlc2NyaXB0b3IoZ3VpZCwgdHlwZSwgb2JqZWN0TmFtZSwgZGVzY3JpcHRpb24sIGxhbmd1YWdlLCBzb3VyY2VQYWNrYWdlVVJMLCBtZXNzYWdlU2NoZW1hcywgY29uZmlndXJhdGlvbkxpc3QsIGNvbnN0cmFpbnRMaXN0KSB7CiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFByb3RvY29sU3R1YkRlc2NyaXB0b3IpOwoKICAgICAgICBfZ2V0KE9iamVjdC5nZXRQcm90b3R5cGVPZihQcm90b2NvbFN0dWJEZXNjcmlwdG9yLnByb3RvdHlwZSksICdjb25zdHJ1Y3RvcicsIHRoaXMpLmNhbGwodGhpcywgZ3VpZCwgdHlwZSwgb2JqZWN0TmFtZSwgZGVzY3JpcHRpb24sIGxhbmd1YWdlLCBzb3VyY2VQYWNrYWdlVVJMKTsKCiAgICAgICAgdGhpcy5fbWVzc2FnZVNjaGVtYXMgPSBtZXNzYWdlU2NoZW1hczsKICAgICAgICBpZiAoY29uZmlndXJhdGlvbkxpc3QpIHRoaXMuX2NvbmZpZ3VyYXRpb25MaXN0ID0gY29uZmlndXJhdGlvbkxpc3Q7ZWxzZSB0aGlzLl9jb25maWd1cmF0aW9uTGlzdCA9IHt9OwoKICAgICAgICBpZiAoY29uc3RyYWludExpc3QpIHRoaXMuX2NvbnN0cmFpbnRzTGlzdCA9IGNvbnN0cmFpbnRMaXN0O2Vsc2UgdGhpcy5fY29uc3RyYWludHNMaXN0ID0ge307CiAgICB9CgogICAgX2NyZWF0ZUNsYXNzKFByb3RvY29sU3R1YkRlc2NyaXB0b3IsIFt7CiAgICAgICAga2V5OiAnbWVzc2FnZVNjaGVtYXMnLAogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fbWVzc2FnZVNjaGVtYXM7CiAgICAgICAgfQogICAgfSwgewogICAgICAgIGtleTogJ2NvbnN0cmFpbnRzTGlzdCcsCiAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9jb25zdHJhaW50c0xpc3Q7CiAgICAgICAgfQogICAgfSwgewogICAgICAgIGtleTogJ2NvbmZpZ3VyYXRpb25MaXN0JywKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NvbmZpZ3VyYXRpb25MaXN0OwogICAgICAgIH0KICAgIH1dKTsKCiAgICByZXR1cm4gUHJvdG9jb2xTdHViRGVzY3JpcHRvcjsKfSkoX0NhdGFsb2d1ZURhdGFPYmplY3QzWydkZWZhdWx0J10pOwoKZXhwb3J0c1snZGVmYXVsdCddID0gUHJvdG9jb2xTdHViRGVzY3JpcHRvcjsKbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWydkZWZhdWx0J107Cgp9LHsiLi9DYXRhbG9ndWVEYXRhT2JqZWN0Ijo0LCIuL0h5cGVydHlSdW50aW1lRGVzY3JpcHRvciI6OH1dLDExOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKLyoqCiAqIENyZWF0ZWQgYnkgYW1vIG9uIDE0LzExLzIwMTUuCiAqLwoidXNlIHN0cmljdCI7CgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgICB2YWx1ZTogdHJ1ZQp9KTsKCnZhciBfY3JlYXRlQ2xhc3MgPSAoZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9IHJldHVybiBmdW5jdGlvbiAoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH07IH0pKCk7CgpmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOyB9IH0KCnZhciBTb3VyY2VQYWNrYWdlID0gKGZ1bmN0aW9uICgpIHsKICAgIGZ1bmN0aW9uIFNvdXJjZVBhY2thZ2Uoc291cmNlQ29kZSwgc291cmNlQ29kZUNsYXNzbmFtZSkgewogICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBTb3VyY2VQYWNrYWdlKTsKCiAgICAgICAgdGhpcy5fc291cmNlQ29kZSA9IHNvdXJjZUNvZGU7CiAgICAgICAgdGhpcy5fc291cmNlQ29kZUNsYXNzbmFtZSA9IHNvdXJjZUNvZGVDbGFzc25hbWU7CgogICAgICAgIHRoaXMuX2VuY29kaW5nID0gbnVsbDsKICAgICAgICB0aGlzLl9zaWduYXR1cmUgPSBudWxsOwogICAgfQoKICAgIF9jcmVhdGVDbGFzcyhTb3VyY2VQYWNrYWdlLCBbewogICAgICAgIGtleTogInNvdXJjZUNvZGUiLAogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fc291cmNlQ29kZTsKICAgICAgICB9CiAgICB9LCB7CiAgICAgICAga2V5OiAic291cmNlQ29kZUNsYXNzbmFtZSIsCiAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zb3VyY2VDb2RlOwogICAgICAgIH0KICAgIH0sIHsKICAgICAgICBrZXk6ICJlbmNvZGluZyIsCiAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9lbmNvZGluZzsKICAgICAgICB9LAogICAgICAgIHNldDogZnVuY3Rpb24gc2V0KGVuY29kaW5nKSB7CiAgICAgICAgICAgIGlmIChlbmNvZGluZykgdGhpcy5fZW5jb2RpbmcgPSBlbmNvZGluZzsKICAgICAgICB9CiAgICB9LCB7CiAgICAgICAga2V5OiAic2lnbmF0dXJlIiwKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3NpZ25hdHVyZTsKICAgICAgICB9LAogICAgICAgIHNldDogZnVuY3Rpb24gc2V0KHNpZ24pIHsKICAgICAgICAgICAgaWYgKHNpZ24pIHRoaXMuX3NpZ25hdHVyZSA9IHNpZ247CiAgICAgICAgfQogICAgfV0pOwoKICAgIHJldHVybiBTb3VyY2VQYWNrYWdlOwp9KSgpOwoKZXhwb3J0c1siZGVmYXVsdCJdID0gU291cmNlUGFja2FnZTsKbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWyJkZWZhdWx0Il07Cgp9LHt9XSwxMjpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Ci8qIGpzaGludCB1bmRlZjogdHJ1ZSAqLwovKiBnbG9iYWxzIFJUQ1BlZXJDb25uZWN0aW9uICovCi8qIGdsb2JhbHMgUlRDU2Vzc2lvbkRlc2NyaXB0aW9uICovCi8qIGdsb2JhbHMgUlRDSWNlQ2FuZGlkYXRlICovCgondXNlIHN0cmljdCc7CgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7CiAgdmFsdWU6IHRydWUKfSk7Cgp2YXIgX2NyZWF0ZUNsYXNzID0gKGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmICgndmFsdWUnIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfSByZXR1cm4gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9OyB9KSgpOwoKdmFyIF9nZXQgPSBmdW5jdGlvbiBnZXQoX3gsIF94MiwgX3gzKSB7IHZhciBfYWdhaW4gPSB0cnVlOyBfZnVuY3Rpb246IHdoaWxlIChfYWdhaW4pIHsgdmFyIG9iamVjdCA9IF94LCBwcm9wZXJ0eSA9IF94MiwgcmVjZWl2ZXIgPSBfeDM7IF9hZ2FpbiA9IGZhbHNlOyBpZiAob2JqZWN0ID09PSBudWxsKSBvYmplY3QgPSBGdW5jdGlvbi5wcm90b3R5cGU7IHZhciBkZXNjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmplY3QsIHByb3BlcnR5KTsgaWYgKGRlc2MgPT09IHVuZGVmaW5lZCkgeyB2YXIgcGFyZW50ID0gT2JqZWN0LmdldFByb3RvdHlwZU9mKG9iamVjdCk7IGlmIChwYXJlbnQgPT09IG51bGwpIHsgcmV0dXJuIHVuZGVmaW5lZDsgfSBlbHNlIHsgX3ggPSBwYXJlbnQ7IF94MiA9IHByb3BlcnR5OyBfeDMgPSByZWNlaXZlcjsgX2FnYWluID0gdHJ1ZTsgZGVzYyA9IHBhcmVudCA9IHVuZGVmaW5lZDsgY29udGludWUgX2Z1bmN0aW9uOyB9IH0gZWxzZSBpZiAoJ3ZhbHVlJyBpbiBkZXNjKSB7IHJldHVybiBkZXNjLnZhbHVlOyB9IGVsc2UgeyB2YXIgZ2V0dGVyID0gZGVzYy5nZXQ7IGlmIChnZXR0ZXIgPT09IHVuZGVmaW5lZCkgeyByZXR1cm4gdW5kZWZpbmVkOyB9IHJldHVybiBnZXR0ZXIuY2FsbChyZWNlaXZlcik7IH0gfSB9OwoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgJ2RlZmF1bHQnOiBvYmogfTsgfQoKZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCdDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24nKTsgfSB9CgpmdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHsgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSAnZnVuY3Rpb24nICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcignU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24sIG5vdCAnICsgdHlwZW9mIHN1cGVyQ2xhc3MpOyB9IHN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgeyBjb25zdHJ1Y3RvcjogeyB2YWx1ZTogc3ViQ2xhc3MsIGVudW1lcmFibGU6IGZhbHNlLCB3cml0YWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0gfSk7IGlmIChzdXBlckNsYXNzKSBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3Quc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIDogc3ViQ2xhc3MuX19wcm90b19fID0gc3VwZXJDbGFzczsgfQoKcmVxdWlyZSgnd2VicnRjLWFkYXB0ZXItdGVzdCcpOwoKdmFyIF91dGlsc0V2ZW50RW1pdHRlciA9IHJlcXVpcmUoJy4uL3V0aWxzL0V2ZW50RW1pdHRlcicpOwoKdmFyIF91dGlsc0V2ZW50RW1pdHRlcjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF91dGlsc0V2ZW50RW1pdHRlcik7Cgp2YXIgQ29ubmVjdGlvbkNvbnRyb2xsZXIgPSAoZnVuY3Rpb24gKF9FdmVudEVtaXR0ZXIpIHsKICBfaW5oZXJpdHMoQ29ubmVjdGlvbkNvbnRyb2xsZXIsIF9FdmVudEVtaXR0ZXIpOwoKICBmdW5jdGlvbiBDb25uZWN0aW9uQ29udHJvbGxlcigpIHsKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBDb25uZWN0aW9uQ29udHJvbGxlcik7CgogICAgX2dldChPYmplY3QuZ2V0UHJvdG90eXBlT2YoQ29ubmVjdGlvbkNvbnRyb2xsZXIucHJvdG90eXBlKSwgJ2NvbnN0cnVjdG9yJywgdGhpcykuY2FsbCh0aGlzKTsKCiAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgIF90aGlzLm1vZGUgPSAnb2ZmZXInOwoKICAgIF90aGlzLm1lZGlhQ29uc3RyYWludHMgPSB7CiAgICAgIG9wdGlvbmFsOiBbXSwKICAgICAgbWFuZGF0b3J5OiB7CiAgICAgICAgb2ZmZXJUb1JlY2VpdmVBdWRpbzogdHJ1ZSwKICAgICAgICBvZmZlclRvUmVjZWl2ZVZpZGVvOiB0cnVlCiAgICAgIH0KICAgIH07CgogICAgLy8gUHJlcGFyZSB0aGUgUGVlckNvbm5lY3Rpb24KICAgIHZhciBwZWVyQ29ubmVjdGlvbiA9IG5ldyBSVENQZWVyQ29ubmVjdGlvbigpOwoKICAgIHBlZXJDb25uZWN0aW9uLmFkZEV2ZW50TGlzdGVuZXIoJ3NpZ25hbGluZ3N0YXRlY2hhbmdlJywgZnVuY3Rpb24gKGV2ZW50KSB7CgogICAgICBjb25zb2xlLmluZm8oJ3NpZ25hbGluZ3N0YXRlY2hhbmdlJywgZXZlbnQpOwoKICAgICAgaWYgKGV2ZW50LmN1cnJlbnRUYXJnZXQuc2lnbmFsaW5nU3RhdGUgPT09ICdoYXZlLXJlbW90ZS1vZmZlcicpIHsKICAgICAgICBfdGhpcy5tb2RlID0gJ2Fuc3dlcic7CiAgICAgICAgX3RoaXMudHJpZ2dlcignY29udHJvbGxlcjpzdGF0ZTpjaGFuZ2UnLCBfdGhpcy5tb2RlKTsKICAgICAgfQoKICAgICAgaWYgKGV2ZW50LmN1cnJlbnRUYXJnZXQuc2lnbmFsaW5nU3RhdGUgPT09ICdoYXZlLWxvY2FsLW9mZmVyJykgewogICAgICAgIF90aGlzLnRyaWdnZXIoJ2NvbnRyb2xsZXI6c3RhdGU6Y2hhbmdlJywgX3RoaXMubW9kZSk7CiAgICAgIH0KICAgIH0pOwoKICAgIHBlZXJDb25uZWN0aW9uLmFkZEV2ZW50TGlzdGVuZXIoJ2ljZWNvbm5lY3Rpb25zdGF0ZWNoYW5nZScsIGZ1bmN0aW9uIChldmVudCkgewogICAgICBjb25zb2xlLmluZm8oZXZlbnQuY3VycmVudFRhcmdldC5pY2VDb25uZWN0aW9uU3RhdGUpOwogICAgfSk7CgogICAgcGVlckNvbm5lY3Rpb24uYWRkRXZlbnRMaXN0ZW5lcignaWNlY2FuZGlkYXRlJywgZnVuY3Rpb24gKGV2ZW50KSB7CgogICAgICBpZiAoIWV2ZW50LmNhbmRpZGF0ZSkgcmV0dXJuOwoKICAgICAgdmFyIGRhdGEgPSBfdGhpcy5fY29ubmVjdGlvbkRhdGFPYmplY3RSZXBvcnRlci5kYXRhOwogICAgICBkYXRhLmljZSA9IHsKICAgICAgICB0eXBlOiAnY2FuZGlkYXRlJywKICAgICAgICBjYW5kaWRhdGU6IGV2ZW50LmNhbmRpZGF0ZS5jYW5kaWRhdGUsCiAgICAgICAgc2RwTWlkOiBldmVudC5jYW5kaWRhdGUuc2RwTWlkLAogICAgICAgIHNkcE1MaW5lSW5kZXg6IGV2ZW50LmNhbmRpZGF0ZS5zZHBNTGluZUluZGV4CiAgICAgIH07CiAgICB9KTsKCiAgICAvLyBBZGQgc3RyZWFtIHRvIFBlZXJDb25uZWN0aW9uCiAgICBwZWVyQ29ubmVjdGlvbi5hZGRFdmVudExpc3RlbmVyKCdhZGRzdHJlYW0nLCBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgY29uc29sZS5pbmZvKCdhZGQgc3RyZWFtIGZyb20gbW9kZTogJywgX3RoaXMubW9kZSk7CiAgICAgIF90aGlzLnRyaWdnZXIoJ3N0cmVhbTphZGRlZCcsIFVSTC5jcmVhdGVPYmplY3RVUkwoZXZlbnQuc3RyZWFtKSwgX3RoaXMuY29ubmVjdGlvbkRhdGFPYmplY3RSZXBvcnRlciwgX3RoaXMuY29ubmVjdGlvbkRhdGFPYmplY3RPYnNlcnZlcik7CiAgICB9KTsKCiAgICBfdGhpcy5wZWVyQ29ubmVjdGlvbiA9IHBlZXJDb25uZWN0aW9uOwogIH0KCiAgX2NyZWF0ZUNsYXNzKENvbm5lY3Rpb25Db250cm9sbGVyLCBbewogICAga2V5OiAnZ2V0VXNlck1lZGlhJywKCiAgICAvKioKICAgICAqIEdldCBXZWJSVEMgQVBJIHJlc291cmNlcwogICAgICogQHBhcmFtICB7T2JqZWN0fSAgICAgb3B0aW9ucyBPYmplY3QgY29udGFpbmluZyB0aGUgaW5mb3JtYXRpb24gdGhhdCByZXNvdXJjZXMgd2lsbCBiZSB1c2VkIChjYW1lcmEsIG1pYywgcmVzb2x1dGlvbiwgZXRjKTsKICAgICAqIEByZXR1cm4ge1Byb21pc2V9CiAgICAgKi8KICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRVc2VyTWVkaWEoY29uc3RyYWludHMpIHsKCiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewoKICAgICAgICBuYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmdldFVzZXJNZWRpYShjb25zdHJhaW50cykudGhlbihmdW5jdGlvbiAobWVkaWFTdHJlYW0pIHsKICAgICAgICAgIF90aGlzLnBlZXJDb25uZWN0aW9uLmFkZFN0cmVhbShtZWRpYVN0cmVhbSk7CiAgICAgICAgICByZXNvbHZlKG1lZGlhU3RyZWFtKTsKICAgICAgICB9KVsnY2F0Y2gnXShmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgICAgICByZWplY3QocmVhc29uKTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAnY2hhbmdlUGVlckluZm9ybWF0aW9uJywKICAgIHZhbHVlOiBmdW5jdGlvbiBjaGFuZ2VQZWVySW5mb3JtYXRpb24oKSB7CgogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgX3RoaXMuX2Nvbm5lY3Rpb25EYXRhT2JqZWN0T2JzZXJ2ZXIub25DaGFuZ2UoJyonLCBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICBjb25zb2xlLmRlYnVnKCdtZXNzYWdlOicsIGV2ZW50KTsKCiAgICAgICAgdmFyIG1lc3NhZ2UgPSBldmVudC5kYXRhOwoKICAgICAgICBpZiAobWVzc2FnZS50eXBlID09PSAnb2ZmZXInIHx8IG1lc3NhZ2UudHlwZSA9PT0gJ2Fuc3dlcicpIHsKCiAgICAgICAgICBfdGhpcy5wZWVyQ29ubmVjdGlvbi5zZXRSZW1vdGVEZXNjcmlwdGlvbihuZXcgUlRDU2Vzc2lvbkRlc2NyaXB0aW9uKG1lc3NhZ2UpLCBfdGhpcy5yZW1vdGVEZXNjcmlwdGlvblN1Y2Nlc3MsIF90aGlzLnJlbW90ZURlc2NyaXB0aW9uRXJyb3IpOwogICAgICAgIH0gZWxzZSBpZiAobWVzc2FnZS50eXBlID09PSAnY2FuZGlkYXRlJykgewogICAgICAgICAgX3RoaXMucGVlckNvbm5lY3Rpb24uYWRkSWNlQ2FuZGlkYXRlKG5ldyBSVENJY2VDYW5kaWRhdGUoeyBjYW5kaWRhdGU6IG1lc3NhZ2UuY2FuZGlkYXRlIH0pKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogJ3JlbW90ZURlc2NyaXB0aW9uU3VjY2VzcycsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVtb3RlRGVzY3JpcHRpb25TdWNjZXNzKCkgewogICAgICBjb25zb2xlLmluZm8oJ3JlbW90ZSBzdWNjZXNzJyk7CiAgICB9CiAgfSwgewogICAga2V5OiAncmVtb3RlRGVzY3JpcHRpb25FcnJvcicsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVtb3RlRGVzY3JpcHRpb25FcnJvcihlcnJvcikgewogICAgICBjb25zb2xlLmVycm9yKCdlcnJvcjogJywgZXJyb3IpOwogICAgfQogIH0sIHsKICAgIGtleTogJ2NyZWF0ZU9mZmVyJywKICAgIHZhbHVlOiBmdW5jdGlvbiBjcmVhdGVPZmZlcigpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIF90aGlzLnBlZXJDb25uZWN0aW9uLmNyZWF0ZU9mZmVyKGZ1bmN0aW9uIChkZXNjcmlwdGlvbikgewogICAgICAgIF90aGlzLm9uTG9jYWxTZXNzaW9uQ3JlYXRlZChkZXNjcmlwdGlvbik7CiAgICAgIH0sIF90aGlzLmluZm9FcnJvciwgX3RoaXMubWVkaWFDb25zdHJhaW50cyk7CiAgICB9CiAgfSwgewogICAga2V5OiAnY3JlYXRlQW5zd2VyJywKICAgIHZhbHVlOiBmdW5jdGlvbiBjcmVhdGVBbnN3ZXIoKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICBfdGhpcy5wZWVyQ29ubmVjdGlvbi5jcmVhdGVBbnN3ZXIoZnVuY3Rpb24gKGRlc2NyaXB0aW9uKSB7CiAgICAgICAgX3RoaXMub25Mb2NhbFNlc3Npb25DcmVhdGVkKGRlc2NyaXB0aW9uKTsKICAgICAgfSwgX3RoaXMuaW5mb0Vycm9yKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICdvbkxvY2FsU2Vzc2lvbkNyZWF0ZWQnLAogICAgdmFsdWU6IGZ1bmN0aW9uIG9uTG9jYWxTZXNzaW9uQ3JlYXRlZChkZXNjcmlwdGlvbikgewoKICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgdmFyIHBlZXJDb25uZWN0aW9uID0gX3RoaXMucGVlckNvbm5lY3Rpb247CgogICAgICBwZWVyQ29ubmVjdGlvbi5zZXRMb2NhbERlc2NyaXB0aW9uKGRlc2NyaXB0aW9uLCBmdW5jdGlvbiAoKSB7CgogICAgICAgIHZhciBkYXRhID0gX3RoaXMuX2Nvbm5lY3Rpb25EYXRhT2JqZWN0UmVwb3J0ZXIuZGF0YTsKICAgICAgICBkYXRhLnNkcCA9IHsKICAgICAgICAgIHNkcDogZGVzY3JpcHRpb24uc2RwLAogICAgICAgICAgdHlwZTogZGVzY3JpcHRpb24udHlwZQogICAgICAgIH07CiAgICAgIH0sIF90aGlzLmluZm9FcnJvcik7CiAgICB9CiAgfSwgewogICAga2V5OiAnaW5mb0Vycm9yJywKICAgIHZhbHVlOiBmdW5jdGlvbiBpbmZvRXJyb3IoZXJyKSB7CiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyLnRvU3RyaW5nKCksIGVycik7CiAgICB9CgogICAgLyoqCiAgICAgKiBVc2VkIHRvIGFjY2VwdCBhbiBpbmNvbWluZyBjb25uZWN0aW9uIHJlcXVlc3QuCiAgICAgKiBAbWV0aG9kIGFjY2VwdAogICAgICogQHJldHVybiB7UHJvbWlzZX0KICAgICAqLwogIH0sIHsKICAgIGtleTogJ2FjY2VwdCcsCiAgICB2YWx1ZTogZnVuY3Rpb24gYWNjZXB0KCkgewogICAgICAvLyBUT0RPOiBvcHRpbWl6ZSB0aGUgZGlzY29ubmVjdCBmdW5jdGlvbgoKICAgICAgLy8gbGV0IF90aGlzID0gdGhpczsKCiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIHJlc29sdmUodHJ1ZSk7CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgcmVqZWN0KCdlcnJvciBhY2NlcHRpbmcgY29ubmVjdGlvbicpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CgogICAgLyoqCiAgICAqIFVzZWQgdG8gZGVjbGluZSBhbiBpbmNvbWluZyBjb25uZWN0aW9uIHJlcXVlc3QuCiAgICAqIEBtZXRob2QgZGVjbGluZQogICAgKiBAcmV0dXJuIHtQcm9taXNlfQogICAgKi8KICB9LCB7CiAgICBrZXk6ICdkZWNsaW5lJywKICAgIHZhbHVlOiBmdW5jdGlvbiBkZWNsaW5lKCkge30KCiAgICAvKioKICAgICAqIFVzZWQgdG8gY2xvc2UgYW4gZXhpc3RpbmcgY29ubmVjdGlvbiBpbnN0YW5jZS4KICAgICAqIEBtZXRob2QgZGlzY29ubmVjdAogICAgICogQHJldHVybiB7UHJvbWlzZX0KICAgICAqLwogIH0sIHsKICAgIGtleTogJ2Rpc2Nvbm5lY3QnLAogICAgdmFsdWU6IGZ1bmN0aW9uIGRpc2Nvbm5lY3QoKSB7CgogICAgICAvLyBUT0RPOiBvcHRpbWl6ZSB0aGUgZGlzY29ubmVjdCBmdW5jdGlvbgoKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CgogICAgICAgIHRyeSB7CgogICAgICAgICAgX3RoaXMucGVlckNvbm5lY3Rpb24uY2xvc2UoKTsKCiAgICAgICAgICByZXNvbHZlKHRydWUpOwogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgIHJlamVjdCgnZXJyb3IgZGlzY29ubmVjdGluZyBjb25uZWN0aW9uJyk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KCiAgICAvKioKICAgICAqIFVzZWQgdG8gYWRkL2ludml0ZSBuZXcgcGVlcnMgb24gYW4gZXhpc3RpbmcgY29ubmVjdGlvbiBpbnN0YW5jZSAoZm9yIG11bHRpcGFydHkgY29ubmVjdGlvbnMpLgogICAgICogQG1ldGhvZCBhZGRQZWVyCiAgICAgKiBAcmV0dXJuIHtQcm9taXNlfQogICAgICovCiAgfSwgewogICAga2V5OiAnYWRkUGVlcicsCiAgICB2YWx1ZTogZnVuY3Rpb24gYWRkUGVlcigpIHt9CgogICAgLyoqCiAgICAgKiBVc2VkIHRvIHJlbW92ZSBhIHBlZXIgZnJvbSBhbiBleGlzdGluZyBjb25uZWN0aW9uIGluc3RhbmNlLgogICAgICogQG1ldGhvZCByZW1vdmVQZWVyCiAgICAgKiBAcmV0dXJuIHtQcm9taXNlfQogICAgICovCiAgfSwgewogICAga2V5OiAncmVtb3ZlUGVlcicsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVtb3ZlUGVlcigpIHt9CiAgfSwgewogICAga2V5OiAnc3RhdHVzJywKICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICByZXR1cm4gX3RoaXMuX3N0YXR1czsKICAgIH0KCiAgICAvKioKICAgICogU2V0IHRoZSBjb25uZWN0aW9uRGF0YU9iamVjdCBpbiB0aGUgY29udHJvbGxlcgogICAgKiBAcGFyYW0ge0Nvbm5lY3Rpb25EYXRhT2JqZWN0fSBjb25uZWN0aW9uRGF0YU9iamVjdCAtIGhhdmUgYWxsIGluZm9ybWF0aW9uIGFib3V0IHRoZSBzeW5jaGVyIG9iamVjdDsKICAgICovCiAgfSwgewogICAga2V5OiAnY29ubmVjdGlvbkRhdGFPYmplY3RSZXBvcnRlcicsCiAgICBzZXQ6IGZ1bmN0aW9uIHNldChjb25uZWN0aW9uRGF0YU9iamVjdCkgewogICAgICBpZiAoIWNvbm5lY3Rpb25EYXRhT2JqZWN0KSB0aHJvdyBuZXcgRXJyb3IoJ1RoZSBDb25uZWN0aW9uIERhdGEgT2JqZWN0IGlzIGEgbmVlZGVkIHBhcmFtZXRlcicpOwoKICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgX3RoaXMuX2Nvbm5lY3Rpb25EYXRhT2JqZWN0UmVwb3J0ZXIgPSBjb25uZWN0aW9uRGF0YU9iamVjdDsKCiAgICAgIGNvbm5lY3Rpb25EYXRhT2JqZWN0Lm9uU3Vic2NyaXB0aW9uKGZ1bmN0aW9uIChldmVudCkgewogICAgICAgIGV2ZW50LmFjY2VwdCgpOwoKICAgICAgICBpZiAoX3RoaXMubW9kZSA9PT0gJ29mZmVyJykgewogICAgICAgICAgX3RoaXMuY3JlYXRlT2ZmZXIoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgX3RoaXMuY3JlYXRlQW5zd2VyKCk7CiAgICAgICAgfQogICAgICB9KTsKCiAgICAgIGNvbnNvbGUuaW5mbygnU2V0IGNvbm5lY3Rpb25EYXRhT2JqZWN0OiAnLCBfdGhpcy5fY29ubmVjdGlvbkRhdGFPYmplY3RSZXBvcnRlcik7CiAgICB9LAoKICAgIC8qKgogICAgKiByZXR1cm4gdGhlIGNvbm5lY3Rpb25EYXRhT2JqZWN0IGluIHRoZSBjb250cm9sbGVyCiAgICAqIEByZXR1cm4ge0Nvbm5lY3Rpb25EYXRhT2JqZWN0fSBjb25uZWN0aW9uRGF0YU9iamVjdAogICAgKi8KICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICByZXR1cm4gX3RoaXMuX2Nvbm5lY3Rpb25EYXRhT2JqZWN0UmVwb3J0ZXI7CiAgICB9CgogICAgLyoqCiAgICAqIFNldCB0aGUgY29ubmVjdGlvbkRhdGFPYmplY3QgaW4gdGhlIGNvbnRyb2xsZXIKICAgICogQHBhcmFtIHtDb25uZWN0aW9uRGF0YU9iamVjdH0gY29ubmVjdGlvbkRhdGFPYmplY3QgLSBoYXZlIGFsbCBpbmZvcm1hdGlvbiBhYm91dCB0aGUgc3luY2hlciBvYmplY3Q7CiAgICAqLwogIH0sIHsKICAgIGtleTogJ2Nvbm5lY3Rpb25EYXRhT2JqZWN0T2JzZXJ2ZXInLAogICAgc2V0OiBmdW5jdGlvbiBzZXQoY29ubmVjdGlvbkRhdGFPYmplY3QpIHsKICAgICAgaWYgKCFjb25uZWN0aW9uRGF0YU9iamVjdCkgdGhyb3cgbmV3IEVycm9yKCdUaGUgQ29ubmVjdGlvbiBEYXRhIE9iamVjdCBpcyBhIG5lZWRlZCBwYXJhbWV0ZXInKTsKCiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgIF90aGlzLl9jb25uZWN0aW9uRGF0YU9iamVjdE9ic2VydmVyID0gY29ubmVjdGlvbkRhdGFPYmplY3Q7CgogICAgICBjb25uZWN0aW9uRGF0YU9iamVjdC5vbk5vdGlmaWNhdGlvbihmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICBjb25zb2xlLmluZm8oJ0Nvbm5lY3Rpb24gRGF0YSBPYmplY3QgT2JzZXJ2ZXIgbm90aWZpY2F0aW9uOiAnLCBldmVudCk7CiAgICAgICAgX3RoaXMudHJpZ2dlcignb246bm90aWZpY2F0aW9uJywgZXZlbnQpOwogICAgICB9KTsKCiAgICAgIGNvbnNvbGUuaW5mbygnU2V0IGNvbm5lY3Rpb25EYXRhT2JqZWN0OiAnLCBfdGhpcy5fY29ubmVjdGlvbkRhdGFPYmplY3RPYnNlcnZlcik7CgogICAgICBfdGhpcy5jaGFuZ2VQZWVySW5mb3JtYXRpb24oKTsKICAgIH0sCgogICAgLyoqCiAgICAqIHJldHVybiB0aGUgY29ubmVjdGlvbkRhdGFPYmplY3QgaW4gdGhlIGNvbnRyb2xsZXIKICAgICogQHJldHVybiB7Q29ubmVjdGlvbkRhdGFPYmplY3R9IGNvbm5lY3Rpb25EYXRhT2JqZWN0CiAgICAqLwogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgIHJldHVybiBfdGhpcy5fY29ubmVjdGlvbkRhdGFPYmplY3RPYnNlcnZlcjsKICAgIH0KICB9XSk7CgogIHJldHVybiBDb25uZWN0aW9uQ29udHJvbGxlcjsKfSkoX3V0aWxzRXZlbnRFbWl0dGVyMlsnZGVmYXVsdCddKTsKCmV4cG9ydHNbJ2RlZmF1bHQnXSA9IENvbm5lY3Rpb25Db250cm9sbGVyOwptb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbJ2RlZmF1bHQnXTsKCn0seyIuLi91dGlscy9FdmVudEVtaXR0ZXIiOjIzLCJ3ZWJydGMtYWRhcHRlci10ZXN0IjoyfV0sMTM6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewondXNlIHN0cmljdCc7CgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7CiAgdmFsdWU6IHRydWUKfSk7Cgp2YXIgX2NyZWF0ZUNsYXNzID0gKGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmICgndmFsdWUnIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfSByZXR1cm4gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9OyB9KSgpOwoKdmFyIF9nZXQgPSBmdW5jdGlvbiBnZXQoX3gsIF94MiwgX3gzKSB7IHZhciBfYWdhaW4gPSB0cnVlOyBfZnVuY3Rpb246IHdoaWxlIChfYWdhaW4pIHsgdmFyIG9iamVjdCA9IF94LCBwcm9wZXJ0eSA9IF94MiwgcmVjZWl2ZXIgPSBfeDM7IF9hZ2FpbiA9IGZhbHNlOyBpZiAob2JqZWN0ID09PSBudWxsKSBvYmplY3QgPSBGdW5jdGlvbi5wcm90b3R5cGU7IHZhciBkZXNjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmplY3QsIHByb3BlcnR5KTsgaWYgKGRlc2MgPT09IHVuZGVmaW5lZCkgeyB2YXIgcGFyZW50ID0gT2JqZWN0LmdldFByb3RvdHlwZU9mKG9iamVjdCk7IGlmIChwYXJlbnQgPT09IG51bGwpIHsgcmV0dXJuIHVuZGVmaW5lZDsgfSBlbHNlIHsgX3ggPSBwYXJlbnQ7IF94MiA9IHByb3BlcnR5OyBfeDMgPSByZWNlaXZlcjsgX2FnYWluID0gdHJ1ZTsgZGVzYyA9IHBhcmVudCA9IHVuZGVmaW5lZDsgY29udGludWUgX2Z1bmN0aW9uOyB9IH0gZWxzZSBpZiAoJ3ZhbHVlJyBpbiBkZXNjKSB7IHJldHVybiBkZXNjLnZhbHVlOyB9IGVsc2UgeyB2YXIgZ2V0dGVyID0gZGVzYy5nZXQ7IGlmIChnZXR0ZXIgPT09IHVuZGVmaW5lZCkgeyByZXR1cm4gdW5kZWZpbmVkOyB9IHJldHVybiBnZXR0ZXIuY2FsbChyZWNlaXZlcik7IH0gfSB9OwoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgJ2RlZmF1bHQnOiBvYmogfTsgfQoKZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCdDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24nKTsgfSB9CgpmdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHsgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSAnZnVuY3Rpb24nICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcignU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24sIG5vdCAnICsgdHlwZW9mIHN1cGVyQ2xhc3MpOyB9IHN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgeyBjb25zdHJ1Y3RvcjogeyB2YWx1ZTogc3ViQ2xhc3MsIGVudW1lcmFibGU6IGZhbHNlLCB3cml0YWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0gfSk7IGlmIChzdXBlckNsYXNzKSBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3Quc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIDogc3ViQ2xhc3MuX19wcm90b19fID0gc3VwZXJDbGFzczsgfQoKdmFyIF9Db25uZWN0aW9uQ29udHJvbGxlciA9IHJlcXVpcmUoJy4vQ29ubmVjdGlvbkNvbnRyb2xsZXInKTsKCnZhciBfQ29ubmVjdGlvbkNvbnRyb2xsZXIyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfQ29ubmVjdGlvbkNvbnRyb2xsZXIpOwoKdmFyIF91dGlsc0V2ZW50RW1pdHRlciA9IHJlcXVpcmUoJy4uL3V0aWxzL0V2ZW50RW1pdHRlcicpOwoKdmFyIF91dGlsc0V2ZW50RW1pdHRlcjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF91dGlsc0V2ZW50RW1pdHRlcik7CgovKioKICogSHlwZXJ0eSBDb25uZWN0b3I7CiAqIEBhdXRob3IgVml0b3IgU2lsdmEgW3ZpdG9yLXQtc2lsdmFAdGVsZWNvbS5wdF0KICogQHZlcnNpb24gMC4xLjAKICovCgp2YXIgSHlwZXJ0eUNvbm5lY3RvciA9IChmdW5jdGlvbiAoX0V2ZW50RW1pdHRlcikgewogIF9pbmhlcml0cyhIeXBlcnR5Q29ubmVjdG9yLCBfRXZlbnRFbWl0dGVyKTsKCiAgLyoqCiAgICogQ3JlYXRlIGEgbmV3IEh5cGVydHkgQ29ubmVjdG9yCiAgICogQHBhcmFtICB7U3luY2hlcn0gc3luY2hlciAtIFN5bmNoZXIgcHJvdmlkZWQgZnJvbSB0aGUgcnVudGltZSBjb3JlCiAgICovCgogIGZ1bmN0aW9uIEh5cGVydHlDb25uZWN0b3Ioc3luY2hlcikgewogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEh5cGVydHlDb25uZWN0b3IpOwoKICAgIGlmICghc3luY2hlcikgdGhyb3cgbmV3IEVycm9yKCdUaGUgU3luY2hlciBpcyBhIG5lZWRlZCBwYXJhbWV0ZXInKTsKCiAgICBfZ2V0KE9iamVjdC5nZXRQcm90b3R5cGVPZihIeXBlcnR5Q29ubmVjdG9yLnByb3RvdHlwZSksICdjb25zdHJ1Y3RvcicsIHRoaXMpLmNhbGwodGhpcywgc3luY2hlcik7CgogICAgdmFyIF90aGlzID0gdGhpczsKCiAgICBfdGhpcy5jb250cm9sbGVycyA9IHt9OwoKICAgIC8vIHN0ZXAgMiAtIGh0dHBzOi8vZ2l0aHViLmNvbS9yZVRISU5LLXByb2plY3Qvc2NlbmFyaW8tc2VydmljZS1pbXBsZW1lbnRhdGlvbi90cmVlL21hc3Rlci9kb2NzL2h5cGVydGllcy9jb25uZWN0b3Ijbm90aWZpY2F0aW9uLWFib3V0LWluY29taW5nLWNvbm5lY3Rpb24tcmVxdWVzdAogICAgc3luY2hlci5vbk5vdGlmaWNhdGlvbihmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgY29uc29sZS5pbmZvKCdjb25uZWN0b3IgaGF2ZSBhbiBub3RpZmljYXRpb246ICcsIGV2ZW50KTsKICAgICAgX3RoaXMuX2F1dG9TdWJzY3JpYmUoZXZlbnQpOwogICAgfSk7CgogICAgX3RoaXMuX3N5bmNoZXIgPSBzeW5jaGVyOwogIH0KCiAgLyoqCiAgICogRXN0YWJsaXNoIGNvbm5lY3Rpb24gd2l0aCBvdGhlciBjbGllbnQgaWRlbnRpZmllcgogICAqIEBwYXJhbSAge0h5cGVydHlVUkx9IEh5cGVydHlVUkwgLSBEZWZpbmUgdGhlIGlkZW50aWZpZXIgb2YgdGhlIG90aGVyIGNvbXBvbmVudAogICAqIEBwYXJhbSAge09iamVjdH0gb3B0aW9ucyAtIE9iamVjdCB3aXRoIG9wdGlvbnMgdG8gaW1wcm92ZSB0aGUgY29ubmVjdAogICAqLwoKICBfY3JlYXRlQ2xhc3MoSHlwZXJ0eUNvbm5lY3RvciwgW3sKICAgIGtleTogJ2Nvbm5lY3QnLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNvbm5lY3QoaHlwZXJ0eVVSTCwgb3B0aW9ucykgewogICAgICAvLyBUT0RPOiBDSGFuZ2UgdGhlIGh5cGVydHlVUkwgZm9yIGEgbGlzdCBvZiBVUkxTCiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7IHZpZGVvOiB0cnVlLCBhdWRpbzogdHJ1ZSB9OwoKICAgICAgdmFyIGNvbm5lY3Rpb25Db250cm9sbGVyID0gbmV3IF9Db25uZWN0aW9uQ29udHJvbGxlcjJbJ2RlZmF1bHQnXSgpOwoKICAgICAgY29ubmVjdGlvbkNvbnRyb2xsZXIuYWRkRXZlbnRMaXN0ZW5lcignY29udHJvbGxlcjpzdGF0ZTpjaGFuZ2UnLCBmdW5jdGlvbiAoc3RhdGUpIHsKICAgICAgICBpZiAoc3RhdGUgPT09ICdhbnN3ZXInKSB7CiAgICAgICAgICBjb25zb2xlLmluZm8oJ2Nvbm5lY3Rpb24gY29udHJvbGxlciBzdGF0ZTogJywgc3RhdGUpOwogICAgICAgICAgX3RoaXMubW9kZSA9IHN0YXRlOwoKICAgICAgICAgIC8vIF90aGlzLl9hdXRvQ29ubmVjdChfdGhpcy5ub3RpZmljYXRpb25FdmVudC5mcm9tKTsKICAgICAgICB9CiAgICAgIH0pOwoKICAgICAgX3RoaXMuY29udHJvbGxlcnNbaHlwZXJ0eVVSTF0gPSBjb25uZWN0aW9uQ29udHJvbGxlcjsKCiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CgogICAgICAgIC8vIFN0ZXAgMyBhbmQgNCAtIGh0dHBzOi8vZ2l0aHViLmNvbS9yZVRISU5LLXByb2plY3Qvc2NlbmFyaW8tc2VydmljZS1pbXBsZW1lbnRhdGlvbi90cmVlL21hc3Rlci9kb2NzL2h5cGVydGllcy9jb25uZWN0b3IjY3JlYXRlLW5ldy1jb25uZWN0aW9uCiAgICAgICAgY29ubmVjdGlvbkNvbnRyb2xsZXIuZ2V0VXNlck1lZGlhKG9wdGlvbnMpLnRoZW4oZnVuY3Rpb24gKGNvbW1SZXNvdXJjZXMpIHsKICAgICAgICAgIGNvbnNvbGUuaW5mbygnR2V0IHdlYlJUQyBjb21tb24gcmVzb3VyY2VzJywgY29tbVJlc291cmNlcywgaHlwZXJ0eVVSTCk7CgogICAgICAgICAgLy8gVE9ETzogT3B0aW1pemUgdGhlIHJlc291cmNlcyB0byBnZXQ7CiAgICAgICAgICAvLyBhbmQgYWRkIGFsbCBvcHRpb25zIGF2YWlsYWJsZTsKICAgICAgICAgIHZhciBpbml0aWFsID0ge307CiAgICAgICAgICBpbml0aWFsLm93bmVyID0gdHJ1ZTsKICAgICAgICAgIGluaXRpYWwudG8gPSBoeXBlcnR5VVJMOwogICAgICAgICAgaW5pdGlhbC5yZXNvdXJjZXMgPSB7CiAgICAgICAgICAgIHZpZGVvOiBvcHRpb25zLnZpZGVvLAogICAgICAgICAgICBhdWRpbzogb3B0aW9ucy5hdWRpbwogICAgICAgICAgfTsKCiAgICAgICAgICAvLyBTdGVwIDUgLSBodHRwczovL2dpdGh1Yi5jb20vcmVUSElOSy1wcm9qZWN0L3NjZW5hcmlvLXNlcnZpY2UtaW1wbGVtZW50YXRpb24vdHJlZS9tYXN0ZXIvZG9jcy9oeXBlcnRpZXMvY29ubmVjdG9yI2NyZWF0ZS1uZXctY29ubmVjdGlvbgogICAgICAgICAgcmV0dXJuIF90aGlzLl9zeW5jaGVyLmNyZWF0ZSh7fSwgW2h5cGVydHlVUkxdLCBpbml0aWFsKTsKICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChjb25uZWN0aW9uRGF0YU9iamVjdCkgewogICAgICAgICAgY29uc29sZS5pbmZvKCdSZXR1cm4gQ3JlYXRlIENvbm5lY3Rpb24gRGF0YSBPYmplY3QnLCBjb25uZWN0aW9uRGF0YU9iamVjdCk7CgogICAgICAgICAgLy8gU3RlcCAxMSAtIGh0dHBzOi8vZ2l0aHViLmNvbS9yZVRISU5LLXByb2plY3Qvc2NlbmFyaW8tc2VydmljZS1pbXBsZW1lbnRhdGlvbi90cmVlL21hc3Rlci9kb2NzL2h5cGVydGllcy9jb25uZWN0b3IjY3JlYXRlLW5ldy1jb25uZWN0aW9uCiAgICAgICAgICBjb25uZWN0aW9uQ29udHJvbGxlci5jb25uZWN0aW9uRGF0YU9iamVjdFJlcG9ydGVyID0gY29ubmVjdGlvbkRhdGFPYmplY3Q7CgogICAgICAgICAgLy8gU3RlcCAxMiAtIGh0dHBzOi8vZ2l0aHViLmNvbS9yZVRISU5LLXByb2plY3Qvc2NlbmFyaW8tc2VydmljZS1pbXBsZW1lbnRhdGlvbi90cmVlL21hc3Rlci9kb2NzL2h5cGVydGllcy9jb25uZWN0b3IjY3JlYXRlLW5ldy1jb25uZWN0aW9uCiAgICAgICAgICByZXNvbHZlKGNvbm5lY3Rpb25Db250cm9sbGVyKTsKICAgICAgICB9KVsnY2F0Y2gnXShmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgICAgICBjb25zb2xlLmVycm9yKHJlYXNvbik7CiAgICAgICAgICByZWplY3QocmVhc29uKTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBY2NlcHQgdGhlIGluY29taW5nIGNhbGwKICAgICAqIEBtZXRob2QgYWNjZXB0CiAgICAgKiBAcmV0dXJuIHtQcm9taXNlfQogICAgICovCiAgfSwgewogICAga2V5OiAnYWNjZXB0JywKICAgIHZhbHVlOiBmdW5jdGlvbiBhY2NlcHQoKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewoKICAgICAgICB2YXIgb2JqZWN0VVJMID0gX3RoaXMubm90aWZpY2F0aW9uRXZlbnQudXJsOwoKICAgICAgICAvLyBzdGVwIDYgLSBodHRwczovL2dpdGh1Yi5jb20vcmVUSElOSy1wcm9qZWN0L3NjZW5hcmlvLXNlcnZpY2UtaW1wbGVtZW50YXRpb24vdHJlZS9tYXN0ZXIvZG9jcy9oeXBlcnRpZXMvY29ubmVjdG9yI25vdGlmaWNhdGlvbi1hYm91dC1pbmNvbWluZy1jb25uZWN0aW9uLXJlcXVlc3QKICAgICAgICAvLyBhZnRlciB3YWl0aW5nIGZvciBhbiBhbnN3ZXIsIHdlIGNhbiBub3cgc3Vic2NyaWJlIHRoZSBvYmplY3RVUkwKICAgICAgICBfdGhpcy5fc3luY2hlci5zdWJzY3JpYmUob2JqZWN0VVJMKS50aGVuKGZ1bmN0aW9uIChjb25uZWN0aW9uRGF0YU9iamVjdCkgewogICAgICAgICAgY29uc29sZS5pbmZvKCdSZXR1cm4gU3Vic2NyaWJlIENvbm5lY3Rpb24gRGF0YSBPYmplY3QnLCBjb25uZWN0aW9uRGF0YU9iamVjdCk7CgogICAgICAgICAgLy8gc3RlcCA3IGFuZCAxMCAtIGh0dHBzOi8vZ2l0aHViLmNvbS9yZVRISU5LLXByb2plY3Qvc2NlbmFyaW8tc2VydmljZS1pbXBsZW1lbnRhdGlvbi90cmVlL21hc3Rlci9kb2NzL2h5cGVydGllcy9jb25uZWN0b3Ijbm90aWZpY2F0aW9uLWFib3V0LWluY29taW5nLWNvbm5lY3Rpb24tcmVxdWVzdAogICAgICAgICAgX3RoaXMuY29ubmVjdGlvbkNvbnRyb2xsZXIuY29ubmVjdGlvbkRhdGFPYmplY3RPYnNlcnZlciA9IGNvbm5lY3Rpb25EYXRhT2JqZWN0OwogICAgICAgICAgcmVzb2x2ZShfdGhpcy5jb25uZWN0aW9uQ29udHJvbGxlcik7CgogICAgICAgICAgdmFyIHJlc291cmNlcyA9IGNvbm5lY3Rpb25EYXRhT2JqZWN0LmRhdGEucmVzb3VyY2VzOwogICAgICAgICAgcmV0dXJuIF90aGlzLmNvbm5lY3Rpb25Db250cm9sbGVyLmdldFVzZXJNZWRpYShyZXNvdXJjZXMpOwogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKGNvbW1SZXNvdXJjZXMpIHsKICAgICAgICAgIGNvbnNvbGUuaW5mbygnR2V0IHdlYlJUQyBjb21tb24gcmVzb3VyY2VzJywgY29tbVJlc291cmNlcyk7CiAgICAgICAgfSlbJ2NhdGNoJ10oZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgICAgY29uc29sZS5lcnJvcihyZWFzb24pOwogICAgICAgICAgcmVqZWN0KHJlYXNvbik7CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQoKICAgIC8qKgogICAgICogQ29ubmVjdGlvbiBpcyBjbG9zZWQgYnkgbG9jYWwgcGVlciBhbmQgZGlzY29ubmVjdGVkOwogICAgICogQG1ldGhvZCBkaXNjb25uZWN0CiAgICAgKiBAcmV0dXJuIHtQcm9taXNlfQogICAgICovCiAgfSwgewogICAga2V5OiAnZGlzY29ubmVjdCcsCiAgICB2YWx1ZTogZnVuY3Rpb24gZGlzY29ubmVjdCgpIHsKCiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewoKICAgICAgICBfdGhpcy5jb25uZWN0aW9uQ29udHJvbGxlci5kaXNjb25uZWN0KCkudGhlbihmdW5jdGlvbiAoZGlzY29ubmVjdGVkKSB7CgogICAgICAgICAgY29uc29sZS5pbmZvKCdkaXNjb25uZWN0ZWQ6ICcsIGRpc2Nvbm5lY3RlZCk7CgogICAgICAgICAgcmVzb2x2ZShkaXNjb25uZWN0ZWQpOwogICAgICAgIH0pWydjYXRjaCddKGZ1bmN0aW9uIChyZWFzb24pIHsKICAgICAgICAgIHJlamVjdChyZWFzb24pOwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICdfYXV0b0Nvbm5lY3QnLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9hdXRvQ29ubmVjdChoeXBlcnR5VVJMKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICBfdGhpcy5fc3luY2hlci5jcmVhdGUoe30sIFtoeXBlcnR5VVJMXSwge30pLnRoZW4oZnVuY3Rpb24gKGNvbm5lY3Rpb25EYXRhT2JqZWN0KSB7CiAgICAgICAgY29uc29sZS5pbmZvKCdSZXR1cm4gQ3JlYXRlIENvbm5lY3Rpb24gRGF0YSBPYmplY3QnLCBjb25uZWN0aW9uRGF0YU9iamVjdCk7CiAgICAgICAgX3RoaXMuY29ubmVjdGlvbkNvbnRyb2xsZXIuY29ubmVjdGlvbkRhdGFPYmplY3RSZXBvcnRlciA9IGNvbm5lY3Rpb25EYXRhT2JqZWN0OwogICAgICB9KVsnY2F0Y2gnXShmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgICAgY29uc29sZS5lcnJvcihyZWFzb24pOwogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICdfYXV0b1N1YnNjcmliZScsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2F1dG9TdWJzY3JpYmUoZXZlbnQpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgdmFyIHVybCA9IGV2ZW50LnVybDsKCiAgICAgIGV2ZW50LmFjaygpOwoKICAgICAgX3RoaXMuX3N5bmNoZXIuc3Vic2NyaWJlKHVybCkudGhlbihmdW5jdGlvbiAoY29ubmVjdGlvbkRhdGFPYmplY3QpIHsKICAgICAgICBjb25zb2xlLmluZm8oJ1JldHVybiBTdWJzY3JpYmUgQ29ubmVjdGlvbiBEYXRhIE9iamVjdCcsIGNvbm5lY3Rpb25EYXRhT2JqZWN0KTsKCiAgICAgICAgdmFyIGNvbm5lY3Rpb25Db250cm9sbGVyID0gbmV3IF9Db25uZWN0aW9uQ29udHJvbGxlcjJbJ2RlZmF1bHQnXSgpOwogICAgICAgIGNvbm5lY3Rpb25Db250cm9sbGVyLmNvbm5lY3Rpb25EYXRhT2JqZWN0T2JzZXJ2ZXIgPSBjb25uZWN0aW9uRGF0YU9iamVjdDsKICAgICAgICBfdGhpcy50cmlnZ2VyKCdvbjpzdWJzY3JpYmUnLCBjb25uZWN0aW9uQ29udHJvbGxlcik7CiAgICAgIH0pWydjYXRjaCddKGZ1bmN0aW9uICgpIHt9KTsKICAgIH0KICB9XSk7CgogIHJldHVybiBIeXBlcnR5Q29ubmVjdG9yOwp9KShfdXRpbHNFdmVudEVtaXR0ZXIyWydkZWZhdWx0J10pOwoKZXhwb3J0c1snZGVmYXVsdCddID0gSHlwZXJ0eUNvbm5lY3RvcjsKbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWydkZWZhdWx0J107Cgp9LHsiLi4vdXRpbHMvRXZlbnRFbWl0dGVyIjoyMywiLi9Db25uZWN0aW9uQ29udHJvbGxlciI6MTJ9XSwxNDpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Ci8qKgoqIENsYXNzIGltcGxlbWVudGF0aW9uIG9mIE1lc3NhZ2UgRGF0YSBNb2RlbAoqLwoKJ3VzZSBzdHJpY3QnOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgewogICAgdmFsdWU6IHRydWUKfSk7CgpmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoJ0Nhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbicpOyB9IH0KCnZhciBNZXNzYWdlID0gZnVuY3Rpb24gTWVzc2FnZShpZCwgZnJvbSwgdG9MaXN0LCB0eXBlLCBjb250ZXh0SWQsIGJvZHksIHNpZ25hdHVyZSkgewogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIE1lc3NhZ2UpOwoKICAgIHRoaXMuaWQgPSBpZDsKICAgIHRoaXMuZnJvbSA9IGZyb207CiAgICB0aGlzLnRvID0gdG9MaXN0OwogICAgdGhpcy50eXBlID0gdHlwZTsKICAgIHRoaXMuY29udGV4dElkID0gY29udGV4dElkOwogICAgdGhpcy5zaWduYXR1cmUgPSBzaWduYXR1cmU7CiAgICB0aGlzLmJvZHkgPSBib2R5Owp9CgovKgpnZXQgaWQoKXsgcmV0dXJuIHRoaXMuaWQ7IH0KIGdldCBmcm9tKCl7IHJldHVybiB0aGlzLmZyb207IH0KIGdldCB0eXBlKCkgeyByZXR1cm4gdGhpcy50eXBlOyB9CiBnZXQgY29udGV4dElkKCkgeyByZXR1cm4gdGhpcy5jb250ZXh0SWQ7IH0KIGdldCBib2R5KCl7IHJldHVybiB0aGlzLmJvZHk7IH0KIHNldCBpZChpZGVudGlmaWVyKXsKICAgIGlmKGlkZW50aWZpZXIpCiAgICAgICAgdGhpcy5pZCA9IGlkZW50aWZpZXI7Cn0KIHNldCBmcm9tKHNlbmRlcil7CiAgICBpZihzZW5kZXIpCiAgICAgICAgdGhpcy5mcm9tID0gc2VuZGVyOwp9CiBzZXQgdHlwZShtc2dUeXBlKXsKICAgIGlmKG1zZ1R5cGUpCiAgICAgICAgdGhpcy50eXBlID0gbXNnVHlwZTsKfQogc2V0IGNvbnRleHRJZChjSUQpewogICAgaWYoY0lEKQogICAgICAgIHRoaXMuY29udGV4dElkID0gY0lEOwp9CnNldCBib2R5KG1zZ0JvZHkpewogICAgaWYobXNnQm9keSkKICAgICAgICB0aGlzLmJvZHkgPSBtc2dCb2R5Owp9CnNldCB0byhyZWNpcGllbnRMaXN0KXsKICAgIGlmKHJlY2lwaWVudExpc3QpCiAgICAgICAgdGhpcy50byA9IHJlY2lwaWVudExpc3Q7Cn0KIHNldCBzaWduYXR1cmUoc2lnbmF0dXJlKSB7CiAgICBpZiAoc2lnbmF0dXJlKQogICAgICAgIHRoaXMuc2lnbmF0dXJlID0gc2lnbmF0dXJlOwp9Ki8KCjsKCmV4cG9ydHMuTWVzc2FnZSA9IE1lc3NhZ2U7CnZhciBNZXNzYWdlVHlwZSA9IHsgQ1JFQVRFOiAnY3JlYXRlJywgUkVBRDogJ3JlYWQnLCBVUERBVEU6ICd1cGRhdGUnLCBERUxFVEU6ICdkZWxldGUnLCBTVUJTQ1JJQkU6ICdzdWJzY3JpYmUnLAogICAgVU5TVUJTQ1JJQkU6ICd1bnN1YnNjcmliZScsIFJFU1BPTlNFOiAncmVzcG9uc2UnLCBGT1JXQVJEOiAnZm9yd2FyZCcgfTsKCmV4cG9ydHMuTWVzc2FnZVR5cGUgPSBNZXNzYWdlVHlwZTsKZXhwb3J0c1snZGVmYXVsdCddID0gTWVzc2FnZTsKCn0se31dLDE1OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKJ3VzZSBzdHJpY3QnOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgewogICAgdmFsdWU6IHRydWUKfSk7Cgp2YXIgX2dldCA9IGZ1bmN0aW9uIGdldChfeCwgX3gyLCBfeDMpIHsgdmFyIF9hZ2FpbiA9IHRydWU7IF9mdW5jdGlvbjogd2hpbGUgKF9hZ2FpbikgeyB2YXIgb2JqZWN0ID0gX3gsIHByb3BlcnR5ID0gX3gyLCByZWNlaXZlciA9IF94MzsgX2FnYWluID0gZmFsc2U7IGlmIChvYmplY3QgPT09IG51bGwpIG9iamVjdCA9IEZ1bmN0aW9uLnByb3RvdHlwZTsgdmFyIGRlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iamVjdCwgcHJvcGVydHkpOyBpZiAoZGVzYyA9PT0gdW5kZWZpbmVkKSB7IHZhciBwYXJlbnQgPSBPYmplY3QuZ2V0UHJvdG90eXBlT2Yob2JqZWN0KTsgaWYgKHBhcmVudCA9PT0gbnVsbCkgeyByZXR1cm4gdW5kZWZpbmVkOyB9IGVsc2UgeyBfeCA9IHBhcmVudDsgX3gyID0gcHJvcGVydHk7IF94MyA9IHJlY2VpdmVyOyBfYWdhaW4gPSB0cnVlOyBkZXNjID0gcGFyZW50ID0gdW5kZWZpbmVkOyBjb250aW51ZSBfZnVuY3Rpb247IH0gfSBlbHNlIGlmICgndmFsdWUnIGluIGRlc2MpIHsgcmV0dXJuIGRlc2MudmFsdWU7IH0gZWxzZSB7IHZhciBnZXR0ZXIgPSBkZXNjLmdldDsgaWYgKGdldHRlciA9PT0gdW5kZWZpbmVkKSB7IHJldHVybiB1bmRlZmluZWQ7IH0gcmV0dXJuIGdldHRlci5jYWxsKHJlY2VpdmVyKTsgfSB9IH07CgpmdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHsgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSAnZnVuY3Rpb24nICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcignU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24sIG5vdCAnICsgdHlwZW9mIHN1cGVyQ2xhc3MpOyB9IHN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgeyBjb25zdHJ1Y3RvcjogeyB2YWx1ZTogc3ViQ2xhc3MsIGVudW1lcmFibGU6IGZhbHNlLCB3cml0YWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0gfSk7IGlmIChzdXBlckNsYXNzKSBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3Quc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIDogc3ViQ2xhc3MuX19wcm90b19fID0gc3VwZXJDbGFzczsgfQoKZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCdDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24nKTsgfSB9Cgp2YXIgTWVzc2FnZUJvZHkgPQoKLyoqCiAqCiAqIEBwYXJhbSB7SWRlbnRpdHkuSldUfSBpZFRva2VuIC0gdG9rZW4gZm9yIElkZW50aXR5IGFzc2VydGlvbiBwdXJwb3NlCiAqIEBwYXJhbSB7SWRlbnRpdHkuSldUfSBhY2Nlc3NUb2tlbgogKiBAcGFyYW0ge1VSTC5VUkx9IHJlc291cmNlCiAqIEBwYXJhbSB7VVJMLkh5cGVydHlDYXRhbG9ndWVVUkx9IHNjaGVtYQogKiBAcGFyYW0ge0lkZW50aXR5LkpXVH0gYXNzZXJ0ZWRJZGVudGl0eQogKgogKi8KZnVuY3Rpb24gTWVzc2FnZUJvZHkoaWRUb2tlbiwgYWNjZXNzVG9rZW4sIHJlc291cmNlLCBzY2hlbWEsIGFzc2VydGVkSWRlbnRpdHkpIHsKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBNZXNzYWdlQm9keSk7CgogICAgLy9sZXQgX3RoaXMgPSB0aGlzOwogICAgaWYgKHR5cGVvZiBpZG9rZW4gIT09ICd1bmRlZmluZWQnKSB0aGlzLmlkVG9rZW4gPSBpZFRva2VuOwogICAgaWYgKHR5cGVvZiBhY2Nlc3NUb2tlbiAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuYWNjZXNzVG9rZW4gPSBhY2Nlc3NUb2tlbjsKICAgIGlmICh0eXBlb2YgcmVzb3VyY2UgIT09ICd1bmRlZmluZWQnKSB0aGlzLnJlc291cmNlID0gcmVzb3VyY2U7CiAgICBpZiAodHlwZW9mIHNjaGVtYSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuc2NoZW1hID0gc2NoZW1hOwogICAgaWYgKHR5cGVvZiBhc3NlcnRlZElkZW50aXR5ICE9PSAndW5kZWZpbmVkJykgdGhpcy5hc3NlcnRlZElkZW50aXR5ID0gYXNzZXJ0ZWRJZGVudGl0eTsKfTsKCnZhciBDcmVhdGVNZXNzYWdlQm9keSA9IChmdW5jdGlvbiAoX01lc3NhZ2VCb2R5KSB7CiAgICBfaW5oZXJpdHMoQ3JlYXRlTWVzc2FnZUJvZHksIF9NZXNzYWdlQm9keSk7CgogICAgZnVuY3Rpb24gQ3JlYXRlTWVzc2FnZUJvZHkodmFsdWUsIHBvbGljeSwgaWRUb2tlbiwgYWNjZXNzVG9rZW4sIHJlc291cmNlLCBzY2hlbWEsIGFzc2VydGVkSWRlbnRpdHkpIHsKICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgQ3JlYXRlTWVzc2FnZUJvZHkpOwoKICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAndW5kZWZpbmVkJykgdGhyb3cgbmV3IEVycm9yKCJUaGUgdmFsdWUgcGFyYW1ldGVyIGlzIG51bGwiKTsKICAgICAgICBfZ2V0KE9iamVjdC5nZXRQcm90b3R5cGVPZihDcmVhdGVNZXNzYWdlQm9keS5wcm90b3R5cGUpLCAnY29uc3RydWN0b3InLCB0aGlzKS5jYWxsKHRoaXMsIGlkVG9rZW4sIGFjY2Vzc1Rva2VuLCByZXNvdXJjZSwgc2NoZW1hLCBhc3NlcnRlZElkZW50aXR5LCBzY2hlbWEsIGFzc2VydGVkSWRlbnRpdHkpOwoKICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7CiAgICAgICAgaWYgKHBvbGljeSkgdGhpcy5wb2xpY3kgPSBwb2xpY3k7CiAgICB9CgogICAgcmV0dXJuIENyZWF0ZU1lc3NhZ2VCb2R5Owp9KShNZXNzYWdlQm9keSk7CgpleHBvcnRzLkNyZWF0ZU1lc3NhZ2VCb2R5ID0gQ3JlYXRlTWVzc2FnZUJvZHk7Cgp2YXIgUmVhZE1lc3NhZ2VCb2R5ID0gKGZ1bmN0aW9uIChfTWVzc2FnZUJvZHkyKSB7CiAgICBfaW5oZXJpdHMoUmVhZE1lc3NhZ2VCb2R5LCBfTWVzc2FnZUJvZHkyKTsKCiAgICBmdW5jdGlvbiBSZWFkTWVzc2FnZUJvZHkoaWRUb2tlbiwgYWNjZXNzVG9rZW4sIHJlc291cmNlLCBzY2hlbWEsIGFzc2VydGVkSWRlbnRpdHksIGF0dHJpYnV0ZSwgY3JpdGVyaWFTeW50YXgsIGNyaXRlcmlhKSB7CiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFJlYWRNZXNzYWdlQm9keSk7CgogICAgICAgIF9nZXQoT2JqZWN0LmdldFByb3RvdHlwZU9mKFJlYWRNZXNzYWdlQm9keS5wcm90b3R5cGUpLCAnY29uc3RydWN0b3InLCB0aGlzKS5jYWxsKHRoaXMsIGlkVG9rZW4sIGFjY2Vzc1Rva2VuLCByZXNvdXJjZSwgc2NoZW1hLCBhc3NlcnRlZElkZW50aXR5KTsKCiAgICAgICAgaWYgKGF0dHJpYnV0ZSkgdGhpcy5hdHRyaWJ1dGUgPSBhdHRyaWJ1dGU7CgogICAgICAgIGlmIChjcml0ZXJpYVN5bnRheCkgdGhpcy5jcml0ZXJpYVN5bnRheCA9IGNyaXRlcmlhU3ludGF4OwoKICAgICAgICBpZiAoY3JpdGVyaWEpIHRoaXMuY3JpdGVyaWEgPSBjcml0ZXJpYTsKICAgIH0KCiAgICByZXR1cm4gUmVhZE1lc3NhZ2VCb2R5Owp9KShNZXNzYWdlQm9keSk7CgpleHBvcnRzLlJlYWRNZXNzYWdlQm9keSA9IFJlYWRNZXNzYWdlQm9keTsKCnZhciBEZWxldGVNZXNzYWdlQm9keSA9IChmdW5jdGlvbiAoX01lc3NhZ2VCb2R5MykgewogICAgX2luaGVyaXRzKERlbGV0ZU1lc3NhZ2VCb2R5LCBfTWVzc2FnZUJvZHkzKTsKCiAgICBmdW5jdGlvbiBEZWxldGVNZXNzYWdlQm9keShpZFRva2VuLCBhY2Nlc3NUb2tlbiwgcmVzb3VyY2UsIHNjaGVtYSwgYXNzZXJ0ZWRJZGVudGl0eSwgYXR0cmlidXRlKSB7CiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIERlbGV0ZU1lc3NhZ2VCb2R5KTsKCiAgICAgICAgX2dldChPYmplY3QuZ2V0UHJvdG90eXBlT2YoRGVsZXRlTWVzc2FnZUJvZHkucHJvdG90eXBlKSwgJ2NvbnN0cnVjdG9yJywgdGhpcykuY2FsbCh0aGlzLCBpZFRva2VuLCBhY2Nlc3NUb2tlbiwgcmVzb3VyY2UsIHNjaGVtYSwgYXNzZXJ0ZWRJZGVudGl0eSk7CgogICAgICAgIGlmIChhdHRyaWJ1dGUpIHsKICAgICAgICAgICAgdGhpcy5hdHRyaWJ1dGUgPSBhdHRyaWJ1dGU7CiAgICAgICAgfQogICAgfQoKICAgIHJldHVybiBEZWxldGVNZXNzYWdlQm9keTsKfSkoTWVzc2FnZUJvZHkpOwoKZXhwb3J0cy5EZWxldGVNZXNzYWdlQm9keSA9IERlbGV0ZU1lc3NhZ2VCb2R5OwoKdmFyIFVwZGF0ZU1lc3NhZ2VCb2R5ID0gKGZ1bmN0aW9uIChfTWVzc2FnZUJvZHk0KSB7CiAgICBfaW5oZXJpdHMoVXBkYXRlTWVzc2FnZUJvZHksIF9NZXNzYWdlQm9keTQpOwoKICAgIGZ1bmN0aW9uIFVwZGF0ZU1lc3NhZ2VCb2R5KGlkVG9rZW4sIGFjY2Vzc1Rva2VuLCByZXNvdXJjZSwgc2NoZW1hLCBhc3NlcnRlZElkZW50aXR5LCBhdHRyaWJ1dGUsIHZhbHVlKSB7CiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFVwZGF0ZU1lc3NhZ2VCb2R5KTsKCiAgICAgICAgX2dldChPYmplY3QuZ2V0UHJvdG90eXBlT2YoVXBkYXRlTWVzc2FnZUJvZHkucHJvdG90eXBlKSwgJ2NvbnN0cnVjdG9yJywgdGhpcykuY2FsbCh0aGlzLCBpZFRva2VuLCBhY2Nlc3NUb2tlbiwgcmVzb3VyY2UsIHNjaGVtYSwgYXNzZXJ0ZWRJZGVudGl0eSk7CgogICAgICAgIHRoaXMuYXR0cmlidXRlID0gYXR0cmlidXRlOwogICAgICAgIHRoaXMudmFsdWUgPSB2YWx1ZTsKICAgIH0KCiAgICByZXR1cm4gVXBkYXRlTWVzc2FnZUJvZHk7Cn0pKE1lc3NhZ2VCb2R5KTsKCmV4cG9ydHMuVXBkYXRlTWVzc2FnZUJvZHkgPSBVcGRhdGVNZXNzYWdlQm9keTsKCnZhciBGb3J3YXJkTWVzc2FnZUJvZHkgPSAoZnVuY3Rpb24gKF9NZXNzYWdlQm9keTUpIHsKICAgIF9pbmhlcml0cyhGb3J3YXJkTWVzc2FnZUJvZHksIF9NZXNzYWdlQm9keTUpOwoKICAgIGZ1bmN0aW9uIEZvcndhcmRNZXNzYWdlQm9keShpZFRva2VuLCBhY2Nlc3NUb2tlbiwgcmVzb3VyY2UsIHNjaGVtYSwgYXNzZXJ0ZWRJZGVudGl0eSwgbWVzc2FnZSkgewogICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBGb3J3YXJkTWVzc2FnZUJvZHkpOwoKICAgICAgICBfZ2V0KE9iamVjdC5nZXRQcm90b3R5cGVPZihGb3J3YXJkTWVzc2FnZUJvZHkucHJvdG90eXBlKSwgJ2NvbnN0cnVjdG9yJywgdGhpcykuY2FsbCh0aGlzLCBpZFRva2VuLCBhY2Nlc3NUb2tlbiwgcmVzb3VyY2UsIHNjaGVtYSwgYXNzZXJ0ZWRJZGVudGl0eSk7CgogICAgICAgIHRoaXMubWVzc2FnZSA9IG1lc3NhZ2U7CiAgICB9CgogICAgcmV0dXJuIEZvcndhcmRNZXNzYWdlQm9keTsKfSkoTWVzc2FnZUJvZHkpOwoKZXhwb3J0cy5Gb3J3YXJkTWVzc2FnZUJvZHkgPSBGb3J3YXJkTWVzc2FnZUJvZHk7Cgp2YXIgUmVzcG9uc2VNZXNzYWdlQm9keSA9IChmdW5jdGlvbiAoX01lc3NhZ2VCb2R5NikgewogICAgX2luaGVyaXRzKFJlc3BvbnNlTWVzc2FnZUJvZHksIF9NZXNzYWdlQm9keTYpOwoKICAgIGZ1bmN0aW9uIFJlc3BvbnNlTWVzc2FnZUJvZHkoaWRUb2tlbiwgYWNjZXNzVG9rZW4sIHJlc291cmNlLCBjb2RlLCB2YWx1ZSkgewogICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBSZXNwb25zZU1lc3NhZ2VCb2R5KTsKCiAgICAgICAgX2dldChPYmplY3QuZ2V0UHJvdG90eXBlT2YoUmVzcG9uc2VNZXNzYWdlQm9keS5wcm90b3R5cGUpLCAnY29uc3RydWN0b3InLCB0aGlzKS5jYWxsKHRoaXMsIGlkVG9rZW4sIGFjY2Vzc1Rva2VuLCByZXNvdXJjZSk7CgogICAgICAgIGlmIChjb2RlKSB7CiAgICAgICAgICAgIHRoaXMuY29kZSA9IGNvZGU7CiAgICAgICAgICAgIHRoaXMuZGVzY3JpcHRpb24gPSBSRUFTT05fUEhSQVNFW2NvZGVdOwogICAgICAgIH0KCiAgICAgICAgaWYgKHZhbHVlKSB0aGlzLnZhbHVlID0gdmFsdWU7CiAgICB9CgogICAgcmV0dXJuIFJlc3BvbnNlTWVzc2FnZUJvZHk7Cn0pKE1lc3NhZ2VCb2R5KTsKCmV4cG9ydHMuUmVzcG9uc2VNZXNzYWdlQm9keSA9IFJlc3BvbnNlTWVzc2FnZUJvZHk7CnZhciBSRVNQT05TX0NPREUgPSB7CiAgICAxMDA6ICcxMDAnLAogICAgMTAxOiAnMTAxJywKICAgIDIwMDogJzIwMCcsCiAgICAyMDE6ICcyMDEnLAogICAgMjAyOiAnMjAyJywKICAgIDIwMzogJzIwMycsCiAgICAyMDQ6ICcyMDQnLAogICAgMjA1OiAnMjA1JywKICAgIDIwNjogJzIwNicsCiAgICAzMDA6ICczMDAnLAogICAgMzAxOiAnMzAxJywKICAgIDMwMjogJzMwMicsCiAgICAzMDM6ICczMDMnLAogICAgMzA0OiAnMzA0JywKICAgIDMwNTogJzMwNScsCiAgICAzMDc6ICczMDcnLAogICAgNDAwOiAnNDAwJywKICAgIDQwMTogJzQwMScsCiAgICA0MDI6ICc0MDInLAogICAgNDAzOiAnNDAzJywKICAgIDQwNDogJzQwNCcsCiAgICA0MDU6ICc0MDUnLAogICAgNDA2OiAnNDA2JywKICAgIDQwNzogJzQwNycsCiAgICA0MDg6ICc0MDgnLAogICAgNDA5OiAnNDA5JywKICAgIDQxMDogJzQxMCcsCiAgICA0MTE6ICc0MTEnLAogICAgNDEyOiAnNDEyJywKICAgIDQxMzogJzQxMycsCiAgICA0MTQ6ICc0MTQnLAogICAgNDE1OiAnNDE1JywKICAgIDQxNjogJzQxNicsCiAgICA0MTc6ICc0MTcnLAogICAgNDI2OiAnNDI2JywKICAgIDUwMDogJzUwMCcsCiAgICA1MDE6ICc1MDEnLAogICAgNTAyOiAnNTAyJywKICAgIDUwMzogJzUwMycsCiAgICA1MDQ6ICc1MDQnLAogICAgNTA1OiAnNTA1Jwp9OwpleHBvcnRzLlJFU1BPTlNfQ09ERSA9IFJFU1BPTlNfQ09ERTsKdmFyIFJFQVNPTl9QSFJBU0UgPSB7CiAgICAxMDA6ICdDb250aW51ZScsCiAgICAxMDE6ICdTd2l0Y2hpbmcgUHJvdG9jb2xzJywKICAgIDIwMDogJ09LJywKICAgIDIwMTogJ0NyZWF0ZWQnLAogICAgMjAyOiAnQWNjZXB0ZWQnLAogICAgMjAzOiAnTm9uLUF1dGhvcml0YXRpdmUgSW5mb3JtYXRpb24nLAogICAgMjA0OiAnTm8gQ29udGVudCcsCiAgICAyMDU6ICdSZXNldCBDb250ZW50JywKICAgIDIwNjogJ1BhcnRpYWwgQ29udGVudCcsCiAgICAzMDA6ICdNdWx0aXBsZSBDaG9pY2VzJywKICAgIDMwMTogJ01vdmVkIFBlcm1hbmVudGx5JywKICAgIDMwMjogJ0ZvdW5kJywKICAgIDMwMzogJ1NlZSBPdGhlcicsCiAgICAzMDQ6ICdOb3QgTW9kaWZpZWQnLAogICAgMzA1OiAnVXNlIFByb3h5JywKICAgIDMwNzogJ1RlbXBvcmFyeSBSZWRpcmVjdCcsCiAgICA0MDA6ICdCYWQgUmVxdWVzdCcsCiAgICA0MDE6ICdVbmF1dGhvcml6ZWQnLAogICAgNDAyOiAnUGF5bWVudCBSZXF1aXJlZCcsCiAgICA0MDM6ICdGb3JiaWRkZW4nLAogICAgNDA0OiAnTm90IEZvdW5kJywKICAgIDQwNTogJ01ldGhvZCBOb3QgQWxsb3dlZCcsCiAgICA0MDY6ICdOb3QgQWNjZXB0YWJsZScsCiAgICA0MDc6ICdQcm94eSBBdXRoZW50aWNhdGlvbiBSZXF1aXJlZCcsCiAgICA0MDg6ICdSZXF1ZXN0IFRpbWVvdXQnLAogICAgNDA5OiAnQ29uZmxpY3QnLAogICAgNDEwOiAnR29uZScsCiAgICA0MTE6ICdMZW5ndGggUmVxdWlyZWQnLAogICAgNDEyOiAnUHJlY29uZGl0aW9uIEZhaWxlZCcsCiAgICA0MTM6ICdQYXlsb2FkIFRvbyBMYXJnZScsCiAgICA0MTQ6ICdSZXF1ZXN0LVVSSSBUb28gTG9uZycsCiAgICA0MTU6ICdVbnN1cHBvcnRlZCBNZWRpYSBUeXBlJywKICAgIDQxNjogJ1JhbmdlIE5vdCBTYXRpc2ZpYWJsZScsCiAgICA0MTc6ICdFeHBlY3RhdGlvbiBGYWlsZWQnLAogICAgNDI2OiAnVXBncmFkZSBSZXF1aXJlZCcsCiAgICA1MDA6ICdJbnRlcm5hbCBTZXJ2ZXIgRXJyb3InLAogICAgNTAxOiAnTm90IEltcGxlbWVudGVkJywKICAgIDUwMjogJ0JhZCBHYXRld2F5JywKICAgIDUwMzogJ1NlcnZpY2UgVW5hdmFpbGFibGUnLAogICAgNTA0OiAnR2F0ZXdheSBUaW1lLW91dCcsCiAgICA1MDU6ICdIVFRQIFZlcnNpb24gTm90IFN1cHBvcnRlZCcKfTsKCmV4cG9ydHMuUkVBU09OX1BIUkFTRSA9IFJFQVNPTl9QSFJBU0U7CmV4cG9ydHNbJ2RlZmF1bHQnXSA9IE1lc3NhZ2VCb2R5OwoKfSx7fV0sMTY6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewovKioKKiBNZXNzYWdlIEZhY3RvcnkKKiAKKi8KCid1c2Ugc3RyaWN0JzsKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsKICAgIHZhbHVlOiB0cnVlCn0pOwoKdmFyIF9jcmVhdGVDbGFzcyA9IChmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoJ3ZhbHVlJyBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0gcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfTsgfSkoKTsKCnZhciBfZ2V0ID0gZnVuY3Rpb24gZ2V0KF94LCBfeDIsIF94MykgeyB2YXIgX2FnYWluID0gdHJ1ZTsgX2Z1bmN0aW9uOiB3aGlsZSAoX2FnYWluKSB7IHZhciBvYmplY3QgPSBfeCwgcHJvcGVydHkgPSBfeDIsIHJlY2VpdmVyID0gX3gzOyBfYWdhaW4gPSBmYWxzZTsgaWYgKG9iamVjdCA9PT0gbnVsbCkgb2JqZWN0ID0gRnVuY3Rpb24ucHJvdG90eXBlOyB2YXIgZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBwcm9wZXJ0eSk7IGlmIChkZXNjID09PSB1bmRlZmluZWQpIHsgdmFyIHBhcmVudCA9IE9iamVjdC5nZXRQcm90b3R5cGVPZihvYmplY3QpOyBpZiAocGFyZW50ID09PSBudWxsKSB7IHJldHVybiB1bmRlZmluZWQ7IH0gZWxzZSB7IF94ID0gcGFyZW50OyBfeDIgPSBwcm9wZXJ0eTsgX3gzID0gcmVjZWl2ZXI7IF9hZ2FpbiA9IHRydWU7IGRlc2MgPSBwYXJlbnQgPSB1bmRlZmluZWQ7IGNvbnRpbnVlIF9mdW5jdGlvbjsgfSB9IGVsc2UgaWYgKCd2YWx1ZScgaW4gZGVzYykgeyByZXR1cm4gZGVzYy52YWx1ZTsgfSBlbHNlIHsgdmFyIGdldHRlciA9IGRlc2MuZ2V0OyBpZiAoZ2V0dGVyID09PSB1bmRlZmluZWQpIHsgcmV0dXJuIHVuZGVmaW5lZDsgfSByZXR1cm4gZ2V0dGVyLmNhbGwocmVjZWl2ZXIpOyB9IH0gfTsKCmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7ICdkZWZhdWx0Jzogb2JqIH07IH0KCmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcignQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uJyk7IH0gfQoKZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7IGlmICh0eXBlb2Ygc3VwZXJDbGFzcyAhPT0gJ2Z1bmN0aW9uJyAmJiBzdXBlckNsYXNzICE9PSBudWxsKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoJ1N1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uLCBub3QgJyArIHR5cGVvZiBzdXBlckNsYXNzKTsgfSBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IHN1YkNsYXNzLCBlbnVtZXJhYmxlOiBmYWxzZSwgd3JpdGFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9IH0pOyBpZiAoc3VwZXJDbGFzcykgT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LnNldFByb3RvdHlwZU9mKHN1YkNsYXNzLCBzdXBlckNsYXNzKSA6IHN1YkNsYXNzLl9fcHJvdG9fXyA9IHN1cGVyQ2xhc3M7IH0KCnZhciBfcmVUSElOS09iamVjdFJldGhpbmtPYmplY3RKcyA9IHJlcXVpcmUoJy4uL3JlVEhJTktPYmplY3QvUmV0aGlua09iamVjdC5qcycpOwoKdmFyIF9yZVRISU5LT2JqZWN0UmV0aGlua09iamVjdEpzMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3JlVEhJTktPYmplY3RSZXRoaW5rT2JqZWN0SnMpOwoKdmFyIF9NZXNzYWdlSnMgPSByZXF1aXJlKCcuL01lc3NhZ2UuanMnKTsKCnZhciBfTWVzc2FnZUpzMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX01lc3NhZ2VKcyk7Cgp2YXIgX01lc3NhZ2VCb2R5SnMgPSByZXF1aXJlKCcuL01lc3NhZ2VCb2R5LmpzJyk7Cgp2YXIgTWVzc2FnZUZhY3RvcnkgPSAoZnVuY3Rpb24gKF9SZXRoaW5rT2JqZWN0KSB7CiAgICBfaW5oZXJpdHMoTWVzc2FnZUZhY3RvcnksIF9SZXRoaW5rT2JqZWN0KTsKCiAgICAvKioKICAgICAqIENvbnN0cnVjdG9yCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IHZhbGlkYXRpb24KICAgICAqIEBwYXJhbSB7VVJMLlVSTCB9IHNjaGVtYSAtIGxpbmsgdG8gdGhlIHNjaGVtYQogICAgICovCgogICAgZnVuY3Rpb24gTWVzc2FnZUZhY3RvcnkodmFsaWRhdGlvbiwgc2NoZW1hKSB7CiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIE1lc3NhZ2VGYWN0b3J5KTsKCiAgICAgICAgX2dldChPYmplY3QuZ2V0UHJvdG90eXBlT2YoTWVzc2FnZUZhY3RvcnkucHJvdG90eXBlKSwgJ2NvbnN0cnVjdG9yJywgdGhpcykuY2FsbCh0aGlzLCB2YWxpZGF0aW9uLCBzY2hlbWEpOwoKICAgICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgfQoKICAgIF9jcmVhdGVDbGFzcyhNZXNzYWdlRmFjdG9yeSwgW3sKICAgICAgICBrZXk6ICd2YWxpZGF0ZScsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHZhbGlkYXRlKGRhdGEpIHsKICAgICAgICAgICAgcmV0dXJuIF9nZXQoT2JqZWN0LmdldFByb3RvdHlwZU9mKE1lc3NhZ2VGYWN0b3J5LnByb3RvdHlwZSksICd2YWxpZGF0ZScsIHRoaXMpLmNhbGwodGhpcywgZGF0YSk7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBDcmVhdGUgYSBNZXNzYWdlIHdpdGggQ1JFQVRFIE1lc3NhZ2VUeXBlIGFuZCBDcmVhdGUgTWVzc2FnZSBCb2R5CiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0ge1VSTC5VUkx9IGZyb20gLSB0aGUgc2VuZGVyIG9mIHRoaXMgbWVzc2FnZQogICAgICAgICAqIEBwYXJhbSB7VVJMLlVSTExpc3R9IE9uZSBvciBtb3JlIFVSTHMgb2YgTWVzc2FnZSByZWNpcGllbnRzLiBBY2NvcmRpbmcgdG8gdGhlIFVSTCBzY2hlbWUgaXQgbWF5IGJlIGhhbmRsZWQgaW4KICAgICAgICAgKiBkaWZmZXJlbnQgd2F5cwogICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBjb250ZXh0SWQgLSB0aGUgR1VJRCB1c2VkIHRvIGlkZW50aXR5IGVnIGEgY29tbXVuaWNhdGlvbiBzZXNzaW9uIGxpa2UgYSB0ZWxlcGhvbnkgY2FsbAogICAgICAgICAqIEBwYXJhbSB7SWRlbnRpdHkuSldUfSBpZFRva2VuIC0gdG9rZW4gZm9yIElkZW50aXR5IGFzc2VydGlvbiBwdXJwb3NlCiAgICAgICAgICogQHBhcmFtIHtJZGVudGl0eS5KV1R9IGFjY2Vzc1Rva2VuIC0gYWNjZXNzIHRva2VuIGZvciBhY2Nlc3MgY29udHJvbCBwdXJwb3NlcwogICAgICAgICAqIEBwYXJhbSB7VVJMLlVSbH0gcmVzb3VyY2UgLSBVUkwgb2YgRGF0YSBPYmplY3QgUmVzb3VyY2UgYXNzb2NpYXRlZCB3aXRoIHRoZSBtZXNzYWdlCiAgICAgICAgICogQHBhcmFtIHtzdHJpbmd9IHNpZ25hdHVyZSAtCiAgICAgICAgICogQHBhcmFtIHtzdHJpbmd9IHZhbHVlIC0gdGhlIGNyZWF0ZWQgb2JqZWN0IGluIEpTT04gZm9ybWF0CiAgICAgICAgICogQHBhcmFtIHtVUkwuVVJMfSBwb2xpY3kgLSBVUkwgZnJvbSB3aGVyZSBhY2Nlc3MgcG9saWN5IGNvbnRyb2wgY2FuIGJlIGRvd25sb2FkZWQKICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm4ge01lc3NhZ2V9IENyZWF0ZSBNZXNzYWdlCiAgICAgICAgICovCiAgICB9LCB7CiAgICAgICAga2V5OiAnY3JlYXRlTWVzc2FnZVJlcXVlc3QnLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBjcmVhdGVNZXNzYWdlUmVxdWVzdChmcm9tLCB0bywgY29udGV4dElkLCBpZFRva2VuLCBhY2Nlc3NUb2tlbiwgcmVzb3VyY2UsIHNpZ25hdHVyZSwgc2NoZW1hLCBhc3NlcnRlZElkZW50aXR5LCB2YWx1ZSwgcG9saWN5KSB7CiAgICAgICAgICAgIGlmICh0eXBlb2YgZnJvbSA9PT0gJ3VuZGVmaW5lZCcgfHwgdHlwZW9mIGNvbnRleHRJZCA9PT0gJ3VuZGVmaW5lZCcgfHwgdHlwZW9mIHZhbHVlID09PSAndW5kZWZpbmVkJykgdGhyb3cgbmV3IEVycm9yKCJmcm9tLCBjb250ZXh0SWQsIGFuZCB2YWx1ZSBvZiBvYmplY3QgdG8gYmUgY3JlYXRlZCBNVVNUIGJlIHNwZWNpZmllZCIpOwoKICAgICAgICAgICAgdmFyIG1lc3NhZ2VCb2R5ID0gbmV3IF9NZXNzYWdlQm9keUpzLkNyZWF0ZU1lc3NhZ2VCb2R5KHZhbHVlLCBwb2xpY3ksIGlkVG9rZW4sIGFjY2Vzc1Rva2VuLCByZXNvdXJjZSwgc2NoZW1hLCBhc3NlcnRlZElkZW50aXR5KTsKICAgICAgICAgICAgdmFyIG1lc3NhZ2UgPSBuZXcgX01lc3NhZ2VKczJbJ2RlZmF1bHQnXShNZXNzYWdlRmFjdG9yeS5fZ2VuZXJhdGVNZXNzYWdlSWQoKSwgZnJvbSwgdG8sIF9NZXNzYWdlSnMuTWVzc2FnZVR5cGUuQ1JFQVRFLCBjb250ZXh0SWQsIG1lc3NhZ2VCb2R5LCBzaWduYXR1cmUpOwogICAgICAgICAgICByZXR1cm4gbWVzc2FnZTsKICAgICAgICB9CiAgICB9LCB7CiAgICAgICAga2V5OiAnY3JlYXRlRm9yd2FyZE1lc3NhZ2VSZXF1ZXN0JywKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gY3JlYXRlRm9yd2FyZE1lc3NhZ2VSZXF1ZXN0KGRhdGEsIGZyb20sIHRvLCBjb250ZXh0SWQsIGlkVG9rZW4sIGFjY2Vzc1Rva2VuLCByZXNvdXJjZSwgc2lnbmF0dXJlLCBzY2hlbWEsIGFzc2VydGVkSWRlbnRpdHkpIHsKICAgICAgICAgICAgaWYgKHR5cGVvZiBmcm9tID09PSAndW5kZWZpbmVkJyB8fCB0eXBlb2YgY29udGV4dElkID09PSAndW5kZWZpbmVkJyB8fCB0eXBlb2YgZGF0YSA9PT0gJ3VuZGVmaW5lZCcpIHRocm93IG5ldyBFcnJvcigiZnJvbSwgY29udGV4dElkLCBhbmQgbWVzc2FnZSB0byBmb3J3YXJkIE1VU1QgYmUgc3BlY2lmaWVkIik7CgogICAgICAgICAgICB2YXIgbWVzc2FnZUJvZHkgPSBuZXcgX01lc3NhZ2VCb2R5SnMuRm9yd2FyZE1lc3NhZ2VCb2R5KGlkVG9rZW4sIGFjY2Vzc1Rva2VuLCByZXNvdXJjZSwgc2NoZW1hLCBhc3NlcnRlZElkZW50aXR5LCBkYXRhKTsKICAgICAgICAgICAgdmFyIG1lc3NhZ2UgPSBuZXcgX01lc3NhZ2VKczJbJ2RlZmF1bHQnXShNZXNzYWdlRmFjdG9yeS5fZ2VuZXJhdGVNZXNzYWdlSWQoKSwgZnJvbSwgdG8sIF9NZXNzYWdlSnMuTWVzc2FnZVR5cGUuRk9SV0FSRCwgY29udGV4dElkLCBtZXNzYWdlQm9keSwgc2lnbmF0dXJlKTsKICAgICAgICAgICAgcmV0dXJuIG1lc3NhZ2U7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiAgQ3JlYXRlIERlbGV0ZSBNZXNzYWdlCiAgICAgICAgICogQHBhcmFtIHtVUkwuVVJMfSBmcm9tIC0gdGhlIHNlbmRlciBvZiB0aGlzIG1lc3NhZ2UKICAgICAgICAgKiBAcGFyYW0ge1VSTC5VUkxMaXN0fSB0byAtIE9uZSBvciBtb3JlIFVSTHMgb2YgTWVzc2FnZSByZWNpcGllbnRzLiBBY2NvcmRpbmcgdG8gdGhlIFVSTCBzY2hlbWUgaXQgbWF5IGJlIGhhbmRsZWQgaW4KICAgICAgICAgKiBkaWZmZXJlbnQgd2F5cwogICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBjb250ZXh0SWQgLSB0aGUgR1VJRCB1c2VkIHRvIGlkZW50aXR5IGVnIGEgY29tbXVuaWNhdGlvbiBzZXNzaW9uIGxpa2UgYSB0ZWxlcGhvbnkgY2FsbAogICAgICAgICAqIEBwYXJhbSB7SWRlbnRpdHkuSldUfSBpZFRva2VuIC0gdG9rZW4gZm9yIElkZW50aXR5IGFzc2VydGlvbiBwdXJwb3NlCiAgICAgICAgICogQHBhcmFtIHtJZGVudGl0eS5KV1R9IGFjY2Vzc1Rva2VuIC0gYWNjZXNzIHRva2VuIGZvciBhY2Nlc3MgY29udHJvbCBwdXJwb3NlcwogICAgICAgICAqIEBwYXJhbSB7VVJMLlVSbH0gcmVzb3VyY2UgLSBVUkwgb2YgRGF0YSBPYmplY3QgUmVzb3VyY2UgYXNzb2NpYXRlZCB3aXRoIHRoZSBtZXNzYWdlCiAgICAgICAgICogQHBhcmFtIHtzdHJpbmd9IHNpZ25hdHVyZSAtCiAgICAgICAgICogQHBhcmFtIGF0dHJpYnV0ZSAtIElkZW50aWZpZXMgdGhlIGF0dHJpYnV0ZSBpbiB0aGUgT2JqZWN0IHRvIGJlIGRlbGV0ZWQKICAgICAgICAgKiBAcGFyYW0gc2NoZW1hCiAgICAgICAgICogQHBhcmFtIGFzc2VydGVkSWRlbnRpdHkgLSB1c2VyIGlkZW50aXR5CiAgICAgICAgICogQHJldHVybiBEZWxldGUgTWVzc2FnZQogICAgICAgICAqLwogICAgfSwgewogICAgICAgIGtleTogJ2NyZWF0ZURlbGV0ZU1lc3NhZ2VSZXF1ZXN0JywKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gY3JlYXRlRGVsZXRlTWVzc2FnZVJlcXVlc3QoZnJvbSwgdG8sIGNvbnRleHRJZCwgaWRUb2tlbiwgYWNjZXNzVG9rZW4sIHJlc291cmNlLCBzaWduYXR1cmUsIGF0dHJpYnV0ZSwgc2NoZW1hLCBhc3NlcnRlZElkZW50aXR5KSB7CiAgICAgICAgICAgIGlmICh0eXBlb2YgZnJvbSA9PT0gJ3VuZGVmaW5lZCcgfHwgdHlwZW9mIGNvbnRleHRJZCA9PT0gJ3VuZGVmaW5lZCcpIHRocm93IG5ldyBFcnJvcigiZnJvbSwgY29udGV4dElkLCBhbmQgdmFsdWUgb2Ygb2JqZWN0IHRvIGJlIGNyZWF0ZWQgTVVTVCBiZSBzcGVjaWZpZWQiKTsKICAgICAgICAgICAgdmFyIG1lc3NhZ2VCb2R5ID0gbmV3IF9NZXNzYWdlQm9keUpzLkRlbGV0ZU1lc3NhZ2VCb2R5KGlkVG9rZW4sIGFjY2Vzc1Rva2VuLCByZXNvdXJjZSwgYXR0cmlidXRlLCBzY2hlbWEsIGFzc2VydGVkSWRlbnRpdHkpOwogICAgICAgICAgICB2YXIgbWVzc2FnZSA9IG5ldyBfTWVzc2FnZUpzMlsnZGVmYXVsdCddKE1lc3NhZ2VGYWN0b3J5Ll9nZW5lcmF0ZU1lc3NhZ2VJZCgpLCBmcm9tLCB0bywgX01lc3NhZ2VKcy5NZXNzYWdlVHlwZS5ERUxFVEUsIGNvbnRleHRJZCwgbWVzc2FnZUJvZHksIHNpZ25hdHVyZSk7CiAgICAgICAgICAgIHJldHVybiBtZXNzYWdlOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogQ3JlYXRlcyBhbiBVcGRhdGUgTWVzc2FnZSBSZXF1ZXN0CiAgICAgICAgICogQHBhcmFtIHtVUkwuVVJMfSBmcm9tIC0gdGhlIHNlbmRlciBvZiB0aGlzIG1lc3NhZ2UKICAgICAgICAgKiBAcGFyYW0ge1VSTC5VUkxMaXN0fSBPbmUgb3IgbW9yZSBVUkxzIG9mIE1lc3NhZ2UgcmVjaXBpZW50cy4gQWNjb3JkaW5nIHRvIHRoZSBVUkwgc2NoZW1lIGl0IG1heSBiZSBoYW5kbGVkIGluCiAgICAgICAgICogZGlmZmVyZW50IHdheXMKICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gY29udGV4dElkIC0gdGhlIEdVSUQgdXNlZCB0byBpZGVudGl0eSBlZyBhIGNvbW11bmljYXRpb24gc2Vzc2lvbiBsaWtlIGEgdGVsZXBob255IGNhbGwKICAgICAgICAgKiBAcGFyYW0ge0lkZW50aXR5LkpXVH0gaWRUb2tlbiAtIHRva2VuIGZvciBJZGVudGl0eSBhc3NlcnRpb24gcHVycG9zZQogICAgICAgICAqIEBwYXJhbSB7SWRlbnRpdHkuSldUfSBhY2Nlc3NUb2tlbiAtIGFjY2VzcyB0b2tlbiBmb3IgYWNjZXNzIGNvbnRyb2wgcHVycG9zZXMKICAgICAgICAgKiBAcGFyYW0ge1VSTC5VUmx9IHJlc291cmNlIC0gVVJMIG9mIERhdGEgT2JqZWN0IFJlc291cmNlIGFzc29jaWF0ZWQgd2l0aCB0aGUgbWVzc2FnZQogICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBzaWduYXR1cmUgLQogICAgICAgICAqIEBwYXJhbSBhdHRyaWJ1dGUgLSBJZGVudGlmaWVzIHRoZSBhdHRyaWJ1dGUgaW4gdGhlIE9iamVjdCB0byBiZSB1cGRhdGVkCiAgICAgICAgICogQHBhcmFtIHZhbHVlIC0gVGhlIG5ldyB2YWx1ZSBvZiB0aGUgYXR0cmlidXRlIHRvIGJlIHVwZGF0ZWQKICAgICAgICAgKi8KICAgIH0sIHsKICAgICAgICBrZXk6ICdjcmVhdGVVcGRhdGVNZXNzYWdlUmVxdWVzdCcsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGNyZWF0ZVVwZGF0ZU1lc3NhZ2VSZXF1ZXN0KGZyb20sIHRvLCBjb250ZXh0SWQsIGlkVG9rZW4sIGFjY2Vzc1Rva2VuLCByZXNvdXJjZSwgc2lnbmF0dXJlLCBzY2hlbWEsIGFzc2VydGVkSWRlbnRpdHksIGF0dHJpYnV0ZSwgdmFsdWUpIHsKICAgICAgICAgICAgaWYgKHR5cGVvZiBmcm9tID09PSAndW5kZWZpbmVkJyB8fCB0eXBlb2YgY29udGV4dElkID09PSAndW5kZWZpbmVkJykgdGhyb3cgbmV3IEVycm9yKCJmcm9tLCBhbmQgY29udGV4dElkIE1VU1QgYmUgc3BlY2lmaWVkIik7CiAgICAgICAgICAgIHZhciBtZXNzYWdlQm9keSA9IG5ldyBfTWVzc2FnZUJvZHlKcy5VcGRhdGVNZXNzYWdlQm9keShpZFRva2VuLCBhY2Nlc3NUb2tlbiwgcmVzb3VyY2UsIHNjaGVtYSwgYXNzZXJ0ZWRJZGVudGl0eSwgYXR0cmlidXRlLCB2YWx1ZSk7CiAgICAgICAgICAgIHZhciBtZXNzYWdlID0gbmV3IF9NZXNzYWdlSnMyWydkZWZhdWx0J10oTWVzc2FnZUZhY3RvcnkuX2dlbmVyYXRlTWVzc2FnZUlkKCksIGZyb20sIHRvLCBfTWVzc2FnZUpzLk1lc3NhZ2VUeXBlLlVQREFURSwgY29udGV4dElkLCBtZXNzYWdlQm9keSwgc2lnbmF0dXJlKTsKICAgICAgICAgICAgcmV0dXJuIG1lc3NhZ2U7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB7VVJMLlVSTH0gZnJvbSAtIHRoZSBzZW5kZXIgb2YgdGhpcyBtZXNzYWdlCiAgICAgICAgICogQHBhcmFtIHtVUkwuVVJMTGlzdH0gT25lIG9yIG1vcmUgVVJMcyBvZiBNZXNzYWdlIHJlY2lwaWVudHMuIEFjY29yZGluZyB0byB0aGUgVVJMIHNjaGVtZSBpdCBtYXkgYmUgaGFuZGxlZCBpbgogICAgICAgICAqIGRpZmZlcmVudCB3YXlzCiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGNvbnRleHRJZCAtIHRoZSBHVUlEIHVzZWQgdG8gaWRlbnRpdHkgZWcgYSBjb21tdW5pY2F0aW9uIHNlc3Npb24gbGlrZSBhIHRlbGVwaG9ueSBjYWxsCiAgICAgICAgICogQHBhcmFtIHtJZGVudGl0eS5KV1R9IGlkVG9rZW4gLSB0b2tlbiBmb3IgSWRlbnRpdHkgYXNzZXJ0aW9uIHB1cnBvc2UKICAgICAgICAgKiBAcGFyYW0ge0lkZW50aXR5LkpXVH0gYWNjZXNzVG9rZW4gLSBhY2Nlc3MgdG9rZW4gZm9yIGFjY2VzcyBjb250cm9sIHB1cnBvc2VzCiAgICAgICAgICogQHBhcmFtIHtVUkwuVVJsfSByZXNvdXJjZSAtIFVSTCBvZiBEYXRhIE9iamVjdCBSZXNvdXJjZSBhc3NvY2lhdGVkIHdpdGggdGhlIG1lc3NhZ2UKICAgICAgICAgKiBAcGFyYW0ge3N0cmluZ30gc2lnbmF0dXJlIC0KICAgICAgICAgKiBAcGFyYW0gc2NoZW1hIC0KICAgICAgICAgKiBAcGFyYW0gYXNzZXJ0ZWRJZGVudGl0eSAtIHRoZSB1c2VyIGlkZW50aXR5CiAgICAgICAgICogQHBhcmFtIGF0dHJpYnV0ZSAtIElkZW50aWZpZXMgdGhlIGF0dHJpYnV0ZSBpbiB0aGUgT2JqZWN0IHRvIGJlIHJlYWQKICAgICAgICAgKiBAcGFyYW0gY3JpdGVyaWFTeW50YXggLQogICAgICAgICAqIEBwYXJhbSBjcml0ZXJpYSAtCiAgICAgICAgICovCiAgICB9LCB7CiAgICAgICAga2V5OiAnY3JlYXRlUmVhZE1lc3NhZ2VSZXF1ZXN0JywKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gY3JlYXRlUmVhZE1lc3NhZ2VSZXF1ZXN0KGZyb20sIHRvLCBjb250ZXh0SWQsIGlkVG9rZW4sIGFjY2Vzc1Rva2VuLCByZXNvdXJjZSwgc2lnbmF0dXJlLCBzY2hlbWEsIGFzc2VydGVkSWRlbnRpdHksIGF0dHJpYnV0ZSwgY3JpdGVyaWFTeW50YXgsIGNyaXRlcmlhKSB7CiAgICAgICAgICAgIGlmICh0eXBlb2YgZnJvbSA9PT0gJ3VuZGVmaW5lZCcgfHwgdHlwZW9mIGNvbnRleHRJZCA9PT0gJ3VuZGVmaW5lZCcpIHRocm93IG5ldyBFcnJvcigiZnJvbSwgYW5kIGNvbnRleHRJZCBNVVNUIGJlIHNwZWNpZmllZCIpOwogICAgICAgICAgICB2YXIgbWVzc2FnZUJvZHkgPSBuZXcgX01lc3NhZ2VCb2R5SnMuUmVhZE1lc3NhZ2VCb2R5KGlkVG9rZW4sIGFjY2Vzc1Rva2VuLCByZXNvdXJjZSwgc2NoZW1hLCBhc3NlcnRlZElkZW50aXR5LCBhdHRyaWJ1dGUsIGNyaXRlcmlhU3ludGF4LCBjcml0ZXJpYSk7CiAgICAgICAgICAgIHZhciBtZXNzYWdlID0gbmV3IF9NZXNzYWdlSnMyWydkZWZhdWx0J10oTWVzc2FnZUZhY3RvcnkuX2dlbmVyYXRlTWVzc2FnZUlkKCksIGZyb20sIHRvLCBfTWVzc2FnZUpzLk1lc3NhZ2VUeXBlLlVQREFURSwgY29udGV4dElkLCBtZXNzYWdlQm9keSwgc2lnbmF0dXJlKTsKICAgICAgICAgICAgcmV0dXJuIG1lc3NhZ2U7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB7VVJMLlVSTH0gZnJvbSAtIHRoZSBzZW5kZXIgb2YgdGhpcyBtZXNzYWdlCiAgICAgICAgICogQHBhcmFtIHtVUkwuVVJMTGlzdH0gT25lIG9yIG1vcmUgVVJMcyBvZiBNZXNzYWdlIHJlY2lwaWVudHMuIEFjY29yZGluZyB0byB0aGUgVVJMIHNjaGVtZSBpdCBtYXkgYmUgaGFuZGxlZCBpbgogICAgICAgICAqIGRpZmZlcmVudCB3YXlzCiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGNvbnRleHRJZCAtIHRoZSBHVUlEIHVzZWQgdG8gaWRlbnRpdHkgZWcgYSBjb21tdW5pY2F0aW9uIHNlc3Npb24gbGlrZSBhIHRlbGVwaG9ueSBjYWxsCiAgICAgICAgICogQHBhcmFtIHtJZGVudGl0eS5KV1R9IGlkVG9rZW4gLSB0b2tlbiBmb3IgSWRlbnRpdHkgYXNzZXJ0aW9uIHB1cnBvc2UKICAgICAgICAgKiBAcGFyYW0ge0lkZW50aXR5LkpXVH0gYWNjZXNzVG9rZW4gLSBhY2Nlc3MgdG9rZW4gZm9yIGFjY2VzcyBjb250cm9sIHB1cnBvc2VzCiAgICAgICAgICogQHBhcmFtIHtVUkwuVVJsfSByZXNvdXJjZSAtIFVSTCBvZiBEYXRhIE9iamVjdCBSZXNvdXJjZSBhc3NvY2lhdGVkIHdpdGggdGhlIG1lc3NhZ2UKICAgICAgICAgKiBAcGFyYW0ge3N0cmluZ30gc2lnbmF0dXJlIC0KICAgICAgICAgKiBAcGFyYW0gc2NoZW1hIC0KICAgICAgICAgKiBAcGFyYW0gYXNzZXJ0ZWRJZGVudGl0eSAtIHRoZSB1c2VyJ3MgaWRlbnRpdHkKICAgICAgICAgKiBAcGFyYW0gY29kZSAtIHJlc3BvbnNlIGNvZGUgY29tcGxpYW50IHdpdGggSFRUUCByZXNwb25zZSBjb2RlcyAoUkZDNzIzMSkuCiAgICAgICAgICogQHBhcmFtIHZhbHVlIC0gQ29udGFpbnMgYSBkYXRhIHZhbHVlIGluIEpTT04gZm9ybWF0LgogICAgICAgICAqLwogICAgfSwgewogICAgICAgIGtleTogJ2NyZWF0ZU1lc3NhZ2VSZXNwb25zZScsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGNyZWF0ZU1lc3NhZ2VSZXNwb25zZShmcm9tLCB0bywgY29udGV4dElkLCBpZFRva2VuLCBhY2Nlc3NUb2tlbiwgcmVzb3VyY2UsIHNpZ25hdHVyZSwgc2NoZW1hLCBhc3NlcnRlZElkZW50aXR5LCBjb2RlLCB2YWx1ZSkgewogICAgICAgICAgICBpZiAodHlwZW9mIGZyb20gPT09ICd1bmRlZmluZWQnIHx8IHR5cGVvZiBjb250ZXh0SWQgPT09ICd1bmRlZmluZWQnIHx8IHR5cGVvZiBjb2RlID09PSAndW5kZWZpbmVkJykgdGhyb3cgbmV3IEVycm9yKCJmcm9tLCBjb250ZXh0SWQsIGFuZCByZXNwb25zZSBDb2RlIE1VU1QgYmUgc3BlY2lmaWVkIik7CiAgICAgICAgICAgIHZhciByZXNwb25zZSA9IG5ldyBfTWVzc2FnZUJvZHlKcy5SZXNwb25zZU1lc3NhZ2VCb2R5KGlkVG9rZW4sIGFjY2Vzc1Rva2VuLCByZXNvdXJjZSwgY29kZSwgdmFsdWUpOwogICAgICAgICAgICByZXR1cm4gbmV3IF9NZXNzYWdlSnMyWydkZWZhdWx0J10oTWVzc2FnZUZhY3RvcnkuX2dlbmVyYXRlTWVzc2FnZUlkKCksIGZyb20sIHRvLCBfTWVzc2FnZUpzLk1lc3NhZ2VUeXBlLlJFU1BPTlNFLCBjb250ZXh0SWQsIHJlc3BvbnNlLCBzaWduYXR1cmUpOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogR2VuZXJhdGUgYSBEZWxldGUgTWVzc2FnZSBCb2R5IHRvIHRoZSBnaXZlbiBNZXNzYWdlCiAgICAgICAgICogQHBhcmFtIHtNZXNzYWdlfSBkYXRhIC0gdGhlIGlucHV0IE1lc3NhZ2UKICAgICAgICAgKiBAcGFyYW0ge3N0cmluZ30gYXR0cmlidXRlIC0gdGhlIGF0dHJpYnV0ZSB0byBiZSBkZWxldGVkCiAgICAgICAgICogQHJldHVybiB7TWVzc2FnZX0gRGVsZXRlIE1lc3NhZ2UKICAgICAgICAgKi8KICAgIH0sIHsKICAgICAgICBrZXk6ICdnZW5lcmF0ZURlbGV0ZU1lc3NhZ2VCb2R5JywKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZ2VuZXJhdGVEZWxldGVNZXNzYWdlQm9keShkYXRhLCBhdHRyaWJ1dGUpIHsKICAgICAgICAgICAgaWYgKHR5cGVvZiBkYXRhID09PSAndW5kZWZpbmVkJyB8fCB0eXBlb2YgYXR0cmlidXRlID09PSAndW5kZWZpbmVkJykgdGhyb3cgbmV3IEVycm9yKCJtZXNzYWdlIGFuZCBhdHRyaWJ1dGUgTVVTVCBiZSBzcGVjaWZpZWQiKTsKICAgICAgICAgICAgdmFyIHByZXZpb3VzQm9keSA9IGRhdGEuYm9keTsKICAgICAgICAgICAgdmFyIGlkVG9rZW4gPSBwcmV2aW91c0JvZHkuaWRUb2tlbjsKICAgICAgICAgICAgdmFyIGFjY2Vzc1Rva2VuID0gcHJldmlvdXNCb2R5LmFjY2Vzc1Rva2VuOwogICAgICAgICAgICB2YXIgcmVzb3VyY2UgPSBwcmV2aW91c0JvZHkucmVzb3VyY2U7CiAgICAgICAgICAgIHZhciBzY2hlbWEgPSBwcmV2aW91c0JvZHkuc2NoZW1hOwogICAgICAgICAgICB2YXIgYXNzZXJ0ZWRJZGVudGl0eSA9IHByZXZpb3VzQm9keS5hc3NlcnRlZElkZW50aXR5OwoKICAgICAgICAgICAgdmFyIG5ld0JvZHkgPSBuZXcgX01lc3NhZ2VCb2R5SnMuRGVsZXRlTWVzc2FnZUJvZHkoaWRUb2tlbiwgYWNjZXNzVG9rZW4sIHJlc291cmNlLCBhdHRyaWJ1dGUsIHNjaGVtYSwgYXNzZXJ0ZWRJZGVudGl0eSk7CiAgICAgICAgICAgIHJldHVybiBuZXcgX01lc3NhZ2VKczJbJ2RlZmF1bHQnXShkYXRhLmlkLCBkYXRhLmZyb20sIGRhdGEudG8sIF9NZXNzYWdlSnMuTWVzc2FnZVR5cGUuREVMRVRFLCBkYXRhLmNvbnRleHRJZCwgbmV3Qm9keSwgZGF0YS5zaWduYXR1cmUpOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogR2VuZXJhdGUgYW4gVXBkYXRlIE1lc3NhZ2UgQm9keSB0byB0aGUgZ2l2ZW4gTWVzc2FnZQogICAgICAgICAqIEBwYXJhbSB7TWVzc2FnZX0gZGF0YSAtIE1lc3NhZ2UgdG8gYmUgdXBkYXRlZAogICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBhdHRyaWJ1dGUgdG8gYmUgdXBkYXRlZAogICAgICAgICAqIEBwYXJhbSB7b2JqZWN0fSB2YWx1ZSB0aGUgbmV3IHZhbHVlIG9mIHRoZSBhdHRyaWJ1dGUKICAgICAgICAgKiBAcmV0dXJuIHtNZXNzYWdlfSBVcGRhdGUgTWVzc2FnZQogICAgICAgICAqLwogICAgfSwgewogICAgICAgIGtleTogJ2dlbmVyYXRlVXBkYXRlTWVzc2FnZUJvZHknLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBnZW5lcmF0ZVVwZGF0ZU1lc3NhZ2VCb2R5KGRhdGEsIGF0dHJpYnV0ZSwgdmFsdWUpIHsKICAgICAgICAgICAgaWYgKCFkYXRhIHx8ICFhdHRyaWJ1dGUgfHwgIXZhbHVlKSB0aHJvdyBuZXcgRXJyb3IoIm1lc3NhZ2UgYXR0cmlidXRlIGFuZCB2YWx1ZSBNVVNUIGJlIHNwZWNpZmllZCIpOwogICAgICAgICAgICB2YXIgcHJldmlvdXNCb2R5ID0gZGF0YS5ib2R5OwogICAgICAgICAgICB2YXIgaWRUb2tlbiA9IHByZXZpb3VzQm9keS5pZFRva2VuOwogICAgICAgICAgICB2YXIgYWNjZXNzVG9rZW4gPSBwcmV2aW91c0JvZHkuYWNjZXNzVG9rZW47CiAgICAgICAgICAgIHZhciByZXNvdXJjZSA9IHByZXZpb3VzQm9keS5yZXNvdXJjZTsKICAgICAgICAgICAgdmFyIHNjaGVtYSA9IHByZXZpb3VzQm9keS5zY2hlbWE7CiAgICAgICAgICAgIHZhciBhc3NlcnRlZElkZW50aXR5ID0gcHJldmlvdXNCb2R5LmFzc2VydGVkSWRlbnRpdHk7CgogICAgICAgICAgICB2YXIgbmV3Qm9keSA9IG5ldyBfTWVzc2FnZUJvZHlKcy5VcGRhdGVNZXNzYWdlQm9keShpZFRva2VuLCBhY2Nlc3NUb2tlbiwgcmVzb3VyY2UsIHNjaGVtYSwgYXNzZXJ0ZWRJZGVudGl0eSwgYXR0cmlidXRlLCB2YWx1ZSk7CiAgICAgICAgICAgIHJldHVybiBuZXcgX01lc3NhZ2VKczJbJ2RlZmF1bHQnXShkYXRhLmlkLCBkYXRhLmZyb20sIGRhdGEudG8sIF9NZXNzYWdlSnMuTWVzc2FnZVR5cGUuVVBEQVRFLCBkYXRhLmNvbnRleHRJZCwgbmV3Qm9keSwgZGF0YS5zaWduYXR1cmUpOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogZ2VuZXJhdGUgYSBSZWFkIE1lc3NhZ2UgQm9keSB0byBnaXZlbiByZXF1ZXN0CiAgICAgICAgICogQHBhcmFtIHtNZXNzYWdlfSBkYXRhIC0gTWVzc2FnZSB0byBiZSB1cGRhdGVkCiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGF0dHJpYnV0ZSAtIElkZW50aWZpZXMgdGhlIGF0dHJpYnV0ZSBpbiB0aGUgT2JqZWN0IHRvIGJlIHJlYWQKICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gY3JpdGVyaWEKICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gY3JpdGVyaWFTeW50YXgKICAgICAgICAgKi8KICAgIH0sIHsKICAgICAgICBrZXk6ICdnZW5lcmF0ZVJlYWRNZXNzYWdlQm9keScsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGdlbmVyYXRlUmVhZE1lc3NhZ2VCb2R5KGRhdGEsIGF0dHJpYnV0ZSwgY3JpdGVyaWEsIGNyaXRlcmlhU3ludGF4KSB7CiAgICAgICAgICAgIGlmICghZGF0YSkgdGhyb3cgbmV3IEVycm9yKCJtZXNzYWdlIE1VU1QgYmUgc3BlY2lmaWVkIik7CiAgICAgICAgICAgIHZhciBwcmV2aW91c0JvZHkgPSBkYXRhLmJvZHk7CiAgICAgICAgICAgIHZhciBpZFRva2VuID0gcHJldmlvdXNCb2R5LmlkVG9rZW47CiAgICAgICAgICAgIHZhciBhY2Nlc3NUb2tlbiA9IHByZXZpb3VzQm9keS5hY2Nlc3NUb2tlbjsKICAgICAgICAgICAgdmFyIHJlc291cmNlID0gcHJldmlvdXNCb2R5LnJlc291cmNlOwogICAgICAgICAgICB2YXIgc2NoZW1hID0gcHJldmlvdXNCb2R5LnNjaGVtYTsKICAgICAgICAgICAgdmFyIGFzc2VydGVkSWRlbnRpdHkgPSBwcmV2aW91c0JvZHkuYXNzZXJ0ZWRJZGVudGl0eTsKCiAgICAgICAgICAgIHZhciByZWFkQm9keSA9IG5ldyBfTWVzc2FnZUJvZHlKcy5SZWFkTWVzc2FnZUJvZHkoaWRUb2tlbiwgYWNjZXNzVG9rZW4sIHJlc291cmNlLCBzY2hlbWEsIGFzc2VydGVkSWRlbnRpdHksIGF0dHJpYnV0ZSwgY3JpdGVyaWFTeW50YXgsIGNyaXRlcmlhKTsKICAgICAgICAgICAgcmV0dXJuIG5ldyBfTWVzc2FnZUpzMlsnZGVmYXVsdCddKGRhdGEuaWQsIGRhdGEuZnJvbSwgZGF0YS50bywgX01lc3NhZ2VKcy5NZXNzYWdlVHlwZS5SRUFELCBkYXRhLmNvbnRleHRJZCwgcmVhZEJvZHksIGRhdGEuc2lnbmF0dXJlKTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIEdlbmVyYXRlIGEgcmVzcG9uc2UgdG8gdGhlIGdpdmVuIE1lc3NhZ2UKICAgICAgICAgKiBAcGFyYW0ge01lc3NhZ2V9IGRhdGEgLSBNZXNzYWdlIHRvIGJlIHVwZGF0ZWQKICAgICAgICAgKiBAcGFyYW0gY29kZSAtIHJlc3BvbnNlIGNvZGUgY29tcGxpYW50IHdpdGggSFRUUCByZXNwb25zZSBjb2RlcyAoUkZDNzIzMSkuCiAgICAgICAgICogQHBhcmFtIHZhbHVlIC0gQ29udGFpbnMgYSBkYXRhIHZhbHVlIGluIEpTT04gZm9ybWF0LgogICAgICAgICAqLwogICAgfSwgewogICAgICAgIGtleTogJ2dlbmVyYXRlTWVzc2FnZVJlc3BvbnNlJywKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZ2VuZXJhdGVNZXNzYWdlUmVzcG9uc2UoZGF0YSwgY29kZSwgdmFsdWUpIHsKICAgICAgICAgICAgaWYgKCFkYXRhIHx8ICFjb2RlKSB0aHJvdyBuZXcgRXJyb3IoIm1lc3NhZ2UgYW5kIHJlc3BvbnNlIGNvZGUgTVVTVCBiZSBzcGVjaWZpZWQiKTsKCiAgICAgICAgICAgIHZhciBwcmV2aW91c0JvZHkgPSBkYXRhLmJvZHk7CiAgICAgICAgICAgIHZhciBpZFRva2VuID0gcHJldmlvdXNCb2R5LmlkVG9rZW47CiAgICAgICAgICAgIHZhciBhY2Nlc3NUb2tlbiA9IHByZXZpb3VzQm9keS5hY2Nlc3NUb2tlbjsKICAgICAgICAgICAgdmFyIHJlc291cmNlID0gcHJldmlvdXNCb2R5LnJlc291cmNlOwoKICAgICAgICAgICAgdmFyIHJlc3BvbnNlID0gbmV3IF9NZXNzYWdlQm9keUpzLlJlc3BvbnNlTWVzc2FnZUJvZHkoaWRUb2tlbiwgYWNjZXNzVG9rZW4sIHJlc291cmNlLCBjb2RlLCB2YWx1ZSk7CiAgICAgICAgICAgIHJldHVybiBuZXcgX01lc3NhZ2VKczJbJ2RlZmF1bHQnXShkYXRhLmlkLCBkYXRhLmZyb20sIGRhdGEudG8sIF9NZXNzYWdlSnMuTWVzc2FnZVR5cGUuUkVTUE9OU0UsIGRhdGEuY29udGV4dElkLCByZXNwb25zZSwgZGF0YS5zaWduYXR1cmUpOwogICAgICAgIH0KICAgIH1dLCBbewogICAgICAgIGtleTogJ19nZW5lcmF0ZU1lc3NhZ2VJZCcsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9nZW5lcmF0ZU1lc3NhZ2VJZCgpIHsKICAgICAgICAgICAgdmFyIGQgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTsKCiAgICAgICAgICAgIHJldHVybiAneHh4eHh4eHgteHh4eC00eHh4LXl4eHgteHh4eHh4eHh4eHh4Jy5yZXBsYWNlKC9beHldL2csIGZ1bmN0aW9uIChjKSB7CiAgICAgICAgICAgICAgICB2YXIgciA9IChkICsgTWF0aC5yYW5kb20oKSAqIDE2KSAlIDE2IHwgMDsKICAgICAgICAgICAgICAgIGQgPSBNYXRoLmZsb29yKGQgLyAxNik7CiAgICAgICAgICAgICAgICByZXR1cm4gKGMgPT0gJ3gnID8gciA6IHIgJiAweDMgfCAweDgpLnRvU3RyaW5nKDE2KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgfV0pOwoKICAgIHJldHVybiBNZXNzYWdlRmFjdG9yeTsKfSkoX3JlVEhJTktPYmplY3RSZXRoaW5rT2JqZWN0SnMyWydkZWZhdWx0J10pOwoKZXhwb3J0c1snZGVmYXVsdCddID0gTWVzc2FnZUZhY3Rvcnk7Cm1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1snZGVmYXVsdCddOwoKfSx7Ii4uL3JlVEhJTktPYmplY3QvUmV0aGlua09iamVjdC5qcyI6MTcsIi4vTWVzc2FnZS5qcyI6MTQsIi4vTWVzc2FnZUJvZHkuanMiOjE1fV0sMTc6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewoidXNlIHN0cmljdCI7CgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgICB2YWx1ZTogdHJ1ZQp9KTsKCnZhciBfY3JlYXRlQ2xhc3MgPSAoZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9IHJldHVybiBmdW5jdGlvbiAoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH07IH0pKCk7CgpmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyAiZGVmYXVsdCI6IG9iaiB9OyB9CgpmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOyB9IH0KCnZhciBfdHY0ID0gcmVxdWlyZSgidHY0Iik7Cgp2YXIgX3R2NDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF90djQpOwoKdmFyIFJldGhpbmtPYmplY3QgPSAoZnVuY3Rpb24gKCkgewogICAgZnVuY3Rpb24gUmV0aGlua09iamVjdCh2YWxpZGF0aW9uLCBzY2hlbWEpIHsKICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgUmV0aGlua09iamVjdCk7CgogICAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICAgIHRoaXMudmFsaWRhdGlvbiA9IHZhbGlkYXRpb247CiAgICAgICAgdGhpcy5zY2hlbWEgPSBzY2hlbWE7CiAgICB9CgogICAgX2NyZWF0ZUNsYXNzKFJldGhpbmtPYmplY3QsIFt7CiAgICAgICAga2V5OiAidmFsaWRhdGUiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiB2YWxpZGF0ZShkYXRhKSB7CiAgICAgICAgICAgIGlmICh0aGlzLnNjaGVtYSkgcmV0dXJuIF90djQyWyJkZWZhdWx0Il0udmFsaWRhdGUoZGF0YSwgdGhpcy5zY2hlbWEpO2Vsc2UgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgIH1dKTsKCiAgICByZXR1cm4gUmV0aGlua09iamVjdDsKfSkoKTsKCmV4cG9ydHMuUmV0aGlua09iamVjdCA9IFJldGhpbmtPYmplY3Q7CmV4cG9ydHNbImRlZmF1bHQiXSA9IFJldGhpbmtPYmplY3Q7Cgp9LHsidHY0IjoxfV0sMTg6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewovLyBpbXBvcnQgQWRkcmVzc0ZhY3RvcnkgZnJvbSAnLi9hZGRyZXNzLWZhY3RvcnkvdXJsJzsKJ3VzZSBzdHJpY3QnOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgewogIHZhbHVlOiB0cnVlCn0pOwoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgJ2RlZmF1bHQnOiBvYmogfTsgfQoKdmFyIF9jYXRhbG9ndWVGYWN0b3J5Q2F0YWxvZ3VlRGF0YU9iamVjdEZhY3RvcnkgPSByZXF1aXJlKCcuL2NhdGFsb2d1ZS1mYWN0b3J5L0NhdGFsb2d1ZURhdGFPYmplY3RGYWN0b3J5Jyk7Cgp2YXIgX2NhdGFsb2d1ZUZhY3RvcnlDYXRhbG9ndWVEYXRhT2JqZWN0RmFjdG9yeTIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9jYXRhbG9ndWVGYWN0b3J5Q2F0YWxvZ3VlRGF0YU9iamVjdEZhY3RvcnkpOwoKdmFyIF9tZXNzYWdlRmFjdG9yeU1lc3NhZ2VGYWN0b3J5ID0gcmVxdWlyZSgnLi9tZXNzYWdlLWZhY3RvcnkvTWVzc2FnZUZhY3RvcnknKTsKCnZhciBfbWVzc2FnZUZhY3RvcnlNZXNzYWdlRmFjdG9yeTIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9tZXNzYWdlRmFjdG9yeU1lc3NhZ2VGYWN0b3J5KTsKCnZhciBfc3luY2hlclN5bmNoZXIgPSByZXF1aXJlKCcuL3N5bmNoZXIvU3luY2hlcicpOwoKdmFyIF9zeW5jaGVyU3luY2hlcjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9zeW5jaGVyU3luY2hlcik7Cgp2YXIgX3N5bmNoZXJEYXRhT2JqZWN0UmVwb3J0ZXIgPSByZXF1aXJlKCcuL3N5bmNoZXIvRGF0YU9iamVjdFJlcG9ydGVyJyk7Cgp2YXIgX3N5bmNoZXJEYXRhT2JqZWN0UmVwb3J0ZXIyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfc3luY2hlckRhdGFPYmplY3RSZXBvcnRlcik7Cgp2YXIgX3N5bmNoZXJEYXRhT2JqZWN0T2JzZXJ2ZXIgPSByZXF1aXJlKCcuL3N5bmNoZXIvRGF0YU9iamVjdE9ic2VydmVyJyk7Cgp2YXIgX3N5bmNoZXJEYXRhT2JqZWN0T2JzZXJ2ZXIyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfc3luY2hlckRhdGFPYmplY3RPYnNlcnZlcik7Cgp2YXIgX2h5cGVydHlIeXBlcnR5Q29ubmVjdG9yID0gcmVxdWlyZSgnLi9oeXBlcnR5L0h5cGVydHlDb25uZWN0b3InKTsKCnZhciBfaHlwZXJ0eUh5cGVydHlDb25uZWN0b3IyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfaHlwZXJ0eUh5cGVydHlDb25uZWN0b3IpOwoKdmFyIF9jYXRhbG9ndWVGYWN0b3J5SHlwZXJ0eURlc2NyaXB0b3IgPSByZXF1aXJlKCcuL2NhdGFsb2d1ZS1mYWN0b3J5L0h5cGVydHlEZXNjcmlwdG9yJyk7Cgp2YXIgX2NhdGFsb2d1ZUZhY3RvcnlIeXBlcnR5RGVzY3JpcHRvcjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9jYXRhbG9ndWVGYWN0b3J5SHlwZXJ0eURlc2NyaXB0b3IpOwoKdmFyIF9jYXRhbG9ndWVGYWN0b3J5UHJvdG9jb2xTdHViRGVzY3JpcHRvciA9IHJlcXVpcmUoJy4vY2F0YWxvZ3VlLWZhY3RvcnkvUHJvdG9jb2xTdHViRGVzY3JpcHRvcicpOwoKdmFyIF9jYXRhbG9ndWVGYWN0b3J5UHJvdG9jb2xTdHViRGVzY3JpcHRvcjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9jYXRhbG9ndWVGYWN0b3J5UHJvdG9jb2xTdHViRGVzY3JpcHRvcik7Cgp2YXIgX2NhdGFsb2d1ZUZhY3RvcnlTb3VyY2VQYWNrYWdlID0gcmVxdWlyZSgnLi9jYXRhbG9ndWUtZmFjdG9yeS9Tb3VyY2VQYWNrYWdlJyk7Cgp2YXIgX2NhdGFsb2d1ZUZhY3RvcnlTb3VyY2VQYWNrYWdlMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2NhdGFsb2d1ZUZhY3RvcnlTb3VyY2VQYWNrYWdlKTsKCi8vIGV4cG9ydCB7QWRkcmVzc0ZhY3Rvcnl9OwpleHBvcnRzLkNhdGFsb2d1ZUZhY3RvcnkgPSBfY2F0YWxvZ3VlRmFjdG9yeUNhdGFsb2d1ZURhdGFPYmplY3RGYWN0b3J5MlsnZGVmYXVsdCddOwpleHBvcnRzLk1lc3NhZ2VGYWN0b3J5ID0gX21lc3NhZ2VGYWN0b3J5TWVzc2FnZUZhY3RvcnkyWydkZWZhdWx0J107CmV4cG9ydHMuU3luY2hlciA9IF9zeW5jaGVyU3luY2hlcjJbJ2RlZmF1bHQnXTsKZXhwb3J0cy5EYXRhT2JqZWN0UmVwb3J0ZXIgPSBfc3luY2hlckRhdGFPYmplY3RSZXBvcnRlcjJbJ2RlZmF1bHQnXTsKZXhwb3J0cy5EYXRhT2JqZWN0T2JzZXJ2ZXIgPSBfc3luY2hlckRhdGFPYmplY3RPYnNlcnZlcjJbJ2RlZmF1bHQnXTsKZXhwb3J0cy5IeXBlcnR5Q29ubmVjdG9yID0gX2h5cGVydHlIeXBlcnR5Q29ubmVjdG9yMlsnZGVmYXVsdCddOwpleHBvcnRzLkh5cGVydHlEZXNjcmlwdG9yID0gX2NhdGFsb2d1ZUZhY3RvcnlIeXBlcnR5RGVzY3JpcHRvcjJbJ2RlZmF1bHQnXTsKZXhwb3J0cy5Qcm90b2NvbFN0dWJEZXNjcmlwdG9yID0gX2NhdGFsb2d1ZUZhY3RvcnlQcm90b2NvbFN0dWJEZXNjcmlwdG9yMlsnZGVmYXVsdCddOwpleHBvcnRzLlNvdXJjZVBhY2thZ2UgPSBfY2F0YWxvZ3VlRmFjdG9yeVNvdXJjZVBhY2thZ2UyWydkZWZhdWx0J107Cgp9LHsiLi9jYXRhbG9ndWUtZmFjdG9yeS9DYXRhbG9ndWVEYXRhT2JqZWN0RmFjdG9yeSI6NSwiLi9jYXRhbG9ndWUtZmFjdG9yeS9IeXBlcnR5RGVzY3JpcHRvciI6NywiLi9jYXRhbG9ndWUtZmFjdG9yeS9Qcm90b2NvbFN0dWJEZXNjcmlwdG9yIjoxMCwiLi9jYXRhbG9ndWUtZmFjdG9yeS9Tb3VyY2VQYWNrYWdlIjoxMSwiLi9oeXBlcnR5L0h5cGVydHlDb25uZWN0b3IiOjEzLCIuL21lc3NhZ2UtZmFjdG9yeS9NZXNzYWdlRmFjdG9yeSI6MTYsIi4vc3luY2hlci9EYXRhT2JqZWN0T2JzZXJ2ZXIiOjE5LCIuL3N5bmNoZXIvRGF0YU9iamVjdFJlcG9ydGVyIjoyMCwiLi9zeW5jaGVyL1N5bmNoZXIiOjIyfV0sMTk6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewondXNlIHN0cmljdCc7CgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7CiAgdmFsdWU6IHRydWUKfSk7Cgp2YXIgX2NyZWF0ZUNsYXNzID0gKGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmICgndmFsdWUnIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfSByZXR1cm4gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9OyB9KSgpOwoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgJ2RlZmF1bHQnOiBvYmogfTsgfQoKZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCdDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24nKTsgfSB9Cgp2YXIgX1N5bmNPYmplY3QgPSByZXF1aXJlKCcuL1N5bmNPYmplY3QnKTsKCnZhciBfU3luY09iamVjdDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9TeW5jT2JqZWN0KTsKCnZhciBGaWx0ZXJUeXBlID0geyBBTlk6ICdhbnknLCBTVEFSVDogJ3N0YXJ0JywgRVhBQ1Q6ICdleGFjdCcgfTsKCnZhciBEYXRhT2JqZWN0T2JzZXJ2ZXIgLyogaW1wbGVtZW50cyBTeW5jU3RhdHVzICovID0gKGZ1bmN0aW9uICgpIHsKICAvKiBwcml2YXRlCiAgX3ZlcnNpb246IG51bWJlcgogIF9vd25lcjogSHlwZXJ0eVVSTAogICBfdXJsOiBPYmplY3RVUkwKICBfc2NoZW1hOiBTY2hlbWEKICBfc3RhdHVzOiBvbiB8IHBhdXNlZAogICBfc3luY09iajogU3luY0RhdGEKICAgLS0tLWV2ZW50IGhhbmRsZXJzLS0tLQogIF9maWx0ZXJzOiB7PGZpbHRlcj46IHt0eXBlOiA8c3RhcnQsIGV4YWN0PiwgY2FsbGJhY2s6IDxmdW5jdGlvbj59IH0KICAqLwoKICBmdW5jdGlvbiBEYXRhT2JqZWN0T2JzZXJ2ZXIob3duZXJVUkwsIG9iamVjdFVSTCwgc2NoZW1hLCBpbml0aWFsU3RhdHVzLCBpbml0aWFsRGF0YSkgewogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIERhdGFPYmplY3RPYnNlcnZlcik7CgogICAgdmFyIF90aGlzID0gdGhpczsKCiAgICBfdGhpcy5fdmVyc2lvbiA9IDA7CiAgICBfdGhpcy5fb3duZXIgPSBvd25lclVSTDsKICAgIF90aGlzLl91cmwgPSBvYmplY3RVUkw7CiAgICBfdGhpcy5fc2NoZW1hID0gc2NoZW1hOwoKICAgIF90aGlzLl9zdGF0dXMgPSBpbml0aWFsU3RhdHVzOwogICAgX3RoaXMuX3N5bmNPYmogPSBuZXcgX1N5bmNPYmplY3QyWydkZWZhdWx0J10oaW5pdGlhbERhdGEpOwogICAgX3RoaXMuX3N5bmNPYmoub2JzZXJ2ZShmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgX3RoaXMuX29uRmlsdGVyKGV2ZW50KTsKICAgIH0pOwoKICAgIF90aGlzLl9maWx0ZXJzID0ge307CiAgfQoKICBfY3JlYXRlQ2xhc3MoRGF0YU9iamVjdE9ic2VydmVyLCBbewogICAga2V5OiAncGF1c2UnLAogICAgdmFsdWU6IGZ1bmN0aW9uIHBhdXNlKCkgewogICAgICAvL1RPRE86IHRoaXMgZmVhdHVyZSBuZWVkcyBtb3JlIGFuYWxpc2UKICAgICAgdGhyb3cgJ05vdCBpbXBsZW1lbnRlZCc7CiAgICB9CiAgfSwgewogICAga2V5OiAncmVzdW1lJywKICAgIHZhbHVlOiBmdW5jdGlvbiByZXN1bWUoKSB7CiAgICAgIC8vVE9ETzogdGhpcyBmZWF0dXJlIG5lZWRzIG1vcmUgYW5hbGlzZQogICAgICB0aHJvdyAnTm90IGltcGxlbWVudGVkJzsKICAgIH0KICB9LCB7CiAgICBrZXk6ICdzdG9wJywKICAgIHZhbHVlOiBmdW5jdGlvbiBzdG9wKCkgewogICAgICAvL1RPRE86IHNob3VsZCByZW1vdmUgdGhlIHN1YnNjcmlwdGlvbiBhbmQgc2VuZCBtZXNzYWdlIHVuc3Vic2NyaWJlPwogICAgICB0aHJvdyAnTm90IGltcGxlbWVudGVkJzsKICAgIH0KCiAgICAvL3JlZ2lzdGVyIGNoYW5nZSBmaWx0ZXIKICB9LCB7CiAgICBrZXk6ICdvbkNoYW5nZScsCiAgICB2YWx1ZTogZnVuY3Rpb24gb25DaGFuZ2UoZmlsdGVyLCBjYWxsYmFjaykgewogICAgICB2YXIga2V5ID0gZmlsdGVyOwogICAgICB2YXIgZmlsdGVyT2JqID0gewogICAgICAgIHR5cGU6IEZpbHRlclR5cGUuRVhBQ1QsCiAgICAgICAgY2FsbGJhY2s6IGNhbGxiYWNrCiAgICAgIH07CgogICAgICB2YXIgaWR4ID0gZmlsdGVyLmluZGV4T2YoJyonKTsKICAgICAgaWYgKGlkeCA9PT0gZmlsdGVyLmxlbmd0aCAtIDEpIHsKICAgICAgICBpZiAoaWR4ID09PSAwKSB7CiAgICAgICAgICBmaWx0ZXJPYmoudHlwZSA9IEZpbHRlclR5cGUuQU5ZOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBmaWx0ZXJPYmoudHlwZSA9IEZpbHRlclR5cGUuU1RBUlQ7CiAgICAgICAgICBrZXkgPSBmaWx0ZXIuc3Vic3RyKDAsIGZpbHRlci5sZW5ndGggLSAxKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuX2ZpbHRlcnNba2V5XSA9IGZpbHRlck9iajsKICAgIH0KCiAgICAvL2ZpbHRlciBjaGFuZ2VzCiAgfSwgewogICAga2V5OiAnX29uRmlsdGVyJywKICAgIHZhbHVlOiBmdW5jdGlvbiBfb25GaWx0ZXIoZXZlbnQpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIE9iamVjdC5rZXlzKF90aGlzLl9maWx0ZXJzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICB2YXIgZmlsdGVyID0gX3RoaXMuX2ZpbHRlcnNba2V5XTsKICAgICAgICBpZiAoZmlsdGVyLnR5cGUgPT09IEZpbHRlclR5cGUuQU5ZKSB7CiAgICAgICAgICAvL21hdGNoIGFueXRoaW5nCiAgICAgICAgICBmaWx0ZXIuY2FsbGJhY2soZXZlbnQpOwogICAgICAgIH0gZWxzZSBpZiAoZmlsdGVyLnR5cGUgPT09IEZpbHRlclR5cGUuU1RBUlQpIHsKICAgICAgICAgIC8vaWYgc3RhcnRzIHdpdGggZmlsdGVyLi4uCiAgICAgICAgICBpZiAoZXZlbnQuZmllbGQuaW5kZXhPZihrZXkpID09PSAwKSB7CiAgICAgICAgICAgIGZpbHRlci5jYWxsYmFjayhldmVudCk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChmaWx0ZXIudHlwZSA9PT0gRmlsdGVyVHlwZS5FWEFDVCkgewogICAgICAgICAgLy9leGFjdCBtYXRjaAogICAgICAgICAgaWYgKGV2ZW50LmZpZWxkID09PSBrZXkpIHsKICAgICAgICAgICAgZmlsdGVyLmNhbGxiYWNrKGV2ZW50KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pOwogICAgfQoKICAgIC8vcmVjZWl2ZSBhbmQgcHJvY2VzcyBjaGFuZ2UgbWVzc2FnZXMKICB9LCB7CiAgICBrZXk6ICdfY2hhbmdlT2JqZWN0JywKICAgIHZhbHVlOiBmdW5jdGlvbiBfY2hhbmdlT2JqZWN0KG1zZykgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgLy9UT0RPOiB1cGRhdGUgdmVyc2lvbiA/CiAgICAgIC8vaG93IHRvIGhhbmRsZSBhbiBpbmNvcnJlY3QgdmVyc2lvbiA/IEV4YW1wbGU6IHJlY2VpdmUgYSB2ZXJzaW9uIDMgd2hlbiB0aGUgb2JzZXJ2ZXIgaXMgaW4gdmVyc2lvbiAxLCB3aGVyZSBpcyB0aGUgdmVyc2lvbiAyID8KICAgICAgLy93aWxsIHdlIG5lZWQgdG8gY29uZmlybSB0aGUgcmVjZXB0aW9uID8KICAgICAgaWYgKF90aGlzLl92ZXJzaW9uICsgMSA9PT0gbXNnLmJvZHkudmVyc2lvbikgewogICAgICAgIF90aGlzLl92ZXJzaW9uKys7CiAgICAgICAgdmFyIHBhdGggPSBtc2cuYm9keS5hdHRyaWI7CiAgICAgICAgdmFyIHZhbHVlID0gbXNnLmJvZHkudmFsdWU7CiAgICAgICAgdmFyIGZpbmRSZXN1bHQgPSBfdGhpcy5fc3luY09iai5maW5kQmVmb3JlKHBhdGgpOwoKICAgICAgICBpZiAobXNnLnR5cGUgPT09IF9TeW5jT2JqZWN0LkNoYW5nZVR5cGUuVVBEQVRFKSB7CiAgICAgICAgICBmaW5kUmVzdWx0Lm9ialtmaW5kUmVzdWx0Lmxhc3RdID0gdmFsdWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmIChtc2cudHlwZSA9PT0gX1N5bmNPYmplY3QuQ2hhbmdlVHlwZS5BREQpIHsKICAgICAgICAgICAgaWYgKG1zZy5ib2R5Lm9UeXBlID09PSBfU3luY09iamVjdC5PYmplY3RUeXBlLk9CSkVDVCkgewogICAgICAgICAgICAgIGZpbmRSZXN1bHQub2JqW2ZpbmRSZXN1bHQubGFzdF0gPSB2YWx1ZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAvL0FSUkFZCiAgICAgICAgICAgICAgdmFyIGFyciA9IGZpbmRSZXN1bHQub2JqOwogICAgICAgICAgICAgIHZhciBpbmRleCA9IGZpbmRSZXN1bHQubGFzdDsKICAgICAgICAgICAgICBBcnJheS5wcm90b3R5cGUuc3BsaWNlLmFwcGx5KGFyciwgW2luZGV4LCAwXS5jb25jYXQodmFsdWUpKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy9SRU1PVkUKICAgICAgICAgICAgaWYgKG1zZy5ib2R5Lm9UeXBlID09PSBfU3luY09iamVjdC5PYmplY3RUeXBlLk9CSkVDVCkgewogICAgICAgICAgICAgIGRlbGV0ZSBmaW5kUmVzdWx0Lm9ialtmaW5kUmVzdWx0Lmxhc3RdOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIC8vQVJSQVkKICAgICAgICAgICAgICB2YXIgYXJyID0gZmluZFJlc3VsdC5vYmo7CiAgICAgICAgICAgICAgdmFyIGluZGV4ID0gZmluZFJlc3VsdC5sYXN0OwogICAgICAgICAgICAgIGFyci5zcGxpY2UoaW5kZXgsIHZhbHVlKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICAvL1RPRE86IGhvdyB0byBoYW5kbGUgdW5zeW5jaHJvbml6ZWQgdmVyc2lvbnM/CiAgICAgICAgY29uc29sZS5sb2coJ3Vuc3luY2hyb25pemVkIHZlcnNpb25zJyk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICd2ZXJzaW9uJywKICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICByZXR1cm4gdGhpcy5fdmVyc2lvbjsKICAgIH0KICB9LCB7CiAgICBrZXk6ICdvd25lcicsCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgcmV0dXJuIHRoaXMuX293bmVyOwogICAgfQogIH0sIHsKICAgIGtleTogJ3VybCcsCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgcmV0dXJuIHRoaXMuX3VybDsKICAgIH0KICB9LCB7CiAgICBrZXk6ICdzY2hlbWEnLAogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgIHJldHVybiB0aGlzLl9zY2hlbWE7CiAgICB9CiAgfSwgewogICAga2V5OiAnc3RhdHVzJywKICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICByZXR1cm4gdGhpcy5fc3RhdHVzOwogICAgfQogIH0sIHsKICAgIGtleTogJ2RhdGEnLAogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgIHJldHVybiB0aGlzLl9zeW5jT2JqLmRhdGE7CiAgICB9CiAgfV0pOwoKICByZXR1cm4gRGF0YU9iamVjdE9ic2VydmVyOwp9KSgpOwoKZXhwb3J0c1snZGVmYXVsdCddID0gRGF0YU9iamVjdE9ic2VydmVyOwptb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbJ2RlZmF1bHQnXTsKCn0seyIuL1N5bmNPYmplY3QiOjIxfV0sMjA6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewondXNlIHN0cmljdCc7CgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7CiAgdmFsdWU6IHRydWUKfSk7Cgp2YXIgX2NyZWF0ZUNsYXNzID0gKGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmICgndmFsdWUnIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfSByZXR1cm4gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9OyB9KSgpOwoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgJ2RlZmF1bHQnOiBvYmogfTsgfQoKZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCdDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24nKTsgfSB9Cgp2YXIgX1N5bmNPYmplY3QgPSByZXF1aXJlKCcuL1N5bmNPYmplY3QnKTsKCnZhciBfU3luY09iamVjdDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9TeW5jT2JqZWN0KTsKCnZhciBfdXRpbHNVdGlsc0pzID0gcmVxdWlyZSgnLi4vdXRpbHMvdXRpbHMuanMnKTsKCnZhciBEYXRhT2JqZWN0UmVwb3J0ZXIgLyogaW1wbGVtZW50cyBTeW5jU3RhdHVzICovID0gKGZ1bmN0aW9uICgpIHsKICAvKiBwcml2YXRlCiAgX3ZlcnNpb246IG51bWJlcgogICBfdXJsOiBPYmplY3RVUkwKICBfc2NoZW1hOiBTY2hlbWEKICBfYnVzOiBNaW5pQnVzCiAgX3N0YXR1czogb24gfCBwYXVzZWQKICAgX3N5bmNPYmo6IFN5bmNEYXRhCiAgX3N1YnNjcmlwdGlvbnM6IDxoeXBlcnR5VXJsOiB7IHN0YXR1czogc3RyaW5nIH0gfT4KICAgLS0tLWV2ZW50IGhhbmRsZXJzLS0tLQogIF9vblN1YnNjcmlwdGlvbkhhbmRsZXI6IChldmVudCkgPT4gdm9pZAogICovCgogIGZ1bmN0aW9uIERhdGFPYmplY3RSZXBvcnRlcihvd25lciwgdXJsLCBzY2hlbWEsIGJ1cywgaW5pdGlhbFN0YXR1cywgaW5pdGlhbERhdGEpIHsKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBEYXRhT2JqZWN0UmVwb3J0ZXIpOwoKICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgX3RoaXMuX3ZlcnNpb24gPSAwOwogICAgX3RoaXMuX293bmVyID0gb3duZXI7CiAgICBfdGhpcy5fdXJsID0gdXJsOwogICAgX3RoaXMuX3NjaGVtYSA9IHNjaGVtYTsKICAgIF90aGlzLl9idXMgPSBidXM7CgogICAgX3RoaXMuX3N1YnNjcmlwdGlvbnMgPSB7fTsKCiAgICBfdGhpcy5fc3RhdHVzID0gaW5pdGlhbFN0YXR1czsKICAgIF90aGlzLl9zeW5jT2JqID0gbmV3IF9TeW5jT2JqZWN0MlsnZGVmYXVsdCddKGluaXRpYWxEYXRhKTsKICAgIF90aGlzLl9zeW5jT2JqLm9ic2VydmUoZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgIF90aGlzLl9vbkNoYW5nZShldmVudCk7CiAgICB9KTsKICB9CgogIF9jcmVhdGVDbGFzcyhEYXRhT2JqZWN0UmVwb3J0ZXIsIFt7CiAgICBrZXk6ICdwYXVzZScsCiAgICB2YWx1ZTogZnVuY3Rpb24gcGF1c2UoKSB7CiAgICAgIC8vVE9ETzogcGF1c2UgY2hhbmdlIHJlcG9ydHM/CiAgICB9CiAgfSwgewogICAga2V5OiAncmVzdW1lJywKICAgIHZhbHVlOiBmdW5jdGlvbiByZXN1bWUoKSB7CiAgICAgIC8vVE9ETzogcmVzdW1lIGNoYW5nZSByZXBvcnRzPwogICAgfQogIH0sIHsKICAgIGtleTogJ3N0b3AnLAogICAgdmFsdWU6IGZ1bmN0aW9uIHN0b3AoKSB7CiAgICAgIC8vVE9ETzogZGVzdHJveSByZXBvcnRlcj8KICAgIH0KICB9LCB7CiAgICBrZXk6ICdvblN1YnNjcmlwdGlvbicsCiAgICB2YWx1ZTogZnVuY3Rpb24gb25TdWJzY3JpcHRpb24oY2FsbGJhY2spIHsKICAgICAgdGhpcy5fb25TdWJzY3JpcHRpb25IYW5kbGVyID0gY2FsbGJhY2s7CiAgICB9CiAgfSwgewogICAga2V5OiAnX29uRm9yd2FyZCcsCiAgICB2YWx1ZTogZnVuY3Rpb24gX29uRm9yd2FyZChtc2cpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIGNvbnNvbGUubG9nKCdEYXRhT2JqZWN0UmVwb3J0ZXItUkNWOiAnLCBtc2cpOwogICAgICBzd2l0Y2ggKG1zZy5ib2R5LnR5cGUpIHsKICAgICAgICBjYXNlICdzdWJzY3JpYmUnOgogICAgICAgICAgX3RoaXMuX29uU3Vic2NyaWJlKG1zZyk7YnJlYWs7CiAgICAgICAgY2FzZSAndW5zdWJzY3JpYmUnOgogICAgICAgICAgX3RoaXMuX29uVW5TdWJzY3JpYmUobXNnKTticmVhazsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogJ19vblN1YnNjcmliZScsCiAgICB2YWx1ZTogZnVuY3Rpb24gX29uU3Vic2NyaWJlKG1zZykgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICB2YXIgaHlwZXJ0eVVybCA9IG1zZy5ib2R5LmZyb207CgogICAgICB2YXIgZXZlbnQgPSB7CiAgICAgICAgdHlwZTogbXNnLmJvZHkudHlwZSwKICAgICAgICB1cmw6IGh5cGVydHlVcmwsCgogICAgICAgIGFjY2VwdDogZnVuY3Rpb24gYWNjZXB0KCkgewogICAgICAgICAgLy9jcmVhdGUgbmV3IHN1YnNjcmlwdGlvbgogICAgICAgICAgX3RoaXMuX3N1YnNjcmlwdGlvbnNbaHlwZXJ0eVVybF0gPSB7IHN0YXR1czogJ29uJyB9OwoKICAgICAgICAgIC8vc2VuZCBvayByZXNwb25zZSBtZXNzYWdlCiAgICAgICAgICBfdGhpcy5fYnVzLnBvc3RNZXNzYWdlKHsKICAgICAgICAgICAgaWQ6IG1zZy5pZCwgdHlwZTogJ3Jlc3BvbnNlJywgZnJvbTogbXNnLnRvLCB0bzogbXNnLmZyb20sCiAgICAgICAgICAgIGJvZHk6IHsgY29kZTogMjAwLCBzY2hlbWE6IF90aGlzLl9zY2hlbWEsIHZlcnNpb246IF90aGlzLl92ZXJzaW9uLCB2YWx1ZTogKDAsIF91dGlsc1V0aWxzSnMuZGVlcENsb25lKShfdGhpcy5kYXRhKSB9CiAgICAgICAgICB9KTsKICAgICAgICB9LAoKICAgICAgICByZWplY3Q6IGZ1bmN0aW9uIHJlamVjdChyZWFzb24pIHsKICAgICAgICAgIC8vc2VuZCByZWplY3QgcmVzcG9uc2UgbWVzc2FnZQogICAgICAgICAgX3RoaXMuX2J1cy5wb3N0TWVzc2FnZSh7CiAgICAgICAgICAgIGlkOiBtc2cuaWQsIHR5cGU6ICdyZXNwb25zZScsIGZyb206IG1zZy50bywgdG86IG1zZy5mcm9tLAogICAgICAgICAgICBib2R5OiB7IGNvZGU6IDQwMywgZGVzYzogcmVhc29uIH0KICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfTsKCiAgICAgIGlmIChfdGhpcy5fb25TdWJzY3JpcHRpb25IYW5kbGVyKSB7CiAgICAgICAgX3RoaXMuX29uU3Vic2NyaXB0aW9uSGFuZGxlcihldmVudCk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICdfb25VblN1YnNjcmliZScsCiAgICB2YWx1ZTogZnVuY3Rpb24gX29uVW5TdWJzY3JpYmUobXNnKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgIHZhciBoeXBlcnR5VXJsID0gbXNnLmJvZHkuZnJvbTsKCiAgICAgIHZhciBzdWIgPSBfdGhpcy5fc3Vic2NyaXB0aW9uc1toeXBlcnR5VXJsXTsKICAgICAgZGVsZXRlIF90aGlzLl9zdWJzY3JpcHRpb25zW2h5cGVydHlVcmxdOwoKICAgICAgdmFyIGV2ZW50ID0gewogICAgICAgIHR5cGU6IG1zZy5ib2R5LnR5cGUsCiAgICAgICAgdXJsOiBoeXBlcnR5VXJsLAogICAgICAgIG9iamVjdDogc3ViCiAgICAgIH07CgogICAgICBpZiAoX3RoaXMuX29uU3Vic2NyaXB0aW9uSGFuZGxlcikgewogICAgICAgIF90aGlzLl9vblN1YnNjcmlwdGlvbkhhbmRsZXIoZXZlbnQpOwogICAgICB9CiAgICB9CgogICAgLy9zZW5kIGRlbHRhIG1lc3NhZ2VzIHRvIHN1YnNjcmlwdGlvbnMKICB9LCB7CiAgICBrZXk6ICdfb25DaGFuZ2UnLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9vbkNoYW5nZShldmVudCkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgX3RoaXMuX3ZlcnNpb24rKzsKCiAgICAgIGlmIChfdGhpcy5fc3RhdHVzID09PSAnb24nKSB7CiAgICAgICAgX3RoaXMuX2J1cy5wb3N0TWVzc2FnZSh7CiAgICAgICAgICB0eXBlOiBldmVudC5jVHlwZSwgZnJvbTogX3RoaXMuX293bmVyLCB0bzogX3RoaXMuX3VybCwKICAgICAgICAgIGJvZHk6IHsgdmVyc2lvbjogX3RoaXMuX3ZlcnNpb24sIG9UeXBlOiBldmVudC5vVHlwZSwgYXR0cmliOiBldmVudC5maWVsZCwgdmFsdWU6IGV2ZW50LmRhdGEgfQogICAgICAgIH0pOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAndmVyc2lvbicsCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgcmV0dXJuIHRoaXMuX3ZlcnNpb247CiAgICB9CiAgfSwgewogICAga2V5OiAndXJsJywKICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICByZXR1cm4gdGhpcy5fdXJsOwogICAgfQogIH0sIHsKICAgIGtleTogJ3NjaGVtYScsCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgcmV0dXJuIHRoaXMuX3NjaGVtYTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICdzdGF0dXMnLAogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgIHJldHVybiB0aGlzLl9zdGF0dXM7CiAgICB9CiAgfSwgewogICAga2V5OiAnZGF0YScsCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgcmV0dXJuIHRoaXMuX3N5bmNPYmouZGF0YTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICdzdWJzY3JpcHRpb25zJywKICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICByZXR1cm4gdGhpcy5fc3Vic2NyaXB0aW9uczsKICAgIH0KICB9XSk7CgogIHJldHVybiBEYXRhT2JqZWN0UmVwb3J0ZXI7Cn0pKCk7CgpleHBvcnRzWydkZWZhdWx0J10gPSBEYXRhT2JqZWN0UmVwb3J0ZXI7Cm1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1snZGVmYXVsdCddOwoKfSx7Ii4uL3V0aWxzL3V0aWxzLmpzIjoyNCwiLi9TeW5jT2JqZWN0IjoyMX1dLDIxOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKJ3VzZSBzdHJpY3QnOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgewogIHZhbHVlOiB0cnVlCn0pOwoKdmFyIF9jcmVhdGVDbGFzcyA9IChmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoJ3ZhbHVlJyBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0gcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfTsgfSkoKTsKCmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcignQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uJyk7IH0gfQoKdmFyIF91dGlsc1V0aWxzSnMgPSByZXF1aXJlKCcuLi91dGlscy91dGlscy5qcycpOwoKdmFyIFN5bmNPYmplY3QgPSAoZnVuY3Rpb24gKCkgewogIC8qIHByaXZhdGUKICAgIF9kYXRhOiBhbnk7CiAgICBfb2JzZXJ2ZXJzOiAoKGV2ZW50OiBDaGFuZ2VFdmVudCkgPT4gdm9pZClbXQogICovCgogIGZ1bmN0aW9uIFN5bmNPYmplY3QoaW5pdGlhbERhdGEpIHsKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBTeW5jT2JqZWN0KTsKCiAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgIF90aGlzLl9vYnNlcnZlcnMgPSBbXTsKICAgIF90aGlzLl9maWx0ZXJzID0ge307CgogICAgaWYgKGluaXRpYWxEYXRhKSB7CiAgICAgIF90aGlzLl9kYXRhID0gaW5pdGlhbERhdGE7CiAgICB9IGVsc2UgewogICAgICBfdGhpcy5fZGF0YSA9IHt9OwogICAgfQoKICAgIF90aGlzLl9pbnRlcm5hbE9ic2VydmUobmV3IFBhdGgoKSwgX3RoaXMuX2RhdGEpOwogIH0KCiAgLy9keW5hbWljIHBhdGggZm9yIEFycmF5IGluZGV4Li4uCgogIF9jcmVhdGVDbGFzcyhTeW5jT2JqZWN0LCBbewogICAga2V5OiAnb2JzZXJ2ZScsCiAgICB2YWx1ZTogZnVuY3Rpb24gb2JzZXJ2ZShjYWxsYmFjaykgewogICAgICB0aGlzLl9vYnNlcnZlcnMucHVzaChjYWxsYmFjayk7CiAgICB9CiAgfSwgewogICAga2V5OiAnZmluZCcsCiAgICB2YWx1ZTogZnVuY3Rpb24gZmluZChwYXRoKSB7CiAgICAgIHZhciBsaXN0ID0gcGF0aC5zcGxpdCgnLicpOwoKICAgICAgcmV0dXJuIHRoaXMuX2ZpbmRXaXRoU3BsaXQobGlzdCk7CiAgICB9CiAgfSwgewogICAga2V5OiAnZmluZEJlZm9yZScsCiAgICB2YWx1ZTogZnVuY3Rpb24gZmluZEJlZm9yZShwYXRoKSB7CiAgICAgIHZhciByZXN1bHQgPSB7fTsKICAgICAgdmFyIGxpc3QgPSBwYXRoLnNwbGl0KCcuJyk7CiAgICAgIHJlc3VsdC5sYXN0ID0gbGlzdC5wb3AoKTsKICAgICAgcmVzdWx0Lm9iaiA9IHRoaXMuX2ZpbmRXaXRoU3BsaXQobGlzdCk7CgogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogIH0sIHsKICAgIGtleTogJ19maW5kV2l0aFNwbGl0JywKICAgIHZhbHVlOiBmdW5jdGlvbiBfZmluZFdpdGhTcGxpdChsaXN0KSB7CiAgICAgIHZhciBvYmogPSB0aGlzLl9kYXRhOwogICAgICBsaXN0LmZvckVhY2goZnVuY3Rpb24gKHZhbHVlKSB7CiAgICAgICAgb2JqID0gb2JqW3ZhbHVlXTsKICAgICAgfSk7CgogICAgICByZXR1cm4gb2JqOwogICAgfQogIH0sIHsKICAgIGtleTogJ19maXJlRXZlbnQnLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9maXJlRXZlbnQoZXZlbnQpIHsKICAgICAgdGhpcy5fb2JzZXJ2ZXJzLmZvckVhY2goZnVuY3Rpb24gKGNhbGxiYWNrKSB7CiAgICAgICAgY2FsbGJhY2soZXZlbnQpOwogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICdfaXNPYnNlcnZhYmxlJywKICAgIHZhbHVlOiBmdW5jdGlvbiBfaXNPYnNlcnZhYmxlKG9iaikgewogICAgICBpZiAob2JqLmNvbnN0cnVjdG9yID09PSBPYmplY3QgfHwgb2JqLmNvbnN0cnVjdG9yID09PSBBcnJheSkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CgogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgfSwgewogICAga2V5OiAnX2ludGVybmFsT2JzZXJ2ZScsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2ludGVybmFsT2JzZXJ2ZShwYXRoLCBvYmopIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIGlmIChfdGhpcy5faXNPYnNlcnZhYmxlKG9iaikpIHsKICAgICAgICB2YXIgaGFuZGxlciA9IGZ1bmN0aW9uIGhhbmRsZXIoY2hhbmdlcykgewogICAgICAgICAgX3RoaXMuX29uQ2hhbmdlcyhwYXRoLCBjaGFuZ2VzKTsKICAgICAgICB9OwoKICAgICAgICBpZiAob2JqLmNvbnN0cnVjdG9yID09PSBPYmplY3QpIHsKICAgICAgICAgIE9iamVjdC5vYnNlcnZlKG9iaiwgaGFuZGxlcik7CiAgICAgICAgICBmb3IgKHZhciBwcm9wIGluIG9iaikgewogICAgICAgICAgICBpZiAoX3RoaXMuX2lzT2JzZXJ2YWJsZShvYmpbcHJvcF0pKSB7CiAgICAgICAgICAgICAgX3RoaXMuX2ludGVybmFsT2JzZXJ2ZShwYXRoWyduZXcnXShwcm9wKSwgb2JqW3Byb3BdKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAob2JqLmNvbnN0cnVjdG9yID09PSBBcnJheSkgewogICAgICAgICAgQXJyYXkub2JzZXJ2ZShvYmosIGhhbmRsZXIpOwogICAgICAgICAgZm9yICh2YXIgcHJvcCBpbiBvYmopIHsKICAgICAgICAgICAgaWYgKF90aGlzLl9pc09ic2VydmFibGUob2JqW3Byb3BdKSkgewogICAgICAgICAgICAgIHZhciBucCA9IHBhdGhbJ25ldyddKG5ldyBBcnJheUluZGV4KG9ialtwcm9wXSwgcHJvcCkpOwogICAgICAgICAgICAgIF90aGlzLl9pbnRlcm5hbE9ic2VydmUobnAsIG9ialtwcm9wXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICdfb25DaGFuZ2VzJywKICAgIHZhbHVlOiBmdW5jdGlvbiBfb25DaGFuZ2VzKHBhdGgsIGNoYW5nZXMpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICBmb3IgKHZhciBpIGluIGNoYW5nZXMpIHsKICAgICAgICB2YXIgb2JqID0gY2hhbmdlc1tpXS5vYmplY3Q7CiAgICAgICAgdmFyIG9ialR5cGUgPSB1bmRlZmluZWQ7CgogICAgICAgIGlmIChvYmouY29uc3RydWN0b3IgPT0gT2JqZWN0KSB7CiAgICAgICAgICBvYmpUeXBlID0gT2JqZWN0VHlwZS5PQkpFQ1Q7CiAgICAgICAgfQoKICAgICAgICBpZiAob2JqLmNvbnN0cnVjdG9yID09IEFycmF5KSB7CiAgICAgICAgICBvYmpUeXBlID0gT2JqZWN0VHlwZS5BUlJBWTsKICAgICAgICB9CgogICAgICAgIGlmIChjaGFuZ2VzW2ldLnR5cGUgPT09ICdzcGxpY2UnKSB7CiAgICAgICAgICAoZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgaWR4ID0gY2hhbmdlc1tpXS5pbmRleDsKICAgICAgICAgICAgdmFyIGZpZWxkID0gcGF0aFsnbmV3J10oJycgKyBpZHgpOwogICAgICAgICAgICB2YXIgZmllbGRTdHJpbmcgPSBmaWVsZC50b1N0cmluZygpOwoKICAgICAgICAgICAgdmFyIHJlbW92ZVNpemUgPSBjaGFuZ2VzW2ldLnJlbW92ZWQubGVuZ3RoOwogICAgICAgICAgICBpZiAocmVtb3ZlU2l6ZSAhPT0gMCkgewogICAgICAgICAgICAgIHZhciByZW1vdmVWYWx1ZXMgPSBjaGFuZ2VzW2ldLnJlbW92ZWQ7CiAgICAgICAgICAgICAgcmVtb3ZlVmFsdWVzLmZvckVhY2goZnVuY3Rpb24gKHZhbHVlLCBpbmRleCkgewogICAgICAgICAgICAgICAgaWYgKF90aGlzMi5faXNPYnNlcnZhYmxlKHZhbHVlKSkgewogICAgICAgICAgICAgICAgICBwYXRoLnJlbW92ZUluZGV4KGlkeCArIGluZGV4KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgX3RoaXMyLl9maXJlRXZlbnQoewogICAgICAgICAgICAgICAgY1R5cGU6IENoYW5nZVR5cGUuUkVNT1ZFLAogICAgICAgICAgICAgICAgb1R5cGU6IG9ialR5cGUsCiAgICAgICAgICAgICAgICBmaWVsZDogZmllbGRTdHJpbmcsCiAgICAgICAgICAgICAgICBkYXRhOiByZW1vdmVTaXplCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBhZGRTaXplID0gY2hhbmdlc1tpXS5hZGRlZENvdW50OwogICAgICAgICAgICBpZiAoYWRkU2l6ZSAhPT0gMCkgewogICAgICAgICAgICAgIHZhciBhZGRWYWx1ZXMgPSBvYmouc2xpY2UoaWR4LCBpZHggKyBhZGRTaXplKTsKICAgICAgICAgICAgICBhZGRWYWx1ZXMuZm9yRWFjaChmdW5jdGlvbiAodmFsdWUsIGluZGV4KSB7CiAgICAgICAgICAgICAgICBpZiAoX3RoaXMyLl9pc09ic2VydmFibGUodmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgIHZhciBucCA9IHBhdGhbJ25ldyddKG5ldyBBcnJheUluZGV4KHZhbHVlLCBpZHggKyBpbmRleCkpOwogICAgICAgICAgICAgICAgICBfdGhpczIuX2ludGVybmFsT2JzZXJ2ZShucCwgdmFsdWUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBfdGhpczIuX2ZpcmVFdmVudCh7CiAgICAgICAgICAgICAgICBjVHlwZTogQ2hhbmdlVHlwZS5BREQsCiAgICAgICAgICAgICAgICBvVHlwZTogb2JqVHlwZSwKICAgICAgICAgICAgICAgIGZpZWxkOiBmaWVsZFN0cmluZywKICAgICAgICAgICAgICAgIGRhdGE6ICgwLCBfdXRpbHNVdGlsc0pzLmRlZXBDbG9uZSkoYWRkVmFsdWVzKQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvL3JlLWRlZmluZSBwYXRocy4uLgogICAgICAgICAgICBpZiAoaWR4ICE9IG9iai5sZW5ndGggLSAxKSB7CiAgICAgICAgICAgICAgcGF0aC5yZUluZGV4RnJvbShvYmopOwogICAgICAgICAgICB9CiAgICAgICAgICB9KSgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB2YXIgZmllbGQgPSBwYXRoWyduZXcnXShjaGFuZ2VzW2ldLm5hbWUpOwogICAgICAgICAgdmFyIGZpZWxkU3RyaW5nID0gZmllbGQudG9TdHJpbmcoKTsKCiAgICAgICAgICBpZiAoZmllbGRTdHJpbmcuaW5kZXhPZignU3ltYm9sJykgIT09IC0xKSB7CiAgICAgICAgICAgIC8vaGFjayBmb3IgUGhhbnRvbUpTMgogICAgICAgICAgICAvL2NvbnNvbGUubG9nKCdTWU1CT0w6ICcsIGNoYW5nZXNbaV0pOwogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KCiAgICAgICAgICAvL2xldCBvbGRWYWx1ZSA9IGNoYW5nZXNbaV0ub2xkVmFsdWU7CiAgICAgICAgICB2YXIgbmV3VmFsdWUgPSBvYmpbY2hhbmdlc1tpXS5uYW1lXTsKICAgICAgICAgIGlmIChjaGFuZ2VzW2ldLnR5cGUgPT09ICd1cGRhdGUnKSB7CiAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudCh7CiAgICAgICAgICAgICAgY1R5cGU6IENoYW5nZVR5cGUuVVBEQVRFLAogICAgICAgICAgICAgIG9UeXBlOiBvYmpUeXBlLAogICAgICAgICAgICAgIGZpZWxkOiBmaWVsZFN0cmluZywKICAgICAgICAgICAgICBkYXRhOiAoMCwgX3V0aWxzVXRpbHNKcy5kZWVwQ2xvbmUpKG5ld1ZhbHVlKQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoY2hhbmdlc1tpXS50eXBlID09PSAnYWRkJykgewogICAgICAgICAgICB0aGlzLl9pbnRlcm5hbE9ic2VydmUoZmllbGQsIG5ld1ZhbHVlKTsKICAgICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KHsKICAgICAgICAgICAgICBjVHlwZTogQ2hhbmdlVHlwZS5BREQsCiAgICAgICAgICAgICAgb1R5cGU6IG9ialR5cGUsCiAgICAgICAgICAgICAgZmllbGQ6IGZpZWxkU3RyaW5nLAogICAgICAgICAgICAgIGRhdGE6ICgwLCBfdXRpbHNVdGlsc0pzLmRlZXBDbG9uZSkobmV3VmFsdWUpCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChjaGFuZ2VzW2ldLnR5cGUgPT09ICdkZWxldGUnKSB7CiAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudCh7CiAgICAgICAgICAgICAgY1R5cGU6IENoYW5nZVR5cGUuUkVNT1ZFLAogICAgICAgICAgICAgIG9UeXBlOiBvYmpUeXBlLAogICAgICAgICAgICAgIGZpZWxkOiBmaWVsZFN0cmluZwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICdkYXRhJywKICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICByZXR1cm4gdGhpcy5fZGF0YTsKICAgIH0KICB9XSk7CgogIHJldHVybiBTeW5jT2JqZWN0Owp9KSgpOwoKdmFyIFBhdGggPSAoZnVuY3Rpb24gKCkgewogIGZ1bmN0aW9uIFBhdGgoKSB7CiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgUGF0aCk7CgogICAgdGhpcy5fcGF0aCA9IFtdOwogICAgdGhpcy5fb2JzZXJ2YWJsZXMgPSB7fTsgLy88aW5kZXg6QXJyYXlJbmRleD4KICB9CgogIF9jcmVhdGVDbGFzcyhQYXRoLCBbewogICAga2V5OiAncmVtb3ZlSW5kZXgnLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbW92ZUluZGV4KGlkeCkgewogICAgICAvL2NvbnNvbGUubG9nKCdSRU1PVkUtUEFUSCAnICsgaWR4KTsKICAgICAgZGVsZXRlIHRoaXMuX29ic2VydmFibGVzW2lkeF07CiAgICB9CiAgfSwgewogICAga2V5OiAncmVJbmRleEZyb20nLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlSW5kZXhGcm9tKGFycmF5KSB7CiAgICAgIHZhciBfdGhpczMgPSB0aGlzOwoKICAgICAgT2JqZWN0LmtleXModGhpcy5fb2JzZXJ2YWJsZXMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgICAgIHZhciBhcnJheUluZGV4ID0gX3RoaXMzLl9vYnNlcnZhYmxlc1trZXldOwogICAgICAgIHZhciBpZHggPSBhcnJheS5pbmRleE9mKGFycmF5SW5kZXgub2JqKTsKICAgICAgICBpZiAoYXJyYXlJbmRleC5pZHggIT0gaWR4KSB7CiAgICAgICAgICAvL2NvbnNvbGUubG9nKCdSRS1JTkRFWDogJyArIGtleSArICctPicgKyBpZHgpOwogICAgICAgICAgYXJyYXlJbmRleC5pZHggPSBpZHg7CiAgICAgICAgICBkZWxldGUgX3RoaXMzLl9vYnNlcnZhYmxlc1trZXldOwogICAgICAgICAgX3RoaXMzLl9vYnNlcnZhYmxlc1tpZHhdID0gYXJyYXlJbmRleDsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogJ25ldycsCiAgICB2YWx1ZTogZnVuY3Rpb24gX25ldyhpZHgpIHsKICAgICAgaWYgKGlkeC5jb25zdHJ1Y3RvciA9PSBBcnJheUluZGV4KSB7CiAgICAgICAgLy9jb25zb2xlLmxvZygnUEFUSC1PQlNFUlY6ICcsIGlkeCk7CiAgICAgICAgdGhpcy5fb2JzZXJ2YWJsZXNbaWR4LmlkeF0gPSBpZHg7CiAgICAgIH0KCiAgICAgIHZhciBuUGF0aCA9IHRoaXMuY2xvbmUoKTsKICAgICAgblBhdGguX3BhdGgucHVzaChpZHgpOwoKICAgICAgcmV0dXJuIG5QYXRoOwogICAgfQogIH0sIHsKICAgIGtleTogJ2Nsb25lJywKICAgIHZhbHVlOiBmdW5jdGlvbiBjbG9uZSgpIHsKICAgICAgdmFyIG5QYXRoID0gbmV3IFBhdGgoKTsKICAgICAgdGhpcy5fcGF0aC5mb3JFYWNoKGZ1bmN0aW9uICh2YWx1ZSkgewogICAgICAgIG5QYXRoLl9wYXRoLnB1c2godmFsdWUpOwogICAgICB9KTsKCiAgICAgIHJldHVybiBuUGF0aDsKICAgIH0KICB9LCB7CiAgICBrZXk6ICd0b1N0cmluZycsCiAgICB2YWx1ZTogZnVuY3Rpb24gdG9TdHJpbmcoKSB7CiAgICAgIC8vVE9ETzogb3B0aW1pemUhIQogICAgICB2YXIgc3RyID0gJyc7CiAgICAgIHRoaXMuX3BhdGguZm9yRWFjaChmdW5jdGlvbiAodmFsdWUsIGluZGV4KSB7CiAgICAgICAgaWYgKGluZGV4ID09PSAwKSB7CiAgICAgICAgICBzdHIgPSB2YWx1ZS50b1N0cmluZygpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBzdHIgKz0gJy4nICsgdmFsdWUudG9TdHJpbmcoKTsKICAgICAgICB9CiAgICAgIH0pOwoKICAgICAgcmV0dXJuIHN0cjsKICAgIH0KICB9XSk7CgogIHJldHVybiBQYXRoOwp9KSgpOwoKdmFyIEFycmF5SW5kZXggPSAoZnVuY3Rpb24gKCkgewogIGZ1bmN0aW9uIEFycmF5SW5kZXgob2JqLCBpZHgpIHsKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBBcnJheUluZGV4KTsKCiAgICB0aGlzLm9iaiA9IG9iajsKICAgIHRoaXMuaWR4ID0gaWR4OwogIH0KCiAgX2NyZWF0ZUNsYXNzKEFycmF5SW5kZXgsIFt7CiAgICBrZXk6ICd0b1N0cmluZycsCiAgICB2YWx1ZTogZnVuY3Rpb24gdG9TdHJpbmcoKSB7CiAgICAgIHJldHVybiB0aGlzLmlkeC50b1N0cmluZygpOwogICAgfQogIH1dKTsKCiAgcmV0dXJuIEFycmF5SW5kZXg7Cn0pKCk7Cgp2YXIgQ2hhbmdlVHlwZSA9IHsgVVBEQVRFOiAndXBkYXRlJywgQUREOiAnYWRkJywgUkVNT1ZFOiAncmVtb3ZlJyB9OwpleHBvcnRzLkNoYW5nZVR5cGUgPSBDaGFuZ2VUeXBlOwp2YXIgT2JqZWN0VHlwZSA9IHsgT0JKRUNUOiAnb2JqZWN0JywgQVJSQVk6ICdhcnJheScgfTsKZXhwb3J0cy5PYmplY3RUeXBlID0gT2JqZWN0VHlwZTsKZXhwb3J0c1snZGVmYXVsdCddID0gU3luY09iamVjdDsKCn0seyIuLi91dGlscy91dGlscy5qcyI6MjR9XSwyMjpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Cid1c2Ugc3RyaWN0JzsKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsKICB2YWx1ZTogdHJ1ZQp9KTsKCnZhciBfY3JlYXRlQ2xhc3MgPSAoZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKCd2YWx1ZScgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9IHJldHVybiBmdW5jdGlvbiAoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH07IH0pKCk7CgpmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyAnZGVmYXVsdCc6IG9iaiB9OyB9CgpmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoJ0Nhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbicpOyB9IH0KCnZhciBfRGF0YU9iamVjdFJlcG9ydGVyID0gcmVxdWlyZSgnLi9EYXRhT2JqZWN0UmVwb3J0ZXInKTsKCnZhciBfRGF0YU9iamVjdFJlcG9ydGVyMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX0RhdGFPYmplY3RSZXBvcnRlcik7Cgp2YXIgX0RhdGFPYmplY3RPYnNlcnZlciA9IHJlcXVpcmUoJy4vRGF0YU9iamVjdE9ic2VydmVyJyk7Cgp2YXIgX0RhdGFPYmplY3RPYnNlcnZlcjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9EYXRhT2JqZWN0T2JzZXJ2ZXIpOwoKLyoqCiAqIEBhdXRob3IgbWljYWVscGVkcm9zYUBnbWFpbC5jb20KICogQ2xpZW50IEFQSSBTeW5jcm9uaXphdGlvbiBzeXN0ZW0uCiAqLwoKdmFyIFN5bmNoZXIgPSAoZnVuY3Rpb24gKCkgewogIC8qIHByaXZhdGUKICBfb3duZXI6IFVSTAogIF9idXM6IE1pbmlCdXMKICAgX3N1YlVSTDogVVJMCiAgIF9yZXBvcnRlcnM6IDx1cmw6IERhdGFPYmplY3RSZXBvcnRlcj4KICBfb2JzZXJ2ZXJzOiA8dXJsOiBEYXRhT2JqZWN0T2JzZXJ2ZXI+CiAgIC0tLS1ldmVudCBoYW5kbGVycy0tLS0KICBfb25SZXNwb25zZUhhbmRsZXI6IChldmVudCkgPT4gdm9pZAogIF9vbk5vdGlmaWNhdGlvbkhhbmRsZXI6IChldmVudCkgPT4gdm9pZAogICovCgogIGZ1bmN0aW9uIFN5bmNoZXIob3duZXIsIGJ1cywgY29uZmlnKSB7CiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgU3luY2hlcik7CgogICAgdmFyIF90aGlzID0gdGhpczsKCiAgICBfdGhpcy5fb3duZXIgPSBvd25lcjsKICAgIF90aGlzLl9idXMgPSBidXM7CgogICAgX3RoaXMuX3N1YlVSTCA9IGNvbmZpZy5ydW50aW1lVVJMICsgJy9zbSc7CgogICAgX3RoaXMuX3JlcG9ydGVycyA9IHt9OwogICAgX3RoaXMuX29ic2VydmVycyA9IHt9OwoKICAgIGJ1cy5hZGRMaXN0ZW5lcihvd25lciwgZnVuY3Rpb24gKG1zZykgewogICAgICBjb25zb2xlLmxvZygnU3luY2hlci1SQ1Y6ICcsIG1zZyk7CiAgICAgIHN3aXRjaCAobXNnLnR5cGUpIHsKICAgICAgICBjYXNlICdyZXNwb25zZSc6CiAgICAgICAgICBfdGhpcy5fb25SZXNwb25zZShtc2cpO2JyZWFrOwogICAgICAgIGNhc2UgJ2ZvcndhcmQnOgogICAgICAgICAgX3RoaXMuX29uRm9yd2FyZChtc2cpO2JyZWFrOwogICAgICAgIGNhc2UgJ2NyZWF0ZSc6CiAgICAgICAgICBfdGhpcy5fb25DcmVhdGUobXNnKTticmVhazsKICAgICAgICBjYXNlICd1cGRhdGUnOgogICAgICAgICAgX3RoaXMuX29uQ2hhbmdlKG1zZyk7YnJlYWs7CiAgICAgICAgY2FzZSAnYWRkJzoKICAgICAgICAgIF90aGlzLl9vbkNoYW5nZShtc2cpO2JyZWFrOwogICAgICAgIGNhc2UgJ3JlbW92ZSc6CiAgICAgICAgICBfdGhpcy5fb25DaGFuZ2UobXNnKTticmVhazsKICAgICAgfQogICAgfSk7CiAgfQoKICBfY3JlYXRlQ2xhc3MoU3luY2hlciwgW3sKICAgIGtleTogJ2NyZWF0ZScsCgogICAgLyoqCiAgICAgKiBSZXF1ZXN0IGEgRGF0YU9iamVjdFJlcG9ydGVyIGNyZWF0aW9uLiBUaGUgVVJMIHdpbGwgYmUgYmUgcmVxdWVzdGVkIGJ5IHRoZSBhbGxvY2F0aW9uIG1lY2hhbmlzbS4KICAgICAqIEBwYXJhbSAge1NjaGVtYX0gc2NoZW1hIFNjaGVtYSBvZiB0aGUgb2JqZWN0CiAgICAgKiBAcGFyYW0gIHtIeXBlcnR5VVJMW119IExpc3Qgb2YgaHlwZXJ0aWVzIHRvIHNlbmQgdGhlIGNyZWF0ZQogICAgICogQHBhcmFtICB7SlNPTn0gaW5pdGlhbERhdGEgT2JqZWN0IGluaXRpYWwgZGF0YQogICAgICogQHJldHVybiB7UHJvbWlzZTxEYXRhT2JqZWN0UmVwb3J0ZXI+fSBSZXR1cm4gUHJvbWlzZSB0byBhIG5ldyBSZXBvcnRlci4gVGhlIHJlcG9ydGVyIGNhbiBiZSBhY2NlcHRlZCBvciByZWplY3RlZCBieSB0aGUgUEVQCiAgICAgKi8KICAgIHZhbHVlOiBmdW5jdGlvbiBjcmVhdGUoc2NoZW1hLCBvYnNlcnZlcnMsIGluaXRpYWxEYXRhKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICAvL1RPRE86IHdoYXQgdG8gZG8gd2l0aCBzY2hlbWE/CgogICAgICB2YXIgcmVxdWVzdE1zZyA9IHsKICAgICAgICB0eXBlOiAnY3JlYXRlJywgZnJvbTogX3RoaXMuX293bmVyLCB0bzogX3RoaXMuX3N1YlVSTCwKICAgICAgICBib2R5OiB7IHNjaGVtYTogc2NoZW1hLCB2YWx1ZTogaW5pdGlhbERhdGEsIGF1dGhvcmlzZTogb2JzZXJ2ZXJzIH0KICAgICAgfTsKCiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgLy9yZXF1ZXN0IGNyZWF0ZSB0byB0aGUgQWxsb2NhdGlvbiBzeXN0ZW0/IENhbiBiZSByZWplY3RlZCBieSB0aGUgUG9saWN5RW5naW5lLgogICAgICAgIF90aGlzLl9idXMucG9zdE1lc3NhZ2UocmVxdWVzdE1zZywgZnVuY3Rpb24gKHJlcGx5KSB7CiAgICAgICAgICBjb25zb2xlLmxvZygnY3JlYXRlLXJlc3BvbnNlOiAnLCByZXBseSk7CiAgICAgICAgICBpZiAocmVwbHkuYm9keS5jb2RlID09PSAyMDApIHsKICAgICAgICAgICAgdmFyIG9ialVybCA9IHJlcGx5LmJvZHkucmVzb3VyY2U7CgogICAgICAgICAgICAvL3JlcG9ydGVyIGNyZWF0aW9uIGFjY2VwdGVkCiAgICAgICAgICAgIHZhciBuZXdPYmogPSBuZXcgX0RhdGFPYmplY3RSZXBvcnRlcjJbJ2RlZmF1bHQnXShfdGhpcy5fb3duZXIsIG9ialVybCwgc2NoZW1hLCBfdGhpcy5fYnVzLCAnb24nLCBpbml0aWFsRGF0YSk7CiAgICAgICAgICAgIF90aGlzLl9yZXBvcnRlcnNbb2JqVXJsXSA9IG5ld09iajsKICAgICAgICAgICAgcmVzb2x2ZShuZXdPYmopOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy9yZXBvcnRlciBjcmVhdGlvbiByZWplY3RlZAogICAgICAgICAgICByZWplY3QocmVwbHkuYm9keS5kZXNjKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXF1ZXN0IGEgc3Vic2NyaXB0aW9uIHRvIGFuIGV4aXN0ZW50IG9iamVjdC4KICAgICAqIEBwYXJhbSAge09iamVjdFVSTH0gb2JqVVJMIEFkZHJlc3Mgb2YgdGhlIGV4aXN0ZW50IG9iamVjdC4KICAgICAqIEByZXR1cm4ge1Byb21pc2U8RGF0YU9iamVjdE9ic2VydmVyPn0gUmV0dXJuIFByb21pc2UgdG8gYSBuZXcgT2JzZXJ2ZXIuCiAgICAgKi8KICB9LCB7CiAgICBrZXk6ICdzdWJzY3JpYmUnLAogICAgdmFsdWU6IGZ1bmN0aW9uIHN1YnNjcmliZShvYmpVUkwpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgdmFyIG9ialN1YnNjcmlwdG9yVVJMID0gb2JqVVJMICsgJy9zdWJzY3JpcHRpb24nOwoKICAgICAgLy9UT0RPOiB2YWxpZGF0ZSBpZiBzdWJzY3JpcHRpb24gYWxyZWFkeSBleGlzdHMgPwogICAgICAvL1RPRE86IHJlbW92ZSBmcm9tIGJvZHkgaHlwZXJ0eVVSTCAod2FzIGFkZGVkIGJlY2F1c2UgdGhlIFBvbGljeUVuZ2luZSkKICAgICAgdmFyIHN1YnNjcmliZU1zZyA9IHsKICAgICAgICB0eXBlOiAnc3Vic2NyaWJlJywgZnJvbTogX3RoaXMuX293bmVyLCB0bzogb2JqU3Vic2NyaXB0b3JVUkwKICAgICAgfTsKCiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgLy9yZXF1ZXN0IHN1YnNjcmlwdGlvbgogICAgICAgIF90aGlzLl9idXMucG9zdE1lc3NhZ2Uoc3Vic2NyaWJlTXNnLCBmdW5jdGlvbiAocmVwbHkpIHsKICAgICAgICAgIGNvbnNvbGUubG9nKCdzdWJzY3JpYmUtcmVzcG9uc2U6ICcsIHJlcGx5KTsKICAgICAgICAgIGlmIChyZXBseS5ib2R5LmNvZGUgPT09IDIwMCkgewogICAgICAgICAgICAvL3N1YnNjcmlwdGlvbiBhY2NlcHRlZAogICAgICAgICAgICB2YXIgbmV3T2JqID0gX3RoaXMuX2FkZE9ic2VydmVyKG9ialVSTCwgcmVwbHkuYm9keS5zY2hlbWEsIHJlcGx5LmJvZHkudmFsdWUpOwogICAgICAgICAgICByZXNvbHZlKG5ld09iaik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvL3N1YnNjcmlwdGlvbiByZWplY3RlZAogICAgICAgICAgICByZWplY3QocmVwbHkuYm9keS5kZXNjKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAnb25SZXNwb25zZScsCiAgICB2YWx1ZTogZnVuY3Rpb24gb25SZXNwb25zZShjYWxsYmFjaykgewogICAgICB0aGlzLl9vblJlc3BvbnNlSGFuZGxlciA9IGNhbGxiYWNrOwogICAgfQogIH0sIHsKICAgIGtleTogJ29uTm90aWZpY2F0aW9uJywKICAgIHZhbHVlOiBmdW5jdGlvbiBvbk5vdGlmaWNhdGlvbihjYWxsYmFjaykgewogICAgICB0aGlzLl9vbk5vdGlmaWNhdGlvbkhhbmRsZXIgPSBjYWxsYmFjazsKICAgIH0KICB9LCB7CiAgICBrZXk6ICdfb25SZXNwb25zZScsCiAgICB2YWx1ZTogZnVuY3Rpb24gX29uUmVzcG9uc2UobXNnKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICAvL1RPRE86IHByb2Nlc3Mgbm90aWZpY2F0aW9uIHJlcG9uc2VzIQogICAgICBjb25zb2xlLmxvZygnb25SZXNwb25zZTonLCBtc2cpOwogICAgfQogIH0sIHsKICAgIGtleTogJ19vbkZvcndhcmQnLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9vbkZvcndhcmQobXNnKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICB2YXIgcmVwb3J0ZXIgPSBfdGhpcy5fcmVwb3J0ZXJzW21zZy5ib2R5LnRvXTsKICAgICAgcmVwb3J0ZXIuX29uRm9yd2FyZChtc2cpOwogICAgfQogIH0sIHsKICAgIGtleTogJ19vbkNyZWF0ZScsCiAgICB2YWx1ZTogZnVuY3Rpb24gX29uQ3JlYXRlKG1zZykgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgdmFyIGV2ZW50ID0gewogICAgICAgIHR5cGU6IG1zZy50eXBlLAogICAgICAgIGZyb206IG1zZy5mcm9tLAogICAgICAgIHVybDogbXNnLmJvZHkucmVzb3VyY2UsCiAgICAgICAgc2NoZW1hOiBtc2cuYm9keS5zY2hlbWEsCiAgICAgICAgdmFsdWU6IG1zZy5ib2R5LnZhbHVlLAoKICAgICAgICBhY2s6IGZ1bmN0aW9uIGFjaygpIHsKICAgICAgICAgIC8vc2VuZCBhY2sgcmVzcG9uc2UgbWVzc2FnZQogICAgICAgICAgX3RoaXMuX2J1cy5wb3N0TWVzc2FnZSh7CiAgICAgICAgICAgIGlkOiBtc2cuaWQsIHR5cGU6ICdyZXNwb25zZScsIGZyb206IG1zZy50bywgdG86IG1zZy5mcm9tLAogICAgICAgICAgICBib2R5OiB7IGNvZGU6IDIwMCB9CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH07CgogICAgICBpZiAoX3RoaXMuX29uTm90aWZpY2F0aW9uSGFuZGxlcikgewogICAgICAgIF90aGlzLl9vbk5vdGlmaWNhdGlvbkhhbmRsZXIoZXZlbnQpOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAnX29uQ2hhbmdlJywKICAgIHZhbHVlOiBmdW5jdGlvbiBfb25DaGFuZ2UobXNnKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICB2YXIgb2JzZXJ2ZXIgPSBfdGhpcy5fb2JzZXJ2ZXJzW21zZy5mcm9tXTsKICAgICAgb2JzZXJ2ZXIuX2NoYW5nZU9iamVjdChtc2cpOwogICAgfQogIH0sIHsKICAgIGtleTogJ19hZGRPYnNlcnZlcicsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2FkZE9ic2VydmVyKG9ialVSTCwgc2NoZW1hVVJMLCBpbml0aWFsRGF0YSkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgdmFyIG5ld09iaiA9IG5ldyBfRGF0YU9iamVjdE9ic2VydmVyMlsnZGVmYXVsdCddKF90aGlzLl9vd25lciwgb2JqVVJMLCBzY2hlbWFVUkwsICdvbicsIGluaXRpYWxEYXRhKTsKICAgICAgX3RoaXMuX29ic2VydmVyc1tvYmpVUkxdID0gbmV3T2JqOwoKICAgICAgcmV0dXJuIG5ld09iajsKICAgIH0KICB9LCB7CiAgICBrZXk6ICdvd25lcicsCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgcmV0dXJuIHRoaXMuX293bmVyOwogICAgfQogIH0sIHsKICAgIGtleTogJ3JlcG9ydGVycycsCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgcmV0dXJuIHRoaXMuX3JlcG9ydGVyczsKICAgIH0KICB9LCB7CiAgICBrZXk6ICdvYnNlcnZlcnMnLAogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgIHJldHVybiB0aGlzLl9vYnNlcnZlcnM7CiAgICB9CiAgfV0pOwoKICByZXR1cm4gU3luY2hlcjsKfSkoKTsKCmV4cG9ydHNbJ2RlZmF1bHQnXSA9IFN5bmNoZXI7Cm1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1snZGVmYXVsdCddOwoKfSx7Ii4vRGF0YU9iamVjdE9ic2VydmVyIjoxOSwiLi9EYXRhT2JqZWN0UmVwb3J0ZXIiOjIwfV0sMjM6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewovKioKICogRXZlbnRFbWl0dGVyCiAqIEFsbCBjbGFzc2VzIHdoaWNoIGV4dGVuZHMgdGhpcywgY2FuIGhhdmUgYWRkRXZlbnRMaXN0ZW5lciBhbmQgdHJpZ2dlciBldmVudHM7CiAqLwoidXNlIHN0cmljdCI7CgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgdmFsdWU6IHRydWUKfSk7Cgp2YXIgX2NyZWF0ZUNsYXNzID0gKGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfSByZXR1cm4gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9OyB9KSgpOwoKZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTsgfSB9Cgp2YXIgRXZlbnRFbWl0dGVyID0gKGZ1bmN0aW9uICgpIHsKICBmdW5jdGlvbiBFdmVudEVtaXR0ZXIoKSB7CiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgRXZlbnRFbWl0dGVyKTsKICB9CgogIF9jcmVhdGVDbGFzcyhFdmVudEVtaXR0ZXIsIFt7CiAgICBrZXk6ICJhZGRFdmVudExpc3RlbmVyIiwKCiAgICAvKioKICAgICAqIGFkZEV2ZW50TGlzdGVuZXIgbGlzdGVuIGZvciBhbiBldmVudFR5cGUKICAgICAqIEBwYXJhbSAge3N0cmluZ30gICAgICAgICBldmVudFR5cGUgLSBsaXN0ZW5pbmcgZm9yIHRoaXMgdHlwZSBvZiBldmVudAogICAgICogQHBhcmFtICB7RnVuY3Rpb259ICAgICAgIGNiICAgICAgICAtIGNhbGxiYWNrIGZ1bmN0aW9uIHdpbGwgYmUgZXhlY3V0ZWQgd2hlbiB0aGUgZXZlbnQgaXQgaXMgaW52b2tlZAogICAgICovCiAgICB2YWx1ZTogZnVuY3Rpb24gYWRkRXZlbnRMaXN0ZW5lcihldmVudFR5cGUsIGNiKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgIF90aGlzW2V2ZW50VHlwZV0gPSBjYjsKICAgIH0KCiAgICAvKioKICAgICAqIEludm9rZSB0aGUgZXZlbnRUeXBlCiAgICAgKiBAcGFyYW0gIHtzdHJpbmd9IGV2ZW50VHlwZSAtIGV2ZW50IHdpbGwgYmUgaW52b2tlZAogICAgICogQHBhcmFtICB7b2JqZWN0fSBwYXJhbXMgLSBwYXJhbWV0ZXJzIHdpbGwgYmUgcGFzc2VkIHRvIHRoZSBhZGRFdmVudExpc3RlbmVyCiAgICAgKi8KICB9LCB7CiAgICBrZXk6ICJ0cmlnZ2VyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiB0cmlnZ2VyKGV2ZW50VHlwZSwgcGFyYW1zKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICBpZiAoX3RoaXNbZXZlbnRUeXBlXSkgewogICAgICAgIF90aGlzW2V2ZW50VHlwZV0ocGFyYW1zKTsKICAgICAgfQogICAgfQogIH1dKTsKCiAgcmV0dXJuIEV2ZW50RW1pdHRlcjsKfSkoKTsKCmV4cG9ydHNbImRlZmF1bHQiXSA9IEV2ZW50RW1pdHRlcjsKbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWyJkZWZhdWx0Il07Cgp9LHt9XSwyNDpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Ci8qKgogKiBTdXBwb3J0IG1vZHVsZSB3aXRoIHNvbWUgZnVuY3Rpb25zIHdpbGwgYmUgdXNlZnVsCiAqIEBtb2R1bGUgdXRpbHMKICovCgovKioKICogQHR5cGVkZWYgZGl2aWRlVVJMCiAqIEB0eXBlIE9iamVjdAogKiBAcHJvcGVydHkge3N0cmluZ30gdHlwZSBUaGUgdHlwZSBvZiBVUkwKICogQHByb3BlcnR5IHtzdHJpbmd9IGRvbWFpbiBUaGUgZG9tYWluIG9mIFVSTAogKiBAcHJvcGVydHkge3N0cmluZ30gaWRlbnRpdHkgVGhlIGlkZW50aXR5IG9mIFVSTAogKi8KCi8qKgogKiBEaXZpZGUgYW4gdXJsIGluIHR5cGUsIGRvbWFpbiBhbmQgaWRlbnRpdHkKICogQHBhcmFtICB7VVJMLlVSTH0gdXJsIC0gdXJsIGFkZHJlc3MKICogQHJldHVybiB7ZGl2aWRlVVJMfSB0aGUgcmVzdWx0IG9mIGRpdmlkZVVSTAogKi8KJ3VzZSBzdHJpY3QnOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLmRpdmlkZVVSTCA9IGRpdmlkZVVSTDsKZXhwb3J0cy5kZWVwQ2xvbmUgPSBkZWVwQ2xvbmU7CgpmdW5jdGlvbiBkaXZpZGVVUkwodXJsKSB7CgogIC8vIGxldCByZSA9IC8oW2EtekEtWi1dKik/OlwvXC8oPzpcLik/KFstYS16QS1aMC05QDolLl9cK34jPV17MiwyNTZ9XC5bYS16XXsyLDZ9XGIpKihcL1tcL1xkXHdcLi1dKikqKD86W1w/XSkqKC4rKSovZ2k7CiAgdmFyIHJlID0gLyhbYS16QS1aLV0qKTpcL1wvKD86XC4pPyhbLWEtekEtWjAtOUA6JS5fXCt+Iz1dezIsMjU2fSkoWy1hLXpBLVowLTlAOiUuX1wrfiM9XC9dKikvZ2k7CiAgdmFyIHN1YnN0ID0gJyQxLCQyLCQzJzsKICB2YXIgcGFydHMgPSB1cmwucmVwbGFjZShyZSwgc3Vic3QpLnNwbGl0KCcsJyk7CiAgdmFyIHJlc3VsdCA9IHsKICAgIHR5cGU6IHBhcnRzWzBdLAogICAgZG9tYWluOiBwYXJ0c1sxXSwKICAgIGlkZW50aXR5OiBwYXJ0c1syXQogIH07CgogIHJldHVybiByZXN1bHQ7Cn0KCi8qKgogKiBNYWtlIGEgQ09QWSBvZiB0aGUgb3JpZ2luYWwgZGF0YQogKiBAcGFyYW0gIHtPYmplY3R9ICBvYmogLSBvYmplY3QgdG8gYmUgY2xvbmVkCiAqIEByZXR1cm4ge09iamVjdH0KICovCgpmdW5jdGlvbiBkZWVwQ2xvbmUob2JqKSB7CiAgLy9UT0RPOiBzaW1wbGUgYnV0IGluZWZmaWNpZW50IEpTT04gZGVlcCBjbG9uZS4uLgogIHJldHVybiBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KG9iaikpOwp9Cgp9LHt9XX0se30sWzNdKSgzKQp9KTs=",
      "sourceCodeClassname": "HelloHyperty",
      "encoding": "Base64",
      "signature": ""
    },
    "language": "Javascript ECMA5",
    "signature": "",
    "messageSchemas": "",
    "configuration": "",
    "constraints": "",
    "hypertyCapabilities": "",
    "protocolCapabilities": "",
    "policies": "",
    "dataObjects": []
  },
  "WorldHyperty": {
    "cguid": "2",
    "type": "0",
    "version": "0.1",
    "description": "description of World Hyperty",
    "objectName": "WorldHyperty",
    "sourcePackageURL": "/sourcePackage",
    "sourcePackage": {},
    "language": "Javascript ECMA5",
    "signature": "",
    "messageSchemas": "",
    "configuration": "",
    "constraints": "",
    "hypertyCapabilities": "",
    "protocolCapabilities": "",
    "policies": "",
    "dataObjects": []
  },
  "HypertyChat": {
    "sourcePackage": {
      "sourceCode": "KGZ1bmN0aW9uKGYpe2lmKHR5cGVvZiBleHBvcnRzPT09Im9iamVjdCImJnR5cGVvZiBtb2R1bGUhPT0idW5kZWZpbmVkIil7bW9kdWxlLmV4cG9ydHM9ZigpfWVsc2UgaWYodHlwZW9mIGRlZmluZT09PSJmdW5jdGlvbiImJmRlZmluZS5hbWQpe2RlZmluZShbXSxmKX1lbHNle3ZhciBnO2lmKHR5cGVvZiB3aW5kb3chPT0idW5kZWZpbmVkIil7Zz13aW5kb3d9ZWxzZSBpZih0eXBlb2YgZ2xvYmFsIT09InVuZGVmaW5lZCIpe2c9Z2xvYmFsfWVsc2UgaWYodHlwZW9mIHNlbGYhPT0idW5kZWZpbmVkIil7Zz1zZWxmfWVsc2V7Zz10aGlzfWcuYWN0aXZhdGUgPSBmKCl9fSkoZnVuY3Rpb24oKXt2YXIgZGVmaW5lLG1vZHVsZSxleHBvcnRzO3JldHVybiAoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PSJmdW5jdGlvbiImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoIkNhbm5vdCBmaW5kIG1vZHVsZSAnIitvKyInIik7dGhyb3cgZi5jb2RlPSJNT0RVTEVfTk9UX0ZPVU5EIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PSJmdW5jdGlvbiImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pKHsxOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKbW9kdWxlLmV4cG9ydHMgPSB7ICJkZWZhdWx0IjogcmVxdWlyZSgiY29yZS1qcy9saWJyYXJ5L2ZuL29iamVjdC9jcmVhdGUiKSwgX19lc01vZHVsZTogdHJ1ZSB9Owp9LHsiY29yZS1qcy9saWJyYXJ5L2ZuL29iamVjdC9jcmVhdGUiOjE4fV0sMjpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Cm1vZHVsZS5leHBvcnRzID0geyAiZGVmYXVsdCI6IHJlcXVpcmUoImNvcmUtanMvbGlicmFyeS9mbi9vYmplY3QvZGVmaW5lLXByb3BlcnR5IiksIF9fZXNNb2R1bGU6IHRydWUgfTsKfSx7ImNvcmUtanMvbGlicmFyeS9mbi9vYmplY3QvZGVmaW5lLXByb3BlcnR5IjoxOX1dLDM6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewptb2R1bGUuZXhwb3J0cyA9IHsgImRlZmF1bHQiOiByZXF1aXJlKCJjb3JlLWpzL2xpYnJhcnkvZm4vb2JqZWN0L2dldC1vd24tcHJvcGVydHktZGVzY3JpcHRvciIpLCBfX2VzTW9kdWxlOiB0cnVlIH07Cn0seyJjb3JlLWpzL2xpYnJhcnkvZm4vb2JqZWN0L2dldC1vd24tcHJvcGVydHktZGVzY3JpcHRvciI6MjB9XSw0OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKbW9kdWxlLmV4cG9ydHMgPSB7ICJkZWZhdWx0IjogcmVxdWlyZSgiY29yZS1qcy9saWJyYXJ5L2ZuL29iamVjdC9nZXQtcHJvdG90eXBlLW9mIiksIF9fZXNNb2R1bGU6IHRydWUgfTsKfSx7ImNvcmUtanMvbGlicmFyeS9mbi9vYmplY3QvZ2V0LXByb3RvdHlwZS1vZiI6MjF9XSw1OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKbW9kdWxlLmV4cG9ydHMgPSB7ICJkZWZhdWx0IjogcmVxdWlyZSgiY29yZS1qcy9saWJyYXJ5L2ZuL29iamVjdC9rZXlzIiksIF9fZXNNb2R1bGU6IHRydWUgfTsKfSx7ImNvcmUtanMvbGlicmFyeS9mbi9vYmplY3Qva2V5cyI6MjJ9XSw2OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKbW9kdWxlLmV4cG9ydHMgPSB7ICJkZWZhdWx0IjogcmVxdWlyZSgiY29yZS1qcy9saWJyYXJ5L2ZuL29iamVjdC9zZXQtcHJvdG90eXBlLW9mIiksIF9fZXNNb2R1bGU6IHRydWUgfTsKfSx7ImNvcmUtanMvbGlicmFyeS9mbi9vYmplY3Qvc2V0LXByb3RvdHlwZS1vZiI6MjN9XSw3OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKbW9kdWxlLmV4cG9ydHMgPSB7ICJkZWZhdWx0IjogcmVxdWlyZSgiY29yZS1qcy9saWJyYXJ5L2ZuL3Byb21pc2UiKSwgX19lc01vZHVsZTogdHJ1ZSB9Owp9LHsiY29yZS1qcy9saWJyYXJ5L2ZuL3Byb21pc2UiOjI0fV0sODpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Cm1vZHVsZS5leHBvcnRzID0geyAiZGVmYXVsdCI6IHJlcXVpcmUoImNvcmUtanMvbGlicmFyeS9mbi9zeW1ib2wiKSwgX19lc01vZHVsZTogdHJ1ZSB9Owp9LHsiY29yZS1qcy9saWJyYXJ5L2ZuL3N5bWJvbCI6MjV9XSw5OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKbW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKCIuL2NsYXNzQ2FsbENoZWNrLmpzIik7Cn0seyIuL2NsYXNzQ2FsbENoZWNrLmpzIjoxMH1dLDEwOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKInVzZSBzdHJpY3QiOwoKZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTsKCmV4cG9ydHMuZGVmYXVsdCA9IGZ1bmN0aW9uIChpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsKICBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgewogICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7CiAgfQp9Owp9LHt9XSwxMTpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Cm1vZHVsZS5leHBvcnRzID0gcmVxdWlyZSgiLi9jcmVhdGVDbGFzcy5qcyIpOwp9LHsiLi9jcmVhdGVDbGFzcy5qcyI6MTJ9XSwxMjpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7CiJ1c2Ugc3RyaWN0IjsKCmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7Cgp2YXIgX2RlZmluZVByb3BlcnR5ID0gcmVxdWlyZSgiLi4vY29yZS1qcy9vYmplY3QvZGVmaW5lLXByb3BlcnR5Iik7Cgp2YXIgX2RlZmluZVByb3BlcnR5MiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2RlZmluZVByb3BlcnR5KTsKCmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IGRlZmF1bHQ6IG9iaiB9OyB9CgpleHBvcnRzLmRlZmF1bHQgPSAoZnVuY3Rpb24gKCkgewogIGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgewogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgewogICAgICB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOwogICAgICBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7CiAgICAgIGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsKICAgICAgaWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7CiAgICAgICgwLCBfZGVmaW5lUHJvcGVydHkyLmRlZmF1bHQpKHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOwogICAgfQogIH0KCiAgcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsKICAgIGlmIChwcm90b1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7CiAgICBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsKICAgIHJldHVybiBDb25zdHJ1Y3RvcjsKICB9Owp9KSgpOwp9LHsiLi4vY29yZS1qcy9vYmplY3QvZGVmaW5lLXByb3BlcnR5IjoyfV0sMTM6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewoidXNlIHN0cmljdCI7CgpleHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlOwoKdmFyIF9nZXRQcm90b3R5cGVPZiA9IHJlcXVpcmUoIi4uL2NvcmUtanMvb2JqZWN0L2dldC1wcm90b3R5cGUtb2YiKTsKCnZhciBfZ2V0UHJvdG90eXBlT2YyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfZ2V0UHJvdG90eXBlT2YpOwoKdmFyIF9nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IgPSByZXF1aXJlKCIuLi9jb3JlLWpzL29iamVjdC9nZXQtb3duLXByb3BlcnR5LWRlc2NyaXB0b3IiKTsKCnZhciBfZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2dldE93blByb3BlcnR5RGVzY3JpcHRvcik7CgpmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyBkZWZhdWx0OiBvYmogfTsgfQoKZXhwb3J0cy5kZWZhdWx0ID0gZnVuY3Rpb24gZ2V0KG9iamVjdCwgcHJvcGVydHksIHJlY2VpdmVyKSB7CiAgaWYgKG9iamVjdCA9PT0gbnVsbCkgb2JqZWN0ID0gRnVuY3Rpb24ucHJvdG90eXBlOwogIHZhciBkZXNjID0gKDAsIF9nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IyLmRlZmF1bHQpKG9iamVjdCwgcHJvcGVydHkpOwoKICBpZiAoZGVzYyA9PT0gdW5kZWZpbmVkKSB7CiAgICB2YXIgcGFyZW50ID0gKDAsIF9nZXRQcm90b3R5cGVPZjIuZGVmYXVsdCkob2JqZWN0KTsKCiAgICBpZiAocGFyZW50ID09PSBudWxsKSB7CiAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gZ2V0KHBhcmVudCwgcHJvcGVydHksIHJlY2VpdmVyKTsKICAgIH0KICB9IGVsc2UgaWYgKCJ2YWx1ZSIgaW4gZGVzYykgewogICAgcmV0dXJuIGRlc2MudmFsdWU7CiAgfSBlbHNlIHsKICAgIHZhciBnZXR0ZXIgPSBkZXNjLmdldDsKCiAgICBpZiAoZ2V0dGVyID09PSB1bmRlZmluZWQpIHsKICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgIH0KCiAgICByZXR1cm4gZ2V0dGVyLmNhbGwocmVjZWl2ZXIpOwogIH0KfTsKfSx7Ii4uL2NvcmUtanMvb2JqZWN0L2dldC1vd24tcHJvcGVydHktZGVzY3JpcHRvciI6MywiLi4vY29yZS1qcy9vYmplY3QvZ2V0LXByb3RvdHlwZS1vZiI6NH1dLDE0OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKInVzZSBzdHJpY3QiOwoKZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTsKCnZhciBfc2V0UHJvdG90eXBlT2YgPSByZXF1aXJlKCIuLi9jb3JlLWpzL29iamVjdC9zZXQtcHJvdG90eXBlLW9mIik7Cgp2YXIgX3NldFByb3RvdHlwZU9mMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3NldFByb3RvdHlwZU9mKTsKCnZhciBfY3JlYXRlID0gcmVxdWlyZSgiLi4vY29yZS1qcy9vYmplY3QvY3JlYXRlIik7Cgp2YXIgX2NyZWF0ZTIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9jcmVhdGUpOwoKdmFyIF90eXBlb2YyID0gcmVxdWlyZSgiLi4vaGVscGVycy90eXBlb2YiKTsKCnZhciBfdHlwZW9mMyA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3R5cGVvZjIpOwoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgZGVmYXVsdDogb2JqIH07IH0KCmV4cG9ydHMuZGVmYXVsdCA9IGZ1bmN0aW9uIChzdWJDbGFzcywgc3VwZXJDbGFzcykgewogIGlmICh0eXBlb2Ygc3VwZXJDbGFzcyAhPT0gImZ1bmN0aW9uIiAmJiBzdXBlckNsYXNzICE9PSBudWxsKSB7CiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiwgbm90ICIgKyAodHlwZW9mIHN1cGVyQ2xhc3MgPT09ICJ1bmRlZmluZWQiID8gInVuZGVmaW5lZCIgOiAoMCwgX3R5cGVvZjMuZGVmYXVsdCkoc3VwZXJDbGFzcykpKTsKICB9CgogIHN1YkNsYXNzLnByb3RvdHlwZSA9ICgwLCBfY3JlYXRlMi5kZWZhdWx0KShzdXBlckNsYXNzICYmIHN1cGVyQ2xhc3MucHJvdG90eXBlLCB7CiAgICBjb25zdHJ1Y3RvcjogewogICAgICB2YWx1ZTogc3ViQ2xhc3MsCiAgICAgIGVudW1lcmFibGU6IGZhbHNlLAogICAgICB3cml0YWJsZTogdHJ1ZSwKICAgICAgY29uZmlndXJhYmxlOiB0cnVlCiAgICB9CiAgfSk7CiAgaWYgKHN1cGVyQ2xhc3MpIF9zZXRQcm90b3R5cGVPZjIuZGVmYXVsdCA/ICgwLCBfc2V0UHJvdG90eXBlT2YyLmRlZmF1bHQpKHN1YkNsYXNzLCBzdXBlckNsYXNzKSA6IHN1YkNsYXNzLl9fcHJvdG9fXyA9IHN1cGVyQ2xhc3M7Cn07Cn0seyIuLi9jb3JlLWpzL29iamVjdC9jcmVhdGUiOjEsIi4uL2NvcmUtanMvb2JqZWN0L3NldC1wcm90b3R5cGUtb2YiOjYsIi4uL2hlbHBlcnMvdHlwZW9mIjoxN31dLDE1OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKbW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKCIuL2ludGVyb3BSZXF1aXJlRGVmYXVsdC5qcyIpOwp9LHsiLi9pbnRlcm9wUmVxdWlyZURlZmF1bHQuanMiOjE2fV0sMTY6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewoidXNlIHN0cmljdCI7CgpleHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlOwoKZXhwb3J0cy5kZWZhdWx0ID0gZnVuY3Rpb24gKG9iaikgewogIHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7CiAgICBkZWZhdWx0OiBvYmoKICB9Owp9Owp9LHt9XSwxNzpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7CiJ1c2Ugc3RyaWN0IjsKCmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7Cgp2YXIgX3N5bWJvbCA9IHJlcXVpcmUoIi4uL2NvcmUtanMvc3ltYm9sIik7Cgp2YXIgX3N5bWJvbDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9zeW1ib2wpOwoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgZGVmYXVsdDogb2JqIH07IH0KCmZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7IHJldHVybiBvYmogJiYgdHlwZW9mIF9TeW1ib2wgIT09ICJ1bmRlZmluZWQiICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gX1N5bWJvbCA/ICJzeW1ib2wiIDogdHlwZW9mIG9iajsgfQoKZXhwb3J0cy5kZWZhdWx0ID0gZnVuY3Rpb24gKG9iaikgewogIHJldHVybiBvYmogJiYgdHlwZW9mIF9zeW1ib2wyLmRlZmF1bHQgIT09ICJ1bmRlZmluZWQiICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gX3N5bWJvbDIuZGVmYXVsdCA/ICJzeW1ib2wiIDogdHlwZW9mIG9iaiA9PT0gInVuZGVmaW5lZCIgPyAidW5kZWZpbmVkIiA6IF90eXBlb2Yob2JqKTsKfTsKfSx7Ii4uL2NvcmUtanMvc3ltYm9sIjo4fV0sMTg6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewp2YXIgJCA9IHJlcXVpcmUoJy4uLy4uL21vZHVsZXMvJCcpOwptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIGNyZWF0ZShQLCBEKXsKICByZXR1cm4gJC5jcmVhdGUoUCwgRCk7Cn07Cn0seyIuLi8uLi9tb2R1bGVzLyQiOjU2fV0sMTk6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewp2YXIgJCA9IHJlcXVpcmUoJy4uLy4uL21vZHVsZXMvJCcpOwptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIGRlZmluZVByb3BlcnR5KGl0LCBrZXksIGRlc2MpewogIHJldHVybiAkLnNldERlc2MoaXQsIGtleSwgZGVzYyk7Cn07Cn0seyIuLi8uLi9tb2R1bGVzLyQiOjU2fV0sMjA6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewp2YXIgJCA9IHJlcXVpcmUoJy4uLy4uL21vZHVsZXMvJCcpOwpyZXF1aXJlKCcuLi8uLi9tb2R1bGVzL2VzNi5vYmplY3QuZ2V0LW93bi1wcm9wZXJ0eS1kZXNjcmlwdG9yJyk7Cm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKGl0LCBrZXkpewogIHJldHVybiAkLmdldERlc2MoaXQsIGtleSk7Cn07Cn0seyIuLi8uLi9tb2R1bGVzLyQiOjU2LCIuLi8uLi9tb2R1bGVzL2VzNi5vYmplY3QuZ2V0LW93bi1wcm9wZXJ0eS1kZXNjcmlwdG9yIjo4MX1dLDIxOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKcmVxdWlyZSgnLi4vLi4vbW9kdWxlcy9lczYub2JqZWN0LmdldC1wcm90b3R5cGUtb2YnKTsKbW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKCcuLi8uLi9tb2R1bGVzLyQuY29yZScpLk9iamVjdC5nZXRQcm90b3R5cGVPZjsKfSx7Ii4uLy4uL21vZHVsZXMvJC5jb3JlIjozMSwiLi4vLi4vbW9kdWxlcy9lczYub2JqZWN0LmdldC1wcm90b3R5cGUtb2YiOjgyfV0sMjI6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewpyZXF1aXJlKCcuLi8uLi9tb2R1bGVzL2VzNi5vYmplY3Qua2V5cycpOwptb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoJy4uLy4uL21vZHVsZXMvJC5jb3JlJykuT2JqZWN0LmtleXM7Cn0seyIuLi8uLi9tb2R1bGVzLyQuY29yZSI6MzEsIi4uLy4uL21vZHVsZXMvZXM2Lm9iamVjdC5rZXlzIjo4M31dLDIzOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKcmVxdWlyZSgnLi4vLi4vbW9kdWxlcy9lczYub2JqZWN0LnNldC1wcm90b3R5cGUtb2YnKTsKbW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKCcuLi8uLi9tb2R1bGVzLyQuY29yZScpLk9iamVjdC5zZXRQcm90b3R5cGVPZjsKfSx7Ii4uLy4uL21vZHVsZXMvJC5jb3JlIjozMSwiLi4vLi4vbW9kdWxlcy9lczYub2JqZWN0LnNldC1wcm90b3R5cGUtb2YiOjg0fV0sMjQ6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewpyZXF1aXJlKCcuLi9tb2R1bGVzL2VzNi5vYmplY3QudG8tc3RyaW5nJyk7CnJlcXVpcmUoJy4uL21vZHVsZXMvZXM2LnN0cmluZy5pdGVyYXRvcicpOwpyZXF1aXJlKCcuLi9tb2R1bGVzL3dlYi5kb20uaXRlcmFibGUnKTsKcmVxdWlyZSgnLi4vbW9kdWxlcy9lczYucHJvbWlzZScpOwptb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoJy4uL21vZHVsZXMvJC5jb3JlJykuUHJvbWlzZTsKfSx7Ii4uL21vZHVsZXMvJC5jb3JlIjozMSwiLi4vbW9kdWxlcy9lczYub2JqZWN0LnRvLXN0cmluZyI6ODUsIi4uL21vZHVsZXMvZXM2LnByb21pc2UiOjg2LCIuLi9tb2R1bGVzL2VzNi5zdHJpbmcuaXRlcmF0b3IiOjg3LCIuLi9tb2R1bGVzL3dlYi5kb20uaXRlcmFibGUiOjg5fV0sMjU6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewpyZXF1aXJlKCcuLi8uLi9tb2R1bGVzL2VzNi5zeW1ib2wnKTsKcmVxdWlyZSgnLi4vLi4vbW9kdWxlcy9lczYub2JqZWN0LnRvLXN0cmluZycpOwptb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoJy4uLy4uL21vZHVsZXMvJC5jb3JlJykuU3ltYm9sOwp9LHsiLi4vLi4vbW9kdWxlcy8kLmNvcmUiOjMxLCIuLi8uLi9tb2R1bGVzL2VzNi5vYmplY3QudG8tc3RyaW5nIjo4NSwiLi4vLi4vbW9kdWxlcy9lczYuc3ltYm9sIjo4OH1dLDI2OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihpdCl7CiAgaWYodHlwZW9mIGl0ICE9ICdmdW5jdGlvbicpdGhyb3cgVHlwZUVycm9yKGl0ICsgJyBpcyBub3QgYSBmdW5jdGlvbiEnKTsKICByZXR1cm4gaXQ7Cn07Cn0se31dLDI3OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbigpeyAvKiBlbXB0eSAqLyB9Owp9LHt9XSwyODpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7CnZhciBpc09iamVjdCA9IHJlcXVpcmUoJy4vJC5pcy1vYmplY3QnKTsKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihpdCl7CiAgaWYoIWlzT2JqZWN0KGl0KSl0aHJvdyBUeXBlRXJyb3IoaXQgKyAnIGlzIG5vdCBhbiBvYmplY3QhJyk7CiAgcmV0dXJuIGl0Owp9Owp9LHsiLi8kLmlzLW9iamVjdCI6NDl9XSwyOTpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Ci8vIGdldHRpbmcgdGFnIGZyb20gMTkuMS4zLjYgT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZygpCnZhciBjb2YgPSByZXF1aXJlKCcuLyQuY29mJykKICAsIFRBRyA9IHJlcXVpcmUoJy4vJC53a3MnKSgndG9TdHJpbmdUYWcnKQogIC8vIEVTMyB3cm9uZyBoZXJlCiAgLCBBUkcgPSBjb2YoZnVuY3Rpb24oKXsgcmV0dXJuIGFyZ3VtZW50czsgfSgpKSA9PSAnQXJndW1lbnRzJzsKCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oaXQpewogIHZhciBPLCBULCBCOwogIHJldHVybiBpdCA9PT0gdW5kZWZpbmVkID8gJ1VuZGVmaW5lZCcgOiBpdCA9PT0gbnVsbCA/ICdOdWxsJwogICAgLy8gQEB0b1N0cmluZ1RhZyBjYXNlCiAgICA6IHR5cGVvZiAoVCA9IChPID0gT2JqZWN0KGl0KSlbVEFHXSkgPT0gJ3N0cmluZycgPyBUCiAgICAvLyBidWlsdGluVGFnIGNhc2UKICAgIDogQVJHID8gY29mKE8pCiAgICAvLyBFUzMgYXJndW1lbnRzIGZhbGxiYWNrCiAgICA6IChCID0gY29mKE8pKSA9PSAnT2JqZWN0JyAmJiB0eXBlb2YgTy5jYWxsZWUgPT0gJ2Z1bmN0aW9uJyA/ICdBcmd1bWVudHMnIDogQjsKfTsKfSx7Ii4vJC5jb2YiOjMwLCIuLyQud2tzIjo3OH1dLDMwOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKdmFyIHRvU3RyaW5nID0ge30udG9TdHJpbmc7Cgptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGl0KXsKICByZXR1cm4gdG9TdHJpbmcuY2FsbChpdCkuc2xpY2UoOCwgLTEpOwp9Owp9LHt9XSwzMTpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7CnZhciBjb3JlID0gbW9kdWxlLmV4cG9ydHMgPSB7dmVyc2lvbjogJzEuMi42J307CmlmKHR5cGVvZiBfX2UgPT0gJ251bWJlcicpX19lID0gY29yZTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby11bmRlZgp9LHt9XSwzMjpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Ci8vIG9wdGlvbmFsIC8gc2ltcGxlIGNvbnRleHQgYmluZGluZwp2YXIgYUZ1bmN0aW9uID0gcmVxdWlyZSgnLi8kLmEtZnVuY3Rpb24nKTsKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihmbiwgdGhhdCwgbGVuZ3RoKXsKICBhRnVuY3Rpb24oZm4pOwogIGlmKHRoYXQgPT09IHVuZGVmaW5lZClyZXR1cm4gZm47CiAgc3dpdGNoKGxlbmd0aCl7CiAgICBjYXNlIDE6IHJldHVybiBmdW5jdGlvbihhKXsKICAgICAgcmV0dXJuIGZuLmNhbGwodGhhdCwgYSk7CiAgICB9OwogICAgY2FzZSAyOiByZXR1cm4gZnVuY3Rpb24oYSwgYil7CiAgICAgIHJldHVybiBmbi5jYWxsKHRoYXQsIGEsIGIpOwogICAgfTsKICAgIGNhc2UgMzogcmV0dXJuIGZ1bmN0aW9uKGEsIGIsIGMpewogICAgICByZXR1cm4gZm4uY2FsbCh0aGF0LCBhLCBiLCBjKTsKICAgIH07CiAgfQogIHJldHVybiBmdW5jdGlvbigvKiAuLi5hcmdzICovKXsKICAgIHJldHVybiBmbi5hcHBseSh0aGF0LCBhcmd1bWVudHMpOwogIH07Cn07Cn0seyIuLyQuYS1mdW5jdGlvbiI6MjZ9XSwzMzpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Ci8vIDcuMi4xIFJlcXVpcmVPYmplY3RDb2VyY2libGUoYXJndW1lbnQpCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oaXQpewogIGlmKGl0ID09IHVuZGVmaW5lZCl0aHJvdyBUeXBlRXJyb3IoIkNhbid0IGNhbGwgbWV0aG9kIG9uICAiICsgaXQpOwogIHJldHVybiBpdDsKfTsKfSx7fV0sMzQ6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewovLyBUaGFuaydzIElFOCBmb3IgaGlzIGZ1bm55IGRlZmluZVByb3BlcnR5Cm1vZHVsZS5leHBvcnRzID0gIXJlcXVpcmUoJy4vJC5mYWlscycpKGZ1bmN0aW9uKCl7CiAgcmV0dXJuIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh7fSwgJ2EnLCB7Z2V0OiBmdW5jdGlvbigpeyByZXR1cm4gNzsgfX0pLmEgIT0gNzsKfSk7Cn0seyIuLyQuZmFpbHMiOjM4fV0sMzU6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewp2YXIgaXNPYmplY3QgPSByZXF1aXJlKCcuLyQuaXMtb2JqZWN0JykKICAsIGRvY3VtZW50ID0gcmVxdWlyZSgnLi8kLmdsb2JhbCcpLmRvY3VtZW50CiAgLy8gaW4gb2xkIElFIHR5cGVvZiBkb2N1bWVudC5jcmVhdGVFbGVtZW50IGlzICdvYmplY3QnCiAgLCBpcyA9IGlzT2JqZWN0KGRvY3VtZW50KSAmJiBpc09iamVjdChkb2N1bWVudC5jcmVhdGVFbGVtZW50KTsKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihpdCl7CiAgcmV0dXJuIGlzID8gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChpdCkgOiB7fTsKfTsKfSx7Ii4vJC5nbG9iYWwiOjQxLCIuLyQuaXMtb2JqZWN0Ijo0OX1dLDM2OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKLy8gYWxsIGVudW1lcmFibGUgb2JqZWN0IGtleXMsIGluY2x1ZGVzIHN5bWJvbHMKdmFyICQgPSByZXF1aXJlKCcuLyQnKTsKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihpdCl7CiAgdmFyIGtleXMgICAgICAgPSAkLmdldEtleXMoaXQpCiAgICAsIGdldFN5bWJvbHMgPSAkLmdldFN5bWJvbHM7CiAgaWYoZ2V0U3ltYm9scyl7CiAgICB2YXIgc3ltYm9scyA9IGdldFN5bWJvbHMoaXQpCiAgICAgICwgaXNFbnVtICA9ICQuaXNFbnVtCiAgICAgICwgaSAgICAgICA9IDAKICAgICAgLCBrZXk7CiAgICB3aGlsZShzeW1ib2xzLmxlbmd0aCA+IGkpaWYoaXNFbnVtLmNhbGwoaXQsIGtleSA9IHN5bWJvbHNbaSsrXSkpa2V5cy5wdXNoKGtleSk7CiAgfQogIHJldHVybiBrZXlzOwp9Owp9LHsiLi8kIjo1Nn1dLDM3OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKdmFyIGdsb2JhbCAgICA9IHJlcXVpcmUoJy4vJC5nbG9iYWwnKQogICwgY29yZSAgICAgID0gcmVxdWlyZSgnLi8kLmNvcmUnKQogICwgY3R4ICAgICAgID0gcmVxdWlyZSgnLi8kLmN0eCcpCiAgLCBQUk9UT1RZUEUgPSAncHJvdG90eXBlJzsKCnZhciAkZXhwb3J0ID0gZnVuY3Rpb24odHlwZSwgbmFtZSwgc291cmNlKXsKICB2YXIgSVNfRk9SQ0VEID0gdHlwZSAmICRleHBvcnQuRgogICAgLCBJU19HTE9CQUwgPSB0eXBlICYgJGV4cG9ydC5HCiAgICAsIElTX1NUQVRJQyA9IHR5cGUgJiAkZXhwb3J0LlMKICAgICwgSVNfUFJPVE8gID0gdHlwZSAmICRleHBvcnQuUAogICAgLCBJU19CSU5EICAgPSB0eXBlICYgJGV4cG9ydC5CCiAgICAsIElTX1dSQVAgICA9IHR5cGUgJiAkZXhwb3J0LlcKICAgICwgZXhwb3J0cyAgID0gSVNfR0xPQkFMID8gY29yZSA6IGNvcmVbbmFtZV0gfHwgKGNvcmVbbmFtZV0gPSB7fSkKICAgICwgdGFyZ2V0ICAgID0gSVNfR0xPQkFMID8gZ2xvYmFsIDogSVNfU1RBVElDID8gZ2xvYmFsW25hbWVdIDogKGdsb2JhbFtuYW1lXSB8fCB7fSlbUFJPVE9UWVBFXQogICAgLCBrZXksIG93biwgb3V0OwogIGlmKElTX0dMT0JBTClzb3VyY2UgPSBuYW1lOwogIGZvcihrZXkgaW4gc291cmNlKXsKICAgIC8vIGNvbnRhaW5zIGluIG5hdGl2ZQogICAgb3duID0gIUlTX0ZPUkNFRCAmJiB0YXJnZXQgJiYga2V5IGluIHRhcmdldDsKICAgIGlmKG93biAmJiBrZXkgaW4gZXhwb3J0cyljb250aW51ZTsKICAgIC8vIGV4cG9ydCBuYXRpdmUgb3IgcGFzc2VkCiAgICBvdXQgPSBvd24gPyB0YXJnZXRba2V5XSA6IHNvdXJjZVtrZXldOwogICAgLy8gcHJldmVudCBnbG9iYWwgcG9sbHV0aW9uIGZvciBuYW1lc3BhY2VzCiAgICBleHBvcnRzW2tleV0gPSBJU19HTE9CQUwgJiYgdHlwZW9mIHRhcmdldFtrZXldICE9ICdmdW5jdGlvbicgPyBzb3VyY2Vba2V5XQogICAgLy8gYmluZCB0aW1lcnMgdG8gZ2xvYmFsIGZvciBjYWxsIGZyb20gZXhwb3J0IGNvbnRleHQKICAgIDogSVNfQklORCAmJiBvd24gPyBjdHgob3V0LCBnbG9iYWwpCiAgICAvLyB3cmFwIGdsb2JhbCBjb25zdHJ1Y3RvcnMgZm9yIHByZXZlbnQgY2hhbmdlIHRoZW0gaW4gbGlicmFyeQogICAgOiBJU19XUkFQICYmIHRhcmdldFtrZXldID09IG91dCA/IChmdW5jdGlvbihDKXsKICAgICAgdmFyIEYgPSBmdW5jdGlvbihwYXJhbSl7CiAgICAgICAgcmV0dXJuIHRoaXMgaW5zdGFuY2VvZiBDID8gbmV3IEMocGFyYW0pIDogQyhwYXJhbSk7CiAgICAgIH07CiAgICAgIEZbUFJPVE9UWVBFXSA9IENbUFJPVE9UWVBFXTsKICAgICAgcmV0dXJuIEY7CiAgICAvLyBtYWtlIHN0YXRpYyB2ZXJzaW9ucyBmb3IgcHJvdG90eXBlIG1ldGhvZHMKICAgIH0pKG91dCkgOiBJU19QUk9UTyAmJiB0eXBlb2Ygb3V0ID09ICdmdW5jdGlvbicgPyBjdHgoRnVuY3Rpb24uY2FsbCwgb3V0KSA6IG91dDsKICAgIGlmKElTX1BST1RPKShleHBvcnRzW1BST1RPVFlQRV0gfHwgKGV4cG9ydHNbUFJPVE9UWVBFXSA9IHt9KSlba2V5XSA9IG91dDsKICB9Cn07Ci8vIHR5cGUgYml0bWFwCiRleHBvcnQuRiA9IDE7ICAvLyBmb3JjZWQKJGV4cG9ydC5HID0gMjsgIC8vIGdsb2JhbAokZXhwb3J0LlMgPSA0OyAgLy8gc3RhdGljCiRleHBvcnQuUCA9IDg7ICAvLyBwcm90bwokZXhwb3J0LkIgPSAxNjsgLy8gYmluZAokZXhwb3J0LlcgPSAzMjsgLy8gd3JhcAptb2R1bGUuZXhwb3J0cyA9ICRleHBvcnQ7Cn0seyIuLyQuY29yZSI6MzEsIi4vJC5jdHgiOjMyLCIuLyQuZ2xvYmFsIjo0MX1dLDM4OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihleGVjKXsKICB0cnkgewogICAgcmV0dXJuICEhZXhlYygpOwogIH0gY2F0Y2goZSl7CiAgICByZXR1cm4gdHJ1ZTsKICB9Cn07Cn0se31dLDM5OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKdmFyIGN0eCAgICAgICAgID0gcmVxdWlyZSgnLi8kLmN0eCcpCiAgLCBjYWxsICAgICAgICA9IHJlcXVpcmUoJy4vJC5pdGVyLWNhbGwnKQogICwgaXNBcnJheUl0ZXIgPSByZXF1aXJlKCcuLyQuaXMtYXJyYXktaXRlcicpCiAgLCBhbk9iamVjdCAgICA9IHJlcXVpcmUoJy4vJC5hbi1vYmplY3QnKQogICwgdG9MZW5ndGggICAgPSByZXF1aXJlKCcuLyQudG8tbGVuZ3RoJykKICAsIGdldEl0ZXJGbiAgID0gcmVxdWlyZSgnLi9jb3JlLmdldC1pdGVyYXRvci1tZXRob2QnKTsKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihpdGVyYWJsZSwgZW50cmllcywgZm4sIHRoYXQpewogIHZhciBpdGVyRm4gPSBnZXRJdGVyRm4oaXRlcmFibGUpCiAgICAsIGYgICAgICA9IGN0eChmbiwgdGhhdCwgZW50cmllcyA/IDIgOiAxKQogICAgLCBpbmRleCAgPSAwCiAgICAsIGxlbmd0aCwgc3RlcCwgaXRlcmF0b3I7CiAgaWYodHlwZW9mIGl0ZXJGbiAhPSAnZnVuY3Rpb24nKXRocm93IFR5cGVFcnJvcihpdGVyYWJsZSArICcgaXMgbm90IGl0ZXJhYmxlIScpOwogIC8vIGZhc3QgY2FzZSBmb3IgYXJyYXlzIHdpdGggZGVmYXVsdCBpdGVyYXRvcgogIGlmKGlzQXJyYXlJdGVyKGl0ZXJGbikpZm9yKGxlbmd0aCA9IHRvTGVuZ3RoKGl0ZXJhYmxlLmxlbmd0aCk7IGxlbmd0aCA+IGluZGV4OyBpbmRleCsrKXsKICAgIGVudHJpZXMgPyBmKGFuT2JqZWN0KHN0ZXAgPSBpdGVyYWJsZVtpbmRleF0pWzBdLCBzdGVwWzFdKSA6IGYoaXRlcmFibGVbaW5kZXhdKTsKICB9IGVsc2UgZm9yKGl0ZXJhdG9yID0gaXRlckZuLmNhbGwoaXRlcmFibGUpOyAhKHN0ZXAgPSBpdGVyYXRvci5uZXh0KCkpLmRvbmU7ICl7CiAgICBjYWxsKGl0ZXJhdG9yLCBmLCBzdGVwLnZhbHVlLCBlbnRyaWVzKTsKICB9Cn07Cn0seyIuLyQuYW4tb2JqZWN0IjoyOCwiLi8kLmN0eCI6MzIsIi4vJC5pcy1hcnJheS1pdGVyIjo0NywiLi8kLml0ZXItY2FsbCI6NTAsIi4vJC50by1sZW5ndGgiOjc1LCIuL2NvcmUuZ2V0LWl0ZXJhdG9yLW1ldGhvZCI6Nzl9XSw0MDpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Ci8vIGZhbGxiYWNrIGZvciBJRTExIGJ1Z2d5IE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzIHdpdGggaWZyYW1lIGFuZCB3aW5kb3cKdmFyIHRvSU9iamVjdCA9IHJlcXVpcmUoJy4vJC50by1pb2JqZWN0JykKICAsIGdldE5hbWVzICA9IHJlcXVpcmUoJy4vJCcpLmdldE5hbWVzCiAgLCB0b1N0cmluZyAgPSB7fS50b1N0cmluZzsKCnZhciB3aW5kb3dOYW1lcyA9IHR5cGVvZiB3aW5kb3cgPT0gJ29iamVjdCcgJiYgT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMKICA/IE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKHdpbmRvdykgOiBbXTsKCnZhciBnZXRXaW5kb3dOYW1lcyA9IGZ1bmN0aW9uKGl0KXsKICB0cnkgewogICAgcmV0dXJuIGdldE5hbWVzKGl0KTsKICB9IGNhdGNoKGUpewogICAgcmV0dXJuIHdpbmRvd05hbWVzLnNsaWNlKCk7CiAgfQp9OwoKbW9kdWxlLmV4cG9ydHMuZ2V0ID0gZnVuY3Rpb24gZ2V0T3duUHJvcGVydHlOYW1lcyhpdCl7CiAgaWYod2luZG93TmFtZXMgJiYgdG9TdHJpbmcuY2FsbChpdCkgPT0gJ1tvYmplY3QgV2luZG93XScpcmV0dXJuIGdldFdpbmRvd05hbWVzKGl0KTsKICByZXR1cm4gZ2V0TmFtZXModG9JT2JqZWN0KGl0KSk7Cn07Cn0seyIuLyQiOjU2LCIuLyQudG8taW9iamVjdCI6NzR9XSw0MTpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Ci8vIGh0dHBzOi8vZ2l0aHViLmNvbS96bG9pcm9jay9jb3JlLWpzL2lzc3Vlcy84NiNpc3N1ZWNvbW1lbnQtMTE1NzU5MDI4CnZhciBnbG9iYWwgPSBtb2R1bGUuZXhwb3J0cyA9IHR5cGVvZiB3aW5kb3cgIT0gJ3VuZGVmaW5lZCcgJiYgd2luZG93Lk1hdGggPT0gTWF0aAogID8gd2luZG93IDogdHlwZW9mIHNlbGYgIT0gJ3VuZGVmaW5lZCcgJiYgc2VsZi5NYXRoID09IE1hdGggPyBzZWxmIDogRnVuY3Rpb24oJ3JldHVybiB0aGlzJykoKTsKaWYodHlwZW9mIF9fZyA9PSAnbnVtYmVyJylfX2cgPSBnbG9iYWw7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tdW5kZWYKfSx7fV0sNDI6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewp2YXIgaGFzT3duUHJvcGVydHkgPSB7fS5oYXNPd25Qcm9wZXJ0eTsKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihpdCwga2V5KXsKICByZXR1cm4gaGFzT3duUHJvcGVydHkuY2FsbChpdCwga2V5KTsKfTsKfSx7fV0sNDM6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewp2YXIgJCAgICAgICAgICA9IHJlcXVpcmUoJy4vJCcpCiAgLCBjcmVhdGVEZXNjID0gcmVxdWlyZSgnLi8kLnByb3BlcnR5LWRlc2MnKTsKbW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKCcuLyQuZGVzY3JpcHRvcnMnKSA/IGZ1bmN0aW9uKG9iamVjdCwga2V5LCB2YWx1ZSl7CiAgcmV0dXJuICQuc2V0RGVzYyhvYmplY3QsIGtleSwgY3JlYXRlRGVzYygxLCB2YWx1ZSkpOwp9IDogZnVuY3Rpb24ob2JqZWN0LCBrZXksIHZhbHVlKXsKICBvYmplY3Rba2V5XSA9IHZhbHVlOwogIHJldHVybiBvYmplY3Q7Cn07Cn0seyIuLyQiOjU2LCIuLyQuZGVzY3JpcHRvcnMiOjM0LCIuLyQucHJvcGVydHktZGVzYyI6NjF9XSw0NDpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Cm1vZHVsZS5leHBvcnRzID0gcmVxdWlyZSgnLi8kLmdsb2JhbCcpLmRvY3VtZW50ICYmIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudDsKfSx7Ii4vJC5nbG9iYWwiOjQxfV0sNDU6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewovLyBmYXN0IGFwcGx5LCBodHRwOi8vanNwZXJmLmxua2l0LmNvbS9mYXN0LWFwcGx5LzUKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihmbiwgYXJncywgdGhhdCl7CiAgdmFyIHVuID0gdGhhdCA9PT0gdW5kZWZpbmVkOwogIHN3aXRjaChhcmdzLmxlbmd0aCl7CiAgICBjYXNlIDA6IHJldHVybiB1biA/IGZuKCkKICAgICAgICAgICAgICAgICAgICAgIDogZm4uY2FsbCh0aGF0KTsKICAgIGNhc2UgMTogcmV0dXJuIHVuID8gZm4oYXJnc1swXSkKICAgICAgICAgICAgICAgICAgICAgIDogZm4uY2FsbCh0aGF0LCBhcmdzWzBdKTsKICAgIGNhc2UgMjogcmV0dXJuIHVuID8gZm4oYXJnc1swXSwgYXJnc1sxXSkKICAgICAgICAgICAgICAgICAgICAgIDogZm4uY2FsbCh0aGF0LCBhcmdzWzBdLCBhcmdzWzFdKTsKICAgIGNhc2UgMzogcmV0dXJuIHVuID8gZm4oYXJnc1swXSwgYXJnc1sxXSwgYXJnc1syXSkKICAgICAgICAgICAgICAgICAgICAgIDogZm4uY2FsbCh0aGF0LCBhcmdzWzBdLCBhcmdzWzFdLCBhcmdzWzJdKTsKICAgIGNhc2UgNDogcmV0dXJuIHVuID8gZm4oYXJnc1swXSwgYXJnc1sxXSwgYXJnc1syXSwgYXJnc1szXSkKICAgICAgICAgICAgICAgICAgICAgIDogZm4uY2FsbCh0aGF0LCBhcmdzWzBdLCBhcmdzWzFdLCBhcmdzWzJdLCBhcmdzWzNdKTsKICB9IHJldHVybiAgICAgICAgICAgICAgZm4uYXBwbHkodGhhdCwgYXJncyk7Cn07Cn0se31dLDQ2OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKLy8gZmFsbGJhY2sgZm9yIG5vbi1hcnJheS1saWtlIEVTMyBhbmQgbm9uLWVudW1lcmFibGUgb2xkIFY4IHN0cmluZ3MKdmFyIGNvZiA9IHJlcXVpcmUoJy4vJC5jb2YnKTsKbW9kdWxlLmV4cG9ydHMgPSBPYmplY3QoJ3onKS5wcm9wZXJ0eUlzRW51bWVyYWJsZSgwKSA/IE9iamVjdCA6IGZ1bmN0aW9uKGl0KXsKICByZXR1cm4gY29mKGl0KSA9PSAnU3RyaW5nJyA/IGl0LnNwbGl0KCcnKSA6IE9iamVjdChpdCk7Cn07Cn0seyIuLyQuY29mIjozMH1dLDQ3OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKLy8gY2hlY2sgb24gZGVmYXVsdCBBcnJheSBpdGVyYXRvcgp2YXIgSXRlcmF0b3JzICA9IHJlcXVpcmUoJy4vJC5pdGVyYXRvcnMnKQogICwgSVRFUkFUT1IgICA9IHJlcXVpcmUoJy4vJC53a3MnKSgnaXRlcmF0b3InKQogICwgQXJyYXlQcm90byA9IEFycmF5LnByb3RvdHlwZTsKCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oaXQpewogIHJldHVybiBpdCAhPT0gdW5kZWZpbmVkICYmIChJdGVyYXRvcnMuQXJyYXkgPT09IGl0IHx8IEFycmF5UHJvdG9bSVRFUkFUT1JdID09PSBpdCk7Cn07Cn0seyIuLyQuaXRlcmF0b3JzIjo1NSwiLi8kLndrcyI6Nzh9XSw0ODpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Ci8vIDcuMi4yIElzQXJyYXkoYXJndW1lbnQpCnZhciBjb2YgPSByZXF1aXJlKCcuLyQuY29mJyk7Cm1vZHVsZS5leHBvcnRzID0gQXJyYXkuaXNBcnJheSB8fCBmdW5jdGlvbihhcmcpewogIHJldHVybiBjb2YoYXJnKSA9PSAnQXJyYXknOwp9Owp9LHsiLi8kLmNvZiI6MzB9XSw0OTpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Cm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oaXQpewogIHJldHVybiB0eXBlb2YgaXQgPT09ICdvYmplY3QnID8gaXQgIT09IG51bGwgOiB0eXBlb2YgaXQgPT09ICdmdW5jdGlvbic7Cn07Cn0se31dLDUwOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKLy8gY2FsbCBzb21ldGhpbmcgb24gaXRlcmF0b3Igc3RlcCB3aXRoIHNhZmUgY2xvc2luZyBvbiBlcnJvcgp2YXIgYW5PYmplY3QgPSByZXF1aXJlKCcuLyQuYW4tb2JqZWN0Jyk7Cm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oaXRlcmF0b3IsIGZuLCB2YWx1ZSwgZW50cmllcyl7CiAgdHJ5IHsKICAgIHJldHVybiBlbnRyaWVzID8gZm4oYW5PYmplY3QodmFsdWUpWzBdLCB2YWx1ZVsxXSkgOiBmbih2YWx1ZSk7CiAgLy8gNy40LjYgSXRlcmF0b3JDbG9zZShpdGVyYXRvciwgY29tcGxldGlvbikKICB9IGNhdGNoKGUpewogICAgdmFyIHJldCA9IGl0ZXJhdG9yWydyZXR1cm4nXTsKICAgIGlmKHJldCAhPT0gdW5kZWZpbmVkKWFuT2JqZWN0KHJldC5jYWxsKGl0ZXJhdG9yKSk7CiAgICB0aHJvdyBlOwogIH0KfTsKfSx7Ii4vJC5hbi1vYmplY3QiOjI4fV0sNTE6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewondXNlIHN0cmljdCc7CnZhciAkICAgICAgICAgICAgICA9IHJlcXVpcmUoJy4vJCcpCiAgLCBkZXNjcmlwdG9yICAgICA9IHJlcXVpcmUoJy4vJC5wcm9wZXJ0eS1kZXNjJykKICAsIHNldFRvU3RyaW5nVGFnID0gcmVxdWlyZSgnLi8kLnNldC10by1zdHJpbmctdGFnJykKICAsIEl0ZXJhdG9yUHJvdG90eXBlID0ge307CgovLyAyNS4xLjIuMS4xICVJdGVyYXRvclByb3RvdHlwZSVbQEBpdGVyYXRvcl0oKQpyZXF1aXJlKCcuLyQuaGlkZScpKEl0ZXJhdG9yUHJvdG90eXBlLCByZXF1aXJlKCcuLyQud2tzJykoJ2l0ZXJhdG9yJyksIGZ1bmN0aW9uKCl7IHJldHVybiB0aGlzOyB9KTsKCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oQ29uc3RydWN0b3IsIE5BTUUsIG5leHQpewogIENvbnN0cnVjdG9yLnByb3RvdHlwZSA9ICQuY3JlYXRlKEl0ZXJhdG9yUHJvdG90eXBlLCB7bmV4dDogZGVzY3JpcHRvcigxLCBuZXh0KX0pOwogIHNldFRvU3RyaW5nVGFnKENvbnN0cnVjdG9yLCBOQU1FICsgJyBJdGVyYXRvcicpOwp9Owp9LHsiLi8kIjo1NiwiLi8kLmhpZGUiOjQzLCIuLyQucHJvcGVydHktZGVzYyI6NjEsIi4vJC5zZXQtdG8tc3RyaW5nLXRhZyI6NjcsIi4vJC53a3MiOjc4fV0sNTI6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewondXNlIHN0cmljdCc7CnZhciBMSUJSQVJZICAgICAgICA9IHJlcXVpcmUoJy4vJC5saWJyYXJ5JykKICAsICRleHBvcnQgICAgICAgID0gcmVxdWlyZSgnLi8kLmV4cG9ydCcpCiAgLCByZWRlZmluZSAgICAgICA9IHJlcXVpcmUoJy4vJC5yZWRlZmluZScpCiAgLCBoaWRlICAgICAgICAgICA9IHJlcXVpcmUoJy4vJC5oaWRlJykKICAsIGhhcyAgICAgICAgICAgID0gcmVxdWlyZSgnLi8kLmhhcycpCiAgLCBJdGVyYXRvcnMgICAgICA9IHJlcXVpcmUoJy4vJC5pdGVyYXRvcnMnKQogICwgJGl0ZXJDcmVhdGUgICAgPSByZXF1aXJlKCcuLyQuaXRlci1jcmVhdGUnKQogICwgc2V0VG9TdHJpbmdUYWcgPSByZXF1aXJlKCcuLyQuc2V0LXRvLXN0cmluZy10YWcnKQogICwgZ2V0UHJvdG8gICAgICAgPSByZXF1aXJlKCcuLyQnKS5nZXRQcm90bwogICwgSVRFUkFUT1IgICAgICAgPSByZXF1aXJlKCcuLyQud2tzJykoJ2l0ZXJhdG9yJykKICAsIEJVR0dZICAgICAgICAgID0gIShbXS5rZXlzICYmICduZXh0JyBpbiBbXS5rZXlzKCkpIC8vIFNhZmFyaSBoYXMgYnVnZ3kgaXRlcmF0b3JzIHcvbyBgbmV4dGAKICAsIEZGX0lURVJBVE9SICAgID0gJ0BAaXRlcmF0b3InCiAgLCBLRVlTICAgICAgICAgICA9ICdrZXlzJwogICwgVkFMVUVTICAgICAgICAgPSAndmFsdWVzJzsKCnZhciByZXR1cm5UaGlzID0gZnVuY3Rpb24oKXsgcmV0dXJuIHRoaXM7IH07Cgptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKEJhc2UsIE5BTUUsIENvbnN0cnVjdG9yLCBuZXh0LCBERUZBVUxULCBJU19TRVQsIEZPUkNFRCl7CiAgJGl0ZXJDcmVhdGUoQ29uc3RydWN0b3IsIE5BTUUsIG5leHQpOwogIHZhciBnZXRNZXRob2QgPSBmdW5jdGlvbihraW5kKXsKICAgIGlmKCFCVUdHWSAmJiBraW5kIGluIHByb3RvKXJldHVybiBwcm90b1traW5kXTsKICAgIHN3aXRjaChraW5kKXsKICAgICAgY2FzZSBLRVlTOiByZXR1cm4gZnVuY3Rpb24ga2V5cygpeyByZXR1cm4gbmV3IENvbnN0cnVjdG9yKHRoaXMsIGtpbmQpOyB9OwogICAgICBjYXNlIFZBTFVFUzogcmV0dXJuIGZ1bmN0aW9uIHZhbHVlcygpeyByZXR1cm4gbmV3IENvbnN0cnVjdG9yKHRoaXMsIGtpbmQpOyB9OwogICAgfSByZXR1cm4gZnVuY3Rpb24gZW50cmllcygpeyByZXR1cm4gbmV3IENvbnN0cnVjdG9yKHRoaXMsIGtpbmQpOyB9OwogIH07CiAgdmFyIFRBRyAgICAgICAgPSBOQU1FICsgJyBJdGVyYXRvcicKICAgICwgREVGX1ZBTFVFUyA9IERFRkFVTFQgPT0gVkFMVUVTCiAgICAsIFZBTFVFU19CVUcgPSBmYWxzZQogICAgLCBwcm90byAgICAgID0gQmFzZS5wcm90b3R5cGUKICAgICwgJG5hdGl2ZSAgICA9IHByb3RvW0lURVJBVE9SXSB8fCBwcm90b1tGRl9JVEVSQVRPUl0gfHwgREVGQVVMVCAmJiBwcm90b1tERUZBVUxUXQogICAgLCAkZGVmYXVsdCAgID0gJG5hdGl2ZSB8fCBnZXRNZXRob2QoREVGQVVMVCkKICAgICwgbWV0aG9kcywga2V5OwogIC8vIEZpeCBuYXRpdmUKICBpZigkbmF0aXZlKXsKICAgIHZhciBJdGVyYXRvclByb3RvdHlwZSA9IGdldFByb3RvKCRkZWZhdWx0LmNhbGwobmV3IEJhc2UpKTsKICAgIC8vIFNldCBAQHRvU3RyaW5nVGFnIHRvIG5hdGl2ZSBpdGVyYXRvcnMKICAgIHNldFRvU3RyaW5nVGFnKEl0ZXJhdG9yUHJvdG90eXBlLCBUQUcsIHRydWUpOwogICAgLy8gRkYgZml4CiAgICBpZighTElCUkFSWSAmJiBoYXMocHJvdG8sIEZGX0lURVJBVE9SKSloaWRlKEl0ZXJhdG9yUHJvdG90eXBlLCBJVEVSQVRPUiwgcmV0dXJuVGhpcyk7CiAgICAvLyBmaXggQXJyYXkje3ZhbHVlcywgQEBpdGVyYXRvcn0ubmFtZSBpbiBWOCAvIEZGCiAgICBpZihERUZfVkFMVUVTICYmICRuYXRpdmUubmFtZSAhPT0gVkFMVUVTKXsKICAgICAgVkFMVUVTX0JVRyA9IHRydWU7CiAgICAgICRkZWZhdWx0ID0gZnVuY3Rpb24gdmFsdWVzKCl7IHJldHVybiAkbmF0aXZlLmNhbGwodGhpcyk7IH07CiAgICB9CiAgfQogIC8vIERlZmluZSBpdGVyYXRvcgogIGlmKCghTElCUkFSWSB8fCBGT1JDRUQpICYmIChCVUdHWSB8fCBWQUxVRVNfQlVHIHx8ICFwcm90b1tJVEVSQVRPUl0pKXsKICAgIGhpZGUocHJvdG8sIElURVJBVE9SLCAkZGVmYXVsdCk7CiAgfQogIC8vIFBsdWcgZm9yIGxpYnJhcnkKICBJdGVyYXRvcnNbTkFNRV0gPSAkZGVmYXVsdDsKICBJdGVyYXRvcnNbVEFHXSAgPSByZXR1cm5UaGlzOwogIGlmKERFRkFVTFQpewogICAgbWV0aG9kcyA9IHsKICAgICAgdmFsdWVzOiAgREVGX1ZBTFVFUyAgPyAkZGVmYXVsdCA6IGdldE1ldGhvZChWQUxVRVMpLAogICAgICBrZXlzOiAgICBJU19TRVQgICAgICA/ICRkZWZhdWx0IDogZ2V0TWV0aG9kKEtFWVMpLAogICAgICBlbnRyaWVzOiAhREVGX1ZBTFVFUyA/ICRkZWZhdWx0IDogZ2V0TWV0aG9kKCdlbnRyaWVzJykKICAgIH07CiAgICBpZihGT1JDRUQpZm9yKGtleSBpbiBtZXRob2RzKXsKICAgICAgaWYoIShrZXkgaW4gcHJvdG8pKXJlZGVmaW5lKHByb3RvLCBrZXksIG1ldGhvZHNba2V5XSk7CiAgICB9IGVsc2UgJGV4cG9ydCgkZXhwb3J0LlAgKyAkZXhwb3J0LkYgKiAoQlVHR1kgfHwgVkFMVUVTX0JVRyksIE5BTUUsIG1ldGhvZHMpOwogIH0KICByZXR1cm4gbWV0aG9kczsKfTsKfSx7Ii4vJCI6NTYsIi4vJC5leHBvcnQiOjM3LCIuLyQuaGFzIjo0MiwiLi8kLmhpZGUiOjQzLCIuLyQuaXRlci1jcmVhdGUiOjUxLCIuLyQuaXRlcmF0b3JzIjo1NSwiLi8kLmxpYnJhcnkiOjU4LCIuLyQucmVkZWZpbmUiOjYzLCIuLyQuc2V0LXRvLXN0cmluZy10YWciOjY3LCIuLyQud2tzIjo3OH1dLDUzOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKdmFyIElURVJBVE9SICAgICA9IHJlcXVpcmUoJy4vJC53a3MnKSgnaXRlcmF0b3InKQogICwgU0FGRV9DTE9TSU5HID0gZmFsc2U7Cgp0cnkgewogIHZhciByaXRlciA9IFs3XVtJVEVSQVRPUl0oKTsKICByaXRlclsncmV0dXJuJ10gPSBmdW5jdGlvbigpeyBTQUZFX0NMT1NJTkcgPSB0cnVlOyB9OwogIEFycmF5LmZyb20ocml0ZXIsIGZ1bmN0aW9uKCl7IHRocm93IDI7IH0pOwp9IGNhdGNoKGUpeyAvKiBlbXB0eSAqLyB9Cgptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGV4ZWMsIHNraXBDbG9zaW5nKXsKICBpZighc2tpcENsb3NpbmcgJiYgIVNBRkVfQ0xPU0lORylyZXR1cm4gZmFsc2U7CiAgdmFyIHNhZmUgPSBmYWxzZTsKICB0cnkgewogICAgdmFyIGFyciAgPSBbN10KICAgICAgLCBpdGVyID0gYXJyW0lURVJBVE9SXSgpOwogICAgaXRlci5uZXh0ID0gZnVuY3Rpb24oKXsgc2FmZSA9IHRydWU7IH07CiAgICBhcnJbSVRFUkFUT1JdID0gZnVuY3Rpb24oKXsgcmV0dXJuIGl0ZXI7IH07CiAgICBleGVjKGFycik7CiAgfSBjYXRjaChlKXsgLyogZW1wdHkgKi8gfQogIHJldHVybiBzYWZlOwp9Owp9LHsiLi8kLndrcyI6Nzh9XSw1NDpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Cm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oZG9uZSwgdmFsdWUpewogIHJldHVybiB7dmFsdWU6IHZhbHVlLCBkb25lOiAhIWRvbmV9Owp9Owp9LHt9XSw1NTpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Cm1vZHVsZS5leHBvcnRzID0ge307Cn0se31dLDU2OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKdmFyICRPYmplY3QgPSBPYmplY3Q7Cm1vZHVsZS5leHBvcnRzID0gewogIGNyZWF0ZTogICAgICRPYmplY3QuY3JlYXRlLAogIGdldFByb3RvOiAgICRPYmplY3QuZ2V0UHJvdG90eXBlT2YsCiAgaXNFbnVtOiAgICAge30ucHJvcGVydHlJc0VudW1lcmFibGUsCiAgZ2V0RGVzYzogICAgJE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IsCiAgc2V0RGVzYzogICAgJE9iamVjdC5kZWZpbmVQcm9wZXJ0eSwKICBzZXREZXNjczogICAkT2JqZWN0LmRlZmluZVByb3BlcnRpZXMsCiAgZ2V0S2V5czogICAgJE9iamVjdC5rZXlzLAogIGdldE5hbWVzOiAgICRPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcywKICBnZXRTeW1ib2xzOiAkT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scywKICBlYWNoOiAgICAgICBbXS5mb3JFYWNoCn07Cn0se31dLDU3OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKdmFyICQgICAgICAgICA9IHJlcXVpcmUoJy4vJCcpCiAgLCB0b0lPYmplY3QgPSByZXF1aXJlKCcuLyQudG8taW9iamVjdCcpOwptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKG9iamVjdCwgZWwpewogIHZhciBPICAgICAgPSB0b0lPYmplY3Qob2JqZWN0KQogICAgLCBrZXlzICAgPSAkLmdldEtleXMoTykKICAgICwgbGVuZ3RoID0ga2V5cy5sZW5ndGgKICAgICwgaW5kZXggID0gMAogICAgLCBrZXk7CiAgd2hpbGUobGVuZ3RoID4gaW5kZXgpaWYoT1trZXkgPSBrZXlzW2luZGV4KytdXSA9PT0gZWwpcmV0dXJuIGtleTsKfTsKfSx7Ii4vJCI6NTYsIi4vJC50by1pb2JqZWN0Ijo3NH1dLDU4OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKbW9kdWxlLmV4cG9ydHMgPSB0cnVlOwp9LHt9XSw1OTpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7CnZhciBnbG9iYWwgICAgPSByZXF1aXJlKCcuLyQuZ2xvYmFsJykKICAsIG1hY3JvdGFzayA9IHJlcXVpcmUoJy4vJC50YXNrJykuc2V0CiAgLCBPYnNlcnZlciAgPSBnbG9iYWwuTXV0YXRpb25PYnNlcnZlciB8fCBnbG9iYWwuV2ViS2l0TXV0YXRpb25PYnNlcnZlcgogICwgcHJvY2VzcyAgID0gZ2xvYmFsLnByb2Nlc3MKICAsIFByb21pc2UgICA9IGdsb2JhbC5Qcm9taXNlCiAgLCBpc05vZGUgICAgPSByZXF1aXJlKCcuLyQuY29mJykocHJvY2VzcykgPT0gJ3Byb2Nlc3MnCiAgLCBoZWFkLCBsYXN0LCBub3RpZnk7Cgp2YXIgZmx1c2ggPSBmdW5jdGlvbigpewogIHZhciBwYXJlbnQsIGRvbWFpbiwgZm47CiAgaWYoaXNOb2RlICYmIChwYXJlbnQgPSBwcm9jZXNzLmRvbWFpbikpewogICAgcHJvY2Vzcy5kb21haW4gPSBudWxsOwogICAgcGFyZW50LmV4aXQoKTsKICB9CiAgd2hpbGUoaGVhZCl7CiAgICBkb21haW4gPSBoZWFkLmRvbWFpbjsKICAgIGZuICAgICA9IGhlYWQuZm47CiAgICBpZihkb21haW4pZG9tYWluLmVudGVyKCk7CiAgICBmbigpOyAvLyA8LSBjdXJyZW50bHkgd2UgdXNlIGl0IG9ubHkgZm9yIFByb21pc2UgLSB0cnkgLyBjYXRjaCBub3QgcmVxdWlyZWQKICAgIGlmKGRvbWFpbilkb21haW4uZXhpdCgpOwogICAgaGVhZCA9IGhlYWQubmV4dDsKICB9IGxhc3QgPSB1bmRlZmluZWQ7CiAgaWYocGFyZW50KXBhcmVudC5lbnRlcigpOwp9OwoKLy8gTm9kZS5qcwppZihpc05vZGUpewogIG5vdGlmeSA9IGZ1bmN0aW9uKCl7CiAgICBwcm9jZXNzLm5leHRUaWNrKGZsdXNoKTsKICB9OwovLyBicm93c2VycyB3aXRoIE11dGF0aW9uT2JzZXJ2ZXIKfSBlbHNlIGlmKE9ic2VydmVyKXsKICB2YXIgdG9nZ2xlID0gMQogICAgLCBub2RlICAgPSBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnJyk7CiAgbmV3IE9ic2VydmVyKGZsdXNoKS5vYnNlcnZlKG5vZGUsIHtjaGFyYWN0ZXJEYXRhOiB0cnVlfSk7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tbmV3CiAgbm90aWZ5ID0gZnVuY3Rpb24oKXsKICAgIG5vZGUuZGF0YSA9IHRvZ2dsZSA9IC10b2dnbGU7CiAgfTsKLy8gZW52aXJvbm1lbnRzIHdpdGggbWF5YmUgbm9uLWNvbXBsZXRlbHkgY29ycmVjdCwgYnV0IGV4aXN0ZW50IFByb21pc2UKfSBlbHNlIGlmKFByb21pc2UgJiYgUHJvbWlzZS5yZXNvbHZlKXsKICBub3RpZnkgPSBmdW5jdGlvbigpewogICAgUHJvbWlzZS5yZXNvbHZlKCkudGhlbihmbHVzaCk7CiAgfTsKLy8gZm9yIG90aGVyIGVudmlyb25tZW50cyAtIG1hY3JvdGFzayBiYXNlZCBvbjoKLy8gLSBzZXRJbW1lZGlhdGUKLy8gLSBNZXNzYWdlQ2hhbm5lbAovLyAtIHdpbmRvdy5wb3N0TWVzc2FnCi8vIC0gb25yZWFkeXN0YXRlY2hhbmdlCi8vIC0gc2V0VGltZW91dAp9IGVsc2UgewogIG5vdGlmeSA9IGZ1bmN0aW9uKCl7CiAgICAvLyBzdHJhbmdlIElFICsgd2VicGFjayBkZXYgc2VydmVyIGJ1ZyAtIHVzZSAuY2FsbChnbG9iYWwpCiAgICBtYWNyb3Rhc2suY2FsbChnbG9iYWwsIGZsdXNoKTsKICB9Owp9Cgptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIGFzYXAoZm4pewogIHZhciB0YXNrID0ge2ZuOiBmbiwgbmV4dDogdW5kZWZpbmVkLCBkb21haW46IGlzTm9kZSAmJiBwcm9jZXNzLmRvbWFpbn07CiAgaWYobGFzdClsYXN0Lm5leHQgPSB0YXNrOwogIGlmKCFoZWFkKXsKICAgIGhlYWQgPSB0YXNrOwogICAgbm90aWZ5KCk7CiAgfSBsYXN0ID0gdGFzazsKfTsKfSx7Ii4vJC5jb2YiOjMwLCIuLyQuZ2xvYmFsIjo0MSwiLi8kLnRhc2siOjcyfV0sNjA6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewovLyBtb3N0IE9iamVjdCBtZXRob2RzIGJ5IEVTNiBzaG91bGQgYWNjZXB0IHByaW1pdGl2ZXMKdmFyICRleHBvcnQgPSByZXF1aXJlKCcuLyQuZXhwb3J0JykKICAsIGNvcmUgICAgPSByZXF1aXJlKCcuLyQuY29yZScpCiAgLCBmYWlscyAgID0gcmVxdWlyZSgnLi8kLmZhaWxzJyk7Cm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oS0VZLCBleGVjKXsKICB2YXIgZm4gID0gKGNvcmUuT2JqZWN0IHx8IHt9KVtLRVldIHx8IE9iamVjdFtLRVldCiAgICAsIGV4cCA9IHt9OwogIGV4cFtLRVldID0gZXhlYyhmbik7CiAgJGV4cG9ydCgkZXhwb3J0LlMgKyAkZXhwb3J0LkYgKiBmYWlscyhmdW5jdGlvbigpeyBmbigxKTsgfSksICdPYmplY3QnLCBleHApOwp9Owp9LHsiLi8kLmNvcmUiOjMxLCIuLyQuZXhwb3J0IjozNywiLi8kLmZhaWxzIjozOH1dLDYxOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihiaXRtYXAsIHZhbHVlKXsKICByZXR1cm4gewogICAgZW51bWVyYWJsZSAgOiAhKGJpdG1hcCAmIDEpLAogICAgY29uZmlndXJhYmxlOiAhKGJpdG1hcCAmIDIpLAogICAgd3JpdGFibGUgICAgOiAhKGJpdG1hcCAmIDQpLAogICAgdmFsdWUgICAgICAgOiB2YWx1ZQogIH07Cn07Cn0se31dLDYyOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKdmFyIHJlZGVmaW5lID0gcmVxdWlyZSgnLi8kLnJlZGVmaW5lJyk7Cm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24odGFyZ2V0LCBzcmMpewogIGZvcih2YXIga2V5IGluIHNyYylyZWRlZmluZSh0YXJnZXQsIGtleSwgc3JjW2tleV0pOwogIHJldHVybiB0YXJnZXQ7Cn07Cn0seyIuLyQucmVkZWZpbmUiOjYzfV0sNjM6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewptb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoJy4vJC5oaWRlJyk7Cn0seyIuLyQuaGlkZSI6NDN9XSw2NDpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Ci8vIDcuMi45IFNhbWVWYWx1ZSh4LCB5KQptb2R1bGUuZXhwb3J0cyA9IE9iamVjdC5pcyB8fCBmdW5jdGlvbiBpcyh4LCB5KXsKICByZXR1cm4geCA9PT0geSA/IHggIT09IDAgfHwgMSAvIHggPT09IDEgLyB5IDogeCAhPSB4ICYmIHkgIT0geTsKfTsKfSx7fV0sNjU6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewovLyBXb3JrcyB3aXRoIF9fcHJvdG9fXyBvbmx5LiBPbGQgdjggY2FuJ3Qgd29yayB3aXRoIG51bGwgcHJvdG8gb2JqZWN0cy4KLyogZXNsaW50LWRpc2FibGUgbm8tcHJvdG8gKi8KdmFyIGdldERlc2MgID0gcmVxdWlyZSgnLi8kJykuZ2V0RGVzYwogICwgaXNPYmplY3QgPSByZXF1aXJlKCcuLyQuaXMtb2JqZWN0JykKICAsIGFuT2JqZWN0ID0gcmVxdWlyZSgnLi8kLmFuLW9iamVjdCcpOwp2YXIgY2hlY2sgPSBmdW5jdGlvbihPLCBwcm90byl7CiAgYW5PYmplY3QoTyk7CiAgaWYoIWlzT2JqZWN0KHByb3RvKSAmJiBwcm90byAhPT0gbnVsbCl0aHJvdyBUeXBlRXJyb3IocHJvdG8gKyAiOiBjYW4ndCBzZXQgYXMgcHJvdG90eXBlISIpOwp9Owptb2R1bGUuZXhwb3J0cyA9IHsKICBzZXQ6IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fCAoJ19fcHJvdG9fXycgaW4ge30gPyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lCiAgICBmdW5jdGlvbih0ZXN0LCBidWdneSwgc2V0KXsKICAgICAgdHJ5IHsKICAgICAgICBzZXQgPSByZXF1aXJlKCcuLyQuY3R4JykoRnVuY3Rpb24uY2FsbCwgZ2V0RGVzYyhPYmplY3QucHJvdG90eXBlLCAnX19wcm90b19fJykuc2V0LCAyKTsKICAgICAgICBzZXQodGVzdCwgW10pOwogICAgICAgIGJ1Z2d5ID0gISh0ZXN0IGluc3RhbmNlb2YgQXJyYXkpOwogICAgICB9IGNhdGNoKGUpeyBidWdneSA9IHRydWU7IH0KICAgICAgcmV0dXJuIGZ1bmN0aW9uIHNldFByb3RvdHlwZU9mKE8sIHByb3RvKXsKICAgICAgICBjaGVjayhPLCBwcm90byk7CiAgICAgICAgaWYoYnVnZ3kpTy5fX3Byb3RvX18gPSBwcm90bzsKICAgICAgICBlbHNlIHNldChPLCBwcm90byk7CiAgICAgICAgcmV0dXJuIE87CiAgICAgIH07CiAgICB9KHt9LCBmYWxzZSkgOiB1bmRlZmluZWQpLAogIGNoZWNrOiBjaGVjawp9Owp9LHsiLi8kIjo1NiwiLi8kLmFuLW9iamVjdCI6MjgsIi4vJC5jdHgiOjMyLCIuLyQuaXMtb2JqZWN0Ijo0OX1dLDY2OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKJ3VzZSBzdHJpY3QnOwp2YXIgY29yZSAgICAgICAgPSByZXF1aXJlKCcuLyQuY29yZScpCiAgLCAkICAgICAgICAgICA9IHJlcXVpcmUoJy4vJCcpCiAgLCBERVNDUklQVE9SUyA9IHJlcXVpcmUoJy4vJC5kZXNjcmlwdG9ycycpCiAgLCBTUEVDSUVTICAgICA9IHJlcXVpcmUoJy4vJC53a3MnKSgnc3BlY2llcycpOwoKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihLRVkpewogIHZhciBDID0gY29yZVtLRVldOwogIGlmKERFU0NSSVBUT1JTICYmIEMgJiYgIUNbU1BFQ0lFU10pJC5zZXREZXNjKEMsIFNQRUNJRVMsIHsKICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgIGdldDogZnVuY3Rpb24oKXsgcmV0dXJuIHRoaXM7IH0KICB9KTsKfTsKfSx7Ii4vJCI6NTYsIi4vJC5jb3JlIjozMSwiLi8kLmRlc2NyaXB0b3JzIjozNCwiLi8kLndrcyI6Nzh9XSw2NzpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7CnZhciBkZWYgPSByZXF1aXJlKCcuLyQnKS5zZXREZXNjCiAgLCBoYXMgPSByZXF1aXJlKCcuLyQuaGFzJykKICAsIFRBRyA9IHJlcXVpcmUoJy4vJC53a3MnKSgndG9TdHJpbmdUYWcnKTsKCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oaXQsIHRhZywgc3RhdCl7CiAgaWYoaXQgJiYgIWhhcyhpdCA9IHN0YXQgPyBpdCA6IGl0LnByb3RvdHlwZSwgVEFHKSlkZWYoaXQsIFRBRywge2NvbmZpZ3VyYWJsZTogdHJ1ZSwgdmFsdWU6IHRhZ30pOwp9Owp9LHsiLi8kIjo1NiwiLi8kLmhhcyI6NDIsIi4vJC53a3MiOjc4fV0sNjg6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewp2YXIgZ2xvYmFsID0gcmVxdWlyZSgnLi8kLmdsb2JhbCcpCiAgLCBTSEFSRUQgPSAnX19jb3JlLWpzX3NoYXJlZF9fJwogICwgc3RvcmUgID0gZ2xvYmFsW1NIQVJFRF0gfHwgKGdsb2JhbFtTSEFSRURdID0ge30pOwptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGtleSl7CiAgcmV0dXJuIHN0b3JlW2tleV0gfHwgKHN0b3JlW2tleV0gPSB7fSk7Cn07Cn0seyIuLyQuZ2xvYmFsIjo0MX1dLDY5OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKLy8gNy4zLjIwIFNwZWNpZXNDb25zdHJ1Y3RvcihPLCBkZWZhdWx0Q29uc3RydWN0b3IpCnZhciBhbk9iamVjdCAgPSByZXF1aXJlKCcuLyQuYW4tb2JqZWN0JykKICAsIGFGdW5jdGlvbiA9IHJlcXVpcmUoJy4vJC5hLWZ1bmN0aW9uJykKICAsIFNQRUNJRVMgICA9IHJlcXVpcmUoJy4vJC53a3MnKSgnc3BlY2llcycpOwptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKE8sIEQpewogIHZhciBDID0gYW5PYmplY3QoTykuY29uc3RydWN0b3IsIFM7CiAgcmV0dXJuIEMgPT09IHVuZGVmaW5lZCB8fCAoUyA9IGFuT2JqZWN0KEMpW1NQRUNJRVNdKSA9PSB1bmRlZmluZWQgPyBEIDogYUZ1bmN0aW9uKFMpOwp9Owp9LHsiLi8kLmEtZnVuY3Rpb24iOjI2LCIuLyQuYW4tb2JqZWN0IjoyOCwiLi8kLndrcyI6Nzh9XSw3MDpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Cm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oaXQsIENvbnN0cnVjdG9yLCBuYW1lKXsKICBpZighKGl0IGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKXRocm93IFR5cGVFcnJvcihuYW1lICsgIjogdXNlIHRoZSAnbmV3JyBvcGVyYXRvciEiKTsKICByZXR1cm4gaXQ7Cn07Cn0se31dLDcxOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKdmFyIHRvSW50ZWdlciA9IHJlcXVpcmUoJy4vJC50by1pbnRlZ2VyJykKICAsIGRlZmluZWQgICA9IHJlcXVpcmUoJy4vJC5kZWZpbmVkJyk7Ci8vIHRydWUgIC0+IFN0cmluZyNhdAovLyBmYWxzZSAtPiBTdHJpbmcjY29kZVBvaW50QXQKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihUT19TVFJJTkcpewogIHJldHVybiBmdW5jdGlvbih0aGF0LCBwb3MpewogICAgdmFyIHMgPSBTdHJpbmcoZGVmaW5lZCh0aGF0KSkKICAgICAgLCBpID0gdG9JbnRlZ2VyKHBvcykKICAgICAgLCBsID0gcy5sZW5ndGgKICAgICAgLCBhLCBiOwogICAgaWYoaSA8IDAgfHwgaSA+PSBsKXJldHVybiBUT19TVFJJTkcgPyAnJyA6IHVuZGVmaW5lZDsKICAgIGEgPSBzLmNoYXJDb2RlQXQoaSk7CiAgICByZXR1cm4gYSA8IDB4ZDgwMCB8fCBhID4gMHhkYmZmIHx8IGkgKyAxID09PSBsIHx8IChiID0gcy5jaGFyQ29kZUF0KGkgKyAxKSkgPCAweGRjMDAgfHwgYiA+IDB4ZGZmZgogICAgICA/IFRPX1NUUklORyA/IHMuY2hhckF0KGkpIDogYQogICAgICA6IFRPX1NUUklORyA/IHMuc2xpY2UoaSwgaSArIDIpIDogKGEgLSAweGQ4MDAgPDwgMTApICsgKGIgLSAweGRjMDApICsgMHgxMDAwMDsKICB9Owp9Owp9LHsiLi8kLmRlZmluZWQiOjMzLCIuLyQudG8taW50ZWdlciI6NzN9XSw3MjpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7CnZhciBjdHggICAgICAgICAgICAgICAgPSByZXF1aXJlKCcuLyQuY3R4JykKICAsIGludm9rZSAgICAgICAgICAgICA9IHJlcXVpcmUoJy4vJC5pbnZva2UnKQogICwgaHRtbCAgICAgICAgICAgICAgID0gcmVxdWlyZSgnLi8kLmh0bWwnKQogICwgY2VsICAgICAgICAgICAgICAgID0gcmVxdWlyZSgnLi8kLmRvbS1jcmVhdGUnKQogICwgZ2xvYmFsICAgICAgICAgICAgID0gcmVxdWlyZSgnLi8kLmdsb2JhbCcpCiAgLCBwcm9jZXNzICAgICAgICAgICAgPSBnbG9iYWwucHJvY2VzcwogICwgc2V0VGFzayAgICAgICAgICAgID0gZ2xvYmFsLnNldEltbWVkaWF0ZQogICwgY2xlYXJUYXNrICAgICAgICAgID0gZ2xvYmFsLmNsZWFySW1tZWRpYXRlCiAgLCBNZXNzYWdlQ2hhbm5lbCAgICAgPSBnbG9iYWwuTWVzc2FnZUNoYW5uZWwKICAsIGNvdW50ZXIgICAgICAgICAgICA9IDAKICAsIHF1ZXVlICAgICAgICAgICAgICA9IHt9CiAgLCBPTlJFQURZU1RBVEVDSEFOR0UgPSAnb25yZWFkeXN0YXRlY2hhbmdlJwogICwgZGVmZXIsIGNoYW5uZWwsIHBvcnQ7CnZhciBydW4gPSBmdW5jdGlvbigpewogIHZhciBpZCA9ICt0aGlzOwogIGlmKHF1ZXVlLmhhc093blByb3BlcnR5KGlkKSl7CiAgICB2YXIgZm4gPSBxdWV1ZVtpZF07CiAgICBkZWxldGUgcXVldWVbaWRdOwogICAgZm4oKTsKICB9Cn07CnZhciBsaXN0bmVyID0gZnVuY3Rpb24oZXZlbnQpewogIHJ1bi5jYWxsKGV2ZW50LmRhdGEpOwp9OwovLyBOb2RlLmpzIDAuOSsgJiBJRTEwKyBoYXMgc2V0SW1tZWRpYXRlLCBvdGhlcndpc2U6CmlmKCFzZXRUYXNrIHx8ICFjbGVhclRhc2spewogIHNldFRhc2sgPSBmdW5jdGlvbiBzZXRJbW1lZGlhdGUoZm4pewogICAgdmFyIGFyZ3MgPSBbXSwgaSA9IDE7CiAgICB3aGlsZShhcmd1bWVudHMubGVuZ3RoID4gaSlhcmdzLnB1c2goYXJndW1lbnRzW2krK10pOwogICAgcXVldWVbKytjb3VudGVyXSA9IGZ1bmN0aW9uKCl7CiAgICAgIGludm9rZSh0eXBlb2YgZm4gPT0gJ2Z1bmN0aW9uJyA/IGZuIDogRnVuY3Rpb24oZm4pLCBhcmdzKTsKICAgIH07CiAgICBkZWZlcihjb3VudGVyKTsKICAgIHJldHVybiBjb3VudGVyOwogIH07CiAgY2xlYXJUYXNrID0gZnVuY3Rpb24gY2xlYXJJbW1lZGlhdGUoaWQpewogICAgZGVsZXRlIHF1ZXVlW2lkXTsKICB9OwogIC8vIE5vZGUuanMgMC44LQogIGlmKHJlcXVpcmUoJy4vJC5jb2YnKShwcm9jZXNzKSA9PSAncHJvY2VzcycpewogICAgZGVmZXIgPSBmdW5jdGlvbihpZCl7CiAgICAgIHByb2Nlc3MubmV4dFRpY2soY3R4KHJ1biwgaWQsIDEpKTsKICAgIH07CiAgLy8gQnJvd3NlcnMgd2l0aCBNZXNzYWdlQ2hhbm5lbCwgaW5jbHVkZXMgV2ViV29ya2VycwogIH0gZWxzZSBpZihNZXNzYWdlQ2hhbm5lbCl7CiAgICBjaGFubmVsID0gbmV3IE1lc3NhZ2VDaGFubmVsOwogICAgcG9ydCAgICA9IGNoYW5uZWwucG9ydDI7CiAgICBjaGFubmVsLnBvcnQxLm9ubWVzc2FnZSA9IGxpc3RuZXI7CiAgICBkZWZlciA9IGN0eChwb3J0LnBvc3RNZXNzYWdlLCBwb3J0LCAxKTsKICAvLyBCcm93c2VycyB3aXRoIHBvc3RNZXNzYWdlLCBza2lwIFdlYldvcmtlcnMKICAvLyBJRTggaGFzIHBvc3RNZXNzYWdlLCBidXQgaXQncyBzeW5jICYgdHlwZW9mIGl0cyBwb3N0TWVzc2FnZSBpcyAnb2JqZWN0JwogIH0gZWxzZSBpZihnbG9iYWwuYWRkRXZlbnRMaXN0ZW5lciAmJiB0eXBlb2YgcG9zdE1lc3NhZ2UgPT0gJ2Z1bmN0aW9uJyAmJiAhZ2xvYmFsLmltcG9ydFNjcmlwdHMpewogICAgZGVmZXIgPSBmdW5jdGlvbihpZCl7CiAgICAgIGdsb2JhbC5wb3N0TWVzc2FnZShpZCArICcnLCAnKicpOwogICAgfTsKICAgIGdsb2JhbC5hZGRFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgbGlzdG5lciwgZmFsc2UpOwogIC8vIElFOC0KICB9IGVsc2UgaWYoT05SRUFEWVNUQVRFQ0hBTkdFIGluIGNlbCgnc2NyaXB0JykpewogICAgZGVmZXIgPSBmdW5jdGlvbihpZCl7CiAgICAgIGh0bWwuYXBwZW5kQ2hpbGQoY2VsKCdzY3JpcHQnKSlbT05SRUFEWVNUQVRFQ0hBTkdFXSA9IGZ1bmN0aW9uKCl7CiAgICAgICAgaHRtbC5yZW1vdmVDaGlsZCh0aGlzKTsKICAgICAgICBydW4uY2FsbChpZCk7CiAgICAgIH07CiAgICB9OwogIC8vIFJlc3Qgb2xkIGJyb3dzZXJzCiAgfSBlbHNlIHsKICAgIGRlZmVyID0gZnVuY3Rpb24oaWQpewogICAgICBzZXRUaW1lb3V0KGN0eChydW4sIGlkLCAxKSwgMCk7CiAgICB9OwogIH0KfQptb2R1bGUuZXhwb3J0cyA9IHsKICBzZXQ6ICAgc2V0VGFzaywKICBjbGVhcjogY2xlYXJUYXNrCn07Cn0seyIuLyQuY29mIjozMCwiLi8kLmN0eCI6MzIsIi4vJC5kb20tY3JlYXRlIjozNSwiLi8kLmdsb2JhbCI6NDEsIi4vJC5odG1sIjo0NCwiLi8kLmludm9rZSI6NDV9XSw3MzpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Ci8vIDcuMS40IFRvSW50ZWdlcgp2YXIgY2VpbCAgPSBNYXRoLmNlaWwKICAsIGZsb29yID0gTWF0aC5mbG9vcjsKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihpdCl7CiAgcmV0dXJuIGlzTmFOKGl0ID0gK2l0KSA/IDAgOiAoaXQgPiAwID8gZmxvb3IgOiBjZWlsKShpdCk7Cn07Cn0se31dLDc0OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKLy8gdG8gaW5kZXhlZCBvYmplY3QsIHRvT2JqZWN0IHdpdGggZmFsbGJhY2sgZm9yIG5vbi1hcnJheS1saWtlIEVTMyBzdHJpbmdzCnZhciBJT2JqZWN0ID0gcmVxdWlyZSgnLi8kLmlvYmplY3QnKQogICwgZGVmaW5lZCA9IHJlcXVpcmUoJy4vJC5kZWZpbmVkJyk7Cm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oaXQpewogIHJldHVybiBJT2JqZWN0KGRlZmluZWQoaXQpKTsKfTsKfSx7Ii4vJC5kZWZpbmVkIjozMywiLi8kLmlvYmplY3QiOjQ2fV0sNzU6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewovLyA3LjEuMTUgVG9MZW5ndGgKdmFyIHRvSW50ZWdlciA9IHJlcXVpcmUoJy4vJC50by1pbnRlZ2VyJykKICAsIG1pbiAgICAgICA9IE1hdGgubWluOwptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGl0KXsKICByZXR1cm4gaXQgPiAwID8gbWluKHRvSW50ZWdlcihpdCksIDB4MWZmZmZmZmZmZmZmZmYpIDogMDsgLy8gcG93KDIsIDUzKSAtIDEgPT0gOTAwNzE5OTI1NDc0MDk5MQp9Owp9LHsiLi8kLnRvLWludGVnZXIiOjczfV0sNzY6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewovLyA3LjEuMTMgVG9PYmplY3QoYXJndW1lbnQpCnZhciBkZWZpbmVkID0gcmVxdWlyZSgnLi8kLmRlZmluZWQnKTsKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihpdCl7CiAgcmV0dXJuIE9iamVjdChkZWZpbmVkKGl0KSk7Cn07Cn0seyIuLyQuZGVmaW5lZCI6MzN9XSw3NzpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7CnZhciBpZCA9IDAKICAsIHB4ID0gTWF0aC5yYW5kb20oKTsKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihrZXkpewogIHJldHVybiAnU3ltYm9sKCcuY29uY2F0KGtleSA9PT0gdW5kZWZpbmVkID8gJycgOiBrZXksICcpXycsICgrK2lkICsgcHgpLnRvU3RyaW5nKDM2KSk7Cn07Cn0se31dLDc4OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKdmFyIHN0b3JlICA9IHJlcXVpcmUoJy4vJC5zaGFyZWQnKSgnd2tzJykKICAsIHVpZCAgICA9IHJlcXVpcmUoJy4vJC51aWQnKQogICwgU3ltYm9sID0gcmVxdWlyZSgnLi8kLmdsb2JhbCcpLlN5bWJvbDsKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihuYW1lKXsKICByZXR1cm4gc3RvcmVbbmFtZV0gfHwgKHN0b3JlW25hbWVdID0KICAgIFN5bWJvbCAmJiBTeW1ib2xbbmFtZV0gfHwgKFN5bWJvbCB8fCB1aWQpKCdTeW1ib2wuJyArIG5hbWUpKTsKfTsKfSx7Ii4vJC5nbG9iYWwiOjQxLCIuLyQuc2hhcmVkIjo2OCwiLi8kLnVpZCI6Nzd9XSw3OTpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7CnZhciBjbGFzc29mICAgPSByZXF1aXJlKCcuLyQuY2xhc3NvZicpCiAgLCBJVEVSQVRPUiAgPSByZXF1aXJlKCcuLyQud2tzJykoJ2l0ZXJhdG9yJykKICAsIEl0ZXJhdG9ycyA9IHJlcXVpcmUoJy4vJC5pdGVyYXRvcnMnKTsKbW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKCcuLyQuY29yZScpLmdldEl0ZXJhdG9yTWV0aG9kID0gZnVuY3Rpb24oaXQpewogIGlmKGl0ICE9IHVuZGVmaW5lZClyZXR1cm4gaXRbSVRFUkFUT1JdCiAgICB8fCBpdFsnQEBpdGVyYXRvciddCiAgICB8fCBJdGVyYXRvcnNbY2xhc3NvZihpdCldOwp9Owp9LHsiLi8kLmNsYXNzb2YiOjI5LCIuLyQuY29yZSI6MzEsIi4vJC5pdGVyYXRvcnMiOjU1LCIuLyQud2tzIjo3OH1dLDgwOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKJ3VzZSBzdHJpY3QnOwp2YXIgYWRkVG9VbnNjb3BhYmxlcyA9IHJlcXVpcmUoJy4vJC5hZGQtdG8tdW5zY29wYWJsZXMnKQogICwgc3RlcCAgICAgICAgICAgICA9IHJlcXVpcmUoJy4vJC5pdGVyLXN0ZXAnKQogICwgSXRlcmF0b3JzICAgICAgICA9IHJlcXVpcmUoJy4vJC5pdGVyYXRvcnMnKQogICwgdG9JT2JqZWN0ICAgICAgICA9IHJlcXVpcmUoJy4vJC50by1pb2JqZWN0Jyk7CgovLyAyMi4xLjMuNCBBcnJheS5wcm90b3R5cGUuZW50cmllcygpCi8vIDIyLjEuMy4xMyBBcnJheS5wcm90b3R5cGUua2V5cygpCi8vIDIyLjEuMy4yOSBBcnJheS5wcm90b3R5cGUudmFsdWVzKCkKLy8gMjIuMS4zLjMwIEFycmF5LnByb3RvdHlwZVtAQGl0ZXJhdG9yXSgpCm1vZHVsZS5leHBvcnRzID0gcmVxdWlyZSgnLi8kLml0ZXItZGVmaW5lJykoQXJyYXksICdBcnJheScsIGZ1bmN0aW9uKGl0ZXJhdGVkLCBraW5kKXsKICB0aGlzLl90ID0gdG9JT2JqZWN0KGl0ZXJhdGVkKTsgLy8gdGFyZ2V0CiAgdGhpcy5faSA9IDA7ICAgICAgICAgICAgICAgICAgIC8vIG5leHQgaW5kZXgKICB0aGlzLl9rID0ga2luZDsgICAgICAgICAgICAgICAgLy8ga2luZAovLyAyMi4xLjUuMi4xICVBcnJheUl0ZXJhdG9yUHJvdG90eXBlJS5uZXh0KCkKfSwgZnVuY3Rpb24oKXsKICB2YXIgTyAgICAgPSB0aGlzLl90CiAgICAsIGtpbmQgID0gdGhpcy5fawogICAgLCBpbmRleCA9IHRoaXMuX2krKzsKICBpZighTyB8fCBpbmRleCA+PSBPLmxlbmd0aCl7CiAgICB0aGlzLl90ID0gdW5kZWZpbmVkOwogICAgcmV0dXJuIHN0ZXAoMSk7CiAgfQogIGlmKGtpbmQgPT0gJ2tleXMnICApcmV0dXJuIHN0ZXAoMCwgaW5kZXgpOwogIGlmKGtpbmQgPT0gJ3ZhbHVlcycpcmV0dXJuIHN0ZXAoMCwgT1tpbmRleF0pOwogIHJldHVybiBzdGVwKDAsIFtpbmRleCwgT1tpbmRleF1dKTsKfSwgJ3ZhbHVlcycpOwoKLy8gYXJndW1lbnRzTGlzdFtAQGl0ZXJhdG9yXSBpcyAlQXJyYXlQcm90b192YWx1ZXMlICg5LjQuNC42LCA5LjQuNC43KQpJdGVyYXRvcnMuQXJndW1lbnRzID0gSXRlcmF0b3JzLkFycmF5OwoKYWRkVG9VbnNjb3BhYmxlcygna2V5cycpOwphZGRUb1Vuc2NvcGFibGVzKCd2YWx1ZXMnKTsKYWRkVG9VbnNjb3BhYmxlcygnZW50cmllcycpOwp9LHsiLi8kLmFkZC10by11bnNjb3BhYmxlcyI6MjcsIi4vJC5pdGVyLWRlZmluZSI6NTIsIi4vJC5pdGVyLXN0ZXAiOjU0LCIuLyQuaXRlcmF0b3JzIjo1NSwiLi8kLnRvLWlvYmplY3QiOjc0fV0sODE6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewovLyAxOS4xLjIuNiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKE8sIFApCnZhciB0b0lPYmplY3QgPSByZXF1aXJlKCcuLyQudG8taW9iamVjdCcpOwoKcmVxdWlyZSgnLi8kLm9iamVjdC1zYXAnKSgnZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yJywgZnVuY3Rpb24oJGdldE93blByb3BlcnR5RGVzY3JpcHRvcil7CiAgcmV0dXJuIGZ1bmN0aW9uIGdldE93blByb3BlcnR5RGVzY3JpcHRvcihpdCwga2V5KXsKICAgIHJldHVybiAkZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHRvSU9iamVjdChpdCksIGtleSk7CiAgfTsKfSk7Cn0seyIuLyQub2JqZWN0LXNhcCI6NjAsIi4vJC50by1pb2JqZWN0Ijo3NH1dLDgyOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKLy8gMTkuMS4yLjkgT2JqZWN0LmdldFByb3RvdHlwZU9mKE8pCnZhciB0b09iamVjdCA9IHJlcXVpcmUoJy4vJC50by1vYmplY3QnKTsKCnJlcXVpcmUoJy4vJC5vYmplY3Qtc2FwJykoJ2dldFByb3RvdHlwZU9mJywgZnVuY3Rpb24oJGdldFByb3RvdHlwZU9mKXsKICByZXR1cm4gZnVuY3Rpb24gZ2V0UHJvdG90eXBlT2YoaXQpewogICAgcmV0dXJuICRnZXRQcm90b3R5cGVPZih0b09iamVjdChpdCkpOwogIH07Cn0pOwp9LHsiLi8kLm9iamVjdC1zYXAiOjYwLCIuLyQudG8tb2JqZWN0Ijo3Nn1dLDgzOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKLy8gMTkuMS4yLjE0IE9iamVjdC5rZXlzKE8pCnZhciB0b09iamVjdCA9IHJlcXVpcmUoJy4vJC50by1vYmplY3QnKTsKCnJlcXVpcmUoJy4vJC5vYmplY3Qtc2FwJykoJ2tleXMnLCBmdW5jdGlvbigka2V5cyl7CiAgcmV0dXJuIGZ1bmN0aW9uIGtleXMoaXQpewogICAgcmV0dXJuICRrZXlzKHRvT2JqZWN0KGl0KSk7CiAgfTsKfSk7Cn0seyIuLyQub2JqZWN0LXNhcCI6NjAsIi4vJC50by1vYmplY3QiOjc2fV0sODQ6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewovLyAxOS4xLjMuMTkgT2JqZWN0LnNldFByb3RvdHlwZU9mKE8sIHByb3RvKQp2YXIgJGV4cG9ydCA9IHJlcXVpcmUoJy4vJC5leHBvcnQnKTsKJGV4cG9ydCgkZXhwb3J0LlMsICdPYmplY3QnLCB7c2V0UHJvdG90eXBlT2Y6IHJlcXVpcmUoJy4vJC5zZXQtcHJvdG8nKS5zZXR9KTsKfSx7Ii4vJC5leHBvcnQiOjM3LCIuLyQuc2V0LXByb3RvIjo2NX1dLDg1OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKCn0se31dLDg2OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKJ3VzZSBzdHJpY3QnOwp2YXIgJCAgICAgICAgICA9IHJlcXVpcmUoJy4vJCcpCiAgLCBMSUJSQVJZICAgID0gcmVxdWlyZSgnLi8kLmxpYnJhcnknKQogICwgZ2xvYmFsICAgICA9IHJlcXVpcmUoJy4vJC5nbG9iYWwnKQogICwgY3R4ICAgICAgICA9IHJlcXVpcmUoJy4vJC5jdHgnKQogICwgY2xhc3NvZiAgICA9IHJlcXVpcmUoJy4vJC5jbGFzc29mJykKICAsICRleHBvcnQgICAgPSByZXF1aXJlKCcuLyQuZXhwb3J0JykKICAsIGlzT2JqZWN0ICAgPSByZXF1aXJlKCcuLyQuaXMtb2JqZWN0JykKICAsIGFuT2JqZWN0ICAgPSByZXF1aXJlKCcuLyQuYW4tb2JqZWN0JykKICAsIGFGdW5jdGlvbiAgPSByZXF1aXJlKCcuLyQuYS1mdW5jdGlvbicpCiAgLCBzdHJpY3ROZXcgID0gcmVxdWlyZSgnLi8kLnN0cmljdC1uZXcnKQogICwgZm9yT2YgICAgICA9IHJlcXVpcmUoJy4vJC5mb3Itb2YnKQogICwgc2V0UHJvdG8gICA9IHJlcXVpcmUoJy4vJC5zZXQtcHJvdG8nKS5zZXQKICAsIHNhbWUgICAgICAgPSByZXF1aXJlKCcuLyQuc2FtZS12YWx1ZScpCiAgLCBTUEVDSUVTICAgID0gcmVxdWlyZSgnLi8kLndrcycpKCdzcGVjaWVzJykKICAsIHNwZWNpZXNDb25zdHJ1Y3RvciA9IHJlcXVpcmUoJy4vJC5zcGVjaWVzLWNvbnN0cnVjdG9yJykKICAsIGFzYXAgICAgICAgPSByZXF1aXJlKCcuLyQubWljcm90YXNrJykKICAsIFBST01JU0UgICAgPSAnUHJvbWlzZScKICAsIHByb2Nlc3MgICAgPSBnbG9iYWwucHJvY2VzcwogICwgaXNOb2RlICAgICA9IGNsYXNzb2YocHJvY2VzcykgPT0gJ3Byb2Nlc3MnCiAgLCBQICAgICAgICAgID0gZ2xvYmFsW1BST01JU0VdCiAgLCBXcmFwcGVyOwoKdmFyIHRlc3RSZXNvbHZlID0gZnVuY3Rpb24oc3ViKXsKICB2YXIgdGVzdCA9IG5ldyBQKGZ1bmN0aW9uKCl7fSk7CiAgaWYoc3ViKXRlc3QuY29uc3RydWN0b3IgPSBPYmplY3Q7CiAgcmV0dXJuIFAucmVzb2x2ZSh0ZXN0KSA9PT0gdGVzdDsKfTsKCnZhciBVU0VfTkFUSVZFID0gZnVuY3Rpb24oKXsKICB2YXIgd29ya3MgPSBmYWxzZTsKICBmdW5jdGlvbiBQMih4KXsKICAgIHZhciBzZWxmID0gbmV3IFAoeCk7CiAgICBzZXRQcm90byhzZWxmLCBQMi5wcm90b3R5cGUpOwogICAgcmV0dXJuIHNlbGY7CiAgfQogIHRyeSB7CiAgICB3b3JrcyA9IFAgJiYgUC5yZXNvbHZlICYmIHRlc3RSZXNvbHZlKCk7CiAgICBzZXRQcm90byhQMiwgUCk7CiAgICBQMi5wcm90b3R5cGUgPSAkLmNyZWF0ZShQLnByb3RvdHlwZSwge2NvbnN0cnVjdG9yOiB7dmFsdWU6IFAyfX0pOwogICAgLy8gYWN0dWFsIEZpcmVmb3ggaGFzIGJyb2tlbiBzdWJjbGFzcyBzdXBwb3J0LCB0ZXN0IHRoYXQKICAgIGlmKCEoUDIucmVzb2x2ZSg1KS50aGVuKGZ1bmN0aW9uKCl7fSkgaW5zdGFuY2VvZiBQMikpewogICAgICB3b3JrcyA9IGZhbHNlOwogICAgfQogICAgLy8gYWN0dWFsIFY4IGJ1ZywgaHR0cHM6Ly9jb2RlLmdvb2dsZS5jb20vcC92OC9pc3N1ZXMvZGV0YWlsP2lkPTQxNjIKICAgIGlmKHdvcmtzICYmIHJlcXVpcmUoJy4vJC5kZXNjcmlwdG9ycycpKXsKICAgICAgdmFyIHRoZW5hYmxlVGhlbkdvdHRlbiA9IGZhbHNlOwogICAgICBQLnJlc29sdmUoJC5zZXREZXNjKHt9LCAndGhlbicsIHsKICAgICAgICBnZXQ6IGZ1bmN0aW9uKCl7IHRoZW5hYmxlVGhlbkdvdHRlbiA9IHRydWU7IH0KICAgICAgfSkpOwogICAgICB3b3JrcyA9IHRoZW5hYmxlVGhlbkdvdHRlbjsKICAgIH0KICB9IGNhdGNoKGUpeyB3b3JrcyA9IGZhbHNlOyB9CiAgcmV0dXJuIHdvcmtzOwp9KCk7CgovLyBoZWxwZXJzCnZhciBzYW1lQ29uc3RydWN0b3IgPSBmdW5jdGlvbihhLCBiKXsKICAvLyBsaWJyYXJ5IHdyYXBwZXIgc3BlY2lhbCBjYXNlCiAgaWYoTElCUkFSWSAmJiBhID09PSBQICYmIGIgPT09IFdyYXBwZXIpcmV0dXJuIHRydWU7CiAgcmV0dXJuIHNhbWUoYSwgYik7Cn07CnZhciBnZXRDb25zdHJ1Y3RvciA9IGZ1bmN0aW9uKEMpewogIHZhciBTID0gYW5PYmplY3QoQylbU1BFQ0lFU107CiAgcmV0dXJuIFMgIT0gdW5kZWZpbmVkID8gUyA6IEM7Cn07CnZhciBpc1RoZW5hYmxlID0gZnVuY3Rpb24oaXQpewogIHZhciB0aGVuOwogIHJldHVybiBpc09iamVjdChpdCkgJiYgdHlwZW9mICh0aGVuID0gaXQudGhlbikgPT0gJ2Z1bmN0aW9uJyA/IHRoZW4gOiBmYWxzZTsKfTsKdmFyIFByb21pc2VDYXBhYmlsaXR5ID0gZnVuY3Rpb24oQyl7CiAgdmFyIHJlc29sdmUsIHJlamVjdDsKICB0aGlzLnByb21pc2UgPSBuZXcgQyhmdW5jdGlvbigkJHJlc29sdmUsICQkcmVqZWN0KXsKICAgIGlmKHJlc29sdmUgIT09IHVuZGVmaW5lZCB8fCByZWplY3QgIT09IHVuZGVmaW5lZCl0aHJvdyBUeXBlRXJyb3IoJ0JhZCBQcm9taXNlIGNvbnN0cnVjdG9yJyk7CiAgICByZXNvbHZlID0gJCRyZXNvbHZlOwogICAgcmVqZWN0ICA9ICQkcmVqZWN0OwogIH0pOwogIHRoaXMucmVzb2x2ZSA9IGFGdW5jdGlvbihyZXNvbHZlKSwKICB0aGlzLnJlamVjdCAgPSBhRnVuY3Rpb24ocmVqZWN0KQp9Owp2YXIgcGVyZm9ybSA9IGZ1bmN0aW9uKGV4ZWMpewogIHRyeSB7CiAgICBleGVjKCk7CiAgfSBjYXRjaChlKXsKICAgIHJldHVybiB7ZXJyb3I6IGV9OwogIH0KfTsKdmFyIG5vdGlmeSA9IGZ1bmN0aW9uKHJlY29yZCwgaXNSZWplY3QpewogIGlmKHJlY29yZC5uKXJldHVybjsKICByZWNvcmQubiA9IHRydWU7CiAgdmFyIGNoYWluID0gcmVjb3JkLmM7CiAgYXNhcChmdW5jdGlvbigpewogICAgdmFyIHZhbHVlID0gcmVjb3JkLnYKICAgICAgLCBvayAgICA9IHJlY29yZC5zID09IDEKICAgICAgLCBpICAgICA9IDA7CiAgICB2YXIgcnVuID0gZnVuY3Rpb24ocmVhY3Rpb24pewogICAgICB2YXIgaGFuZGxlciA9IG9rID8gcmVhY3Rpb24ub2sgOiByZWFjdGlvbi5mYWlsCiAgICAgICAgLCByZXNvbHZlID0gcmVhY3Rpb24ucmVzb2x2ZQogICAgICAgICwgcmVqZWN0ICA9IHJlYWN0aW9uLnJlamVjdAogICAgICAgICwgcmVzdWx0LCB0aGVuOwogICAgICB0cnkgewogICAgICAgIGlmKGhhbmRsZXIpewogICAgICAgICAgaWYoIW9rKXJlY29yZC5oID0gdHJ1ZTsKICAgICAgICAgIHJlc3VsdCA9IGhhbmRsZXIgPT09IHRydWUgPyB2YWx1ZSA6IGhhbmRsZXIodmFsdWUpOwogICAgICAgICAgaWYocmVzdWx0ID09PSByZWFjdGlvbi5wcm9taXNlKXsKICAgICAgICAgICAgcmVqZWN0KFR5cGVFcnJvcignUHJvbWlzZS1jaGFpbiBjeWNsZScpKTsKICAgICAgICAgIH0gZWxzZSBpZih0aGVuID0gaXNUaGVuYWJsZShyZXN1bHQpKXsKICAgICAgICAgICAgdGhlbi5jYWxsKHJlc3VsdCwgcmVzb2x2ZSwgcmVqZWN0KTsKICAgICAgICAgIH0gZWxzZSByZXNvbHZlKHJlc3VsdCk7CiAgICAgICAgfSBlbHNlIHJlamVjdCh2YWx1ZSk7CiAgICAgIH0gY2F0Y2goZSl7CiAgICAgICAgcmVqZWN0KGUpOwogICAgICB9CiAgICB9OwogICAgd2hpbGUoY2hhaW4ubGVuZ3RoID4gaSlydW4oY2hhaW5baSsrXSk7IC8vIHZhcmlhYmxlIGxlbmd0aCAtIGNhbid0IHVzZSBmb3JFYWNoCiAgICBjaGFpbi5sZW5ndGggPSAwOwogICAgcmVjb3JkLm4gPSBmYWxzZTsKICAgIGlmKGlzUmVqZWN0KXNldFRpbWVvdXQoZnVuY3Rpb24oKXsKICAgICAgdmFyIHByb21pc2UgPSByZWNvcmQucAogICAgICAgICwgaGFuZGxlciwgY29uc29sZTsKICAgICAgaWYoaXNVbmhhbmRsZWQocHJvbWlzZSkpewogICAgICAgIGlmKGlzTm9kZSl7CiAgICAgICAgICBwcm9jZXNzLmVtaXQoJ3VuaGFuZGxlZFJlamVjdGlvbicsIHZhbHVlLCBwcm9taXNlKTsKICAgICAgICB9IGVsc2UgaWYoaGFuZGxlciA9IGdsb2JhbC5vbnVuaGFuZGxlZHJlamVjdGlvbil7CiAgICAgICAgICBoYW5kbGVyKHtwcm9taXNlOiBwcm9taXNlLCByZWFzb246IHZhbHVlfSk7CiAgICAgICAgfSBlbHNlIGlmKChjb25zb2xlID0gZ2xvYmFsLmNvbnNvbGUpICYmIGNvbnNvbGUuZXJyb3IpewogICAgICAgICAgY29uc29sZS5lcnJvcignVW5oYW5kbGVkIHByb21pc2UgcmVqZWN0aW9uJywgdmFsdWUpOwogICAgICAgIH0KICAgICAgfSByZWNvcmQuYSA9IHVuZGVmaW5lZDsKICAgIH0sIDEpOwogIH0pOwp9Owp2YXIgaXNVbmhhbmRsZWQgPSBmdW5jdGlvbihwcm9taXNlKXsKICB2YXIgcmVjb3JkID0gcHJvbWlzZS5fZAogICAgLCBjaGFpbiAgPSByZWNvcmQuYSB8fCByZWNvcmQuYwogICAgLCBpICAgICAgPSAwCiAgICAsIHJlYWN0aW9uOwogIGlmKHJlY29yZC5oKXJldHVybiBmYWxzZTsKICB3aGlsZShjaGFpbi5sZW5ndGggPiBpKXsKICAgIHJlYWN0aW9uID0gY2hhaW5baSsrXTsKICAgIGlmKHJlYWN0aW9uLmZhaWwgfHwgIWlzVW5oYW5kbGVkKHJlYWN0aW9uLnByb21pc2UpKXJldHVybiBmYWxzZTsKICB9IHJldHVybiB0cnVlOwp9Owp2YXIgJHJlamVjdCA9IGZ1bmN0aW9uKHZhbHVlKXsKICB2YXIgcmVjb3JkID0gdGhpczsKICBpZihyZWNvcmQuZClyZXR1cm47CiAgcmVjb3JkLmQgPSB0cnVlOwogIHJlY29yZCA9IHJlY29yZC5yIHx8IHJlY29yZDsgLy8gdW53cmFwCiAgcmVjb3JkLnYgPSB2YWx1ZTsKICByZWNvcmQucyA9IDI7CiAgcmVjb3JkLmEgPSByZWNvcmQuYy5zbGljZSgpOwogIG5vdGlmeShyZWNvcmQsIHRydWUpOwp9Owp2YXIgJHJlc29sdmUgPSBmdW5jdGlvbih2YWx1ZSl7CiAgdmFyIHJlY29yZCA9IHRoaXMKICAgICwgdGhlbjsKICBpZihyZWNvcmQuZClyZXR1cm47CiAgcmVjb3JkLmQgPSB0cnVlOwogIHJlY29yZCA9IHJlY29yZC5yIHx8IHJlY29yZDsgLy8gdW53cmFwCiAgdHJ5IHsKICAgIGlmKHJlY29yZC5wID09PSB2YWx1ZSl0aHJvdyBUeXBlRXJyb3IoIlByb21pc2UgY2FuJ3QgYmUgcmVzb2x2ZWQgaXRzZWxmIik7CiAgICBpZih0aGVuID0gaXNUaGVuYWJsZSh2YWx1ZSkpewogICAgICBhc2FwKGZ1bmN0aW9uKCl7CiAgICAgICAgdmFyIHdyYXBwZXIgPSB7cjogcmVjb3JkLCBkOiBmYWxzZX07IC8vIHdyYXAKICAgICAgICB0cnkgewogICAgICAgICAgdGhlbi5jYWxsKHZhbHVlLCBjdHgoJHJlc29sdmUsIHdyYXBwZXIsIDEpLCBjdHgoJHJlamVjdCwgd3JhcHBlciwgMSkpOwogICAgICAgIH0gY2F0Y2goZSl7CiAgICAgICAgICAkcmVqZWN0LmNhbGwod3JhcHBlciwgZSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgIHJlY29yZC52ID0gdmFsdWU7CiAgICAgIHJlY29yZC5zID0gMTsKICAgICAgbm90aWZ5KHJlY29yZCwgZmFsc2UpOwogICAgfQogIH0gY2F0Y2goZSl7CiAgICAkcmVqZWN0LmNhbGwoe3I6IHJlY29yZCwgZDogZmFsc2V9LCBlKTsgLy8gd3JhcAogIH0KfTsKCi8vIGNvbnN0cnVjdG9yIHBvbHlmaWxsCmlmKCFVU0VfTkFUSVZFKXsKICAvLyAyNS40LjMuMSBQcm9taXNlKGV4ZWN1dG9yKQogIFAgPSBmdW5jdGlvbiBQcm9taXNlKGV4ZWN1dG9yKXsKICAgIGFGdW5jdGlvbihleGVjdXRvcik7CiAgICB2YXIgcmVjb3JkID0gdGhpcy5fZCA9IHsKICAgICAgcDogc3RyaWN0TmV3KHRoaXMsIFAsIFBST01JU0UpLCAgICAgICAgIC8vIDwtIHByb21pc2UKICAgICAgYzogW10sICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIDwtIGF3YWl0aW5nIHJlYWN0aW9ucwogICAgICBhOiB1bmRlZmluZWQsICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gPC0gY2hlY2tlZCBpbiBpc1VuaGFuZGxlZCByZWFjdGlvbnMKICAgICAgczogMCwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIDwtIHN0YXRlCiAgICAgIGQ6IGZhbHNlLCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyA8LSBkb25lCiAgICAgIHY6IHVuZGVmaW5lZCwgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyA8LSB2YWx1ZQogICAgICBoOiBmYWxzZSwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gPC0gaGFuZGxlZCByZWplY3Rpb24KICAgICAgbjogZmFsc2UgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIDwtIG5vdGlmeQogICAgfTsKICAgIHRyeSB7CiAgICAgIGV4ZWN1dG9yKGN0eCgkcmVzb2x2ZSwgcmVjb3JkLCAxKSwgY3R4KCRyZWplY3QsIHJlY29yZCwgMSkpOwogICAgfSBjYXRjaChlcnIpewogICAgICAkcmVqZWN0LmNhbGwocmVjb3JkLCBlcnIpOwogICAgfQogIH07CiAgcmVxdWlyZSgnLi8kLnJlZGVmaW5lLWFsbCcpKFAucHJvdG90eXBlLCB7CiAgICAvLyAyNS40LjUuMyBQcm9taXNlLnByb3RvdHlwZS50aGVuKG9uRnVsZmlsbGVkLCBvblJlamVjdGVkKQogICAgdGhlbjogZnVuY3Rpb24gdGhlbihvbkZ1bGZpbGxlZCwgb25SZWplY3RlZCl7CiAgICAgIHZhciByZWFjdGlvbiA9IG5ldyBQcm9taXNlQ2FwYWJpbGl0eShzcGVjaWVzQ29uc3RydWN0b3IodGhpcywgUCkpCiAgICAgICAgLCBwcm9taXNlICA9IHJlYWN0aW9uLnByb21pc2UKICAgICAgICAsIHJlY29yZCAgID0gdGhpcy5fZDsKICAgICAgcmVhY3Rpb24ub2sgICA9IHR5cGVvZiBvbkZ1bGZpbGxlZCA9PSAnZnVuY3Rpb24nID8gb25GdWxmaWxsZWQgOiB0cnVlOwogICAgICByZWFjdGlvbi5mYWlsID0gdHlwZW9mIG9uUmVqZWN0ZWQgPT0gJ2Z1bmN0aW9uJyAmJiBvblJlamVjdGVkOwogICAgICByZWNvcmQuYy5wdXNoKHJlYWN0aW9uKTsKICAgICAgaWYocmVjb3JkLmEpcmVjb3JkLmEucHVzaChyZWFjdGlvbik7CiAgICAgIGlmKHJlY29yZC5zKW5vdGlmeShyZWNvcmQsIGZhbHNlKTsKICAgICAgcmV0dXJuIHByb21pc2U7CiAgICB9LAogICAgLy8gMjUuNC41LjEgUHJvbWlzZS5wcm90b3R5cGUuY2F0Y2gob25SZWplY3RlZCkKICAgICdjYXRjaCc6IGZ1bmN0aW9uKG9uUmVqZWN0ZWQpewogICAgICByZXR1cm4gdGhpcy50aGVuKHVuZGVmaW5lZCwgb25SZWplY3RlZCk7CiAgICB9CiAgfSk7Cn0KCiRleHBvcnQoJGV4cG9ydC5HICsgJGV4cG9ydC5XICsgJGV4cG9ydC5GICogIVVTRV9OQVRJVkUsIHtQcm9taXNlOiBQfSk7CnJlcXVpcmUoJy4vJC5zZXQtdG8tc3RyaW5nLXRhZycpKFAsIFBST01JU0UpOwpyZXF1aXJlKCcuLyQuc2V0LXNwZWNpZXMnKShQUk9NSVNFKTsKV3JhcHBlciA9IHJlcXVpcmUoJy4vJC5jb3JlJylbUFJPTUlTRV07CgovLyBzdGF0aWNzCiRleHBvcnQoJGV4cG9ydC5TICsgJGV4cG9ydC5GICogIVVTRV9OQVRJVkUsIFBST01JU0UsIHsKICAvLyAyNS40LjQuNSBQcm9taXNlLnJlamVjdChyKQogIHJlamVjdDogZnVuY3Rpb24gcmVqZWN0KHIpewogICAgdmFyIGNhcGFiaWxpdHkgPSBuZXcgUHJvbWlzZUNhcGFiaWxpdHkodGhpcykKICAgICAgLCAkJHJlamVjdCAgID0gY2FwYWJpbGl0eS5yZWplY3Q7CiAgICAkJHJlamVjdChyKTsKICAgIHJldHVybiBjYXBhYmlsaXR5LnByb21pc2U7CiAgfQp9KTsKJGV4cG9ydCgkZXhwb3J0LlMgKyAkZXhwb3J0LkYgKiAoIVVTRV9OQVRJVkUgfHwgdGVzdFJlc29sdmUodHJ1ZSkpLCBQUk9NSVNFLCB7CiAgLy8gMjUuNC40LjYgUHJvbWlzZS5yZXNvbHZlKHgpCiAgcmVzb2x2ZTogZnVuY3Rpb24gcmVzb2x2ZSh4KXsKICAgIC8vIGluc3RhbmNlb2YgaW5zdGVhZCBvZiBpbnRlcm5hbCBzbG90IGNoZWNrIGJlY2F1c2Ugd2Ugc2hvdWxkIGZpeCBpdCB3aXRob3V0IHJlcGxhY2VtZW50IG5hdGl2ZSBQcm9taXNlIGNvcmUKICAgIGlmKHggaW5zdGFuY2VvZiBQICYmIHNhbWVDb25zdHJ1Y3Rvcih4LmNvbnN0cnVjdG9yLCB0aGlzKSlyZXR1cm4geDsKICAgIHZhciBjYXBhYmlsaXR5ID0gbmV3IFByb21pc2VDYXBhYmlsaXR5KHRoaXMpCiAgICAgICwgJCRyZXNvbHZlICA9IGNhcGFiaWxpdHkucmVzb2x2ZTsKICAgICQkcmVzb2x2ZSh4KTsKICAgIHJldHVybiBjYXBhYmlsaXR5LnByb21pc2U7CiAgfQp9KTsKJGV4cG9ydCgkZXhwb3J0LlMgKyAkZXhwb3J0LkYgKiAhKFVTRV9OQVRJVkUgJiYgcmVxdWlyZSgnLi8kLml0ZXItZGV0ZWN0JykoZnVuY3Rpb24oaXRlcil7CiAgUC5hbGwoaXRlcilbJ2NhdGNoJ10oZnVuY3Rpb24oKXt9KTsKfSkpLCBQUk9NSVNFLCB7CiAgLy8gMjUuNC40LjEgUHJvbWlzZS5hbGwoaXRlcmFibGUpCiAgYWxsOiBmdW5jdGlvbiBhbGwoaXRlcmFibGUpewogICAgdmFyIEMgICAgICAgICAgPSBnZXRDb25zdHJ1Y3Rvcih0aGlzKQogICAgICAsIGNhcGFiaWxpdHkgPSBuZXcgUHJvbWlzZUNhcGFiaWxpdHkoQykKICAgICAgLCByZXNvbHZlICAgID0gY2FwYWJpbGl0eS5yZXNvbHZlCiAgICAgICwgcmVqZWN0ICAgICA9IGNhcGFiaWxpdHkucmVqZWN0CiAgICAgICwgdmFsdWVzICAgICA9IFtdOwogICAgdmFyIGFicnVwdCA9IHBlcmZvcm0oZnVuY3Rpb24oKXsKICAgICAgZm9yT2YoaXRlcmFibGUsIGZhbHNlLCB2YWx1ZXMucHVzaCwgdmFsdWVzKTsKICAgICAgdmFyIHJlbWFpbmluZyA9IHZhbHVlcy5sZW5ndGgKICAgICAgICAsIHJlc3VsdHMgICA9IEFycmF5KHJlbWFpbmluZyk7CiAgICAgIGlmKHJlbWFpbmluZykkLmVhY2guY2FsbCh2YWx1ZXMsIGZ1bmN0aW9uKHByb21pc2UsIGluZGV4KXsKICAgICAgICB2YXIgYWxyZWFkeUNhbGxlZCA9IGZhbHNlOwogICAgICAgIEMucmVzb2x2ZShwcm9taXNlKS50aGVuKGZ1bmN0aW9uKHZhbHVlKXsKICAgICAgICAgIGlmKGFscmVhZHlDYWxsZWQpcmV0dXJuOwogICAgICAgICAgYWxyZWFkeUNhbGxlZCA9IHRydWU7CiAgICAgICAgICByZXN1bHRzW2luZGV4XSA9IHZhbHVlOwogICAgICAgICAgLS1yZW1haW5pbmcgfHwgcmVzb2x2ZShyZXN1bHRzKTsKICAgICAgICB9LCByZWplY3QpOwogICAgICB9KTsKICAgICAgZWxzZSByZXNvbHZlKHJlc3VsdHMpOwogICAgfSk7CiAgICBpZihhYnJ1cHQpcmVqZWN0KGFicnVwdC5lcnJvcik7CiAgICByZXR1cm4gY2FwYWJpbGl0eS5wcm9taXNlOwogIH0sCiAgLy8gMjUuNC40LjQgUHJvbWlzZS5yYWNlKGl0ZXJhYmxlKQogIHJhY2U6IGZ1bmN0aW9uIHJhY2UoaXRlcmFibGUpewogICAgdmFyIEMgICAgICAgICAgPSBnZXRDb25zdHJ1Y3Rvcih0aGlzKQogICAgICAsIGNhcGFiaWxpdHkgPSBuZXcgUHJvbWlzZUNhcGFiaWxpdHkoQykKICAgICAgLCByZWplY3QgICAgID0gY2FwYWJpbGl0eS5yZWplY3Q7CiAgICB2YXIgYWJydXB0ID0gcGVyZm9ybShmdW5jdGlvbigpewogICAgICBmb3JPZihpdGVyYWJsZSwgZmFsc2UsIGZ1bmN0aW9uKHByb21pc2UpewogICAgICAgIEMucmVzb2x2ZShwcm9taXNlKS50aGVuKGNhcGFiaWxpdHkucmVzb2x2ZSwgcmVqZWN0KTsKICAgICAgfSk7CiAgICB9KTsKICAgIGlmKGFicnVwdClyZWplY3QoYWJydXB0LmVycm9yKTsKICAgIHJldHVybiBjYXBhYmlsaXR5LnByb21pc2U7CiAgfQp9KTsKfSx7Ii4vJCI6NTYsIi4vJC5hLWZ1bmN0aW9uIjoyNiwiLi8kLmFuLW9iamVjdCI6MjgsIi4vJC5jbGFzc29mIjoyOSwiLi8kLmNvcmUiOjMxLCIuLyQuY3R4IjozMiwiLi8kLmRlc2NyaXB0b3JzIjozNCwiLi8kLmV4cG9ydCI6MzcsIi4vJC5mb3Itb2YiOjM5LCIuLyQuZ2xvYmFsIjo0MSwiLi8kLmlzLW9iamVjdCI6NDksIi4vJC5pdGVyLWRldGVjdCI6NTMsIi4vJC5saWJyYXJ5Ijo1OCwiLi8kLm1pY3JvdGFzayI6NTksIi4vJC5yZWRlZmluZS1hbGwiOjYyLCIuLyQuc2FtZS12YWx1ZSI6NjQsIi4vJC5zZXQtcHJvdG8iOjY1LCIuLyQuc2V0LXNwZWNpZXMiOjY2LCIuLyQuc2V0LXRvLXN0cmluZy10YWciOjY3LCIuLyQuc3BlY2llcy1jb25zdHJ1Y3RvciI6NjksIi4vJC5zdHJpY3QtbmV3Ijo3MCwiLi8kLndrcyI6Nzh9XSw4NzpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Cid1c2Ugc3RyaWN0JzsKdmFyICRhdCAgPSByZXF1aXJlKCcuLyQuc3RyaW5nLWF0JykodHJ1ZSk7CgovLyAyMS4xLjMuMjcgU3RyaW5nLnByb3RvdHlwZVtAQGl0ZXJhdG9yXSgpCnJlcXVpcmUoJy4vJC5pdGVyLWRlZmluZScpKFN0cmluZywgJ1N0cmluZycsIGZ1bmN0aW9uKGl0ZXJhdGVkKXsKICB0aGlzLl90ID0gU3RyaW5nKGl0ZXJhdGVkKTsgLy8gdGFyZ2V0CiAgdGhpcy5faSA9IDA7ICAgICAgICAgICAgICAgIC8vIG5leHQgaW5kZXgKLy8gMjEuMS41LjIuMSAlU3RyaW5nSXRlcmF0b3JQcm90b3R5cGUlLm5leHQoKQp9LCBmdW5jdGlvbigpewogIHZhciBPICAgICA9IHRoaXMuX3QKICAgICwgaW5kZXggPSB0aGlzLl9pCiAgICAsIHBvaW50OwogIGlmKGluZGV4ID49IE8ubGVuZ3RoKXJldHVybiB7dmFsdWU6IHVuZGVmaW5lZCwgZG9uZTogdHJ1ZX07CiAgcG9pbnQgPSAkYXQoTywgaW5kZXgpOwogIHRoaXMuX2kgKz0gcG9pbnQubGVuZ3RoOwogIHJldHVybiB7dmFsdWU6IHBvaW50LCBkb25lOiBmYWxzZX07Cn0pOwp9LHsiLi8kLml0ZXItZGVmaW5lIjo1MiwiLi8kLnN0cmluZy1hdCI6NzF9XSw4ODpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Cid1c2Ugc3RyaWN0JzsKLy8gRUNNQVNjcmlwdCA2IHN5bWJvbHMgc2hpbQp2YXIgJCAgICAgICAgICAgICAgPSByZXF1aXJlKCcuLyQnKQogICwgZ2xvYmFsICAgICAgICAgPSByZXF1aXJlKCcuLyQuZ2xvYmFsJykKICAsIGhhcyAgICAgICAgICAgID0gcmVxdWlyZSgnLi8kLmhhcycpCiAgLCBERVNDUklQVE9SUyAgICA9IHJlcXVpcmUoJy4vJC5kZXNjcmlwdG9ycycpCiAgLCAkZXhwb3J0ICAgICAgICA9IHJlcXVpcmUoJy4vJC5leHBvcnQnKQogICwgcmVkZWZpbmUgICAgICAgPSByZXF1aXJlKCcuLyQucmVkZWZpbmUnKQogICwgJGZhaWxzICAgICAgICAgPSByZXF1aXJlKCcuLyQuZmFpbHMnKQogICwgc2hhcmVkICAgICAgICAgPSByZXF1aXJlKCcuLyQuc2hhcmVkJykKICAsIHNldFRvU3RyaW5nVGFnID0gcmVxdWlyZSgnLi8kLnNldC10by1zdHJpbmctdGFnJykKICAsIHVpZCAgICAgICAgICAgID0gcmVxdWlyZSgnLi8kLnVpZCcpCiAgLCB3a3MgICAgICAgICAgICA9IHJlcXVpcmUoJy4vJC53a3MnKQogICwga2V5T2YgICAgICAgICAgPSByZXF1aXJlKCcuLyQua2V5b2YnKQogICwgJG5hbWVzICAgICAgICAgPSByZXF1aXJlKCcuLyQuZ2V0LW5hbWVzJykKICAsIGVudW1LZXlzICAgICAgID0gcmVxdWlyZSgnLi8kLmVudW0ta2V5cycpCiAgLCBpc0FycmF5ICAgICAgICA9IHJlcXVpcmUoJy4vJC5pcy1hcnJheScpCiAgLCBhbk9iamVjdCAgICAgICA9IHJlcXVpcmUoJy4vJC5hbi1vYmplY3QnKQogICwgdG9JT2JqZWN0ICAgICAgPSByZXF1aXJlKCcuLyQudG8taW9iamVjdCcpCiAgLCBjcmVhdGVEZXNjICAgICA9IHJlcXVpcmUoJy4vJC5wcm9wZXJ0eS1kZXNjJykKICAsIGdldERlc2MgICAgICAgID0gJC5nZXREZXNjCiAgLCBzZXREZXNjICAgICAgICA9ICQuc2V0RGVzYwogICwgX2NyZWF0ZSAgICAgICAgPSAkLmNyZWF0ZQogICwgZ2V0TmFtZXMgICAgICAgPSAkbmFtZXMuZ2V0CiAgLCAkU3ltYm9sICAgICAgICA9IGdsb2JhbC5TeW1ib2wKICAsICRKU09OICAgICAgICAgID0gZ2xvYmFsLkpTT04KICAsIF9zdHJpbmdpZnkgICAgID0gJEpTT04gJiYgJEpTT04uc3RyaW5naWZ5CiAgLCBzZXR0ZXIgICAgICAgICA9IGZhbHNlCiAgLCBISURERU4gICAgICAgICA9IHdrcygnX2hpZGRlbicpCiAgLCBpc0VudW0gICAgICAgICA9ICQuaXNFbnVtCiAgLCBTeW1ib2xSZWdpc3RyeSA9IHNoYXJlZCgnc3ltYm9sLXJlZ2lzdHJ5JykKICAsIEFsbFN5bWJvbHMgICAgID0gc2hhcmVkKCdzeW1ib2xzJykKICAsIHVzZU5hdGl2ZSAgICAgID0gdHlwZW9mICRTeW1ib2wgPT0gJ2Z1bmN0aW9uJwogICwgT2JqZWN0UHJvdG8gICAgPSBPYmplY3QucHJvdG90eXBlOwoKLy8gZmFsbGJhY2sgZm9yIG9sZCBBbmRyb2lkLCBodHRwczovL2NvZGUuZ29vZ2xlLmNvbS9wL3Y4L2lzc3Vlcy9kZXRhaWw/aWQ9Njg3CnZhciBzZXRTeW1ib2xEZXNjID0gREVTQ1JJUFRPUlMgJiYgJGZhaWxzKGZ1bmN0aW9uKCl7CiAgcmV0dXJuIF9jcmVhdGUoc2V0RGVzYyh7fSwgJ2EnLCB7CiAgICBnZXQ6IGZ1bmN0aW9uKCl7IHJldHVybiBzZXREZXNjKHRoaXMsICdhJywge3ZhbHVlOiA3fSkuYTsgfQogIH0pKS5hICE9IDc7Cn0pID8gZnVuY3Rpb24oaXQsIGtleSwgRCl7CiAgdmFyIHByb3RvRGVzYyA9IGdldERlc2MoT2JqZWN0UHJvdG8sIGtleSk7CiAgaWYocHJvdG9EZXNjKWRlbGV0ZSBPYmplY3RQcm90b1trZXldOwogIHNldERlc2MoaXQsIGtleSwgRCk7CiAgaWYocHJvdG9EZXNjICYmIGl0ICE9PSBPYmplY3RQcm90bylzZXREZXNjKE9iamVjdFByb3RvLCBrZXksIHByb3RvRGVzYyk7Cn0gOiBzZXREZXNjOwoKdmFyIHdyYXAgPSBmdW5jdGlvbih0YWcpewogIHZhciBzeW0gPSBBbGxTeW1ib2xzW3RhZ10gPSBfY3JlYXRlKCRTeW1ib2wucHJvdG90eXBlKTsKICBzeW0uX2sgPSB0YWc7CiAgREVTQ1JJUFRPUlMgJiYgc2V0dGVyICYmIHNldFN5bWJvbERlc2MoT2JqZWN0UHJvdG8sIHRhZywgewogICAgY29uZmlndXJhYmxlOiB0cnVlLAogICAgc2V0OiBmdW5jdGlvbih2YWx1ZSl7CiAgICAgIGlmKGhhcyh0aGlzLCBISURERU4pICYmIGhhcyh0aGlzW0hJRERFTl0sIHRhZykpdGhpc1tISURERU5dW3RhZ10gPSBmYWxzZTsKICAgICAgc2V0U3ltYm9sRGVzYyh0aGlzLCB0YWcsIGNyZWF0ZURlc2MoMSwgdmFsdWUpKTsKICAgIH0KICB9KTsKICByZXR1cm4gc3ltOwp9OwoKdmFyIGlzU3ltYm9sID0gZnVuY3Rpb24oaXQpewogIHJldHVybiB0eXBlb2YgaXQgPT0gJ3N5bWJvbCc7Cn07Cgp2YXIgJGRlZmluZVByb3BlcnR5ID0gZnVuY3Rpb24gZGVmaW5lUHJvcGVydHkoaXQsIGtleSwgRCl7CiAgaWYoRCAmJiBoYXMoQWxsU3ltYm9scywga2V5KSl7CiAgICBpZighRC5lbnVtZXJhYmxlKXsKICAgICAgaWYoIWhhcyhpdCwgSElEREVOKSlzZXREZXNjKGl0LCBISURERU4sIGNyZWF0ZURlc2MoMSwge30pKTsKICAgICAgaXRbSElEREVOXVtrZXldID0gdHJ1ZTsKICAgIH0gZWxzZSB7CiAgICAgIGlmKGhhcyhpdCwgSElEREVOKSAmJiBpdFtISURERU5dW2tleV0paXRbSElEREVOXVtrZXldID0gZmFsc2U7CiAgICAgIEQgPSBfY3JlYXRlKEQsIHtlbnVtZXJhYmxlOiBjcmVhdGVEZXNjKDAsIGZhbHNlKX0pOwogICAgfSByZXR1cm4gc2V0U3ltYm9sRGVzYyhpdCwga2V5LCBEKTsKICB9IHJldHVybiBzZXREZXNjKGl0LCBrZXksIEQpOwp9Owp2YXIgJGRlZmluZVByb3BlcnRpZXMgPSBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0aWVzKGl0LCBQKXsKICBhbk9iamVjdChpdCk7CiAgdmFyIGtleXMgPSBlbnVtS2V5cyhQID0gdG9JT2JqZWN0KFApKQogICAgLCBpICAgID0gMAogICAgLCBsID0ga2V5cy5sZW5ndGgKICAgICwga2V5OwogIHdoaWxlKGwgPiBpKSRkZWZpbmVQcm9wZXJ0eShpdCwga2V5ID0ga2V5c1tpKytdLCBQW2tleV0pOwogIHJldHVybiBpdDsKfTsKdmFyICRjcmVhdGUgPSBmdW5jdGlvbiBjcmVhdGUoaXQsIFApewogIHJldHVybiBQID09PSB1bmRlZmluZWQgPyBfY3JlYXRlKGl0KSA6ICRkZWZpbmVQcm9wZXJ0aWVzKF9jcmVhdGUoaXQpLCBQKTsKfTsKdmFyICRwcm9wZXJ0eUlzRW51bWVyYWJsZSA9IGZ1bmN0aW9uIHByb3BlcnR5SXNFbnVtZXJhYmxlKGtleSl7CiAgdmFyIEUgPSBpc0VudW0uY2FsbCh0aGlzLCBrZXkpOwogIHJldHVybiBFIHx8ICFoYXModGhpcywga2V5KSB8fCAhaGFzKEFsbFN5bWJvbHMsIGtleSkgfHwgaGFzKHRoaXMsIEhJRERFTikgJiYgdGhpc1tISURERU5dW2tleV0KICAgID8gRSA6IHRydWU7Cn07CnZhciAkZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yID0gZnVuY3Rpb24gZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKGl0LCBrZXkpewogIHZhciBEID0gZ2V0RGVzYyhpdCA9IHRvSU9iamVjdChpdCksIGtleSk7CiAgaWYoRCAmJiBoYXMoQWxsU3ltYm9scywga2V5KSAmJiAhKGhhcyhpdCwgSElEREVOKSAmJiBpdFtISURERU5dW2tleV0pKUQuZW51bWVyYWJsZSA9IHRydWU7CiAgcmV0dXJuIEQ7Cn07CnZhciAkZ2V0T3duUHJvcGVydHlOYW1lcyA9IGZ1bmN0aW9uIGdldE93blByb3BlcnR5TmFtZXMoaXQpewogIHZhciBuYW1lcyAgPSBnZXROYW1lcyh0b0lPYmplY3QoaXQpKQogICAgLCByZXN1bHQgPSBbXQogICAgLCBpICAgICAgPSAwCiAgICAsIGtleTsKICB3aGlsZShuYW1lcy5sZW5ndGggPiBpKWlmKCFoYXMoQWxsU3ltYm9scywga2V5ID0gbmFtZXNbaSsrXSkgJiYga2V5ICE9IEhJRERFTilyZXN1bHQucHVzaChrZXkpOwogIHJldHVybiByZXN1bHQ7Cn07CnZhciAkZ2V0T3duUHJvcGVydHlTeW1ib2xzID0gZnVuY3Rpb24gZ2V0T3duUHJvcGVydHlTeW1ib2xzKGl0KXsKICB2YXIgbmFtZXMgID0gZ2V0TmFtZXModG9JT2JqZWN0KGl0KSkKICAgICwgcmVzdWx0ID0gW10KICAgICwgaSAgICAgID0gMAogICAgLCBrZXk7CiAgd2hpbGUobmFtZXMubGVuZ3RoID4gaSlpZihoYXMoQWxsU3ltYm9scywga2V5ID0gbmFtZXNbaSsrXSkpcmVzdWx0LnB1c2goQWxsU3ltYm9sc1trZXldKTsKICByZXR1cm4gcmVzdWx0Owp9Owp2YXIgJHN0cmluZ2lmeSA9IGZ1bmN0aW9uIHN0cmluZ2lmeShpdCl7CiAgaWYoaXQgPT09IHVuZGVmaW5lZCB8fCBpc1N5bWJvbChpdCkpcmV0dXJuOyAvLyBJRTggcmV0dXJucyBzdHJpbmcgb24gdW5kZWZpbmVkCiAgdmFyIGFyZ3MgPSBbaXRdCiAgICAsIGkgICAgPSAxCiAgICAsICQkICAgPSBhcmd1bWVudHMKICAgICwgcmVwbGFjZXIsICRyZXBsYWNlcjsKICB3aGlsZSgkJC5sZW5ndGggPiBpKWFyZ3MucHVzaCgkJFtpKytdKTsKICByZXBsYWNlciA9IGFyZ3NbMV07CiAgaWYodHlwZW9mIHJlcGxhY2VyID09ICdmdW5jdGlvbicpJHJlcGxhY2VyID0gcmVwbGFjZXI7CiAgaWYoJHJlcGxhY2VyIHx8ICFpc0FycmF5KHJlcGxhY2VyKSlyZXBsYWNlciA9IGZ1bmN0aW9uKGtleSwgdmFsdWUpewogICAgaWYoJHJlcGxhY2VyKXZhbHVlID0gJHJlcGxhY2VyLmNhbGwodGhpcywga2V5LCB2YWx1ZSk7CiAgICBpZighaXNTeW1ib2wodmFsdWUpKXJldHVybiB2YWx1ZTsKICB9OwogIGFyZ3NbMV0gPSByZXBsYWNlcjsKICByZXR1cm4gX3N0cmluZ2lmeS5hcHBseSgkSlNPTiwgYXJncyk7Cn07CnZhciBidWdneUpTT04gPSAkZmFpbHMoZnVuY3Rpb24oKXsKICB2YXIgUyA9ICRTeW1ib2woKTsKICAvLyBNUyBFZGdlIGNvbnZlcnRzIHN5bWJvbCB2YWx1ZXMgdG8gSlNPTiBhcyB7fQogIC8vIFdlYktpdCBjb252ZXJ0cyBzeW1ib2wgdmFsdWVzIHRvIEpTT04gYXMgbnVsbAogIC8vIFY4IHRocm93cyBvbiBib3hlZCBzeW1ib2xzCiAgcmV0dXJuIF9zdHJpbmdpZnkoW1NdKSAhPSAnW251bGxdJyB8fCBfc3RyaW5naWZ5KHthOiBTfSkgIT0gJ3t9JyB8fCBfc3RyaW5naWZ5KE9iamVjdChTKSkgIT0gJ3t9JzsKfSk7CgovLyAxOS40LjEuMSBTeW1ib2woW2Rlc2NyaXB0aW9uXSkKaWYoIXVzZU5hdGl2ZSl7CiAgJFN5bWJvbCA9IGZ1bmN0aW9uIFN5bWJvbCgpewogICAgaWYoaXNTeW1ib2wodGhpcykpdGhyb3cgVHlwZUVycm9yKCdTeW1ib2wgaXMgbm90IGEgY29uc3RydWN0b3InKTsKICAgIHJldHVybiB3cmFwKHVpZChhcmd1bWVudHMubGVuZ3RoID4gMCA/IGFyZ3VtZW50c1swXSA6IHVuZGVmaW5lZCkpOwogIH07CiAgcmVkZWZpbmUoJFN5bWJvbC5wcm90b3R5cGUsICd0b1N0cmluZycsIGZ1bmN0aW9uIHRvU3RyaW5nKCl7CiAgICByZXR1cm4gdGhpcy5fazsKICB9KTsKCiAgaXNTeW1ib2wgPSBmdW5jdGlvbihpdCl7CiAgICByZXR1cm4gaXQgaW5zdGFuY2VvZiAkU3ltYm9sOwogIH07CgogICQuY3JlYXRlICAgICA9ICRjcmVhdGU7CiAgJC5pc0VudW0gICAgID0gJHByb3BlcnR5SXNFbnVtZXJhYmxlOwogICQuZ2V0RGVzYyAgICA9ICRnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3I7CiAgJC5zZXREZXNjICAgID0gJGRlZmluZVByb3BlcnR5OwogICQuc2V0RGVzY3MgICA9ICRkZWZpbmVQcm9wZXJ0aWVzOwogICQuZ2V0TmFtZXMgICA9ICRuYW1lcy5nZXQgPSAkZ2V0T3duUHJvcGVydHlOYW1lczsKICAkLmdldFN5bWJvbHMgPSAkZ2V0T3duUHJvcGVydHlTeW1ib2xzOwoKICBpZihERVNDUklQVE9SUyAmJiAhcmVxdWlyZSgnLi8kLmxpYnJhcnknKSl7CiAgICByZWRlZmluZShPYmplY3RQcm90bywgJ3Byb3BlcnR5SXNFbnVtZXJhYmxlJywgJHByb3BlcnR5SXNFbnVtZXJhYmxlLCB0cnVlKTsKICB9Cn0KCnZhciBzeW1ib2xTdGF0aWNzID0gewogIC8vIDE5LjQuMi4xIFN5bWJvbC5mb3Ioa2V5KQogICdmb3InOiBmdW5jdGlvbihrZXkpewogICAgcmV0dXJuIGhhcyhTeW1ib2xSZWdpc3RyeSwga2V5ICs9ICcnKQogICAgICA/IFN5bWJvbFJlZ2lzdHJ5W2tleV0KICAgICAgOiBTeW1ib2xSZWdpc3RyeVtrZXldID0gJFN5bWJvbChrZXkpOwogIH0sCiAgLy8gMTkuNC4yLjUgU3ltYm9sLmtleUZvcihzeW0pCiAga2V5Rm9yOiBmdW5jdGlvbiBrZXlGb3Ioa2V5KXsKICAgIHJldHVybiBrZXlPZihTeW1ib2xSZWdpc3RyeSwga2V5KTsKICB9LAogIHVzZVNldHRlcjogZnVuY3Rpb24oKXsgc2V0dGVyID0gdHJ1ZTsgfSwKICB1c2VTaW1wbGU6IGZ1bmN0aW9uKCl7IHNldHRlciA9IGZhbHNlOyB9Cn07Ci8vIDE5LjQuMi4yIFN5bWJvbC5oYXNJbnN0YW5jZQovLyAxOS40LjIuMyBTeW1ib2wuaXNDb25jYXRTcHJlYWRhYmxlCi8vIDE5LjQuMi40IFN5bWJvbC5pdGVyYXRvcgovLyAxOS40LjIuNiBTeW1ib2wubWF0Y2gKLy8gMTkuNC4yLjggU3ltYm9sLnJlcGxhY2UKLy8gMTkuNC4yLjkgU3ltYm9sLnNlYXJjaAovLyAxOS40LjIuMTAgU3ltYm9sLnNwZWNpZXMKLy8gMTkuNC4yLjExIFN5bWJvbC5zcGxpdAovLyAxOS40LjIuMTIgU3ltYm9sLnRvUHJpbWl0aXZlCi8vIDE5LjQuMi4xMyBTeW1ib2wudG9TdHJpbmdUYWcKLy8gMTkuNC4yLjE0IFN5bWJvbC51bnNjb3BhYmxlcwokLmVhY2guY2FsbCgoCiAgJ2hhc0luc3RhbmNlLGlzQ29uY2F0U3ByZWFkYWJsZSxpdGVyYXRvcixtYXRjaCxyZXBsYWNlLHNlYXJjaCwnICsKICAnc3BlY2llcyxzcGxpdCx0b1ByaW1pdGl2ZSx0b1N0cmluZ1RhZyx1bnNjb3BhYmxlcycKKS5zcGxpdCgnLCcpLCBmdW5jdGlvbihpdCl7CiAgdmFyIHN5bSA9IHdrcyhpdCk7CiAgc3ltYm9sU3RhdGljc1tpdF0gPSB1c2VOYXRpdmUgPyBzeW0gOiB3cmFwKHN5bSk7Cn0pOwoKc2V0dGVyID0gdHJ1ZTsKCiRleHBvcnQoJGV4cG9ydC5HICsgJGV4cG9ydC5XLCB7U3ltYm9sOiAkU3ltYm9sfSk7CgokZXhwb3J0KCRleHBvcnQuUywgJ1N5bWJvbCcsIHN5bWJvbFN0YXRpY3MpOwoKJGV4cG9ydCgkZXhwb3J0LlMgKyAkZXhwb3J0LkYgKiAhdXNlTmF0aXZlLCAnT2JqZWN0JywgewogIC8vIDE5LjEuMi4yIE9iamVjdC5jcmVhdGUoTyBbLCBQcm9wZXJ0aWVzXSkKICBjcmVhdGU6ICRjcmVhdGUsCiAgLy8gMTkuMS4yLjQgT2JqZWN0LmRlZmluZVByb3BlcnR5KE8sIFAsIEF0dHJpYnV0ZXMpCiAgZGVmaW5lUHJvcGVydHk6ICRkZWZpbmVQcm9wZXJ0eSwKICAvLyAxOS4xLjIuMyBPYmplY3QuZGVmaW5lUHJvcGVydGllcyhPLCBQcm9wZXJ0aWVzKQogIGRlZmluZVByb3BlcnRpZXM6ICRkZWZpbmVQcm9wZXJ0aWVzLAogIC8vIDE5LjEuMi42IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTywgUCkKICBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3I6ICRnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IsCiAgLy8gMTkuMS4yLjcgT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMoTykKICBnZXRPd25Qcm9wZXJ0eU5hbWVzOiAkZ2V0T3duUHJvcGVydHlOYW1lcywKICAvLyAxOS4xLjIuOCBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKE8pCiAgZ2V0T3duUHJvcGVydHlTeW1ib2xzOiAkZ2V0T3duUHJvcGVydHlTeW1ib2xzCn0pOwoKLy8gMjQuMy4yIEpTT04uc3RyaW5naWZ5KHZhbHVlIFssIHJlcGxhY2VyIFssIHNwYWNlXV0pCiRKU09OICYmICRleHBvcnQoJGV4cG9ydC5TICsgJGV4cG9ydC5GICogKCF1c2VOYXRpdmUgfHwgYnVnZ3lKU09OKSwgJ0pTT04nLCB7c3RyaW5naWZ5OiAkc3RyaW5naWZ5fSk7CgovLyAxOS40LjMuNSBTeW1ib2wucHJvdG90eXBlW0BAdG9TdHJpbmdUYWddCnNldFRvU3RyaW5nVGFnKCRTeW1ib2wsICdTeW1ib2wnKTsKLy8gMjAuMi4xLjkgTWF0aFtAQHRvU3RyaW5nVGFnXQpzZXRUb1N0cmluZ1RhZyhNYXRoLCAnTWF0aCcsIHRydWUpOwovLyAyNC4zLjMgSlNPTltAQHRvU3RyaW5nVGFnXQpzZXRUb1N0cmluZ1RhZyhnbG9iYWwuSlNPTiwgJ0pTT04nLCB0cnVlKTsKfSx7Ii4vJCI6NTYsIi4vJC5hbi1vYmplY3QiOjI4LCIuLyQuZGVzY3JpcHRvcnMiOjM0LCIuLyQuZW51bS1rZXlzIjozNiwiLi8kLmV4cG9ydCI6MzcsIi4vJC5mYWlscyI6MzgsIi4vJC5nZXQtbmFtZXMiOjQwLCIuLyQuZ2xvYmFsIjo0MSwiLi8kLmhhcyI6NDIsIi4vJC5pcy1hcnJheSI6NDgsIi4vJC5rZXlvZiI6NTcsIi4vJC5saWJyYXJ5Ijo1OCwiLi8kLnByb3BlcnR5LWRlc2MiOjYxLCIuLyQucmVkZWZpbmUiOjYzLCIuLyQuc2V0LXRvLXN0cmluZy10YWciOjY3LCIuLyQuc2hhcmVkIjo2OCwiLi8kLnRvLWlvYmplY3QiOjc0LCIuLyQudWlkIjo3NywiLi8kLndrcyI6Nzh9XSw4OTpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7CnJlcXVpcmUoJy4vZXM2LmFycmF5Lml0ZXJhdG9yJyk7CnZhciBJdGVyYXRvcnMgPSByZXF1aXJlKCcuLyQuaXRlcmF0b3JzJyk7Ckl0ZXJhdG9ycy5Ob2RlTGlzdCA9IEl0ZXJhdG9ycy5IVE1MQ29sbGVjdGlvbiA9IEl0ZXJhdG9ycy5BcnJheTsKfSx7Ii4vJC5pdGVyYXRvcnMiOjU1LCIuL2VzNi5hcnJheS5pdGVyYXRvciI6ODB9XSw5MDpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Cid1c2Ugc3RyaWN0JzsKCnZhciBfZ2V0ID0gcmVxdWlyZSgnYmFiZWwtcnVudGltZS9oZWxwZXJzL2dldCcpWydkZWZhdWx0J107Cgp2YXIgX2luaGVyaXRzID0gcmVxdWlyZSgnYmFiZWwtcnVudGltZS9oZWxwZXJzL2luaGVyaXRzJylbJ2RlZmF1bHQnXTsKCnZhciBfY3JlYXRlQ2xhc3MgPSByZXF1aXJlKCdiYWJlbC1ydW50aW1lL2hlbHBlcnMvY3JlYXRlLWNsYXNzJylbJ2RlZmF1bHQnXTsKCnZhciBfY2xhc3NDYWxsQ2hlY2sgPSByZXF1aXJlKCdiYWJlbC1ydW50aW1lL2hlbHBlcnMvY2xhc3MtY2FsbC1jaGVjaycpWydkZWZhdWx0J107Cgp2YXIgX1Byb21pc2UgPSByZXF1aXJlKCdiYWJlbC1ydW50aW1lL2NvcmUtanMvcHJvbWlzZScpWydkZWZhdWx0J107Cgp2YXIgX2ludGVyb3BSZXF1aXJlRGVmYXVsdCA9IHJlcXVpcmUoJ2JhYmVsLXJ1bnRpbWUvaGVscGVycy9pbnRlcm9wLXJlcXVpcmUtZGVmYXVsdCcpWydkZWZhdWx0J107CgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7CiAgdmFsdWU6IHRydWUKfSk7Cgp2YXIgX3V0aWxzRXZlbnRFbWl0dGVyID0gcmVxdWlyZSgnLi4vdXRpbHMvRXZlbnRFbWl0dGVyJyk7Cgp2YXIgX3V0aWxzRXZlbnRFbWl0dGVyMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3V0aWxzRXZlbnRFbWl0dGVyKTsKCnZhciBfcGFydGljaXBhbnQgPSByZXF1aXJlKCcuL3BhcnRpY2lwYW50Jyk7Cgp2YXIgX3BhcnRpY2lwYW50MiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3BhcnRpY2lwYW50KTsKCnZhciBDaGF0R3JvdXAgPSAoZnVuY3Rpb24gKF9FdmVudEVtaXR0ZXIpIHsKICBfaW5oZXJpdHMoQ2hhdEdyb3VwLCBfRXZlbnRFbWl0dGVyKTsKCiAgZnVuY3Rpb24gQ2hhdEdyb3VwKHN5bmNoZXIsIGh5cGVydHlEaXNjb3ZlcnksIGRvbWFpbikgewogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIENoYXRHcm91cCk7CgogICAgaWYgKCFzeW5jaGVyKSB0aHJvdyBFcnJvcignU3luY2hlciBpcyBhIG5lY2Vzc2FyeSBkZXBlbmRlY3knKTsKICAgIGlmICghaHlwZXJ0eURpc2NvdmVyeSkgdGhyb3cgRXJyb3IoJ0h5cGVydHkgZGlzY292ZXIgaXMgYSBuZWNlc3NhcnkgZGVwZW5kZWN5Jyk7CgogICAgX2dldChPYmplY3QuZ2V0UHJvdG90eXBlT2YoQ2hhdEdyb3VwLnByb3RvdHlwZSksICdjb25zdHJ1Y3RvcicsIHRoaXMpLmNhbGwodGhpcywgc3luY2hlciwgaHlwZXJ0eURpc2NvdmVyeSk7CgogICAgdmFyIF90aGlzID0gdGhpczsKICAgIF90aGlzLl9zeW5jaGVyID0gc3luY2hlcjsKICAgIF90aGlzLl9oeXBlcnR5RGlzY292ZXJ5ID0gaHlwZXJ0eURpc2NvdmVyeTsKCiAgICBfdGhpcy5fb2JqZWN0RGVzY1VSTCA9ICdoeXBlcnR5LWNhdGFsb2d1ZTovLycgKyBkb21haW4gKyAnLy53ZWxsLWtub3duL2RhdGFzY2hlbWFzL0Zha2VEYXRhU2NoZW1hJzsKICB9CgogIF9jcmVhdGVDbGFzcyhDaGF0R3JvdXAsIFt7CiAgICBrZXk6ICdwcm9jZXNzUGFydGlwYW50cycsCiAgICB2YWx1ZTogZnVuY3Rpb24gcHJvY2Vzc1BhcnRpcGFudHMoZGF0YU9iamVjdCkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICB2YXIgcGFydGljaXBhbnRzID0gZGF0YU9iamVjdC5kYXRhLmNvbW11bmljYXRpb24ucGFydGljaXBhbnRzOwoKICAgICAgY29uc29sZS5sb2coJ1Byb2Nlc3MgUGFydGljaXBhbnRzOiAnLCBwYXJ0aWNpcGFudHMpOwoKICAgICAgcGFydGljaXBhbnRzLmZvckVhY2goZnVuY3Rpb24gKHBhcnRpY2lwYW50KSB7CiAgICAgICAgaWYgKGRhdGFPYmplY3QuX293bmVyICE9PSBwYXJ0aWNpcGFudC5oeXBlcnR5UmVzb3VyY2UpIHsKICAgICAgICAgIGNvbnNvbGUubG9nKCdFYWNoIFBhcnRpY2lwYW50IHdpbGwgYmUgdHJpZ2dlcjogJywgcGFydGljaXBhbnQpOwogICAgICAgICAgX3RoaXMudHJpZ2dlcigncGFydGljaXBhbnQ6YWRkZWQnLCBwYXJ0aWNpcGFudCk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KCiAgICAvKioNCiAgICAgKiBQcm9jZXNzIGNoaWxkcmVuIG1lc3NhZ2VzDQogICAgICogQHBhcmFtICB7W3R5cGVdfSBjaGlsZHJlbiBbZGVzY3JpcHRpb25dDQogICAgICogQHJldHVybiB7W3R5cGVdfSAgICAgICAgICBbZGVzY3JpcHRpb25dDQogICAgICovCiAgfSwgewogICAga2V5OiAnX3Byb2Nlc3NDaGlsZHJlbicsCiAgICB2YWx1ZTogZnVuY3Rpb24gX3Byb2Nlc3NDaGlsZHJlbihjaGlsZHJlbikgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgY29uc29sZS5pbmZvKCdQcm9jZXNzIE1lc3NhZ2U6JywgY2hpbGRyZW4pOwoKICAgICAgX3RoaXMudHJpZ2dlcignbmV3Om1lc3NhZ2U6cmVjaXZlZCcsIGNoaWxkcmVuKTsKICAgIH0KCiAgICAvKioNCiAgICAgKiBUaGlzIGZ1bmN0aW9uIGlzIHVzZWQgdG8gc2VuZCBhIGNoYXQgbWVzc2FnZS4NCiAgICAgKiBAcGFyYW0gIHtNZXNzYWdlfSBtZXNzYWdlIHRleHQgdG8gYmUgc2VuZA0KICAgICAqLwogIH0sIHsKICAgIGtleTogJ3NlbmQnLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNlbmQobWVzc2FnZSkgewogICAgICBjb25zb2xlLmxvZyhtZXNzYWdlLCB0aGlzKTsKICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgdmFyIGRhdGFPYmplY3QgPSBfdGhpcy5kYXRhT2JqZWN0UmVwb3J0ZXIgPyBfdGhpcy5kYXRhT2JqZWN0UmVwb3J0ZXIgOiBfdGhpcy5kYXRhT2JqZWN0T2JzZXJ2ZXI7CgogICAgICByZXR1cm4gbmV3IF9Qcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKCiAgICAgICAgZGF0YU9iamVjdC5hZGRDaGlsZHJlbignbWVzc2FnZScsIHsgY2hhdE1lc3NhZ2U6IG1lc3NhZ2UgfSkudGhlbihmdW5jdGlvbiAoZGF0YU9iamVjdENoaWxkKSB7CiAgICAgICAgICBjb25zb2xlLmluZm8oZGF0YU9iamVjdENoaWxkKTsKICAgICAgICAgIHZhciBtc2cgPSB7CiAgICAgICAgICAgIGNoaWxkSWQ6IGRhdGFPYmplY3RDaGlsZC5fY2hpbGRJZCwKICAgICAgICAgICAgZnJvbTogZGF0YU9iamVjdENoaWxkLl9vd25lciwKICAgICAgICAgICAgdmFsdWU6IGRhdGFPYmplY3RDaGlsZC5kYXRhCiAgICAgICAgICB9OwoKICAgICAgICAgIF90aGlzLl9wcm9jZXNzQ2hpbGRyZW4obXNnKTsKICAgICAgICAgIHJlc29sdmUoZGF0YU9iamVjdENoaWxkKTsKICAgICAgICB9KVsnY2F0Y2gnXShmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgICAgICBjb25zb2xlLmVycm9yKCdSZWFzb246JywgcmVhc29uKTsKICAgICAgICAgIHJlamVjdChyZWFzb24pOwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0KCiAgICAvKioNCiAgICAgKiBUaGlzIGZ1bmN0aW9uIGlzIHVzZWQgdG8gY2xvc2UgYW4gZXhpc3RpbmcgR3JvdXAgQ2hhdCBpbnN0YW5jZS4NCiAgICAgKg0KICAgICAqLwogIH0sIHsKICAgIGtleTogJ2Nsb3NlJywKICAgIHZhbHVlOiBmdW5jdGlvbiBjbG9zZSgpIHt9CiAgfSwgewogICAga2V5OiAnam9pbicsCiAgICB2YWx1ZTogZnVuY3Rpb24gam9pbihyZXNvdXJjZSkgewoKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIHJldHVybiBuZXcgX1Byb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewoKICAgICAgICBfdGhpcy5hZGRQYXJ0aWNpcGFudChyZXNvdXJjZSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICByZXNvbHZlKCdqb2luZWQ6ICcsIHJlc3VsdCk7CiAgICAgICAgfSlbJ2NhdGNoJ10oZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgICAgcmVqZWN0KHJlYXNvbik7CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQoKICAgIC8vIFRPRE86IGltcHJvdmUgdGhpcyB3aXRoIGFuIGludml0ZTsKICAgIC8qKg0KICAgICAqIFRoaXMgZnVuY3Rpb24gaXMgdXNlZCB0byBhZGQgLyBpbnZpdGUgbmV3IHBhcnRpY2lwYW50IG9uIGFuIGV4aXN0aW5nIEdyb3VwIENoYXQgaW5zdGFuY2UuDQogICAgICogQHJldHVybiB7UHJvbWlzZX0gUHJvbWlzZSB3aXRoIHRoZSBzdGF0dXMNCiAgICAgKi8KICB9LCB7CiAgICBrZXk6ICdhZGRQYXJ0aWNpcGFudCcsCiAgICB2YWx1ZTogZnVuY3Rpb24gYWRkUGFydGljaXBhbnQoZW1haWwpIHsKCiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgIHZhciBzeW5jaGVyID0gX3RoaXMuX3N5bmNoZXI7CgogICAgICByZXR1cm4gbmV3IF9Qcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHt9KTsKICAgIH0KCiAgICAvKioNCiAgICAgKiBUaGlzIGZ1bmN0aW9uIGlzIHVzZWQgdG8gcmVtb3ZlIGEgcGFydGljaXBhbnQgZnJvbSBhbiBleGlzdGluZyBHcm91cCBDaGF0IGluc3RhbmNlLg0KICAgICAqIEByZXR1cm4ge1Byb21pc2V9IFByb21pc2Ugd2l0aCB0aGUgc3RhdHVzDQogICAgICovCiAgfSwgewogICAga2V5OiAncmVtb3ZlUGFydGljaXBhbnQnLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbW92ZVBhcnRpY2lwYW50KCkgewogICAgICByZXR1cm4gbmV3IF9Qcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgIHJlc29sdmUoJ3BhcnRpY2lwYW50IHJlbW92ZWQnKTsKICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICByZWplY3QoJ3JlbW92ZSBwYXJ0aWNpcGFudCBmYWlsJyk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KCiAgICAvKioNCiAgICAgKiBUaGlzIGZ1bmN0aW9uIGlzIHVzZWQgdG8gb3BlbiBhIEdyb3VwIENoYXQgaW5zdGFuY2UgdGhhdCB3YXMgcHJldmlvdXNseSBjbG9zZWQuDQogICAgICogQHJldHVybiB7W3R5cGVdfSBbZGVzY3JpcHRpb25dDQogICAgICovCiAgfSwgewogICAga2V5OiAnb3BlbicsCiAgICB2YWx1ZTogZnVuY3Rpb24gb3BlbigpIHt9CiAgfSwgewogICAga2V5OiAnZGF0YU9iamVjdFJlcG9ydGVyJywKICAgIHNldDogZnVuY3Rpb24gc2V0KGRhdGFPYmplY3RSZXBvcnRlcikgewoKICAgICAgaWYgKCFkYXRhT2JqZWN0UmVwb3J0ZXIpIHRocm93IG5ldyBFcnJvcignVGhlIGRhdGEgb2JqZWN0IHJlcG9ydGVyIGlzIG5lY2Vzc2FyeSBwYXJhbWV0ZXInKTsKCiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgIF90aGlzLl9kYXRhT2JqZWN0UmVwb3J0ZXIgPSBkYXRhT2JqZWN0UmVwb3J0ZXI7CgogICAgICBjb25zb2xlLmluZm8oJ1NldCBkYXRhIG9iamVjdCByZXBvcnRlcjogJywgZGF0YU9iamVjdFJlcG9ydGVyKTsKCiAgICAgIGRhdGFPYmplY3RSZXBvcnRlci5vblN1YnNjcmlwdGlvbihmdW5jdGlvbiAoZXZlbnQpIHsKCiAgICAgICAgZXZlbnQuYWNjZXB0KCk7CgogICAgICAgIC8vIFNldCB0aGUgb3RoZXIgc3Vic2NyaXB0aW9uIGxpa2UgYSBwYXJ0aWNpcGFudAogICAgICAgIF9wYXJ0aWNpcGFudDJbJ2RlZmF1bHQnXS5oeXBlcnR5UmVzb3VyY2UgPSBldmVudC51cmw7CiAgICAgICAgZGF0YU9iamVjdFJlcG9ydGVyLmRhdGEuY29tbXVuaWNhdGlvbi5wYXJ0aWNpcGFudHMucHVzaChfcGFydGljaXBhbnQyWydkZWZhdWx0J10pOwoKICAgICAgICBfdGhpcy50cmlnZ2VyKCdwYXJ0aWNpcGFudDphZGRlZCcsIF9wYXJ0aWNpcGFudDJbJ2RlZmF1bHQnXSk7CiAgICAgIH0pOwoKICAgICAgZGF0YU9iamVjdFJlcG9ydGVyLm9uQWRkQ2hpbGRyZW4oZnVuY3Rpb24gKGNoaWxkcmVuKSB7CiAgICAgICAgX3RoaXMuX3Byb2Nlc3NDaGlsZHJlbihjaGlsZHJlbik7CiAgICAgIH0pOwogICAgfSwKICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICByZXR1cm4gX3RoaXMuX2RhdGFPYmplY3RSZXBvcnRlcjsKICAgIH0KICB9LCB7CiAgICBrZXk6ICdkYXRhT2JqZWN0T2JzZXJ2ZXInLAogICAgc2V0OiBmdW5jdGlvbiBzZXQoZGF0YU9iamVjdE9ic2VydmVyKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICBfdGhpcy5fZGF0YU9iamVjdE9ic2VydmVyID0gZGF0YU9iamVjdE9ic2VydmVyOwoKICAgICAgX3RoaXMucHJvY2Vzc1BhcnRpcGFudHMoZGF0YU9iamVjdE9ic2VydmVyKTsKCiAgICAgIGRhdGFPYmplY3RPYnNlcnZlci5vbkNoYW5nZSgnKicsIGZ1bmN0aW9uIChldmVudCkgewogICAgICAgIGNvbnNvbGUuaW5mbygnQ2hhbmdlIEV2ZW50OiAnLCBldmVudCk7CiAgICAgICAgX3RoaXMucHJvY2Vzc1BhcnRpcGFudHMoZGF0YU9iamVjdE9ic2VydmVyKTsKICAgICAgfSk7CgogICAgICBkYXRhT2JqZWN0T2JzZXJ2ZXIub25BZGRDaGlsZHJlbihmdW5jdGlvbiAoY2hpbGRyZW4pIHsKICAgICAgICBfdGhpcy5fcHJvY2Vzc0NoaWxkcmVuKGNoaWxkcmVuKTsKICAgICAgfSk7CiAgICB9LAogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgIHJldHVybiBfdGhpcy5fZGF0YU9iamVjdE9ic2VydmVyOwogICAgfQogIH0sIHsKICAgIGtleTogJ2RhdGFPYmplY3QnLAogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgIHJldHVybiBfdGhpcy5fZGF0YU9iamVjdFJlcG9ydGVyID8gX3RoaXMuZGF0YU9iamVjdFJlcG9ydGVyIDogX3RoaXMuZGF0YU9iamVjdE9ic2VydmVyOwogICAgfQogIH1dKTsKCiAgcmV0dXJuIENoYXRHcm91cDsKfSkoX3V0aWxzRXZlbnRFbWl0dGVyMlsnZGVmYXVsdCddKTsKCmV4cG9ydHNbJ2RlZmF1bHQnXSA9IENoYXRHcm91cDsKbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWydkZWZhdWx0J107Cgp9LHsiLi4vdXRpbHMvRXZlbnRFbWl0dGVyIjoxMDIsIi4vcGFydGljaXBhbnQiOjkzLCJiYWJlbC1ydW50aW1lL2NvcmUtanMvcHJvbWlzZSI6NywiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NsYXNzLWNhbGwtY2hlY2siOjksImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jcmVhdGUtY2xhc3MiOjExLCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvZ2V0IjoxMywiYmFiZWwtcnVudGltZS9oZWxwZXJzL2luaGVyaXRzIjoxNCwiYmFiZWwtcnVudGltZS9oZWxwZXJzL2ludGVyb3AtcmVxdWlyZS1kZWZhdWx0IjoxNX1dLDkxOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKJ3VzZSBzdHJpY3QnOwoKdmFyIF9nZXQgPSByZXF1aXJlKCdiYWJlbC1ydW50aW1lL2hlbHBlcnMvZ2V0JylbJ2RlZmF1bHQnXTsKCnZhciBfaW5oZXJpdHMgPSByZXF1aXJlKCdiYWJlbC1ydW50aW1lL2hlbHBlcnMvaW5oZXJpdHMnKVsnZGVmYXVsdCddOwoKdmFyIF9jcmVhdGVDbGFzcyA9IHJlcXVpcmUoJ2JhYmVsLXJ1bnRpbWUvaGVscGVycy9jcmVhdGUtY2xhc3MnKVsnZGVmYXVsdCddOwoKdmFyIF9jbGFzc0NhbGxDaGVjayA9IHJlcXVpcmUoJ2JhYmVsLXJ1bnRpbWUvaGVscGVycy9jbGFzcy1jYWxsLWNoZWNrJylbJ2RlZmF1bHQnXTsKCnZhciBfUHJvbWlzZSA9IHJlcXVpcmUoJ2JhYmVsLXJ1bnRpbWUvY29yZS1qcy9wcm9taXNlJylbJ2RlZmF1bHQnXTsKCnZhciBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0ID0gcmVxdWlyZSgnYmFiZWwtcnVudGltZS9oZWxwZXJzL2ludGVyb3AtcmVxdWlyZS1kZWZhdWx0JylbJ2RlZmF1bHQnXTsKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsKICB2YWx1ZTogdHJ1ZQp9KTsKZXhwb3J0c1snZGVmYXVsdCddID0gYWN0aXZhdGU7Cgp2YXIgX2h5cGVydHlEaXNjb3ZlcnlIeXBlcnR5RGlzY292ZXJ5ID0gcmVxdWlyZSgnLi4vaHlwZXJ0eS1kaXNjb3ZlcnkvSHlwZXJ0eURpc2NvdmVyeScpOwoKdmFyIF9oeXBlcnR5RGlzY292ZXJ5SHlwZXJ0eURpc2NvdmVyeTIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9oeXBlcnR5RGlzY292ZXJ5SHlwZXJ0eURpc2NvdmVyeSk7Cgp2YXIgX3V0aWxzRXZlbnRFbWl0dGVyID0gcmVxdWlyZSgnLi4vdXRpbHMvRXZlbnRFbWl0dGVyJyk7Cgp2YXIgX3V0aWxzRXZlbnRFbWl0dGVyMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3V0aWxzRXZlbnRFbWl0dGVyKTsKCnZhciBfY29tbXVuaWNhdGlvbiA9IHJlcXVpcmUoJy4vY29tbXVuaWNhdGlvbicpOwoKdmFyIF9jb21tdW5pY2F0aW9uMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2NvbW11bmljYXRpb24pOwoKdmFyIF91dGlsc1V0aWxzID0gcmVxdWlyZSgnLi4vdXRpbHMvdXRpbHMnKTsKCnZhciBfc3luY2hlclN5bmNoZXIgPSByZXF1aXJlKCcuLi9zeW5jaGVyL1N5bmNoZXInKTsKCnZhciBfc3luY2hlclN5bmNoZXIyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfc3luY2hlclN5bmNoZXIpOwoKdmFyIF9wYXJ0aWNpcGFudCA9IHJlcXVpcmUoJy4vcGFydGljaXBhbnQnKTsKCnZhciBfcGFydGljaXBhbnQyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfcGFydGljaXBhbnQpOwoKdmFyIF9DaGF0ID0gcmVxdWlyZSgnLi9DaGF0Jyk7Cgp2YXIgX0NoYXQyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfQ2hhdCk7CgovKioNCiogSHlwZXJ0eSBDaGF0Ow0KKiBAYXV0aG9yIFZpdG9yIFNpbHZhIFt2aXRvci10LXNpbHZhQHRlbGVjb20ucHRdDQoqIEB2ZXJzaW9uIDAuMS4wDQoqLwoKdmFyIEh5cGVydHlDaGF0ID0gKGZ1bmN0aW9uIChfRXZlbnRFbWl0dGVyKSB7CiAgX2luaGVyaXRzKEh5cGVydHlDaGF0LCBfRXZlbnRFbWl0dGVyKTsKCiAgZnVuY3Rpb24gSHlwZXJ0eUNoYXQoaHlwZXJ0eVVSTCwgYnVzLCBjb25maWd1cmF0aW9uKSB7CiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgSHlwZXJ0eUNoYXQpOwoKICAgIGlmICghaHlwZXJ0eVVSTCkgdGhyb3cgbmV3IEVycm9yKCdUaGUgaHlwZXJ0eVVSTCBpcyBhIG5lZWRlZCBwYXJhbWV0ZXInKTsKICAgIGlmICghYnVzKSB0aHJvdyBuZXcgRXJyb3IoJ1RoZSBNaW5pQnVzIGlzIGEgbmVlZGVkIHBhcmFtZXRlcicpOwogICAgaWYgKCFjb25maWd1cmF0aW9uKSB0aHJvdyBuZXcgRXJyb3IoJ1RoZSBjb25maWd1cmF0aW9uIGlzIGEgbmVlZGVkIHBhcmFtZXRlcicpOwoKICAgIF9nZXQoT2JqZWN0LmdldFByb3RvdHlwZU9mKEh5cGVydHlDaGF0LnByb3RvdHlwZSksICdjb25zdHJ1Y3RvcicsIHRoaXMpLmNhbGwodGhpcywgaHlwZXJ0eVVSTCwgYnVzLCBjb25maWd1cmF0aW9uKTsKCiAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgdmFyIHN5bmNoZXIgPSBuZXcgX3N5bmNoZXJTeW5jaGVyMlsnZGVmYXVsdCddKGh5cGVydHlVUkwsIGJ1cywgY29uZmlndXJhdGlvbik7CgogICAgdmFyIGRvbWFpbiA9ICgwLCBfdXRpbHNVdGlscy5kaXZpZGVVUkwpKGh5cGVydHlVUkwpLmRvbWFpbjsKICAgIHZhciBoeXBlcnR5RGlzY292ZXJ5ID0gbmV3IF9oeXBlcnR5RGlzY292ZXJ5SHlwZXJ0eURpc2NvdmVyeTJbJ2RlZmF1bHQnXShkb21haW4sIGJ1cyk7CgogICAgX3RoaXMuX29iamVjdERlc2NVUkwgPSAnaHlwZXJ0eS1jYXRhbG9ndWU6Ly8nICsgZG9tYWluICsgJy8ud2VsbC1rbm93bi9kYXRhc2NoZW1hcy9GYWtlRGF0YVNjaGVtYSc7CgogICAgX3RoaXMuX2h5cGVydHlVUkwgPSBoeXBlcnR5VVJMOwogICAgX3RoaXMuX3N5bmNoZXIgPSBzeW5jaGVyOwogICAgX3RoaXMuX2h5cGVydHlEaXNjb3ZlcnkgPSBoeXBlcnR5RGlzY292ZXJ5OwoKICAgIHN5bmNoZXIub25Ob3RpZmljYXRpb24oZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgIGNvbnNvbGUubG9nKCdOb3RpZmljYXRpb246ICcsIGV2ZW50KTsKICAgICAgX3RoaXMuX2F1dG9TdWJzY3JpYmUoZXZlbnQudXJsKTsKICAgIH0pOwogIH0KCiAgX2NyZWF0ZUNsYXNzKEh5cGVydHlDaGF0LCBbewogICAga2V5OiAnX2F1dG9TdWJzY3JpYmUnLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9hdXRvU3Vic2NyaWJlKHJlc291cmNlKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgIF90aGlzLmpvaW4ocmVzb3VyY2UpLnRoZW4oZnVuY3Rpb24gKGNoYXRHcm91cCkgewogICAgICAgIF90aGlzLnRyaWdnZXIoJ2NoYXQ6c3Vic2NyaWJlJywgY2hhdEdyb3VwKTsKICAgICAgfSlbJ2NhdGNoJ10oZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgIGNvbnNvbGUuZXJyb3IocmVhc29uKTsKICAgICAgfSk7CiAgICB9CgogICAgLyoqDQogICAgICogVGhpcyBmdW5jdGlvbiBpcyB1c2VkIHRvIGNyZWF0ZSBhIG5ldyBHcm91cCBDaGF0IHByb3ZpZGluZyB0aGUgaWRlbnRpZmllciBvZiB0aGUgR3JvdXAgdG8gYmUgbm90aWZpZWQuDQogICAgICogQHBhcmFtICB7U3RyaW5nfSBuYW1lICAgICAgICAgICAgIGNoYXQgbmFtZQ0KICAgICAqIEBwYXJhbSAge1VSTC5Vc2VyVVJMfSBVc2VyVVJMTGlzdCBMaXN0IG9mIFVzZXIgYWxsb3dlZA0KICAgICAqIEByZXR1cm4ge1Byb21pc2V9DQogICAgICovCiAgfSwgewogICAga2V5OiAnY3JlYXRlJywKICAgIHZhbHVlOiBmdW5jdGlvbiBjcmVhdGUobmFtZSwgcGFydGljaXBhbnRzKSB7CgogICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICB2YXIgc3luY2hlciA9IF90aGlzLl9zeW5jaGVyOwogICAgICB2YXIgaHlwZXJ0eURpc2NvdmVyeSA9IF90aGlzLl9oeXBlcnR5RGlzY292ZXJ5OwoKICAgICAgcmV0dXJuIG5ldyBfUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CgogICAgICAgIC8vIENyZWF0ZSBvd25lciBwYXJ0aWNpcGFudAogICAgICAgIC8vIFRPRE86IGNyZWF0ZSBhbGwgaW5mb3JtYXRpb24gdG8gY29tbXVuaWNhdGlvbjsKICAgICAgICBfY29tbXVuaWNhdGlvbjJbJ2RlZmF1bHQnXS5vd25lciA9IF90aGlzLl9oeXBlcnR5VVJMOwogICAgICAgIF9jb21tdW5pY2F0aW9uMlsnZGVmYXVsdCddLmlkID0gbmFtZTsKCiAgICAgICAgLy8gU2V0IHRoZSBvdGhlciBzdWJzY3JpcHRpb24gbGlrZSBhIHBhcnRpY2lwYW50CiAgICAgICAgX3BhcnRpY2lwYW50MlsnZGVmYXVsdCddLmh5cGVydHlSZXNvdXJjZSA9IF90aGlzLl9oeXBlcnR5VVJMOwogICAgICAgIF9jb21tdW5pY2F0aW9uMlsnZGVmYXVsdCddLnBhcnRpY2lwYW50cy5wdXNoKF9wYXJ0aWNpcGFudDJbJ2RlZmF1bHQnXSk7CgogICAgICAgIGNvbnNvbGUuaW5mbygnLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gTWFwcGluZyBQYXJ0aWNwYW50cyAtLS0tLS0tLS0tLS0tLS0tLS0tLSBcbicpOwogICAgICAgIF90aGlzLl9tYXBwaW5nVXNlcihwYXJ0aWNpcGFudHMpLnRoZW4oZnVuY3Rpb24gKGh5cGVydGllcykgewogICAgICAgICAgY29uc29sZS5pbmZvKCctLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gU3luY2hlciBDcmVhdGUgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSBcbicpOwogICAgICAgICAgcmV0dXJuIHN5bmNoZXIuY3JlYXRlKF90aGlzLl9vYmplY3REZXNjVVJMLCBoeXBlcnRpZXMsIHsgY29tbXVuaWNhdGlvbjogX2NvbW11bmljYXRpb24yWydkZWZhdWx0J10gfSk7CiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAoZGF0YU9iamVjdFJlcG9ydGVyKSB7CiAgICAgICAgICBjb25zb2xlLmluZm8oJzMuIFJldHVybiBDcmVhdGUgRGF0YSBPYmplY3QgUmVwb3J0ZXInLCBkYXRhT2JqZWN0UmVwb3J0ZXIpOwoKICAgICAgICAgIHZhciBjaGF0ID0gbmV3IF9DaGF0MlsnZGVmYXVsdCddKHN5bmNoZXIsIGh5cGVydHlEaXNjb3ZlcnksIF90aGlzLl9kb21haW4pOwogICAgICAgICAgY2hhdC5kYXRhT2JqZWN0UmVwb3J0ZXIgPSBkYXRhT2JqZWN0UmVwb3J0ZXI7CgogICAgICAgICAgcmVzb2x2ZShjaGF0KTsKICAgICAgICB9KVsnY2F0Y2gnXShmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgICAgICByZWplY3QocmVhc29uKTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAnam9pbicsCiAgICB2YWx1ZTogZnVuY3Rpb24gam9pbihyZXNvdXJjZSkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICB2YXIgc3luY2hlciA9IF90aGlzLl9zeW5jaGVyOwoKICAgICAgcmV0dXJuIG5ldyBfUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CgogICAgICAgIGNvbnNvbGUuaW5mbygnLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIFN5bmNoZXIgc3Vic2NyaWJlIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gXG4nKTsKICAgICAgICBjb25zb2xlLmluZm8ocmVzb3VyY2UpOwoKICAgICAgICBzeW5jaGVyLnN1YnNjcmliZShfdGhpcy5fb2JqZWN0RGVzY1VSTCwgcmVzb3VyY2UpLnRoZW4oZnVuY3Rpb24gKGRhdGFPYmplY3RPYnNlcnZlcikgewogICAgICAgICAgY29uc29sZS5pbmZvKCdEYXRhIE9iamVjdCBPYnNlcnZlcjogJywgZGF0YU9iamVjdE9ic2VydmVyKTsKICAgICAgICAgIHZhciBjaGF0ID0gbmV3IF9DaGF0MlsnZGVmYXVsdCddKHN5bmNoZXIsIF90aGlzLl9oeXBlcnR5RGlzY292ZXJ5LCBfdGhpcy5fZG9tYWluKTsKICAgICAgICAgIGNoYXQuZGF0YU9iamVjdE9ic2VydmVyID0gZGF0YU9iamVjdE9ic2VydmVyOwoKICAgICAgICAgIHJlc29sdmUoY2hhdCk7CiAgICAgICAgfSlbJ2NhdGNoJ10oZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgICAgcmVqZWN0KHJlYXNvbik7CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogJ19tYXBwaW5nVXNlcicsCiAgICB2YWx1ZTogZnVuY3Rpb24gX21hcHBpbmdVc2VyKHVzZXJMaXN0KSB7CgogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgcmV0dXJuIG5ldyBfUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgdmFyIHByb21pc2VMaXN0ID0gW107CgogICAgICAgIHVzZXJMaXN0LmZvckVhY2goZnVuY3Rpb24gKGVtYWlsKSB7CiAgICAgICAgICBpZiAoZW1haWwubGVuZ3RoKSB7CiAgICAgICAgICAgIHByb21pc2VMaXN0LnB1c2goX3RoaXMuX2h5cGVydHlEaXNjb3ZlcnkuZGlzY292ZXJIeXBlcnR5UGVyVXNlcihlbWFpbCkpOwogICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICBfUHJvbWlzZS5hbGwocHJvbWlzZUxpc3QpLnRoZW4oZnVuY3Rpb24gKHZhbHVlcykgewogICAgICAgICAgdmFyIGh5cGVydGllcyA9IFtdOwoKICAgICAgICAgIHZhbHVlcy5mb3JFYWNoKGZ1bmN0aW9uICh2YWx1ZSkgewogICAgICAgICAgICBoeXBlcnRpZXMucHVzaCh2YWx1ZS5oeXBlcnR5VVJMKTsKICAgICAgICAgIH0pOwoKICAgICAgICAgIHJlc29sdmUoaHlwZXJ0aWVzKTsKICAgICAgICB9KVsnY2F0Y2gnXShmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgICAgICByZWplY3QocmVhc29uKTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CiAgfV0pOwoKICByZXR1cm4gSHlwZXJ0eUNoYXQ7Cn0pKF91dGlsc0V2ZW50RW1pdHRlcjJbJ2RlZmF1bHQnXSk7CgpmdW5jdGlvbiBhY3RpdmF0ZShoeXBlcnR5VVJMLCBidXMsIGNvbmZpZ3VyYXRpb24pIHsKCiAgcmV0dXJuIHsKICAgIG5hbWU6ICdIeXBlcnR5Q2hhdCcsCiAgICBpbnN0YW5jZTogbmV3IEh5cGVydHlDaGF0KGh5cGVydHlVUkwsIGJ1cywgY29uZmlndXJhdGlvbikKICB9Owp9Cgptb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbJ2RlZmF1bHQnXTsKCn0seyIuLi9oeXBlcnR5LWRpc2NvdmVyeS9IeXBlcnR5RGlzY292ZXJ5Ijo5NCwiLi4vc3luY2hlci9TeW5jaGVyIjoxMDEsIi4uL3V0aWxzL0V2ZW50RW1pdHRlciI6MTAyLCIuLi91dGlscy91dGlscyI6MTAzLCIuL0NoYXQiOjkwLCIuL2NvbW11bmljYXRpb24iOjkyLCIuL3BhcnRpY2lwYW50Ijo5MywiYmFiZWwtcnVudGltZS9jb3JlLWpzL3Byb21pc2UiOjcsImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jbGFzcy1jYWxsLWNoZWNrIjo5LCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY3JlYXRlLWNsYXNzIjoxMSwiYmFiZWwtcnVudGltZS9oZWxwZXJzL2dldCI6MTMsImJhYmVsLXJ1bnRpbWUvaGVscGVycy9pbmhlcml0cyI6MTQsImJhYmVsLXJ1bnRpbWUvaGVscGVycy9pbnRlcm9wLXJlcXVpcmUtZGVmYXVsdCI6MTV9XSw5MjpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Cid1c2Ugc3RyaWN0JzsKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsKICB2YWx1ZTogdHJ1ZQp9KTsKdmFyIENvbW11bmljYXRpb25TdGF0dXMgPSB7CiAgT1BFTjogJ29wZW4nLAogIFBFTkRJTkc6ICdwZW5kaW5nJywKICBDTE9TRUQ6ICdjbG9zZWQnLAogIFBBVVNFRDogJ3BhdXNlZCcsCiAgRkFJTEVEOiAnZmFpbGVkJwp9OwoKZXhwb3J0cy5Db21tdW5pY2F0aW9uU3RhdHVzID0gQ29tbXVuaWNhdGlvblN0YXR1czsKdmFyIGNvbW11bmljYXRpb24gPSB7CiAgaWQ6ICcnLAogIGhvc3Q6ICcnLAogIG93bmVyOiAnJywKICBzdGFydGluZ1RpbWU6ICcnLAogIGxhc3RNb2RpZmllZDogJycsCiAgZHVyYXRpb246ICcnLAogIGNvbW11bmljYXRpb25TdGF0dXM6ICcnLAogIGNvbW11bmljYXRpb25RdWFsaXR5OiAnJywKICBwYXJ0aWNpcGFudHM6IFtdLAogIGNoYXRNZXNzYWdlOiB7fQp9OwoKZXhwb3J0c1snZGVmYXVsdCddID0gY29tbXVuaWNhdGlvbjsKCn0se31dLDkzOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKJ3VzZSBzdHJpY3QnOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgewogIHZhbHVlOiB0cnVlCn0pOwp2YXIgcGFydGljaXBhbnQgPSB7CiAgcGFydGljaXBhbnRTdGF0dXM6ICcnLAogIGh5cGVydHlSZXNvdXJjZTogJycsCiAgaWRlbnRpdHk6ICcnCn07CgpleHBvcnRzWydkZWZhdWx0J10gPSBwYXJ0aWNpcGFudDsKbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWydkZWZhdWx0J107Cgp9LHt9XSw5NDpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Ci8qKg0KKiBDb3JlIEh5cGVydHlEaXNjb3ZlcnkgaW50ZXJmYWNlDQoqIENsYXNzIHRvIGFsbG93IGFwcGxpY2F0aW9ucyB0byBzZWFyY2ggZm9yIGh5cGVydGllcyB1c2luZyB0aGUgbWVzc2FnZSBidXMNCiovCid1c2Ugc3RyaWN0JzsKCnZhciBfY3JlYXRlQ2xhc3MgPSByZXF1aXJlKCdiYWJlbC1ydW50aW1lL2hlbHBlcnMvY3JlYXRlLWNsYXNzJylbJ2RlZmF1bHQnXTsKCnZhciBfY2xhc3NDYWxsQ2hlY2sgPSByZXF1aXJlKCdiYWJlbC1ydW50aW1lL2hlbHBlcnMvY2xhc3MtY2FsbC1jaGVjaycpWydkZWZhdWx0J107Cgp2YXIgX1Byb21pc2UgPSByZXF1aXJlKCdiYWJlbC1ydW50aW1lL2NvcmUtanMvcHJvbWlzZScpWydkZWZhdWx0J107CgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7CiAgdmFsdWU6IHRydWUKfSk7Cgp2YXIgSHlwZXJ0eURpc2NvdmVyeSA9IChmdW5jdGlvbiAoKSB7CgogIC8qKg0KICAqIFRvIGluaXRpYWxpc2UgdGhlIEh5cGVydHlEaXNjb3Zlciwgd2hpY2ggd2lsbCBwcm92aWRlIHRoZSBzdXBwb3J0IGZvciBoeXBlcnRpZXMgdG8NCiAgKiBxdWVyeSB1c2VycyByZWdpc3RlcmVkIGluIG91dHNpZGUgdGhlIGludGVybmFsIGNvcmUuDQogICogQHBhcmFtICB7TWVzc2FnZUJ1c30gICAgICAgICAgbXNnYnVzICAgICAgICAgICAgICAgIG1zZ2J1cw0KICAqIEBwYXJhbSAge1J1bnRpbWVVUkx9ICAgICAgICAgIHJ1bnRpbWVVUkwgICAgICAgICAgICBydW50aW1lVVJMDQogICovCgogIGZ1bmN0aW9uIEh5cGVydHlEaXNjb3ZlcnkoZG9tYWluLCBtc2dCdXMpIHsKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBIeXBlcnR5RGlzY292ZXJ5KTsKCiAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgX3RoaXMubWVzc2FnZUJ1cyA9IG1zZ0J1czsKCiAgICBfdGhpcy5kb21haW4gPSBkb21haW47CiAgICBfdGhpcy5kaXNjb3ZlcnlVUkwgPSAnaHlwZXJ0eTovLycgKyBkb21haW4gKyAnL2h5cGVydHlEaXNvdmVyeSc7CiAgfQoKICAvKioNCiAgKiBmdW5jdGlvbiB0byByZXF1ZXN0IGFib3V0IHVzZXJzIHJlZ2lzdGVyZWQgaW4gZG9tYWluIHJlZ2lzdHJ5LCBhbmQNCiAgKiByZXR1cm4gdGhlIGh5cGVydHkgaW5zdGFuY2UgaWYgZm91bmQuDQogICogQHBhcmFtICB7ZW1haWx9ICAgICAgICAgICAgICBlbWFpbA0KICAqIEByZXR1cm4ge1Byb21pc2V9ICAgICAgICAgIFByb21pc2UNCiAgKi8KCiAgX2NyZWF0ZUNsYXNzKEh5cGVydHlEaXNjb3ZlcnksIFt7CiAgICBrZXk6ICdkaXNjb3Zlckh5cGVydHlQZXJVc2VyJywKICAgIHZhbHVlOiBmdW5jdGlvbiBkaXNjb3Zlckh5cGVydHlQZXJVc2VyKGVtYWlsKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgIHZhciBpZGVudGl0eVVSTCA9ICd1c2VyOi8vJyArIGVtYWlsLnN1YnN0cmluZyhlbWFpbC5pbmRleE9mKCdAJykgKyAxLCBlbWFpbC5sZW5ndGgpICsgJy8nICsgZW1haWwuc3Vic3RyaW5nKDAsIGVtYWlsLmluZGV4T2YoJ0AnKSk7CgogICAgICAvLyBtZXNzYWdlIHRvIHF1ZXJ5IGRvbWFpbiByZWdpc3RyeSwgYXNraW5nIGZvciBhIHVzZXIgaHlwZXJ0eS4KICAgICAgdmFyIG1lc3NhZ2UgPSB7CiAgICAgICAgdHlwZTogJ1JFQUQnLCBmcm9tOiBfdGhpcy5kaXNjb3ZlcnlVUkwsIHRvOiAnZG9tYWluOi8vcmVnaXN0cnkuJyArIF90aGlzLmRvbWFpbiArICcvJywgYm9keTogeyByZXNvdXJjZTogaWRlbnRpdHlVUkwgfQogICAgICB9OwoKICAgICAgcmV0dXJuIG5ldyBfUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CgogICAgICAgIF90aGlzLm1lc3NhZ2VCdXMucG9zdE1lc3NhZ2UobWVzc2FnZSwgZnVuY3Rpb24gKHJlcGx5KSB7CiAgICAgICAgICAvL2NvbnNvbGUubG9nKCdNRVNTQUdFJywgcmVwbHkpOwoKICAgICAgICAgIHZhciBoeXBlcnR5ID0gdW5kZWZpbmVkOwogICAgICAgICAgdmFyIG1vc3RSZWNlbnQgPSB1bmRlZmluZWQ7CiAgICAgICAgICB2YXIgbGFzdEh5cGVydHkgPSB1bmRlZmluZWQ7CiAgICAgICAgICB2YXIgdmFsdWUgPSByZXBseS5ib2R5LnZhbHVlOwoKICAgICAgICAgIC8vY29uc29sZS5sb2coJ3ZhbHVlUGFyc2VkJywgdmFsdWVQYXJzZWQpOwogICAgICAgICAgZm9yIChoeXBlcnR5IGluIHZhbHVlKSB7CiAgICAgICAgICAgIGlmICh2YWx1ZVtoeXBlcnR5XS5sYXN0TW9kaWZpZWQgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgIGlmIChtb3N0UmVjZW50ID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIG1vc3RSZWNlbnQgPSBuZXcgRGF0ZSh2YWx1ZVtoeXBlcnR5XS5sYXN0TW9kaWZpZWQpOwogICAgICAgICAgICAgICAgbGFzdEh5cGVydHkgPSBoeXBlcnR5OwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB2YXIgaHlwZXJ0eURhdGUgPSBuZXcgRGF0ZSh2YWx1ZVtoeXBlcnR5XS5sYXN0TW9kaWZpZWQpOwogICAgICAgICAgICAgICAgaWYgKG1vc3RSZWNlbnQuZ2V0VGltZSgpIDwgaHlwZXJ0eURhdGUuZ2V0VGltZSgpKSB7CiAgICAgICAgICAgICAgICAgIG1vc3RSZWNlbnQgPSBoeXBlcnR5RGF0ZTsKICAgICAgICAgICAgICAgICAgbGFzdEh5cGVydHkgPSBoeXBlcnR5OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgdmFyIGh5cGVydHlVUkwgPSBsYXN0SHlwZXJ0eTsKCiAgICAgICAgICBpZiAoaHlwZXJ0eVVSTCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHJldHVybiByZWplY3QoJ1VzZXIgSHlwZXJ0eSBub3QgZm91bmQnKTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgaWRQYWNrYWdlID0gewogICAgICAgICAgICBpZDogZW1haWwsCiAgICAgICAgICAgIGRlc2NyaXB0b3I6IHZhbHVlW2h5cGVydHlVUkxdLmRlc2NyaXB0b3IsCiAgICAgICAgICAgIGh5cGVydHlVUkw6IGh5cGVydHlVUkwKICAgICAgICAgIH07CgogICAgICAgICAgY29uc29sZS5sb2coJz09PT4gUmVnaXN0ZXJIeXBlcnR5IG1lc3NhZ2VCdW5kbGU6ICcsIGlkUGFja2FnZSk7CiAgICAgICAgICByZXNvbHZlKGlkUGFja2FnZSk7CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQogIH1dKTsKCiAgcmV0dXJuIEh5cGVydHlEaXNjb3Zlcnk7Cn0pKCk7CgpleHBvcnRzWydkZWZhdWx0J10gPSBIeXBlcnR5RGlzY292ZXJ5Owptb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbJ2RlZmF1bHQnXTsKCn0seyJiYWJlbC1ydW50aW1lL2NvcmUtanMvcHJvbWlzZSI6NywiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NsYXNzLWNhbGwtY2hlY2siOjksImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jcmVhdGUtY2xhc3MiOjExfV0sOTU6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewondXNlIHN0cmljdCc7Cgp2YXIgX2NyZWF0ZUNsYXNzID0gcmVxdWlyZSgnYmFiZWwtcnVudGltZS9oZWxwZXJzL2NyZWF0ZS1jbGFzcycpWydkZWZhdWx0J107Cgp2YXIgX2NsYXNzQ2FsbENoZWNrID0gcmVxdWlyZSgnYmFiZWwtcnVudGltZS9oZWxwZXJzL2NsYXNzLWNhbGwtY2hlY2snKVsnZGVmYXVsdCddOwoKdmFyIF9Qcm9taXNlID0gcmVxdWlyZSgnYmFiZWwtcnVudGltZS9jb3JlLWpzL3Byb21pc2UnKVsnZGVmYXVsdCddOwoKdmFyIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQgPSByZXF1aXJlKCdiYWJlbC1ydW50aW1lL2hlbHBlcnMvaW50ZXJvcC1yZXF1aXJlLWRlZmF1bHQnKVsnZGVmYXVsdCddOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgewogIHZhbHVlOiB0cnVlCn0pOwoKdmFyIF9TeW5jT2JqZWN0ID0gcmVxdWlyZSgnLi9TeW5jT2JqZWN0Jyk7Cgp2YXIgX1N5bmNPYmplY3QyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfU3luY09iamVjdCk7Cgp2YXIgX0RhdGFPYmplY3RDaGlsZCA9IHJlcXVpcmUoJy4vRGF0YU9iamVjdENoaWxkJyk7Cgp2YXIgX0RhdGFPYmplY3RDaGlsZDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9EYXRhT2JqZWN0Q2hpbGQpOwoKdmFyIF91dGlsc1V0aWxzSnMgPSByZXF1aXJlKCcuLi91dGlscy91dGlscy5qcycpOwoKLyoqDQogKiBNYWluIGV4dGVuc2lvbiBjbGFzcyBmb3Igb2JzZXJ2ZXJzIGFuZCByZXBvcnRlcnMsIHdpdGggY29tbW9uIHByb3BlcnRpZXMgYW5kIG1ldGhvZHMuDQogKiBDaGlsZHJlbiBtYW5hZ2VtZW50IGlzIGNvbW1vbiBmb3Igb2JzZXJ2ZXJzIGFuZCByZXBvcnRlcnMuDQogKi8KCnZhciBEYXRhT2JqZWN0ID0gKGZ1bmN0aW9uICgpIHsKICAvKiBwcml2YXRlDQogIF92ZXJzaW9uOiBudW1iZXINCiAgICBfb3duZXI6IEh5cGVydHlVUkwNCiAgX3VybDogT2JqZWN0VVJMDQogIF9zY2hlbWE6IFNjaGVtYQ0KICBfYnVzOiBNaW5pQnVzDQogIF9zdGF0dXM6IG9uIHwgcGF1c2VkDQogIF9zeW5jT2JqOiBTeW5jRGF0YQ0KICAgIF9jaGlsZHJlbjogeyBpZDogRGF0YU9iamVjdENoaWxkIH0NCiAgICAtLS0tZXZlbnQgaGFuZGxlcnMtLS0tDQogIF9vbkFkZENoaWxkcmVuSGFuZGxlcjogKGV2ZW50KSA9PiB2b2lkDQogICovCgogIC8qKg0KICAgKiBAaWdub3JlDQogICAqIFNob3VsZCBub3QgYmUgdXNlZCBkaXJlY3RseSBieSBIeXBlcnRpZXMuIEl0J3MgY2FsbGVkIGJ5IHRoZSBTeW5jaGVyIGNyZWF0ZSBvciBzdWJzY3JpYmUgbWV0aG9kJ3MNCiAgICovCgogIGZ1bmN0aW9uIERhdGFPYmplY3Qob3duZXIsIHVybCwgc2NoZW1hLCBidXMsIGluaXRpYWxTdGF0dXMsIGluaXRpYWxEYXRhLCBjaGlsZHJlbikgewogICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIERhdGFPYmplY3QpOwoKICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgX3RoaXMuX3ZlcnNpb24gPSAwOwoKICAgIF90aGlzLl9vd25lciA9IG93bmVyOwogICAgX3RoaXMuX3VybCA9IHVybDsKICAgIF90aGlzLl9zY2hlbWEgPSBzY2hlbWE7CiAgICBfdGhpcy5fYnVzID0gYnVzOwogICAgX3RoaXMuX3N0YXR1cyA9IGluaXRpYWxTdGF0dXM7CiAgICBfdGhpcy5fc3luY09iaiA9IG5ldyBfU3luY09iamVjdDJbJ2RlZmF1bHQnXShpbml0aWFsRGF0YSk7CgogICAgX3RoaXMuX2NoaWxkSWQgPSAwOwogICAgX3RoaXMuX2NoaWxkcmVuID0ge307CgogICAgdmFyIGNoaWxkQmFzZVVSTCA9IHVybCArICcvY2hpbGRyZW4vJzsKCiAgICBpZiAoY2hpbGRyZW4pIHsKICAgICAgY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoY2hpbGQpIHsKICAgICAgICB2YXIgY2hpbGRVUkwgPSBjaGlsZEJhc2VVUkwgKyBjaGlsZDsKICAgICAgICBidXMuYWRkTGlzdGVuZXIoY2hpbGRVUkwsIGZ1bmN0aW9uIChtc2cpIHsKICAgICAgICAgIC8vaWdub3JlIG1zZyBzZW50IGJ5IGhpbXNlbGYKICAgICAgICAgIGlmIChtc2cuZnJvbSAhPT0gX3RoaXMyLl9vd25lcikgewogICAgICAgICAgICBzd2l0Y2ggKG1zZy50eXBlKSB7CiAgICAgICAgICAgICAgY2FzZSAnY3JlYXRlJzoKICAgICAgICAgICAgICAgIF90aGlzLl9vbkNoaWxkcmVuQ3JlYXRlKG1zZyk7YnJlYWs7CiAgICAgICAgICAgICAgY2FzZSAnZGVsZXRlJzoKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKG1zZyk7YnJlYWs7CiAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIF90aGlzLl9jaGFuZ2VDaGlsZHJlbihtc2cpO2JyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQogIH0KCiAgLyoqDQogICAqIE9iamVjdCBVUkwgb2YgcmVwb3J0ZXIgb3Igb2JzZXJ2ZXINCiAgICogQHR5cGUge09iamVjdFVSTH0NCiAgICovCgogIF9jcmVhdGVDbGFzcyhEYXRhT2JqZWN0LCBbewogICAga2V5OiAncGF1c2UnLAoKICAgIC8qKg0KICAgICAqIEBpZ25vcmUNCiAgICAgKi8KICAgIHZhbHVlOiBmdW5jdGlvbiBwYXVzZSgpIHsKICAgICAgLy9UT0RPOiB0aGlzIGZlYXR1cmUgbmVlZHMgbW9yZSBhbmFsaXNlCiAgICAgIHRocm93ICdOb3QgaW1wbGVtZW50ZWQnOwogICAgfQoKICAgIC8qKg0KICAgICAqIEBpZ25vcmUNCiAgICAgKi8KICB9LCB7CiAgICBrZXk6ICdyZXN1bWUnLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlc3VtZSgpIHsKICAgICAgLy9UT0RPOiB0aGlzIGZlYXR1cmUgbmVlZHMgbW9yZSBhbmFsaXNlCiAgICAgIHRocm93ICdOb3QgaW1wbGVtZW50ZWQnOwogICAgfQoKICAgIC8qKg0KICAgICAqIEBpZ25vcmUNCiAgICAgKi8KICB9LCB7CiAgICBrZXk6ICdzdG9wJywKICAgIHZhbHVlOiBmdW5jdGlvbiBzdG9wKCkgewogICAgICAvL1RPRE86IHNob3VsZCByZW1vdmUgdGhlIHN1YnNjcmlwdGlvbiBhbmQgc2VuZCBtZXNzYWdlIHVuc3Vic2NyaWJlPwogICAgICB0aHJvdyAnTm90IGltcGxlbWVudGVkJzsKICAgIH0KCiAgICAvKioNCiAgICAgKiBAaWdub3JlDQogICAgICovCiAgfSwgewogICAga2V5OiAncmVsZWFzZScsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVsZWFzZSgpIHt9CiAgICAvL1RPRE86IHJlbW92ZSBhbGwgbGlzdGVuZXJzIGZvciB0aGlzIG9iamVjdAoKICAgIC8qKg0KICAgICAqIENyZWF0ZSBhbmQgYWRkIGEgY2hpbGRyZW4gdG8gdGhlIHN1YnNjcmlwdGlvbiBncm91cC4NCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gcmVzb3VyY2UgLSBSZXNvdXJjZSBuYW1lLCBvbmUgb2YgdGhlIGl0ZW1zIGluIHRoZSBzY2hlbWEucHJvcGVydGllcy5zY2hlbWUgb2YgdGhlIHBhcmVudCBvYmplY3QuDQogICAgICogQHBhcmFtIHtKU09OfSBpbml0aWFsRGF0YSAtIEluaXRpYWwgZGF0YSBvZiB0aGUgY2hpbGQNCiAgICAgKiBAcmV0dXJuIHtQcm9taXNlPERhdGFPYmplY3RDaGlsZD59IC0gUmV0dXJuIFByb21pc2UgdG8gYSBuZXcgQ2hpbGRyZW4uDQogICAgICovCgogIH0sIHsKICAgIGtleTogJ2FkZENoaWxkcmVuJywKICAgIHZhbHVlOiBmdW5jdGlvbiBhZGRDaGlsZHJlbihyZXNvdXJjZSwgaW5pdGlhbERhdGEpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIC8vY3JlYXRlIG5ldyBjaGlsZCB1bmlxdWUgSUQsIGJhc2VkIG9uIGh5cGVydHlVUkwKICAgICAgX3RoaXMuX2NoaWxkSWQrKzsKICAgICAgdmFyIG1zZ0NoaWxkSWQgPSBfdGhpcy5fb3duZXIgKyAnIycgKyBfdGhpcy5fY2hpbGRJZDsKICAgICAgdmFyIG1zZ0NoaWxkUGF0aCA9IF90aGlzLl91cmwgKyAnL2NoaWxkcmVuLycgKyByZXNvdXJjZTsKCiAgICAgIHZhciByZXF1ZXN0TXNnID0gewogICAgICAgIHR5cGU6ICdjcmVhdGUnLCBmcm9tOiBfdGhpcy5fb3duZXIsIHRvOiBtc2dDaGlsZFBhdGgsCiAgICAgICAgYm9keTogeyByZXNvdXJjZTogbXNnQ2hpbGRJZCwgdmFsdWU6IGluaXRpYWxEYXRhIH0KICAgICAgfTsKCiAgICAgIC8vcmV0dXJucyBwcm9taXNlLCBpbiB0aGUgZnV0dXJlLCB0aGUgQVBJIG1heSBjaGFuZ2UgdG8gYXN5bmNocm9ub3VzIGNhbGwKICAgICAgcmV0dXJuIG5ldyBfUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSkgewogICAgICAgIHZhciBtc2dJZCA9IF90aGlzLl9idXMucG9zdE1lc3NhZ2UocmVxdWVzdE1zZyk7CgogICAgICAgIGNvbnNvbGUubG9nKCdjcmVhdGUtcmVwb3J0ZXItY2hpbGQoICcgKyBfdGhpcy5fb3duZXIgKyAnICk6ICcsIHJlcXVlc3RNc2cpOwogICAgICAgIHZhciBuZXdDaGlsZCA9IG5ldyBfRGF0YU9iamVjdENoaWxkMlsnZGVmYXVsdCddKF90aGlzLl9vd25lciwgbXNnQ2hpbGRJZCwgbXNnSWQsIF90aGlzLl9idXMsIGluaXRpYWxEYXRhKTsKICAgICAgICBuZXdDaGlsZC5vbkNoYW5nZShmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICAgIF90aGlzLl9vbkNoYW5nZShldmVudCwgeyBwYXRoOiBtc2dDaGlsZFBhdGgsIGNoaWxkSWQ6IG1zZ0NoaWxkSWQgfSk7CiAgICAgICAgfSk7CgogICAgICAgIF90aGlzLl9jaGlsZHJlblttc2dDaGlsZElkXSA9IG5ld0NoaWxkOwoKICAgICAgICByZXNvbHZlKG5ld0NoaWxkKTsKICAgICAgfSk7CiAgICB9CgogICAgLyoqDQogICAgICogU2V0dXAgdGhlIGNhbGxiYWNrIHRvIHByb2Nlc3MgY3JlYXRlIGFuZCBkZWxldGUgY2hpbGRyZW5zDQogICAgICogQHBhcmFtIHtmdW5jdGlvbihldmVudDogTXNnRXZlbnQpfSBjYWxsYmFjaw0KICAgICAqLwogIH0sIHsKICAgIGtleTogJ29uQWRkQ2hpbGRyZW4nLAogICAgdmFsdWU6IGZ1bmN0aW9uIG9uQWRkQ2hpbGRyZW4oY2FsbGJhY2spIHsKICAgICAgdGhpcy5fb25BZGRDaGlsZHJlbkhhbmRsZXIgPSBjYWxsYmFjazsKICAgIH0KICB9LCB7CiAgICBrZXk6ICdfb25DaGlsZHJlbkNyZWF0ZScsCiAgICB2YWx1ZTogZnVuY3Rpb24gX29uQ2hpbGRyZW5DcmVhdGUobXNnKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgIHZhciBtc2dDaGlsZElkID0gbXNnLmJvZHkucmVzb3VyY2U7CgogICAgICBjb25zb2xlLmxvZygnY3JlYXRlLW9ic2VydmVyLWNoaWxkKCAnICsgX3RoaXMuX293bmVyICsgJyApOiAnLCBtc2cpOwogICAgICB2YXIgbmV3Q2hpbGQgPSBuZXcgX0RhdGFPYmplY3RDaGlsZDJbJ2RlZmF1bHQnXShtc2cuZnJvbSwgbXNnQ2hpbGRJZCwgMCwgX3RoaXMuX2J1cywgbXNnLmJvZHkudmFsdWUpOwogICAgICBfdGhpcy5fY2hpbGRyZW5bbXNnQ2hpbGRJZF0gPSBuZXdDaGlsZDsKCiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgIF90aGlzLl9idXMucG9zdE1lc3NhZ2UoewogICAgICAgICAgaWQ6IG1zZy5pZCwgdHlwZTogJ3Jlc3BvbnNlJywgZnJvbTogbXNnLnRvLCB0bzogbXNnLmZyb20sCiAgICAgICAgICBib2R5OiB7IGNvZGU6IDIwMCwgc291cmNlOiBfdGhpcy5fb3duZXIgfQogICAgICAgIH0pOwogICAgICB9KTsKCiAgICAgIHZhciBldmVudCA9IHsKICAgICAgICB0eXBlOiBtc2cudHlwZSwKICAgICAgICBmcm9tOiBtc2cuZnJvbSwKICAgICAgICB1cmw6IG1zZy50bywKICAgICAgICB2YWx1ZTogbXNnLmJvZHkudmFsdWUsCiAgICAgICAgY2hpbGRJZDogbXNnQ2hpbGRJZAogICAgICB9OwoKICAgICAgaWYgKF90aGlzLl9vbkFkZENoaWxkcmVuSGFuZGxlcikgewogICAgICAgIF90aGlzLl9vbkFkZENoaWxkcmVuSGFuZGxlcihldmVudCk7CiAgICAgIH0KICAgIH0KCiAgICAvL3NlbmQgZGVsdGEgbWVzc2FnZXMgdG8gc3Vic2NyaXB0aW9ucwogIH0sIHsKICAgIGtleTogJ19vbkNoYW5nZScsCiAgICB2YWx1ZTogZnVuY3Rpb24gX29uQ2hhbmdlKGV2ZW50LCBjaGlsZEluZm8pIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIF90aGlzLl92ZXJzaW9uKys7CgogICAgICBpZiAoX3RoaXMuX3N0YXR1cyA9PT0gJ29uJykgewogICAgICAgIHZhciBjaGFuZ2VNc2cgPSB7CiAgICAgICAgICB0eXBlOiAndXBkYXRlJywgZnJvbTogX3RoaXMuX3VybCwgdG86IF90aGlzLl91cmwgKyAnL2NoYW5nZXMnLAogICAgICAgICAgYm9keTogeyB2ZXJzaW9uOiBfdGhpcy5fdmVyc2lvbiwgYXR0cmlidXRlOiBldmVudC5maWVsZCB9CiAgICAgICAgfTsKCiAgICAgICAgaWYgKGV2ZW50Lm9UeXBlID09PSBfU3luY09iamVjdC5PYmplY3RUeXBlLk9CSkVDVCkgewogICAgICAgICAgaWYgKGV2ZW50LmNUeXBlICE9PSBfU3luY09iamVjdC5DaGFuZ2VUeXBlLlJFTU9WRSkgewogICAgICAgICAgICBjaGFuZ2VNc2cuYm9keS52YWx1ZSA9IGV2ZW50LmRhdGE7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNoYW5nZU1zZy5ib2R5LmF0dHJpYnV0ZVR5cGUgPSBldmVudC5vVHlwZTsKICAgICAgICAgIGNoYW5nZU1zZy5ib2R5LnZhbHVlID0gZXZlbnQuZGF0YTsKICAgICAgICAgIGlmIChldmVudC5jVHlwZSAhPT0gX1N5bmNPYmplY3QuQ2hhbmdlVHlwZS5VUERBVEUpIHsKICAgICAgICAgICAgY2hhbmdlTXNnLmJvZHkub3BlcmF0aW9uID0gZXZlbnQuY1R5cGU7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvL2NoaWxkSW5mbyBtdXN0IGhhdmUgKHBhdGgsIGNoaWxkSWQpCiAgICAgICAgaWYgKGNoaWxkSW5mbykgewogICAgICAgICAgY2hhbmdlTXNnLnRvID0gY2hpbGRJbmZvLnBhdGg7CiAgICAgICAgICBjaGFuZ2VNc2cuYm9keS5jaGlsZElkID0gY2hpbGRJbmZvLmNoaWxkSWQ7CiAgICAgICAgfQoKICAgICAgICBfdGhpcy5fYnVzLnBvc3RNZXNzYWdlKGNoYW5nZU1zZyk7CiAgICAgIH0KICAgIH0KCiAgICAvL3JlY2VpdmUgYW5kIHByb2Nlc3MgZGVsdGEgbWVzc2FnZXMKICB9LCB7CiAgICBrZXk6ICdfY2hhbmdlT2JqZWN0JywKICAgIHZhbHVlOiBmdW5jdGlvbiBfY2hhbmdlT2JqZWN0KHN5bmNPYmosIG1zZykgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgLy9UT0RPOiB1cGRhdGUgdmVyc2lvbiA/CiAgICAgIC8vaG93IHRvIGhhbmRsZSBhbiBpbmNvcnJlY3QgdmVyc2lvbiA/IEV4YW1wbGU6IHJlY2VpdmUgYSB2ZXJzaW9uIDMgd2hlbiB0aGUgb2JzZXJ2ZXIgaXMgaW4gdmVyc2lvbiAxLCB3aGVyZSBpcyB0aGUgdmVyc2lvbiAyID8KICAgICAgLy93aWxsIHdlIG5lZWQgdG8gY29uZmlybSB0aGUgcmVjZXB0aW9uID8KICAgICAgaWYgKF90aGlzLl92ZXJzaW9uICsgMSA9PT0gbXNnLmJvZHkudmVyc2lvbikgewogICAgICAgIF90aGlzLl92ZXJzaW9uKys7CiAgICAgICAgdmFyIHBhdGggPSBtc2cuYm9keS5hdHRyaWJ1dGU7CiAgICAgICAgdmFyIHZhbHVlID0gKDAsIF91dGlsc1V0aWxzSnMuZGVlcENsb25lKShtc2cuYm9keS52YWx1ZSk7CiAgICAgICAgdmFyIGZpbmRSZXN1bHQgPSBzeW5jT2JqLmZpbmRCZWZvcmUocGF0aCk7CgogICAgICAgIGlmIChtc2cuYm9keS5hdHRyaWJ1dGVUeXBlID09PSBfU3luY09iamVjdC5PYmplY3RUeXBlLkFSUkFZKSB7CiAgICAgICAgICBpZiAobXNnLmJvZHkub3BlcmF0aW9uID09PSBfU3luY09iamVjdC5DaGFuZ2VUeXBlLkFERCkgewogICAgICAgICAgICB2YXIgYXJyID0gZmluZFJlc3VsdC5vYmo7CiAgICAgICAgICAgIHZhciBpbmRleCA9IGZpbmRSZXN1bHQubGFzdDsKICAgICAgICAgICAgQXJyYXkucHJvdG90eXBlLnNwbGljZS5hcHBseShhcnIsIFtpbmRleCwgMF0uY29uY2F0KHZhbHVlKSk7CiAgICAgICAgICB9IGVsc2UgaWYgKG1zZy5ib2R5Lm9wZXJhdGlvbiA9PT0gX1N5bmNPYmplY3QuQ2hhbmdlVHlwZS5SRU1PVkUpIHsKICAgICAgICAgICAgdmFyIGFyciA9IGZpbmRSZXN1bHQub2JqOwogICAgICAgICAgICB2YXIgaW5kZXggPSBmaW5kUmVzdWx0Lmxhc3Q7CiAgICAgICAgICAgIGFyci5zcGxpY2UoaW5kZXgsIHZhbHVlKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGZpbmRSZXN1bHQub2JqW2ZpbmRSZXN1bHQubGFzdF0gPSB2YWx1ZTsgLy8gVVBEQVRFCiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKG1zZy5ib2R5LnZhbHVlKSB7CiAgICAgICAgICAgICAgZmluZFJlc3VsdC5vYmpbZmluZFJlc3VsdC5sYXN0XSA9IHZhbHVlOyAvLyBVUERBVEUgb3IgQURECiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBkZWxldGUgZmluZFJlc3VsdC5vYmpbZmluZFJlc3VsdC5sYXN0XTsgLy8gUkVNT1ZFCiAgICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgICAgLy9UT0RPOiBob3cgdG8gaGFuZGxlIHVuc3luY2hyb25pemVkIHZlcnNpb25zPwogICAgICAgICAgY29uc29sZS5sb2coJ1VOU1lOQ0hST05JWkVEIFZFUlNJT046IChkYXRhID0+ICcgKyBfdGhpcy5fdmVyc2lvbiArICcsIG1zZyA9PiAnICsgbXNnLmJvZHkudmVyc2lvbiArICcpJyk7CiAgICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogJ19jaGFuZ2VDaGlsZHJlbicsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2NoYW5nZUNoaWxkcmVuKG1zZykgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICBjb25zb2xlLmxvZygnQ2hhbmdlIGNoaWxkcmVuOiAnLCBfdGhpcy5fb3duZXIsIG1zZyk7CgogICAgICB2YXIgY2hpbGRJZCA9IG1zZy5ib2R5LmNoaWxkSWQ7CiAgICAgIHZhciBjaGlsZHJlbiA9IF90aGlzLl9jaGlsZHJlbltjaGlsZElkXTsKCiAgICAgIGlmIChjaGlsZHJlbikgewogICAgICAgIF90aGlzLl9jaGFuZ2VPYmplY3QoY2hpbGRyZW4uX3N5bmNPYmosIG1zZyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc29sZS5sb2coJ05vIGNoaWxkcmVuIGZvdW5kIGZvcjogJywgY2hpbGRJZCk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICd1cmwnLAogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgIHJldHVybiB0aGlzLl91cmw7CiAgICB9CgogICAgLyoqDQogICAgICogT2JqZWN0IHNjaGVtYSBVUkwgKHRoaXMgZmllbGQgaXMgbm90IHlldCBzdGFibGUsIGFuZCBpcyBzdWJzamVjdCB0byBjaGFuZ2UpDQogICAgICogQHR5cGUge1NjaGVtYVVSTH0NCiAgICAgKi8KICB9LCB7CiAgICBrZXk6ICdzY2hlbWEnLAogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgIHJldHVybiB0aGlzLl9zY2hlbWE7CiAgICB9CgogICAgLyoqDQogICAgICogU3RhdHVzIG9mIHRoZSByZXBvcnRlciBvciBvYnNlcnZlciBjb25uZWN0aW9uICh0aGlzIGZpZWxkIGlzIG5vdCB5ZXQgc3RhYmxlLCBhbmQgaXMgc3Vic2plY3QgdG8gY2hhbmdlKQ0KICAgICAqIEB0eXBlIHtTdGF0dXN9IC0gRW51bSBvZjogb24gfCBwYXVzZWQNCiAgICAgKi8KICB9LCB7CiAgICBrZXk6ICdzdGF0dXMnLAogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgIHJldHVybiB0aGlzLl9zdGF0dXM7CiAgICB9CgogICAgLyoqDQogICAgICogRGF0YSBzdHJ1Y3R1cmUgdG8gYmUgc3luY2hyb25pemVkLg0KICAgICAqIEB0eXBlIHtKU09OfSAtIEpTT04gc3RydWN0dXJlIHRoYXQgc2hvdWxkIGZvbGxvdyB0aGUgZGVmaW5lZCBzY2hlbWEsIGlmIGFueS4NCiAgICAgKi8KICB9LCB7CiAgICBrZXk6ICdkYXRhJywKICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICByZXR1cm4gdGhpcy5fc3luY09iai5kYXRhOwogICAgfQoKICAgIC8qKg0KICAgICAqIEFsbCBjcmVhdGVkIGNoaWxkcmVuJ3Mgc2luY2UgdGhlIHN1YnNjcmlwdGlvbiwgZG9lc24ndCBjb250YWluIGFsbCBjaGlsZHJlbidzIHNpbmNlIHJlcG9ydGVyIGNyZWF0aW9uLg0KICAgICAqIEB0eXBlIHtPYmplY3Q8Q2hpbGRJZCwgRGF0YU9iamVjdENoaWxkPn0NCiAgICAgKi8KICB9LCB7CiAgICBrZXk6ICdjaGlsZHJlbicsCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2NoaWxkcmVuOwogICAgfQogIH1dKTsKCiAgcmV0dXJuIERhdGFPYmplY3Q7Cn0pKCk7CgpleHBvcnRzWydkZWZhdWx0J10gPSBEYXRhT2JqZWN0Owptb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbJ2RlZmF1bHQnXTsKCn0seyIuLi91dGlscy91dGlscy5qcyI6MTAzLCIuL0RhdGFPYmplY3RDaGlsZCI6OTYsIi4vU3luY09iamVjdCI6MTAwLCJiYWJlbC1ydW50aW1lL2NvcmUtanMvcHJvbWlzZSI6NywiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NsYXNzLWNhbGwtY2hlY2siOjksImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jcmVhdGUtY2xhc3MiOjExLCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvaW50ZXJvcC1yZXF1aXJlLWRlZmF1bHQiOjE1fV0sOTY6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewondXNlIHN0cmljdCc7Cgp2YXIgX2NyZWF0ZUNsYXNzID0gcmVxdWlyZSgnYmFiZWwtcnVudGltZS9oZWxwZXJzL2NyZWF0ZS1jbGFzcycpWydkZWZhdWx0J107Cgp2YXIgX2NsYXNzQ2FsbENoZWNrID0gcmVxdWlyZSgnYmFiZWwtcnVudGltZS9oZWxwZXJzL2NsYXNzLWNhbGwtY2hlY2snKVsnZGVmYXVsdCddOwoKdmFyIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQgPSByZXF1aXJlKCdiYWJlbC1ydW50aW1lL2hlbHBlcnMvaW50ZXJvcC1yZXF1aXJlLWRlZmF1bHQnKVsnZGVmYXVsdCddOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgewogIHZhbHVlOiB0cnVlCn0pOwoKdmFyIF9TeW5jT2JqZWN0ID0gcmVxdWlyZSgnLi9TeW5jT2JqZWN0Jyk7Cgp2YXIgX1N5bmNPYmplY3QyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfU3luY09iamVjdCk7CgovKioNCiAqIFRoZSBjbGFzcyByZXR1cm5lZCBmcm9tIHRoZSBEYXRhT2JqZWN0IGFkZENoaWxkcmVuIGNhbGwgb3IgZnJvbSBvbkFkZENoaWxkcmVuIGlmIHJlbW90ZWx5IGNyZWF0ZWQuDQogKiBDaGlsZHJlbiBvYmplY3Qgc3luY2hyb25pemF0aW9uIGlzIGEgYSBmYXN0IGZvcndhcmQgbWVjaGFuaXNtLCBubyBuZWVkIGZvciBkaXJlY3Qgc3Vic2NyaXB0aW9ucywgaXQgdXNlcyB0aGUgYWxyZWFkeSBhdXRob3JpemVkIHN1YnNjcmlwdGlvbiBmcm9tIHRoZSBwYXJlbnQgRGF0YU9iamVjdC4NCiAqLwoKdmFyIERhdGFPYmplY3RDaGlsZCAvKiBpbXBsZW1lbnRzIFN5bmNTdGF0dXMgKi8gPSAoZnVuY3Rpb24gKCkgewogIC8qIHByaXZhdGUNCiAgICAtLS0tZXZlbnQgaGFuZGxlcnMtLS0tDQogIF9vblJlc3BvbnNlSGFuZGxlcjogKGV2ZW50KSA9PiB2b2lkDQogICovCgogIC8qKg0KICAgKiBAaWdub3JlDQogICAqIFNob3VsZCBub3QgYmUgdXNlZCBkaXJlY3RseSBieSBIeXBlcnRpZXMuIEl0J3MgY2FsbGVkIGJ5IHRoZSBEYXRhT2JqZWN0LmFkZENoaWxkcmVuDQogICAqLwoKICBmdW5jdGlvbiBEYXRhT2JqZWN0Q2hpbGQob3duZXIsIGNoaWxkSWQsIG1zZ0lkLCBidXMsIGluaXRpYWxEYXRhKSB7CiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgRGF0YU9iamVjdENoaWxkKTsKCiAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgIF90aGlzLl9vd25lciA9IG93bmVyOwogICAgX3RoaXMuX2NoaWxkSWQgPSBjaGlsZElkOwogICAgX3RoaXMuX2J1cyA9IGJ1czsKICAgIF90aGlzLl9zeW5jT2JqID0gbmV3IF9TeW5jT2JqZWN0MlsnZGVmYXVsdCddKGluaXRpYWxEYXRhKTsKCiAgICBidXMuYWRkTGlzdGVuZXIob3duZXIsIGZ1bmN0aW9uIChtc2cpIHsKICAgICAgaWYgKG1zZy50eXBlID09PSAncmVzcG9uc2UnICYmIG1zZy5pZCA9PT0gbXNnSWQpIHsKICAgICAgICBjb25zb2xlLmxvZygnRGF0YU9iamVjdENoaWxkLm9uUmVzcG9uc2U6JywgbXNnKTsKICAgICAgICBfdGhpcy5fb25SZXNwb25zZShtc2cpOwogICAgICB9CiAgICB9KTsKICB9CgogIC8qKg0KICAgKiBDaGlsZHJlbiBJRCBnZW5lcmF0ZWQgb24gYWRkQ2hpbGRyZW4uIFVuaXF1ZSBpZGVudGlmaWVyDQogICAqIEB0eXBlIHtVUkx9IC0gVVJMIG9mIHRoZSBmb3JtYXQgPEh5cGVydHlVUkw+IzxudW1lcmljLXNlcXVlbmNlPg0KICAgKi8KCiAgX2NyZWF0ZUNsYXNzKERhdGFPYmplY3RDaGlsZCwgW3sKICAgIGtleTogJ29uQ2hhbmdlJywKCiAgICAvKioNCiAgICAgKiBSZWdpc3RlciB0aGUgY2hhbmdlIGxpc3RlbmVycyBzZW50IGJ5IHRoZSByZXBvcnRlciBjaGlsZA0KICAgICAqIEBwYXJhbSB7ZnVuY3Rpb24oZXZlbnQ6IE1zZ0V2ZW50KX0gY2FsbGJhY2sNCiAgICAgKi8KICAgIHZhbHVlOiBmdW5jdGlvbiBvbkNoYW5nZShjYWxsYmFjaykgewogICAgICB0aGlzLl9zeW5jT2JqLm9ic2VydmUoZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgY2FsbGJhY2soZXZlbnQpOwogICAgICB9KTsKICAgIH0KCiAgICAvKioNCiAgICAgKiBTZXR1cCB0aGUgY2FsbGJhY2sgdG8gcHJvY2VzcyByZXNwb25zZSBub3RpZmljYXRpb25zIG9mIHRoZSBjcmVhdGVzDQogICAgICogQHBhcmFtIHtmdW5jdGlvbihldmVudDogTXNnRXZlbnQpfSBjYWxsYmFjaw0KICAgICAqLwogIH0sIHsKICAgIGtleTogJ29uUmVzcG9uc2UnLAogICAgdmFsdWU6IGZ1bmN0aW9uIG9uUmVzcG9uc2UoY2FsbGJhY2spIHsKICAgICAgdGhpcy5fb25SZXNwb25zZUhhbmRsZXIgPSBjYWxsYmFjazsKICAgIH0KICB9LCB7CiAgICBrZXk6ICdfb25SZXNwb25zZScsCiAgICB2YWx1ZTogZnVuY3Rpb24gX29uUmVzcG9uc2UobXNnKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICB2YXIgZXZlbnQgPSB7CiAgICAgICAgdHlwZTogbXNnLnR5cGUsCiAgICAgICAgdXJsOiBtc2cuYm9keS5zb3VyY2UsCiAgICAgICAgY29kZTogbXNnLmJvZHkuY29kZQogICAgICB9OwoKICAgICAgaWYgKF90aGlzLl9vblJlc3BvbnNlSGFuZGxlcikgewogICAgICAgIF90aGlzLl9vblJlc3BvbnNlSGFuZGxlcihldmVudCk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICdjaGlsZElkJywKICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICByZXR1cm4gdGhpcy5fY2hpbGRJZDsKICAgIH0KCiAgICAvKioNCiAgICAgKiBEYXRhIFN0cnVjdHVyZSB0byBiZSBzeW5jaHJvbml6ZWQuDQogICAgICogQHR5cGUge0pTT059IC0gSlNPTiBzdHJ1Y3R1cmUgdGhhdCBzaG91bGQgZm9sbG93IHRoZSBkZWZpbmVkIHNjaGVtYSwgaWYgYW55Lg0KICAgICAqLwogIH0sIHsKICAgIGtleTogJ2RhdGEnLAogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgIHJldHVybiB0aGlzLl9zeW5jT2JqLmRhdGE7CiAgICB9CiAgfV0pOwoKICByZXR1cm4gRGF0YU9iamVjdENoaWxkOwp9KSgpOwoKZXhwb3J0c1snZGVmYXVsdCddID0gRGF0YU9iamVjdENoaWxkOwptb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbJ2RlZmF1bHQnXTsKCn0seyIuL1N5bmNPYmplY3QiOjEwMCwiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NsYXNzLWNhbGwtY2hlY2siOjksImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jcmVhdGUtY2xhc3MiOjExLCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvaW50ZXJvcC1yZXF1aXJlLWRlZmF1bHQiOjE1fV0sOTc6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewondXNlIHN0cmljdCc7Cgp2YXIgX2dldCA9IHJlcXVpcmUoJ2JhYmVsLXJ1bnRpbWUvaGVscGVycy9nZXQnKVsnZGVmYXVsdCddOwoKdmFyIF9pbmhlcml0cyA9IHJlcXVpcmUoJ2JhYmVsLXJ1bnRpbWUvaGVscGVycy9pbmhlcml0cycpWydkZWZhdWx0J107Cgp2YXIgX2NyZWF0ZUNsYXNzID0gcmVxdWlyZSgnYmFiZWwtcnVudGltZS9oZWxwZXJzL2NyZWF0ZS1jbGFzcycpWydkZWZhdWx0J107Cgp2YXIgX2NsYXNzQ2FsbENoZWNrID0gcmVxdWlyZSgnYmFiZWwtcnVudGltZS9oZWxwZXJzL2NsYXNzLWNhbGwtY2hlY2snKVsnZGVmYXVsdCddOwoKdmFyIF9PYmplY3Qka2V5cyA9IHJlcXVpcmUoJ2JhYmVsLXJ1bnRpbWUvY29yZS1qcy9vYmplY3Qva2V5cycpWydkZWZhdWx0J107Cgp2YXIgX2ludGVyb3BSZXF1aXJlRGVmYXVsdCA9IHJlcXVpcmUoJ2JhYmVsLXJ1bnRpbWUvaGVscGVycy9pbnRlcm9wLXJlcXVpcmUtZGVmYXVsdCcpWydkZWZhdWx0J107CgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7CiAgdmFsdWU6IHRydWUKfSk7Cgp2YXIgX0RhdGFPYmplY3QyID0gcmVxdWlyZSgnLi9EYXRhT2JqZWN0Jyk7Cgp2YXIgX0RhdGFPYmplY3QzID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfRGF0YU9iamVjdDIpOwoKdmFyIEZpbHRlclR5cGUgPSB7IEFOWTogJ2FueScsIFNUQVJUOiAnc3RhcnQnLCBFWEFDVDogJ2V4YWN0JyB9OwoKLyoqDQogKiBUaGUgY2xhc3MgcmV0dXJuZWQgZnJvbSB0aGUgU3luY2hlciBzdWJzY3JpYmUgY2FsbC4NCiAqIFRvIGJlIHVzZWQgYXMgYW4gb2JzZXJ2YXRpb24gcG9pbnQgZnJvbSBhIERhdGFPYmplY3RSZXBvcnRlciBjaGFuZ2UuDQogKi8KCnZhciBEYXRhT2JqZWN0T2JzZXJ2ZXIgPSAoZnVuY3Rpb24gKF9EYXRhT2JqZWN0KSB7CiAgX2luaGVyaXRzKERhdGFPYmplY3RPYnNlcnZlciwgX0RhdGFPYmplY3QpOwoKICAvKiBwcml2YXRlDQogICAgLS0tLWV2ZW50IGhhbmRsZXJzLS0tLQ0KICBfZmlsdGVyczogezxmaWx0ZXI+OiB7dHlwZTogPHN0YXJ0LCBleGFjdD4sIGNhbGxiYWNrOiA8ZnVuY3Rpb24+fSB9DQogICovCgogIC8qKg0KICAgKiBAaWdub3JlDQogICAqIFNob3VsZCBub3QgYmUgdXNlZCBkaXJlY3RseSBieSBIeXBlcnRpZXMuIEl0J3MgY2FsbGVkIGJ5IHRoZSBTeW5jaGVyLnN1YnNjcmliZSBtZXRob2QNCiAgICovCgogIGZ1bmN0aW9uIERhdGFPYmplY3RPYnNlcnZlcihvd25lciwgdXJsLCBzY2hlbWEsIGJ1cywgaW5pdGlhbFN0YXR1cywgaW5pdGlhbERhdGEsIGNoaWxkcmVuLCBpbml0aWFsVmVyc2lvbikgewogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIERhdGFPYmplY3RPYnNlcnZlcik7CgogICAgX2dldChPYmplY3QuZ2V0UHJvdG90eXBlT2YoRGF0YU9iamVjdE9ic2VydmVyLnByb3RvdHlwZSksICdjb25zdHJ1Y3RvcicsIHRoaXMpLmNhbGwodGhpcywgb3duZXIsIHVybCwgc2NoZW1hLCBidXMsIGluaXRpYWxTdGF0dXMsIGluaXRpYWxEYXRhLCBjaGlsZHJlbik7CiAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgIF90aGlzLl92ZXJzaW9uID0gaW5pdGlhbFZlcnNpb247CgogICAgLy9hZGQgbGlzdGVuZXIgZm9yIG9ialVSTAogICAgYnVzLmFkZExpc3RlbmVyKHVybCArICcvY2hhbmdlcycsIGZ1bmN0aW9uIChtc2cpIHsKICAgICAgY29uc29sZS5sb2coJ0RhdGFPYmplY3RPYnNlcnZlci0nICsgdXJsICsgJy1SQ1Y6ICcsIG1zZyk7CiAgICAgIF90aGlzLl9jaGFuZ2VPYmplY3QoX3RoaXMuX3N5bmNPYmosIG1zZyk7CiAgICB9KTsKCiAgICBfdGhpcy5fc3luY09iai5vYnNlcnZlKGZ1bmN0aW9uIChldmVudCkgewogICAgICBfdGhpcy5fb25GaWx0ZXIoZXZlbnQpOwogICAgfSk7CgogICAgX3RoaXMuX2ZpbHRlcnMgPSB7fTsKICB9CgogIC8qKg0KICAgKiBSZWdpc3RlciB0aGUgY2hhbmdlIGxpc3RlbmVycyBzZW50IGJ5IHRoZSByZXBvcnRlcg0KICAgKiBAcGFyYW0ge3N0cmluZ30gZmlsdGVyIC0gRmlsdGVyIHRoYXQgaWRlbnRpZmllcyB0aGUgZmllbGQgKHNlcGFyZXRlZCBkb3QgcGF0aCkuIEFjY2VwdHMgKiBhdCB0aGUgZW5kIGZvciBhIG1vcmUgdW5yZXN0cmljdGVkIGZpbHRlcmluZy4NCiAgICogQHBhcmFtIHtmdW5jdGlvbihldmVudDogTXNnRXZlbnQpfSBjYWxsYmFjaw0KICAgKi8KCiAgX2NyZWF0ZUNsYXNzKERhdGFPYmplY3RPYnNlcnZlciwgW3sKICAgIGtleTogJ29uQ2hhbmdlJywKICAgIHZhbHVlOiBmdW5jdGlvbiBvbkNoYW5nZShmaWx0ZXIsIGNhbGxiYWNrKSB7CiAgICAgIHZhciBrZXkgPSBmaWx0ZXI7CiAgICAgIHZhciBmaWx0ZXJPYmogPSB7CiAgICAgICAgdHlwZTogRmlsdGVyVHlwZS5FWEFDVCwKICAgICAgICBjYWxsYmFjazogY2FsbGJhY2sKICAgICAgfTsKCiAgICAgIHZhciBpZHggPSBmaWx0ZXIuaW5kZXhPZignKicpOwogICAgICBpZiAoaWR4ID09PSBmaWx0ZXIubGVuZ3RoIC0gMSkgewogICAgICAgIGlmIChpZHggPT09IDApIHsKICAgICAgICAgIGZpbHRlck9iai50eXBlID0gRmlsdGVyVHlwZS5BTlk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGZpbHRlck9iai50eXBlID0gRmlsdGVyVHlwZS5TVEFSVDsKICAgICAgICAgIGtleSA9IGZpbHRlci5zdWJzdHIoMCwgZmlsdGVyLmxlbmd0aCAtIDEpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5fZmlsdGVyc1trZXldID0gZmlsdGVyT2JqOwogICAgfQogIH0sIHsKICAgIGtleTogJ19vbkZpbHRlcicsCiAgICB2YWx1ZTogZnVuY3Rpb24gX29uRmlsdGVyKGV2ZW50KSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICBfT2JqZWN0JGtleXMoX3RoaXMuX2ZpbHRlcnMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgICAgIHZhciBmaWx0ZXIgPSBfdGhpcy5fZmlsdGVyc1trZXldOwogICAgICAgIGlmIChmaWx0ZXIudHlwZSA9PT0gRmlsdGVyVHlwZS5BTlkpIHsKICAgICAgICAgIC8vbWF0Y2ggYW55dGhpbmcKICAgICAgICAgIGZpbHRlci5jYWxsYmFjayhldmVudCk7CiAgICAgICAgfSBlbHNlIGlmIChmaWx0ZXIudHlwZSA9PT0gRmlsdGVyVHlwZS5TVEFSVCkgewogICAgICAgICAgLy9pZiBzdGFydHMgd2l0aCBmaWx0ZXIuLi4KICAgICAgICAgIGlmIChldmVudC5maWVsZC5pbmRleE9mKGtleSkgPT09IDApIHsKICAgICAgICAgICAgZmlsdGVyLmNhbGxiYWNrKGV2ZW50KTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKGZpbHRlci50eXBlID09PSBGaWx0ZXJUeXBlLkVYQUNUKSB7CiAgICAgICAgICAvL2V4YWN0IG1hdGNoCiAgICAgICAgICBpZiAoZXZlbnQuZmllbGQgPT09IGtleSkgewogICAgICAgICAgICBmaWx0ZXIuY2FsbGJhY2soZXZlbnQpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgfV0pOwoKICByZXR1cm4gRGF0YU9iamVjdE9ic2VydmVyOwp9KShfRGF0YU9iamVjdDNbJ2RlZmF1bHQnXSAvKiBpbXBsZW1lbnRzIFN5bmNTdGF0dXMgKi8pOwoKZXhwb3J0c1snZGVmYXVsdCddID0gRGF0YU9iamVjdE9ic2VydmVyOwptb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbJ2RlZmF1bHQnXTsKCn0seyIuL0RhdGFPYmplY3QiOjk1LCJiYWJlbC1ydW50aW1lL2NvcmUtanMvb2JqZWN0L2tleXMiOjUsImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jbGFzcy1jYWxsLWNoZWNrIjo5LCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY3JlYXRlLWNsYXNzIjoxMSwiYmFiZWwtcnVudGltZS9oZWxwZXJzL2dldCI6MTMsImJhYmVsLXJ1bnRpbWUvaGVscGVycy9pbmhlcml0cyI6MTQsImJhYmVsLXJ1bnRpbWUvaGVscGVycy9pbnRlcm9wLXJlcXVpcmUtZGVmYXVsdCI6MTV9XSw5ODpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Cid1c2Ugc3RyaWN0JzsKCnZhciBfZ2V0ID0gcmVxdWlyZSgnYmFiZWwtcnVudGltZS9oZWxwZXJzL2dldCcpWydkZWZhdWx0J107Cgp2YXIgX2luaGVyaXRzID0gcmVxdWlyZSgnYmFiZWwtcnVudGltZS9oZWxwZXJzL2luaGVyaXRzJylbJ2RlZmF1bHQnXTsKCnZhciBfY3JlYXRlQ2xhc3MgPSByZXF1aXJlKCdiYWJlbC1ydW50aW1lL2hlbHBlcnMvY3JlYXRlLWNsYXNzJylbJ2RlZmF1bHQnXTsKCnZhciBfY2xhc3NDYWxsQ2hlY2sgPSByZXF1aXJlKCdiYWJlbC1ydW50aW1lL2hlbHBlcnMvY2xhc3MtY2FsbC1jaGVjaycpWydkZWZhdWx0J107Cgp2YXIgX2ludGVyb3BSZXF1aXJlRGVmYXVsdCA9IHJlcXVpcmUoJ2JhYmVsLXJ1bnRpbWUvaGVscGVycy9pbnRlcm9wLXJlcXVpcmUtZGVmYXVsdCcpWydkZWZhdWx0J107CgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7CiAgdmFsdWU6IHRydWUKfSk7Cgp2YXIgX0RhdGFPYmplY3QyID0gcmVxdWlyZSgnLi9EYXRhT2JqZWN0Jyk7Cgp2YXIgX0RhdGFPYmplY3QzID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfRGF0YU9iamVjdDIpOwoKdmFyIF91dGlsc1V0aWxzSnMgPSByZXF1aXJlKCcuLi91dGlscy91dGlscy5qcycpOwoKLyoqDQogKiBUaGUgY2xhc3MgcmV0dXJuZWQgZnJvbSB0aGUgU3luY2hlciBjcmVhdGUgY2FsbC4NCiAqIFRvIGJlIHVzZWQgYXMgYSByZXBvcnRlciBwb2ludCwgY2hhbmdlcyB3aWxsIGJlIHN1Ym1pdGVkIHRvIERhdGFPYmplY3RPYnNlcnZlciBpbnN0YW5jZXMuDQogKi8KCnZhciBEYXRhT2JqZWN0UmVwb3J0ZXIgPSAoZnVuY3Rpb24gKF9EYXRhT2JqZWN0KSB7CiAgX2luaGVyaXRzKERhdGFPYmplY3RSZXBvcnRlciwgX0RhdGFPYmplY3QpOwoKICAvKiBwcml2YXRlDQogIF9zdWJzY3JpcHRpb25zOiA8aHlwZXJ0eVVybDogeyBzdGF0dXM6IHN0cmluZyB9IH0+DQogICAgLS0tLWV2ZW50IGhhbmRsZXJzLS0tLQ0KICBfb25TdWJzY3JpcHRpb25IYW5kbGVyOiAoZXZlbnQpID0+IHZvaWQNCiAgX29uUmVzcG9uc2VIYW5kbGVyOiAoZXZlbnQpID0+IHZvaWQNCiAgKi8KCiAgLyoqDQogICAqIEBpZ25vcmUNCiAgICogU2hvdWxkIG5vdCBiZSB1c2VkIGRpcmVjdGx5IGJ5IEh5cGVydGllcy4gSXQncyBjYWxsZWQgYnkgdGhlIFN5bmNoZXIuY3JlYXRlIG1ldGhvZA0KICAgKi8KCiAgZnVuY3Rpb24gRGF0YU9iamVjdFJlcG9ydGVyKG93bmVyLCB1cmwsIHNjaGVtYSwgYnVzLCBpbml0aWFsU3RhdHVzLCBpbml0aWFsRGF0YSwgY2hpbGRyZW4pIHsKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBEYXRhT2JqZWN0UmVwb3J0ZXIpOwoKICAgIF9nZXQoT2JqZWN0LmdldFByb3RvdHlwZU9mKERhdGFPYmplY3RSZXBvcnRlci5wcm90b3R5cGUpLCAnY29uc3RydWN0b3InLCB0aGlzKS5jYWxsKHRoaXMsIG93bmVyLCB1cmwsIHNjaGVtYSwgYnVzLCBpbml0aWFsU3RhdHVzLCBpbml0aWFsRGF0YSwgY2hpbGRyZW4pOwogICAgdmFyIF90aGlzID0gdGhpczsKCiAgICBidXMuYWRkTGlzdGVuZXIodXJsLCBmdW5jdGlvbiAobXNnKSB7CiAgICAgIGlmIChtc2cudHlwZSA9PT0gJ3Jlc3BvbnNlJykgewogICAgICAgIF90aGlzLl9vblJlc3BvbnNlKG1zZyk7CiAgICAgIH0KICAgIH0pOwoKICAgIF90aGlzLl9zeW5jT2JqLm9ic2VydmUoZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgIGNvbnNvbGUubG9nKCdEYXRhT2JqZWN0UmVwb3J0ZXItJyArIHVybCArICctU0VORDogJywgZXZlbnQpOwogICAgICBfdGhpcy5fb25DaGFuZ2UoZXZlbnQpOwogICAgfSk7CgogICAgX3RoaXMuX3N1YnNjcmlwdGlvbnMgPSB7fTsKICB9CgogIC8qKg0KICAgKiBTdWJzY3JpcHRpb25zIHJlcXVlc3RlZCBhbmQgYWNjZXB0ZWQgdG8gdGhpcyByZXBvcnRlcg0KICAgKiBAdHlwZSB7T2JqZWN0PEh5cGVydHlVUkwsIFN5bmNTdWJzY3JpcHRpb24+fQ0KICAgKi8KCiAgX2NyZWF0ZUNsYXNzKERhdGFPYmplY3RSZXBvcnRlciwgW3sKICAgIGtleTogJ29uU3Vic2NyaXB0aW9uJywKCiAgICAvKioNCiAgICAgKiBTZXR1cCB0aGUgY2FsbGJhY2sgdG8gcHJvY2VzcyBzdWJzY3JpYmUgYW5kIHVuc3Vic2NyaWJlIG5vdGlmaWNhdGlvbnMNCiAgICAgKiBAcGFyYW0ge2Z1bmN0aW9uKGV2ZW50OiBNc2dFdmVudCl9IGNhbGxiYWNrDQogICAgICovCiAgICB2YWx1ZTogZnVuY3Rpb24gb25TdWJzY3JpcHRpb24oY2FsbGJhY2spIHsKICAgICAgdGhpcy5fb25TdWJzY3JpcHRpb25IYW5kbGVyID0gY2FsbGJhY2s7CiAgICB9CgogICAgLyoqDQogICAgICogU2V0dXAgdGhlIGNhbGxiYWNrIHRvIHByb2Nlc3MgcmVzcG9uc2Ugbm90aWZpY2F0aW9ucyBvZiB0aGUgY3JlYXRlJ3MNCiAgICAgKiBAcGFyYW0ge2Z1bmN0aW9uKGV2ZW50OiBNc2dFdmVudCl9IGNhbGxiYWNrDQogICAgICovCiAgfSwgewogICAga2V5OiAnb25SZXNwb25zZScsCiAgICB2YWx1ZTogZnVuY3Rpb24gb25SZXNwb25zZShjYWxsYmFjaykgewogICAgICB0aGlzLl9vblJlc3BvbnNlSGFuZGxlciA9IGNhbGxiYWNrOwogICAgfQogIH0sIHsKICAgIGtleTogJ19vbkZvcndhcmQnLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9vbkZvcndhcmQobXNnKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICBjb25zb2xlLmxvZygnRGF0YU9iamVjdFJlcG9ydGVyLVJDVjogJywgbXNnKTsKICAgICAgc3dpdGNoIChtc2cuYm9keS50eXBlKSB7CiAgICAgICAgY2FzZSAnc3Vic2NyaWJlJzoKICAgICAgICAgIF90aGlzLl9vblN1YnNjcmliZShtc2cpO2JyZWFrOwogICAgICAgIGNhc2UgJ3Vuc3Vic2NyaWJlJzoKICAgICAgICAgIF90aGlzLl9vblVuU3Vic2NyaWJlKG1zZyk7YnJlYWs7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICdfb25TdWJzY3JpYmUnLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9vblN1YnNjcmliZShtc2cpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgdmFyIGh5cGVydHlVcmwgPSBtc2cuYm9keS5mcm9tOwoKICAgICAgdmFyIGV2ZW50ID0gewogICAgICAgIHR5cGU6IG1zZy5ib2R5LnR5cGUsCiAgICAgICAgdXJsOiBoeXBlcnR5VXJsLAoKICAgICAgICBhY2NlcHQ6IGZ1bmN0aW9uIGFjY2VwdCgpIHsKICAgICAgICAgIC8vY3JlYXRlIG5ldyBzdWJzY3JpcHRpb24KICAgICAgICAgIHZhciBzdWIgPSB7IHVybDogaHlwZXJ0eVVybCwgc3RhdHVzOiAnb24nIH07CiAgICAgICAgICBfdGhpcy5fc3Vic2NyaXB0aW9uc1toeXBlcnR5VXJsXSA9IHN1YjsKCiAgICAgICAgICAvL3NlbmQgb2sgcmVzcG9uc2UgbWVzc2FnZQogICAgICAgICAgX3RoaXMuX2J1cy5wb3N0TWVzc2FnZSh7CiAgICAgICAgICAgIGlkOiBtc2cuaWQsIHR5cGU6ICdyZXNwb25zZScsIGZyb206IG1zZy50bywgdG86IG1zZy5mcm9tLAogICAgICAgICAgICBib2R5OiB7IGNvZGU6IDIwMCwgc2NoZW1hOiBfdGhpcy5fc2NoZW1hLCB2ZXJzaW9uOiBfdGhpcy5fdmVyc2lvbiwgdmFsdWU6ICgwLCBfdXRpbHNVdGlsc0pzLmRlZXBDbG9uZSkoX3RoaXMuZGF0YSkgfQogICAgICAgICAgfSk7CgogICAgICAgICAgcmV0dXJuIHN1YjsKICAgICAgICB9LAoKICAgICAgICByZWplY3Q6IGZ1bmN0aW9uIHJlamVjdChyZWFzb24pIHsKICAgICAgICAgIC8vc2VuZCByZWplY3QgcmVzcG9uc2UgbWVzc2FnZQogICAgICAgICAgX3RoaXMuX2J1cy5wb3N0TWVzc2FnZSh7CiAgICAgICAgICAgIGlkOiBtc2cuaWQsIHR5cGU6ICdyZXNwb25zZScsIGZyb206IG1zZy50bywgdG86IG1zZy5mcm9tLAogICAgICAgICAgICBib2R5OiB7IGNvZGU6IDQwMywgZGVzYzogcmVhc29uIH0KICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfTsKCiAgICAgIGlmIChfdGhpcy5fb25TdWJzY3JpcHRpb25IYW5kbGVyKSB7CiAgICAgICAgY29uc29sZS5sb2coJ1NVQlNDUklQVElPTi1FVkVOVDogJywgZXZlbnQpOwogICAgICAgIF90aGlzLl9vblN1YnNjcmlwdGlvbkhhbmRsZXIoZXZlbnQpOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAnX29uVW5TdWJzY3JpYmUnLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9vblVuU3Vic2NyaWJlKG1zZykgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICB2YXIgaHlwZXJ0eVVybCA9IG1zZy5ib2R5LmZyb207CgogICAgICB2YXIgc3ViID0gX3RoaXMuX3N1YnNjcmlwdGlvbnNbaHlwZXJ0eVVybF07CiAgICAgIGRlbGV0ZSBfdGhpcy5fc3Vic2NyaXB0aW9uc1toeXBlcnR5VXJsXTsKCiAgICAgIHZhciBldmVudCA9IHsKICAgICAgICB0eXBlOiBtc2cuYm9keS50eXBlLAogICAgICAgIHVybDogaHlwZXJ0eVVybCwKICAgICAgICBvYmplY3Q6IHN1YgogICAgICB9OwoKICAgICAgaWYgKF90aGlzLl9vblN1YnNjcmlwdGlvbkhhbmRsZXIpIHsKICAgICAgICBjb25zb2xlLmxvZygnVU4tU1VCU0NSSVBUSU9OLUVWRU5UOiAnLCBldmVudCk7CiAgICAgICAgX3RoaXMuX29uU3Vic2NyaXB0aW9uSGFuZGxlcihldmVudCk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICdfb25SZXNwb25zZScsCiAgICB2YWx1ZTogZnVuY3Rpb24gX29uUmVzcG9uc2UobXNnKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICB2YXIgZXZlbnQgPSB7CiAgICAgICAgdHlwZTogbXNnLnR5cGUsCiAgICAgICAgdXJsOiBtc2cuZnJvbSwKICAgICAgICBjb2RlOiBtc2cuYm9keS5jb2RlCiAgICAgIH07CgogICAgICBpZiAoX3RoaXMuX29uUmVzcG9uc2VIYW5kbGVyKSB7CiAgICAgICAgY29uc29sZS5sb2coJ1JFU1BPTlNFLUVWRU5UOiAnLCBldmVudCk7CiAgICAgICAgX3RoaXMuX29uUmVzcG9uc2VIYW5kbGVyKGV2ZW50KTsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogJ3N1YnNjcmlwdGlvbnMnLAogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgIHJldHVybiB0aGlzLl9zdWJzY3JpcHRpb25zOwogICAgfQogIH1dKTsKCiAgcmV0dXJuIERhdGFPYmplY3RSZXBvcnRlcjsKfSkoX0RhdGFPYmplY3QzWydkZWZhdWx0J10gLyogaW1wbGVtZW50cyBTeW5jU3RhdHVzICovKTsKCmV4cG9ydHNbJ2RlZmF1bHQnXSA9IERhdGFPYmplY3RSZXBvcnRlcjsKbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWydkZWZhdWx0J107Cgp9LHsiLi4vdXRpbHMvdXRpbHMuanMiOjEwMywiLi9EYXRhT2JqZWN0Ijo5NSwiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NsYXNzLWNhbGwtY2hlY2siOjksImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jcmVhdGUtY2xhc3MiOjExLCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvZ2V0IjoxMywiYmFiZWwtcnVudGltZS9oZWxwZXJzL2luaGVyaXRzIjoxNCwiYmFiZWwtcnVudGltZS9oZWxwZXJzL2ludGVyb3AtcmVxdWlyZS1kZWZhdWx0IjoxNX1dLDk5OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKLyoqDQogKiBAYWNjZXNzIHByaXZhdGUNCiAqLwondXNlIHN0cmljdCc7Cgp2YXIgX2NyZWF0ZUNsYXNzID0gcmVxdWlyZSgnYmFiZWwtcnVudGltZS9oZWxwZXJzL2NyZWF0ZS1jbGFzcycpWydkZWZhdWx0J107Cgp2YXIgX2NsYXNzQ2FsbENoZWNrID0gcmVxdWlyZSgnYmFiZWwtcnVudGltZS9oZWxwZXJzL2NsYXNzLWNhbGwtY2hlY2snKVsnZGVmYXVsdCddOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgewogIHZhbHVlOiB0cnVlCn0pOwoKdmFyIERhdGFQcm92aXNpb25hbCA9IChmdW5jdGlvbiAoKSB7CiAgLyogcHJpdmF0ZQ0KICBfY2hpbGRyZW5MaXN0ZW5lcnM6IFtNc2dMaXN0ZW5lcl0NCiAgX2xpc3RlbmVyOiBNc2dMaXN0ZW5lcg0KICAgIF9jaGFuZ2VzOiBbXQ0KICAqLwoKICBmdW5jdGlvbiBEYXRhUHJvdmlzaW9uYWwob3duZXIsIHVybCwgYnVzLCBjaGlsZHJlbikgewogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIERhdGFQcm92aXNpb25hbCk7CgogICAgdmFyIF90aGlzID0gdGhpczsKCiAgICBfdGhpcy5fY2hhbmdlcyA9IFtdOwogICAgX3RoaXMuX2NoaWxkcmVuID0gY2hpbGRyZW47CiAgICBfdGhpcy5fY2hpbGRyZW5MaXN0ZW5lcnMgPSBbXTsKCiAgICBfdGhpcy5fbGlzdGVuZXIgPSBidXMuYWRkTGlzdGVuZXIodXJsLCBmdW5jdGlvbiAobXNnKSB7CiAgICAgIGNvbnNvbGUubG9nKCdEYXRhUHJvdmlzaW9uYWwtJyArIHVybCArICctUkNWOiAnLCBtc2cpOwogICAgICBfdGhpcy5fY2hhbmdlcy5wdXNoKG1zZyk7CiAgICB9KTsKCiAgICAvKmlmIChjaGlsZHJlbikgew0KICAgICAgbGV0IGNoaWxkQmFzZVVSTCA9IHVybCArICcvY2hpbGRyZW4vJzsNCiAgICAgIGNoaWxkcmVuLmZvckVhY2goKGNoaWxkKSA9PiB7DQogICAgICAgIGxldCBjaGlsZFVSTCA9IGNoaWxkQmFzZVVSTCArIGNoaWxkOw0KICAgICAgICBsZXQgbGlzdGVuZXIgPSBidXMuYWRkTGlzdGVuZXIoY2hpbGRVUkwsIChtc2cpID0+IHsNCiAgICAgICAgICAvL2lnbm9yZSBtc2cgc2VudCBieSBoaW1zZWxmDQogICAgICAgICAgaWYgKG1zZy5mcm9tICE9PSBvd25lcikgew0KICAgICAgICAgICAgY29uc29sZS5sb2cobXNnKTsNCiAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgICAgICAgIF90aGlzLl9jaGlsZHJlbkxpc3RlbmVycy5wdXNoKGxpc3RlbmVyKTsNCiAgICAgIH0pOw0KICAgIH0qLwogIH0KCiAgX2NyZWF0ZUNsYXNzKERhdGFQcm92aXNpb25hbCwgW3sKICAgIGtleTogJ2FwcGx5JywKICAgIHZhbHVlOiBmdW5jdGlvbiBhcHBseShvYnNlcnZlcikgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICBfdGhpcy5fY2hhbmdlcy5mb3JFYWNoKGZ1bmN0aW9uIChjaGFuZ2UpIHsKICAgICAgICBvYnNlcnZlci5fY2hhbmdlT2JqZWN0KG9ic2VydmVyLl9zeW5jT2JqLCBjaGFuZ2UpOwogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICdyZWxlYXNlJywKICAgIHZhbHVlOiBmdW5jdGlvbiByZWxlYXNlKCkgewogICAgICB0aGlzLl9saXN0ZW5lci5yZW1vdmUoKTsKCiAgICAgIC8qdGhpcy5fY2hpbGRyZW5MaXN0ZW5lcnMuZm9yRWFjaCgobGlzdGVuZXIpID0+IHsNCiAgICAgICAgbGlzdGVuZXIucmVtb3ZlKCk7DQogICAgICB9KTsqLwogICAgfQogIH0sIHsKICAgIGtleTogJ2NoaWxkcmVuJywKICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICByZXR1cm4gdGhpcy5fY2hpbGRyZW47CiAgICB9CiAgfV0pOwoKICByZXR1cm4gRGF0YVByb3Zpc2lvbmFsOwp9KSgpOwoKZXhwb3J0c1snZGVmYXVsdCddID0gRGF0YVByb3Zpc2lvbmFsOwptb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbJ2RlZmF1bHQnXTsKCn0seyJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY2xhc3MtY2FsbC1jaGVjayI6OSwiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NyZWF0ZS1jbGFzcyI6MTF9XSwxMDA6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewondXNlIHN0cmljdCc7Cgp2YXIgX2NyZWF0ZUNsYXNzID0gcmVxdWlyZSgnYmFiZWwtcnVudGltZS9oZWxwZXJzL2NyZWF0ZS1jbGFzcycpWydkZWZhdWx0J107Cgp2YXIgX2NsYXNzQ2FsbENoZWNrID0gcmVxdWlyZSgnYmFiZWwtcnVudGltZS9oZWxwZXJzL2NsYXNzLWNhbGwtY2hlY2snKVsnZGVmYXVsdCddOwoKdmFyIF9PYmplY3Qka2V5cyA9IHJlcXVpcmUoJ2JhYmVsLXJ1bnRpbWUvY29yZS1qcy9vYmplY3Qva2V5cycpWydkZWZhdWx0J107CgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7CiAgdmFsdWU6IHRydWUKfSk7Cgp2YXIgX3V0aWxzVXRpbHNKcyA9IHJlcXVpcmUoJy4uL3V0aWxzL3V0aWxzLmpzJyk7CgovKioNCiAqIEBhY2Nlc3MgcHJpdmF0ZQ0KICovCgp2YXIgU3luY09iamVjdCA9IChmdW5jdGlvbiAoKSB7CiAgLyogcHJpdmF0ZQ0KICAgIF9kYXRhOiBhbnk7DQogICAgX29ic2VydmVyczogKChldmVudDogQ2hhbmdlRXZlbnQpID0+IHZvaWQpW10NCiAgKi8KCiAgZnVuY3Rpb24gU3luY09iamVjdChpbml0aWFsRGF0YSkgewogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFN5bmNPYmplY3QpOwoKICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgX3RoaXMuX29ic2VydmVycyA9IFtdOwogICAgX3RoaXMuX2ZpbHRlcnMgPSB7fTsKCiAgICBpZiAoaW5pdGlhbERhdGEpIHsKICAgICAgX3RoaXMuX2RhdGEgPSAoMCwgX3V0aWxzVXRpbHNKcy5kZWVwQ2xvbmUpKGluaXRpYWxEYXRhKTsKICAgIH0gZWxzZSB7CiAgICAgIF90aGlzLl9kYXRhID0ge307CiAgICB9CgogICAgX3RoaXMuX2ludGVybmFsT2JzZXJ2ZShuZXcgUGF0aCgpLCBfdGhpcy5fZGF0YSk7CiAgfQoKICAvL2R5bmFtaWMgcGF0aCBmb3IgQXJyYXkgaW5kZXguLi4KCiAgX2NyZWF0ZUNsYXNzKFN5bmNPYmplY3QsIFt7CiAgICBrZXk6ICdvYnNlcnZlJywKICAgIHZhbHVlOiBmdW5jdGlvbiBvYnNlcnZlKGNhbGxiYWNrKSB7CiAgICAgIHRoaXMuX29ic2VydmVycy5wdXNoKGNhbGxiYWNrKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICdmaW5kJywKICAgIHZhbHVlOiBmdW5jdGlvbiBmaW5kKHBhdGgpIHsKICAgICAgdmFyIGxpc3QgPSBwYXRoLnNwbGl0KCcuJyk7CgogICAgICByZXR1cm4gdGhpcy5fZmluZFdpdGhTcGxpdChsaXN0KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICdmaW5kQmVmb3JlJywKICAgIHZhbHVlOiBmdW5jdGlvbiBmaW5kQmVmb3JlKHBhdGgpIHsKICAgICAgdmFyIHJlc3VsdCA9IHt9OwogICAgICB2YXIgbGlzdCA9IHBhdGguc3BsaXQoJy4nKTsKICAgICAgcmVzdWx0Lmxhc3QgPSBsaXN0LnBvcCgpOwogICAgICByZXN1bHQub2JqID0gdGhpcy5fZmluZFdpdGhTcGxpdChsaXN0KTsKCiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgfSwgewogICAga2V5OiAnX2ZpbmRXaXRoU3BsaXQnLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9maW5kV2l0aFNwbGl0KGxpc3QpIHsKICAgICAgdmFyIG9iaiA9IHRoaXMuX2RhdGE7CiAgICAgIGxpc3QuZm9yRWFjaChmdW5jdGlvbiAodmFsdWUpIHsKICAgICAgICBvYmogPSBvYmpbdmFsdWVdOwogICAgICB9KTsKCiAgICAgIHJldHVybiBvYmo7CiAgICB9CiAgfSwgewogICAga2V5OiAnX2ZpcmVFdmVudCcsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2ZpcmVFdmVudChldmVudCkgewogICAgICB0aGlzLl9vYnNlcnZlcnMuZm9yRWFjaChmdW5jdGlvbiAoY2FsbGJhY2spIHsKICAgICAgICBjYWxsYmFjayhldmVudCk7CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogJ19pc09ic2VydmFibGUnLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9pc09ic2VydmFibGUob2JqKSB7CiAgICAgIGlmIChvYmouY29uc3RydWN0b3IgPT09IE9iamVjdCB8fCBvYmouY29uc3RydWN0b3IgPT09IEFycmF5KSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KCiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICdfaW50ZXJuYWxPYnNlcnZlJywKICAgIHZhbHVlOiBmdW5jdGlvbiBfaW50ZXJuYWxPYnNlcnZlKHBhdGgsIG9iaikgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgaWYgKF90aGlzLl9pc09ic2VydmFibGUob2JqKSkgewogICAgICAgIHZhciBoYW5kbGVyID0gZnVuY3Rpb24gaGFuZGxlcihjaGFuZ2VzKSB7CiAgICAgICAgICBfdGhpcy5fb25DaGFuZ2VzKHBhdGgsIGNoYW5nZXMpOwogICAgICAgIH07CgogICAgICAgIGlmIChvYmouY29uc3RydWN0b3IgPT09IE9iamVjdCkgewogICAgICAgICAgT2JqZWN0Lm9ic2VydmUob2JqLCBoYW5kbGVyKTsKICAgICAgICAgIGZvciAodmFyIHByb3AgaW4gb2JqKSB7CiAgICAgICAgICAgIGlmIChfdGhpcy5faXNPYnNlcnZhYmxlKG9ialtwcm9wXSkpIHsKICAgICAgICAgICAgICBfdGhpcy5faW50ZXJuYWxPYnNlcnZlKHBhdGhbJ25ldyddKHByb3ApLCBvYmpbcHJvcF0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChvYmouY29uc3RydWN0b3IgPT09IEFycmF5KSB7CiAgICAgICAgICBBcnJheS5vYnNlcnZlKG9iaiwgaGFuZGxlcik7CiAgICAgICAgICBmb3IgKHZhciBwcm9wIGluIG9iaikgewogICAgICAgICAgICBpZiAoX3RoaXMuX2lzT2JzZXJ2YWJsZShvYmpbcHJvcF0pKSB7CiAgICAgICAgICAgICAgdmFyIG5wID0gcGF0aFsnbmV3J10obmV3IEFycmF5SW5kZXgob2JqW3Byb3BdLCBwcm9wKSk7CiAgICAgICAgICAgICAgX3RoaXMuX2ludGVybmFsT2JzZXJ2ZShucCwgb2JqW3Byb3BdKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogJ19vbkNoYW5nZXMnLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9vbkNoYW5nZXMocGF0aCwgY2hhbmdlcykgewogICAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICAgIGZvciAodmFyIGkgaW4gY2hhbmdlcykgewogICAgICAgIHZhciBvYmogPSBjaGFuZ2VzW2ldLm9iamVjdDsKICAgICAgICB2YXIgb2JqVHlwZSA9IHVuZGVmaW5lZDsKCiAgICAgICAgaWYgKG9iai5jb25zdHJ1Y3RvciA9PT0gT2JqZWN0KSB7CiAgICAgICAgICBvYmpUeXBlID0gT2JqZWN0VHlwZS5PQkpFQ1Q7CiAgICAgICAgfQoKICAgICAgICBpZiAob2JqLmNvbnN0cnVjdG9yID09PSBBcnJheSkgewogICAgICAgICAgb2JqVHlwZSA9IE9iamVjdFR5cGUuQVJSQVk7CiAgICAgICAgfQoKICAgICAgICBpZiAoY2hhbmdlc1tpXS50eXBlID09PSAnc3BsaWNlJykgewogICAgICAgICAgKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIGlkeCA9IGNoYW5nZXNbaV0uaW5kZXg7CiAgICAgICAgICAgIHZhciBmaWVsZCA9IHBhdGhbJ25ldyddKCcnICsgaWR4KTsKICAgICAgICAgICAgdmFyIGZpZWxkU3RyaW5nID0gZmllbGQudG9TdHJpbmcoKTsKCiAgICAgICAgICAgIHZhciByZW1vdmVTaXplID0gY2hhbmdlc1tpXS5yZW1vdmVkLmxlbmd0aDsKICAgICAgICAgICAgaWYgKHJlbW92ZVNpemUgIT09IDApIHsKICAgICAgICAgICAgICB2YXIgcmVtb3ZlVmFsdWVzID0gY2hhbmdlc1tpXS5yZW1vdmVkOwogICAgICAgICAgICAgIHJlbW92ZVZhbHVlcy5mb3JFYWNoKGZ1bmN0aW9uICh2YWx1ZSwgaW5kZXgpIHsKICAgICAgICAgICAgICAgIGlmIChfdGhpczIuX2lzT2JzZXJ2YWJsZSh2YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgcGF0aC5yZW1vdmVJbmRleChpZHggKyBpbmRleCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIF90aGlzMi5fZmlyZUV2ZW50KHsKICAgICAgICAgICAgICAgIGNUeXBlOiBDaGFuZ2VUeXBlLlJFTU9WRSwKICAgICAgICAgICAgICAgIG9UeXBlOiBvYmpUeXBlLAogICAgICAgICAgICAgICAgZmllbGQ6IGZpZWxkU3RyaW5nLAogICAgICAgICAgICAgICAgZGF0YTogcmVtb3ZlU2l6ZQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgYWRkU2l6ZSA9IGNoYW5nZXNbaV0uYWRkZWRDb3VudDsKICAgICAgICAgICAgaWYgKGFkZFNpemUgIT09IDApIHsKICAgICAgICAgICAgICB2YXIgYWRkVmFsdWVzID0gb2JqLnNsaWNlKGlkeCwgaWR4ICsgYWRkU2l6ZSk7CiAgICAgICAgICAgICAgYWRkVmFsdWVzLmZvckVhY2goZnVuY3Rpb24gKHZhbHVlLCBpbmRleCkgewogICAgICAgICAgICAgICAgaWYgKF90aGlzMi5faXNPYnNlcnZhYmxlKHZhbHVlKSkgewogICAgICAgICAgICAgICAgICB2YXIgbnAgPSBwYXRoWyduZXcnXShuZXcgQXJyYXlJbmRleCh2YWx1ZSwgaWR4ICsgaW5kZXgpKTsKICAgICAgICAgICAgICAgICAgX3RoaXMyLl9pbnRlcm5hbE9ic2VydmUobnAsIHZhbHVlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgX3RoaXMyLl9maXJlRXZlbnQoewogICAgICAgICAgICAgICAgY1R5cGU6IENoYW5nZVR5cGUuQURELAogICAgICAgICAgICAgICAgb1R5cGU6IG9ialR5cGUsCiAgICAgICAgICAgICAgICBmaWVsZDogZmllbGRTdHJpbmcsCiAgICAgICAgICAgICAgICBkYXRhOiAoMCwgX3V0aWxzVXRpbHNKcy5kZWVwQ2xvbmUpKGFkZFZhbHVlcykKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy9yZS1kZWZpbmUgcGF0aHMuLi4KICAgICAgICAgICAgaWYgKGlkeCAhPT0gb2JqLmxlbmd0aCAtIDEpIHsKICAgICAgICAgICAgICBwYXRoLnJlSW5kZXhGcm9tKG9iaik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZhciBmaWVsZCA9IHBhdGhbJ25ldyddKGNoYW5nZXNbaV0ubmFtZSk7CiAgICAgICAgICB2YXIgZmllbGRTdHJpbmcgPSBmaWVsZC50b1N0cmluZygpOwoKICAgICAgICAgIGlmIChmaWVsZFN0cmluZy5pbmRleE9mKCdTeW1ib2wnKSAhPT0gLTEpIHsKICAgICAgICAgICAgLy9oYWNrIGZvciBQaGFudG9tSlMyCiAgICAgICAgICAgIC8vY29uc29sZS5sb2coJ1NZTUJPTDogJywgY2hhbmdlc1tpXSk7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQoKICAgICAgICAgIC8vbGV0IG9sZFZhbHVlID0gY2hhbmdlc1tpXS5vbGRWYWx1ZTsKICAgICAgICAgIHZhciBuZXdWYWx1ZSA9IG9ialtjaGFuZ2VzW2ldLm5hbWVdOwogICAgICAgICAgaWYgKGNoYW5nZXNbaV0udHlwZSA9PT0gJ3VwZGF0ZScpIHsKICAgICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KHsKICAgICAgICAgICAgICBjVHlwZTogQ2hhbmdlVHlwZS5VUERBVEUsCiAgICAgICAgICAgICAgb1R5cGU6IG9ialR5cGUsCiAgICAgICAgICAgICAgZmllbGQ6IGZpZWxkU3RyaW5nLAogICAgICAgICAgICAgIGRhdGE6ICgwLCBfdXRpbHNVdGlsc0pzLmRlZXBDbG9uZSkobmV3VmFsdWUpCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChjaGFuZ2VzW2ldLnR5cGUgPT09ICdhZGQnKSB7CiAgICAgICAgICAgIHRoaXMuX2ludGVybmFsT2JzZXJ2ZShmaWVsZCwgbmV3VmFsdWUpOwogICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoewogICAgICAgICAgICAgIGNUeXBlOiBDaGFuZ2VUeXBlLkFERCwKICAgICAgICAgICAgICBvVHlwZTogb2JqVHlwZSwKICAgICAgICAgICAgICBmaWVsZDogZmllbGRTdHJpbmcsCiAgICAgICAgICAgICAgZGF0YTogKDAsIF91dGlsc1V0aWxzSnMuZGVlcENsb25lKShuZXdWYWx1ZSkKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGNoYW5nZXNbaV0udHlwZSA9PT0gJ2RlbGV0ZScpIHsKICAgICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KHsKICAgICAgICAgICAgICBjVHlwZTogQ2hhbmdlVHlwZS5SRU1PVkUsCiAgICAgICAgICAgICAgb1R5cGU6IG9ialR5cGUsCiAgICAgICAgICAgICAgZmllbGQ6IGZpZWxkU3RyaW5nCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogJ2RhdGEnLAogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgIHJldHVybiB0aGlzLl9kYXRhOwogICAgfQogIH1dKTsKCiAgcmV0dXJuIFN5bmNPYmplY3Q7Cn0pKCk7Cgp2YXIgUGF0aCA9IChmdW5jdGlvbiAoKSB7CiAgZnVuY3Rpb24gUGF0aCgpIHsKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBQYXRoKTsKCiAgICB0aGlzLl9wYXRoID0gW107CiAgICB0aGlzLl9vYnNlcnZhYmxlcyA9IHt9OyAvLzxpbmRleDpBcnJheUluZGV4PgogIH0KCiAgX2NyZWF0ZUNsYXNzKFBhdGgsIFt7CiAgICBrZXk6ICdyZW1vdmVJbmRleCcsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVtb3ZlSW5kZXgoaWR4KSB7CiAgICAgIC8vY29uc29sZS5sb2coJ1JFTU9WRS1QQVRIICcgKyBpZHgpOwogICAgICBkZWxldGUgdGhpcy5fb2JzZXJ2YWJsZXNbaWR4XTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICdyZUluZGV4RnJvbScsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVJbmRleEZyb20oYXJyYXkpIHsKICAgICAgdmFyIF90aGlzMyA9IHRoaXM7CgogICAgICBfT2JqZWN0JGtleXModGhpcy5fb2JzZXJ2YWJsZXMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgICAgIHZhciBhcnJheUluZGV4ID0gX3RoaXMzLl9vYnNlcnZhYmxlc1trZXldOwogICAgICAgIHZhciBpZHggPSBhcnJheS5pbmRleE9mKGFycmF5SW5kZXgub2JqKTsKICAgICAgICBpZiAoYXJyYXlJbmRleC5pZHggIT0gaWR4KSB7CiAgICAgICAgICAvL2NvbnNvbGUubG9nKCdSRS1JTkRFWDogJyArIGtleSArICctPicgKyBpZHgpOwogICAgICAgICAgYXJyYXlJbmRleC5pZHggPSBpZHg7CiAgICAgICAgICBkZWxldGUgX3RoaXMzLl9vYnNlcnZhYmxlc1trZXldOwogICAgICAgICAgX3RoaXMzLl9vYnNlcnZhYmxlc1tpZHhdID0gYXJyYXlJbmRleDsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogJ25ldycsCiAgICB2YWx1ZTogZnVuY3Rpb24gX25ldyhpZHgpIHsKICAgICAgaWYgKGlkeC5jb25zdHJ1Y3RvciA9PSBBcnJheUluZGV4KSB7CiAgICAgICAgLy9jb25zb2xlLmxvZygnUEFUSC1PQlNFUlY6ICcsIGlkeCk7CiAgICAgICAgdGhpcy5fb2JzZXJ2YWJsZXNbaWR4LmlkeF0gPSBpZHg7CiAgICAgIH0KCiAgICAgIHZhciBuUGF0aCA9IHRoaXMuY2xvbmUoKTsKICAgICAgblBhdGguX3BhdGgucHVzaChpZHgpOwoKICAgICAgcmV0dXJuIG5QYXRoOwogICAgfQogIH0sIHsKICAgIGtleTogJ2Nsb25lJywKICAgIHZhbHVlOiBmdW5jdGlvbiBjbG9uZSgpIHsKICAgICAgdmFyIG5QYXRoID0gbmV3IFBhdGgoKTsKICAgICAgdGhpcy5fcGF0aC5mb3JFYWNoKGZ1bmN0aW9uICh2YWx1ZSkgewogICAgICAgIG5QYXRoLl9wYXRoLnB1c2godmFsdWUpOwogICAgICB9KTsKCiAgICAgIHJldHVybiBuUGF0aDsKICAgIH0KICB9LCB7CiAgICBrZXk6ICd0b1N0cmluZycsCiAgICB2YWx1ZTogZnVuY3Rpb24gdG9TdHJpbmcoKSB7CiAgICAgIC8vVE9ETzogb3B0aW1pemUhIQogICAgICB2YXIgc3RyID0gJyc7CiAgICAgIHRoaXMuX3BhdGguZm9yRWFjaChmdW5jdGlvbiAodmFsdWUsIGluZGV4KSB7CiAgICAgICAgaWYgKGluZGV4ID09PSAwKSB7CiAgICAgICAgICBzdHIgPSB2YWx1ZS50b1N0cmluZygpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBzdHIgKz0gJy4nICsgdmFsdWUudG9TdHJpbmcoKTsKICAgICAgICB9CiAgICAgIH0pOwoKICAgICAgcmV0dXJuIHN0cjsKICAgIH0KICB9XSk7CgogIHJldHVybiBQYXRoOwp9KSgpOwoKdmFyIEFycmF5SW5kZXggPSAoZnVuY3Rpb24gKCkgewogIGZ1bmN0aW9uIEFycmF5SW5kZXgob2JqLCBpZHgpIHsKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBBcnJheUluZGV4KTsKCiAgICB0aGlzLm9iaiA9IG9iajsKICAgIHRoaXMuaWR4ID0gaWR4OwogIH0KCiAgX2NyZWF0ZUNsYXNzKEFycmF5SW5kZXgsIFt7CiAgICBrZXk6ICd0b1N0cmluZycsCiAgICB2YWx1ZTogZnVuY3Rpb24gdG9TdHJpbmcoKSB7CiAgICAgIHJldHVybiB0aGlzLmlkeC50b1N0cmluZygpOwogICAgfQogIH1dKTsKCiAgcmV0dXJuIEFycmF5SW5kZXg7Cn0pKCk7Cgp2YXIgQ2hhbmdlVHlwZSA9IHsgVVBEQVRFOiAndXBkYXRlJywgQUREOiAnYWRkJywgUkVNT1ZFOiAncmVtb3ZlJyB9OwpleHBvcnRzLkNoYW5nZVR5cGUgPSBDaGFuZ2VUeXBlOwp2YXIgT2JqZWN0VHlwZSA9IHsgT0JKRUNUOiAnb2JqZWN0JywgQVJSQVk6ICdhcnJheScgfTsKZXhwb3J0cy5PYmplY3RUeXBlID0gT2JqZWN0VHlwZTsKZXhwb3J0c1snZGVmYXVsdCddID0gU3luY09iamVjdDsKCn0seyIuLi91dGlscy91dGlscy5qcyI6MTAzLCJiYWJlbC1ydW50aW1lL2NvcmUtanMvb2JqZWN0L2tleXMiOjUsImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jbGFzcy1jYWxsLWNoZWNrIjo5LCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY3JlYXRlLWNsYXNzIjoxMX1dLDEwMTpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Cid1c2Ugc3RyaWN0JzsKCnZhciBfY3JlYXRlQ2xhc3MgPSByZXF1aXJlKCdiYWJlbC1ydW50aW1lL2hlbHBlcnMvY3JlYXRlLWNsYXNzJylbJ2RlZmF1bHQnXTsKCnZhciBfY2xhc3NDYWxsQ2hlY2sgPSByZXF1aXJlKCdiYWJlbC1ydW50aW1lL2hlbHBlcnMvY2xhc3MtY2FsbC1jaGVjaycpWydkZWZhdWx0J107Cgp2YXIgX1Byb21pc2UgPSByZXF1aXJlKCdiYWJlbC1ydW50aW1lL2NvcmUtanMvcHJvbWlzZScpWydkZWZhdWx0J107Cgp2YXIgX2ludGVyb3BSZXF1aXJlRGVmYXVsdCA9IHJlcXVpcmUoJ2JhYmVsLXJ1bnRpbWUvaGVscGVycy9pbnRlcm9wLXJlcXVpcmUtZGVmYXVsdCcpWydkZWZhdWx0J107CgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7CiAgdmFsdWU6IHRydWUKfSk7Cgp2YXIgX0RhdGFPYmplY3RSZXBvcnRlciA9IHJlcXVpcmUoJy4vRGF0YU9iamVjdFJlcG9ydGVyJyk7Cgp2YXIgX0RhdGFPYmplY3RSZXBvcnRlcjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9EYXRhT2JqZWN0UmVwb3J0ZXIpOwoKdmFyIF9EYXRhT2JqZWN0T2JzZXJ2ZXIgPSByZXF1aXJlKCcuL0RhdGFPYmplY3RPYnNlcnZlcicpOwoKdmFyIF9EYXRhT2JqZWN0T2JzZXJ2ZXIyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfRGF0YU9iamVjdE9ic2VydmVyKTsKCnZhciBfRGF0YVByb3Zpc2lvbmFsID0gcmVxdWlyZSgnLi9EYXRhUHJvdmlzaW9uYWwnKTsKCnZhciBfRGF0YVByb3Zpc2lvbmFsMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX0RhdGFQcm92aXNpb25hbCk7CgovKioNCiAqIFRoZSBtYWluIGNsYXNzIGZvciB0aGUgc3luY2hlciBwYWNrYWdlLg0KICogVGhlIFN5bmNoZXIgaXMgYSBzaW5nbGV0b24gY2xhc3MgcGVyIEh5cGVydHkvVVJMIGFuZCBpdCBpcyB0aGUgb3duZXIgb2YgYWxsIGNyZWF0ZWQgRGF0YSBTeW5jIE9iamVjdHMgYWNjb3JkaW5nIHRvIHRoZSBSZXBvcnRlciAtIE9ic2VydmVyIHBhdHRlcm4uDQogKiBNYWluIGZ1bmN0aW9uYWxpdHkgaXMgdG8gY3JlYXRlIHJlcG9ydGVycyBhbmQgdG8gc3Vic2NyaWJlIHRvIGV4aXN0aW5nIG9uZXMuDQogKi8KCnZhciBTeW5jaGVyID0gKGZ1bmN0aW9uICgpIHsKICAvKiBwcml2YXRlDQogIF9vd25lcjogVVJMDQogIF9idXM6IE1pbmlCdXMNCiAgICBfc3ViVVJMOiBVUkwNCiAgICBfcmVwb3J0ZXJzOiA8dXJsOiBEYXRhT2JqZWN0UmVwb3J0ZXI+DQogIF9vYnNlcnZlcnM6IDx1cmw6IERhdGFPYmplY3RPYnNlcnZlcj4NCiAgX3Byb3Zpc2lvbmFsczogPHVybDogRGF0YVByb3Zpc2lvbmFsPg0KICAgIC0tLS1ldmVudCBoYW5kbGVycy0tLS0NCiAgX29uTm90aWZpY2F0aW9uSGFuZGxlcjogKGV2ZW50KSA9PiB2b2lkDQogICovCgogIC8qKg0KICAgKiBDb25zdHJ1Y3RvciB0aGF0IHNob3VsZCBiZSB1c2VkIGJ5IHRoZSBIeXBlcnR5IG93bmVyDQogICAqIEBwYXJhbSB7SHlwZXJ0eVVSTH0gb3duZXIgLSBIeXBlcnR5IFVSTCBvd25lci4gQW4gVVJMIGFsbG9jYXRlZCBieSB0aGUgcnVudGltZSB0aGF0IHVuaXF1ZWx5IGlkZW50aWZpZXMgdGhlIEh5cGVydHkuDQogICAqIEBwYXJhbSB7TWluaUJ1c30gYnVzIC0gQW4gaW5zdGFuY2Ugb2YgdGhlIE1pbmlCdXMgcHJvdmlkZWQgaW4gdGhlIHNhbmRib3guIFdoZW4gYW4gb2JqZWN0IChSZXBvcnRlciBvciBPYnNlcnZlZCkgaXMgY3JlYXRlZCwgdGhlIFN5bmNoZXJNYW5hZ2VyIHdpbGwgYWRkIGEgbGlzdGVuZXIgaW4gdGhlIE1pbmlCdXMgdG8gcmVjZWl2ZS9zZW5kIE1lc3NhZ2VzIG9mIHRoYXQgb2JqZWN0Lg0KICAgKiBAcGFyYW0ge0pTT059IGNvbmZpZyAtIENvbmZpZ3VyYXRpb24gZGF0YS4gVGhlIG9ubHkgcmVxdWlyZWQgZmllbGQgZm9yIG5vdyBpcyB0aGUgcnVudGltZVVSTC4NCiAgICovCgogIGZ1bmN0aW9uIFN5bmNoZXIob3duZXIsIGJ1cywgY29uZmlnKSB7CiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgU3luY2hlcik7CgogICAgdmFyIF90aGlzID0gdGhpczsKCiAgICBfdGhpcy5fb3duZXIgPSBvd25lcjsKICAgIF90aGlzLl9idXMgPSBidXM7CgogICAgX3RoaXMuX3N1YlVSTCA9IGNvbmZpZy5ydW50aW1lVVJMICsgJy9zbSc7CgogICAgX3RoaXMuX3JlcG9ydGVycyA9IHt9OwogICAgX3RoaXMuX29ic2VydmVycyA9IHt9OwogICAgX3RoaXMuX3Byb3Zpc2lvbmFscyA9IHt9OwoKICAgIGJ1cy5hZGRMaXN0ZW5lcihvd25lciwgZnVuY3Rpb24gKG1zZykgewogICAgICBjb25zb2xlLmxvZygnU3luY2hlci1SQ1Y6ICcsIG1zZyk7CiAgICAgIHN3aXRjaCAobXNnLnR5cGUpIHsKICAgICAgICBjYXNlICdmb3J3YXJkJzoKICAgICAgICAgIF90aGlzLl9vbkZvcndhcmQobXNnKTticmVhazsKICAgICAgICBjYXNlICdjcmVhdGUnOgogICAgICAgICAgX3RoaXMuX29uUmVtb3RlQ3JlYXRlKG1zZyk7YnJlYWs7CiAgICAgIH0KICAgIH0pOwogIH0KCiAgLyoqDQogICAqIFRoZSBvd25lciBvZiB0aGUgU3luY2hlciBhbmQgYWxsIGNyZWF0ZWQgcmVwb3J0ZXJzLg0KICAgKiBAdHlwZSB7SHlwZXJ0eVVSTH0NCiAgICovCgogIF9jcmVhdGVDbGFzcyhTeW5jaGVyLCBbewogICAga2V5OiAnY3JlYXRlJywKCiAgICAvKioNCiAgICAgKiBSZXF1ZXN0IGEgRGF0YU9iamVjdFJlcG9ydGVyIGNyZWF0aW9uLiBUaGUgVVJMIHdpbGwgYmUgYmUgcmVxdWVzdGVkIGJ5IHRoZSBhbGxvY2F0aW9uIG1lY2hhbmlzbS4NCiAgICAgKiBAcGFyYW0gIHtTY2hlbWFVUkx9IHNjaGVtYSAtIFVSTCBvZiB0aGUgb2JqZWN0IGRlc2NyaXB0b3INCiAgICAgKiBAcGFyYW0gIHtIeXBlcnR5VVJMW119IG9ic2VydmVycyAtIExpc3Qgb2YgaHlwZXJ0aWVzIHRoYXQgYXJlIHByZS1hdXRob3JpemVkIGZvciBzdWJzY3JpcHRpb24NCiAgICAgKiBAcGFyYW0gIHtKU09OfSBpbml0aWFsRGF0YSAtIEluaXRpYWwgZGF0YSBvZiB0aGUgcmVwb3J0ZXINCiAgICAgKiBAcmV0dXJuIHtQcm9taXNlPERhdGFPYmplY3RSZXBvcnRlcj59IFJldHVybiBQcm9taXNlIHRvIGEgbmV3IFJlcG9ydGVyLiBUaGUgcmVwb3J0ZXIgY2FuIGJlIGFjY2VwdGVkIG9yIHJlamVjdGVkIGJ5IHRoZSBQRVANCiAgICAgKi8KICAgIHZhbHVlOiBmdW5jdGlvbiBjcmVhdGUoc2NoZW1hLCBvYnNlcnZlcnMsIGluaXRpYWxEYXRhKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICB2YXIgcmVxdWVzdE1zZyA9IHsKICAgICAgICB0eXBlOiAnY3JlYXRlJywgZnJvbTogX3RoaXMuX293bmVyLCB0bzogX3RoaXMuX3N1YlVSTCwKICAgICAgICBib2R5OiB7IHNjaGVtYTogc2NoZW1hLCB2YWx1ZTogaW5pdGlhbERhdGEsIGF1dGhvcmlzZTogb2JzZXJ2ZXJzIH0KICAgICAgfTsKCiAgICAgIHJldHVybiBuZXcgX1Byb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgIC8vcmVxdWVzdCBjcmVhdGUgdG8gdGhlIEFsbG9jYXRpb24gc3lzdGVtPyBDYW4gYmUgcmVqZWN0ZWQgYnkgdGhlIFBvbGljeUVuZ2luZS4KICAgICAgICBfdGhpcy5fYnVzLnBvc3RNZXNzYWdlKHJlcXVlc3RNc2csIGZ1bmN0aW9uIChyZXBseSkgewogICAgICAgICAgY29uc29sZS5sb2coJ2NyZWF0ZS1yZXNwb25zZTogJywgcmVwbHkpOwogICAgICAgICAgaWYgKHJlcGx5LmJvZHkuY29kZSA9PT0gMjAwKSB7CiAgICAgICAgICAgIHZhciBvYmpVUkwgPSByZXBseS5ib2R5LnJlc291cmNlOwoKICAgICAgICAgICAgLy9yZXBvcnRlciBjcmVhdGlvbiBhY2NlcHRlZAogICAgICAgICAgICB2YXIgbmV3T2JqID0gbmV3IF9EYXRhT2JqZWN0UmVwb3J0ZXIyWydkZWZhdWx0J10oX3RoaXMuX293bmVyLCBvYmpVUkwsIHNjaGVtYSwgX3RoaXMuX2J1cywgJ29uJywgaW5pdGlhbERhdGEsIHJlcGx5LmJvZHkuY2hpbGRyZW5SZXNvdXJjZXMpOwogICAgICAgICAgICBfdGhpcy5fcmVwb3J0ZXJzW29ialVSTF0gPSBuZXdPYmo7CgogICAgICAgICAgICByZXNvbHZlKG5ld09iaik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvL3JlcG9ydGVyIGNyZWF0aW9uIHJlamVjdGVkCiAgICAgICAgICAgIHJlamVjdChyZXBseS5ib2R5LmRlc2MpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0KCiAgICAvKioNCiAgICAgKiBSZXF1ZXN0IGEgc3Vic2NyaXB0aW9uIHRvIGFuIGV4aXN0ZW50IG9iamVjdC4NCiAgICAgKiBAcGFyYW0ge1NjaGVtYVVSTH0gc2NoZW1hIC0gVVJMIG9mIHRoZSBvYmplY3QgZGVzY3JpcHRvcg0KICAgICAqIEBwYXJhbSB7T2JqZWN0VVJMfSBvYmpVUkwgLSBBZGRyZXNzIG9mIHRoZSBleGlzdGVudCByZXBvcnRlciBvYmplY3QNCiAgICAgKiBAcmV0dXJuIHtQcm9taXNlPERhdGFPYmplY3RPYnNlcnZlcj59IFJldHVybiBQcm9taXNlIHRvIGEgbmV3IG9ic2VydmVyLg0KICAgICAqLwogIH0sIHsKICAgIGtleTogJ3N1YnNjcmliZScsCiAgICB2YWx1ZTogZnVuY3Rpb24gc3Vic2NyaWJlKHNjaGVtYSwgb2JqVVJMKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICAvL1RPRE86IHZhbGlkYXRlIGlmIHN1YnNjcmlwdGlvbiBhbHJlYWR5IGV4aXN0cyA/CiAgICAgIHZhciBzdWJzY3JpYmVNc2cgPSB7CiAgICAgICAgdHlwZTogJ3N1YnNjcmliZScsIGZyb206IF90aGlzLl9vd25lciwgdG86IF90aGlzLl9zdWJVUkwsCiAgICAgICAgYm9keTogeyBzY2hlbWE6IHNjaGVtYSwgcmVzb3VyY2U6IG9ialVSTCB9CiAgICAgIH07CgogICAgICByZXR1cm4gbmV3IF9Qcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgICAgICAvL3JlcXVlc3Qgc3Vic2NyaXB0aW9uCiAgICAgICAgX3RoaXMuX2J1cy5wb3N0TWVzc2FnZShzdWJzY3JpYmVNc2csIGZ1bmN0aW9uIChyZXBseSkgewogICAgICAgICAgY29uc29sZS5sb2coJ3N1YnNjcmliZS1yZXNwb25zZTogJywgcmVwbHkpOwogICAgICAgICAgdmFyIG5ld1Byb3Zpc2lvbmFsID0gX3RoaXMuX3Byb3Zpc2lvbmFsc1tvYmpVUkxdOwogICAgICAgICAgZGVsZXRlIF90aGlzLl9wcm92aXNpb25hbHNbb2JqVVJMXTsKICAgICAgICAgIGlmIChuZXdQcm92aXNpb25hbCkgbmV3UHJvdmlzaW9uYWwucmVsZWFzZSgpOwoKICAgICAgICAgIGlmIChyZXBseS5ib2R5LmNvZGUgPCAyMDApIHsKICAgICAgICAgICAgbmV3UHJvdmlzaW9uYWwgPSBuZXcgX0RhdGFQcm92aXNpb25hbDJbJ2RlZmF1bHQnXShfdGhpcy5fb3duZXIsIG9ialVSTCwgX3RoaXMuX2J1cywgcmVwbHkuYm9keS5jaGlsZHJlblJlc291cmNlcyk7CiAgICAgICAgICAgIF90aGlzLl9wcm92aXNpb25hbHNbb2JqVVJMXSA9IG5ld1Byb3Zpc2lvbmFsOwogICAgICAgICAgfSBlbHNlIGlmIChyZXBseS5ib2R5LmNvZGUgPT09IDIwMCkgewogICAgICAgICAgICB2YXIgbmV3T2JqID0gbmV3IF9EYXRhT2JqZWN0T2JzZXJ2ZXIyWydkZWZhdWx0J10oX3RoaXMuX293bmVyLCBvYmpVUkwsIHNjaGVtYSwgX3RoaXMuX2J1cywgJ29uJywgcmVwbHkuYm9keS52YWx1ZSwgbmV3UHJvdmlzaW9uYWwuY2hpbGRyZW4sIHJlcGx5LmJvZHkudmVyc2lvbik7CgogICAgICAgICAgICByZXNvbHZlKG5ld09iaik7CiAgICAgICAgICAgIG5ld1Byb3Zpc2lvbmFsLmFwcGx5KG5ld09iaik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZWplY3QocmVwbHkuYm9keS5kZXNjKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CgogICAgLyoqDQogICAgICogU2V0dXAgdGhlIGNhbGxiYWNrIHRvIHByb2Nlc3MgY3JlYXRlIGFuZCBkZWxldGUgZXZlbnRzIG9mIHJlbW92ZSBSZXBvcnRlciBvYmplY3RzLg0KICAgICAqIFRoaXMgaXMgcmVsZWF0ZWQgdG8gdGhlIG1lc3NhZ2VucyBzZW50IGJ5IGNyZWF0ZSB0byB0aGUgb2JzZXJ2ZXJzIEh5cGVydHkgYXJyYXkuDQogICAgICogQHBhcmFtIHtmdW5jdGlvbihldmVudDogTXNnRXZlbnQpfSBjYWxsYmFjaw0KICAgICAqLwogIH0sIHsKICAgIGtleTogJ29uTm90aWZpY2F0aW9uJywKICAgIHZhbHVlOiBmdW5jdGlvbiBvbk5vdGlmaWNhdGlvbihjYWxsYmFjaykgewogICAgICB0aGlzLl9vbk5vdGlmaWNhdGlvbkhhbmRsZXIgPSBjYWxsYmFjazsKICAgIH0KICB9LCB7CiAgICBrZXk6ICdfb25Gb3J3YXJkJywKICAgIHZhbHVlOiBmdW5jdGlvbiBfb25Gb3J3YXJkKG1zZykgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgdmFyIHJlcG9ydGVyID0gX3RoaXMuX3JlcG9ydGVyc1ttc2cuYm9keS50b107CiAgICAgIHJlcG9ydGVyLl9vbkZvcndhcmQobXNnKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICdfb25SZW1vdGVDcmVhdGUnLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9vblJlbW90ZUNyZWF0ZShtc2cpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIC8vcmVtb3ZlICIvc3Vic2NyaXB0aW9uIiBmcm9tIHRoZSBVUkwKICAgICAgdmFyIHJlc291cmNlID0gbXNnLmZyb20uc2xpY2UoMCwgLTEzKTsKCiAgICAgIHZhciBldmVudCA9IHsKICAgICAgICB0eXBlOiBtc2cudHlwZSwKICAgICAgICBmcm9tOiBtc2cuYm9keS5zb3VyY2UsCiAgICAgICAgdXJsOiByZXNvdXJjZSwKICAgICAgICBzY2hlbWE6IG1zZy5ib2R5LnNjaGVtYSwKICAgICAgICB2YWx1ZTogbXNnLmJvZHkudmFsdWUsCiAgICAgICAgaWRlbnRpdHk6IG1zZy5ib2R5LmlkVG9rZW4sCgogICAgICAgIGFjazogZnVuY3Rpb24gYWNrKHR5cGUpIHsKICAgICAgICAgIHZhciBsVHlwZSA9IDIwMDsKICAgICAgICAgIGlmICh0eXBlKSB7CiAgICAgICAgICAgIGxUeXBlID0gdHlwZTsKICAgICAgICAgIH0KCiAgICAgICAgICAvL3NlbmQgYWNrIHJlc3BvbnNlIG1lc3NhZ2UKICAgICAgICAgIF90aGlzLl9idXMucG9zdE1lc3NhZ2UoewogICAgICAgICAgICBpZDogbXNnLmlkLCB0eXBlOiAncmVzcG9uc2UnLCBmcm9tOiBtc2cudG8sIHRvOiBtc2cuZnJvbSwKICAgICAgICAgICAgYm9keTogeyBjb2RlOiBsVHlwZSB9CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH07CgogICAgICBpZiAoX3RoaXMuX29uTm90aWZpY2F0aW9uSGFuZGxlcikgewogICAgICAgIGNvbnNvbGUubG9nKCdOT1RJRklDQVRJT04tRVZFTlQ6ICcsIGV2ZW50KTsKICAgICAgICBfdGhpcy5fb25Ob3RpZmljYXRpb25IYW5kbGVyKGV2ZW50KTsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogJ293bmVyJywKICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICByZXR1cm4gdGhpcy5fb3duZXI7CiAgICB9CgogICAgLyoqDQogICAgICogQWxsIG93bmVkIHJlcG9ydGVycywgdGhlIG9uZXMgdGhhdCB3ZXJlIGNyZWF0ZWQgYnkgYSBjcmVhdGUNCiAgICAgKiBAdHlwZSB7T2JqZWN0PFVSTCwgRGF0YU9iamVjdFJlcG9ydGVyPn0NCiAgICAgKi8KICB9LCB7CiAgICBrZXk6ICdyZXBvcnRlcnMnLAogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgIHJldHVybiB0aGlzLl9yZXBvcnRlcnM7CiAgICB9CgogICAgLyoqDQogICAgICogQWxsIG93bmVkIG9ic2VydmVycywgdGhlIG9uZXMgdGhhdCB3ZXJlIGNyZWF0ZWQgYnkgYSBsb2NhbCBzdWJzY3JpcHRpb24NCiAgICAgKiBAdHlwZSB7T2JqZWN0PFVSTCwgRGF0YU9iamVjdE9ic2VydmVyPn0NCiAgICAgKi8KICB9LCB7CiAgICBrZXk6ICdvYnNlcnZlcnMnLAogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgIHJldHVybiB0aGlzLl9vYnNlcnZlcnM7CiAgICB9CiAgfV0pOwoKICByZXR1cm4gU3luY2hlcjsKfSkoKTsKCmV4cG9ydHNbJ2RlZmF1bHQnXSA9IFN5bmNoZXI7Cm1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1snZGVmYXVsdCddOwoKfSx7Ii4vRGF0YU9iamVjdE9ic2VydmVyIjo5NywiLi9EYXRhT2JqZWN0UmVwb3J0ZXIiOjk4LCIuL0RhdGFQcm92aXNpb25hbCI6OTksImJhYmVsLXJ1bnRpbWUvY29yZS1qcy9wcm9taXNlIjo3LCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY2xhc3MtY2FsbC1jaGVjayI6OSwiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NyZWF0ZS1jbGFzcyI6MTEsImJhYmVsLXJ1bnRpbWUvaGVscGVycy9pbnRlcm9wLXJlcXVpcmUtZGVmYXVsdCI6MTV9XSwxMDI6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewovKioNCiAqIEV2ZW50RW1pdHRlcg0KICogQWxsIGNsYXNzZXMgd2hpY2ggZXh0ZW5kcyB0aGlzLCBjYW4gaGF2ZSBhZGRFdmVudExpc3RlbmVyIGFuZCB0cmlnZ2VyIGV2ZW50czsNCiAqLwoidXNlIHN0cmljdCI7Cgp2YXIgX2NyZWF0ZUNsYXNzID0gcmVxdWlyZSgiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NyZWF0ZS1jbGFzcyIpWyJkZWZhdWx0Il07Cgp2YXIgX2NsYXNzQ2FsbENoZWNrID0gcmVxdWlyZSgiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NsYXNzLWNhbGwtY2hlY2siKVsiZGVmYXVsdCJdOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwoKdmFyIEV2ZW50RW1pdHRlciA9IChmdW5jdGlvbiAoKSB7CiAgZnVuY3Rpb24gRXZlbnRFbWl0dGVyKCkgewogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEV2ZW50RW1pdHRlcik7CiAgfQoKICBfY3JlYXRlQ2xhc3MoRXZlbnRFbWl0dGVyLCBbewogICAga2V5OiAiYWRkRXZlbnRMaXN0ZW5lciIsCgogICAgLyoqDQogICAgICogYWRkRXZlbnRMaXN0ZW5lciBsaXN0ZW4gZm9yIGFuIGV2ZW50VHlwZQ0KICAgICAqIEBwYXJhbSAge3N0cmluZ30gICAgICAgICBldmVudFR5cGUgLSBsaXN0ZW5pbmcgZm9yIHRoaXMgdHlwZSBvZiBldmVudA0KICAgICAqIEBwYXJhbSAge0Z1bmN0aW9ufSAgICAgICBjYiAgICAgICAgLSBjYWxsYmFjayBmdW5jdGlvbiB3aWxsIGJlIGV4ZWN1dGVkIHdoZW4gdGhlIGV2ZW50IGl0IGlzIGludm9rZWQNCiAgICAgKi8KICAgIHZhbHVlOiBmdW5jdGlvbiBhZGRFdmVudExpc3RlbmVyKGV2ZW50VHlwZSwgY2IpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgX3RoaXNbZXZlbnRUeXBlXSA9IGNiOwogICAgfQoKICAgIC8qKg0KICAgICAqIEludm9rZSB0aGUgZXZlbnRUeXBlDQogICAgICogQHBhcmFtICB7c3RyaW5nfSBldmVudFR5cGUgLSBldmVudCB3aWxsIGJlIGludm9rZWQNCiAgICAgKiBAcGFyYW0gIHtvYmplY3R9IHBhcmFtcyAtIHBhcmFtZXRlcnMgd2lsbCBiZSBwYXNzZWQgdG8gdGhlIGFkZEV2ZW50TGlzdGVuZXINCiAgICAgKi8KICB9LCB7CiAgICBrZXk6ICJ0cmlnZ2VyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiB0cmlnZ2VyKGV2ZW50VHlwZSwgcGFyYW1zKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICBpZiAoX3RoaXNbZXZlbnRUeXBlXSkgewogICAgICAgIF90aGlzW2V2ZW50VHlwZV0ocGFyYW1zKTsKICAgICAgfQogICAgfQogIH1dKTsKCiAgcmV0dXJuIEV2ZW50RW1pdHRlcjsKfSkoKTsKCmV4cG9ydHNbImRlZmF1bHQiXSA9IEV2ZW50RW1pdHRlcjsKbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWyJkZWZhdWx0Il07Cgp9LHsiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NsYXNzLWNhbGwtY2hlY2siOjksImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jcmVhdGUtY2xhc3MiOjExfV0sMTAzOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKLyoqDQogKiBTdXBwb3J0IG1vZHVsZSB3aXRoIHNvbWUgZnVuY3Rpb25zIHdpbGwgYmUgdXNlZnVsDQogKiBAbW9kdWxlIHV0aWxzDQogKi8KCi8qKg0KICogQHR5cGVkZWYgZGl2aWRlVVJMDQogKiBAdHlwZSBPYmplY3QNCiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSB0eXBlIFRoZSB0eXBlIG9mIFVSTA0KICogQHByb3BlcnR5IHtzdHJpbmd9IGRvbWFpbiBUaGUgZG9tYWluIG9mIFVSTA0KICogQHByb3BlcnR5IHtzdHJpbmd9IGlkZW50aXR5IFRoZSBpZGVudGl0eSBvZiBVUkwNCiAqLwoKLyoqDQogKiBEaXZpZGUgYW4gdXJsIGluIHR5cGUsIGRvbWFpbiBhbmQgaWRlbnRpdHkNCiAqIEBwYXJhbSAge1VSTC5VUkx9IHVybCAtIHVybCBhZGRyZXNzDQogKiBAcmV0dXJuIHtkaXZpZGVVUkx9IHRoZSByZXN1bHQgb2YgZGl2aWRlVVJMDQogKi8KJ3VzZSBzdHJpY3QnOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLmRpdmlkZVVSTCA9IGRpdmlkZVVSTDsKZXhwb3J0cy5kZWVwQ2xvbmUgPSBkZWVwQ2xvbmU7CgpmdW5jdGlvbiBkaXZpZGVVUkwodXJsKSB7CgogIC8vIGxldCByZSA9IC8oW2EtekEtWi1dKik/OlwvXC8oPzpcLik/KFstYS16QS1aMC05QDolLl9cK34jPV17MiwyNTZ9XC5bYS16XXsyLDZ9XGIpKihcL1tcL1xkXHdcLi1dKikqKD86W1w/XSkqKC4rKSovZ2k7CiAgdmFyIHJlID0gLyhbYS16QS1aLV0qKTpcL1wvKD86XC4pPyhbLWEtekEtWjAtOUA6JS5fXCt+Iz1dezIsMjU2fSkoWy1hLXpBLVowLTlAOiUuX1wrfiM9XC9dKikvZ2k7CiAgdmFyIHN1YnN0ID0gJyQxLCQyLCQzJzsKICB2YXIgcGFydHMgPSB1cmwucmVwbGFjZShyZSwgc3Vic3QpLnNwbGl0KCcsJyk7CiAgdmFyIHJlc3VsdCA9IHsKICAgIHR5cGU6IHBhcnRzWzBdLAogICAgZG9tYWluOiBwYXJ0c1sxXSwKICAgIGlkZW50aXR5OiBwYXJ0c1syXQogIH07CgogIHJldHVybiByZXN1bHQ7Cn0KCi8qKg0KICogTWFrZSBhIENPUFkgb2YgdGhlIG9yaWdpbmFsIGRhdGENCiAqIEBwYXJhbSAge09iamVjdH0gIG9iaiAtIG9iamVjdCB0byBiZSBjbG9uZWQNCiAqIEByZXR1cm4ge09iamVjdH0NCiAqLwoKZnVuY3Rpb24gZGVlcENsb25lKG9iaikgewogIC8vVE9ETzogc2ltcGxlIGJ1dCBpbmVmZmljaWVudCBKU09OIGRlZXAgY2xvbmUuLi4KICBpZiAob2JqKSByZXR1cm4gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShvYmopKTsKfQoKfSx7fV19LHt9LFs5MV0pKDkxKQp9KTs=",
      "sourceCodeClassname": "HypertyChat",
      "encoding": "base64",
      "signature": ""
    },
    "cguid": 1,
    "type": "Hyperties",
    "version": "0.1",
    "description": "Description of HypertyChat",
    "objectName": "HypertyChat",
    "sourcePackageURL": "/sourcePackage",
    "language": "javascript",
    "signature": "",
    "messageSchemas": "",
    "dataObjects": [],
    "accessControlPolicy": "somePolicy"
  },
  "HypertyConnector": {
    "sourcePackage": {
      "sourceCode": "KGZ1bmN0aW9uKGYpe2lmKHR5cGVvZiBleHBvcnRzPT09Im9iamVjdCImJnR5cGVvZiBtb2R1bGUhPT0idW5kZWZpbmVkIil7bW9kdWxlLmV4cG9ydHM9ZigpfWVsc2UgaWYodHlwZW9mIGRlZmluZT09PSJmdW5jdGlvbiImJmRlZmluZS5hbWQpe2RlZmluZShbXSxmKX1lbHNle3ZhciBnO2lmKHR5cGVvZiB3aW5kb3chPT0idW5kZWZpbmVkIil7Zz13aW5kb3d9ZWxzZSBpZih0eXBlb2YgZ2xvYmFsIT09InVuZGVmaW5lZCIpe2c9Z2xvYmFsfWVsc2UgaWYodHlwZW9mIHNlbGYhPT0idW5kZWZpbmVkIil7Zz1zZWxmfWVsc2V7Zz10aGlzfWcuYWN0aXZhdGUgPSBmKCl9fSkoZnVuY3Rpb24oKXt2YXIgZGVmaW5lLG1vZHVsZSxleHBvcnRzO3JldHVybiAoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PSJmdW5jdGlvbiImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoIkNhbm5vdCBmaW5kIG1vZHVsZSAnIitvKyInIik7dGhyb3cgZi5jb2RlPSJNT0RVTEVfTk9UX0ZPVU5EIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PSJmdW5jdGlvbiImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pKHsxOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKbW9kdWxlLmV4cG9ydHMgPSB7ICJkZWZhdWx0IjogcmVxdWlyZSgiY29yZS1qcy9saWJyYXJ5L2ZuL29iamVjdC9jcmVhdGUiKSwgX19lc01vZHVsZTogdHJ1ZSB9Owp9LHsiY29yZS1qcy9saWJyYXJ5L2ZuL29iamVjdC9jcmVhdGUiOjE4fV0sMjpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Cm1vZHVsZS5leHBvcnRzID0geyAiZGVmYXVsdCI6IHJlcXVpcmUoImNvcmUtanMvbGlicmFyeS9mbi9vYmplY3QvZGVmaW5lLXByb3BlcnR5IiksIF9fZXNNb2R1bGU6IHRydWUgfTsKfSx7ImNvcmUtanMvbGlicmFyeS9mbi9vYmplY3QvZGVmaW5lLXByb3BlcnR5IjoxOX1dLDM6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewptb2R1bGUuZXhwb3J0cyA9IHsgImRlZmF1bHQiOiByZXF1aXJlKCJjb3JlLWpzL2xpYnJhcnkvZm4vb2JqZWN0L2dldC1vd24tcHJvcGVydHktZGVzY3JpcHRvciIpLCBfX2VzTW9kdWxlOiB0cnVlIH07Cn0seyJjb3JlLWpzL2xpYnJhcnkvZm4vb2JqZWN0L2dldC1vd24tcHJvcGVydHktZGVzY3JpcHRvciI6MjB9XSw0OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKbW9kdWxlLmV4cG9ydHMgPSB7ICJkZWZhdWx0IjogcmVxdWlyZSgiY29yZS1qcy9saWJyYXJ5L2ZuL29iamVjdC9nZXQtcHJvdG90eXBlLW9mIiksIF9fZXNNb2R1bGU6IHRydWUgfTsKfSx7ImNvcmUtanMvbGlicmFyeS9mbi9vYmplY3QvZ2V0LXByb3RvdHlwZS1vZiI6MjF9XSw1OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKbW9kdWxlLmV4cG9ydHMgPSB7ICJkZWZhdWx0IjogcmVxdWlyZSgiY29yZS1qcy9saWJyYXJ5L2ZuL29iamVjdC9rZXlzIiksIF9fZXNNb2R1bGU6IHRydWUgfTsKfSx7ImNvcmUtanMvbGlicmFyeS9mbi9vYmplY3Qva2V5cyI6MjJ9XSw2OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKbW9kdWxlLmV4cG9ydHMgPSB7ICJkZWZhdWx0IjogcmVxdWlyZSgiY29yZS1qcy9saWJyYXJ5L2ZuL29iamVjdC9zZXQtcHJvdG90eXBlLW9mIiksIF9fZXNNb2R1bGU6IHRydWUgfTsKfSx7ImNvcmUtanMvbGlicmFyeS9mbi9vYmplY3Qvc2V0LXByb3RvdHlwZS1vZiI6MjN9XSw3OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKbW9kdWxlLmV4cG9ydHMgPSB7ICJkZWZhdWx0IjogcmVxdWlyZSgiY29yZS1qcy9saWJyYXJ5L2ZuL3Byb21pc2UiKSwgX19lc01vZHVsZTogdHJ1ZSB9Owp9LHsiY29yZS1qcy9saWJyYXJ5L2ZuL3Byb21pc2UiOjI0fV0sODpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Cm1vZHVsZS5leHBvcnRzID0geyAiZGVmYXVsdCI6IHJlcXVpcmUoImNvcmUtanMvbGlicmFyeS9mbi9zeW1ib2wiKSwgX19lc01vZHVsZTogdHJ1ZSB9Owp9LHsiY29yZS1qcy9saWJyYXJ5L2ZuL3N5bWJvbCI6MjV9XSw5OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKbW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKCIuL2NsYXNzQ2FsbENoZWNrLmpzIik7Cn0seyIuL2NsYXNzQ2FsbENoZWNrLmpzIjoxMH1dLDEwOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKInVzZSBzdHJpY3QiOwoKZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTsKCmV4cG9ydHMuZGVmYXVsdCA9IGZ1bmN0aW9uIChpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsKICBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgewogICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7CiAgfQp9Owp9LHt9XSwxMTpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Cm1vZHVsZS5leHBvcnRzID0gcmVxdWlyZSgiLi9jcmVhdGVDbGFzcy5qcyIpOwp9LHsiLi9jcmVhdGVDbGFzcy5qcyI6MTJ9XSwxMjpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7CiJ1c2Ugc3RyaWN0IjsKCmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7Cgp2YXIgX2RlZmluZVByb3BlcnR5ID0gcmVxdWlyZSgiLi4vY29yZS1qcy9vYmplY3QvZGVmaW5lLXByb3BlcnR5Iik7Cgp2YXIgX2RlZmluZVByb3BlcnR5MiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2RlZmluZVByb3BlcnR5KTsKCmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IGRlZmF1bHQ6IG9iaiB9OyB9CgpleHBvcnRzLmRlZmF1bHQgPSAoZnVuY3Rpb24gKCkgewogIGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgewogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgewogICAgICB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOwogICAgICBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7CiAgICAgIGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsKICAgICAgaWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7CiAgICAgICgwLCBfZGVmaW5lUHJvcGVydHkyLmRlZmF1bHQpKHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOwogICAgfQogIH0KCiAgcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsKICAgIGlmIChwcm90b1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7CiAgICBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsKICAgIHJldHVybiBDb25zdHJ1Y3RvcjsKICB9Owp9KSgpOwp9LHsiLi4vY29yZS1qcy9vYmplY3QvZGVmaW5lLXByb3BlcnR5IjoyfV0sMTM6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewoidXNlIHN0cmljdCI7CgpleHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlOwoKdmFyIF9nZXRQcm90b3R5cGVPZiA9IHJlcXVpcmUoIi4uL2NvcmUtanMvb2JqZWN0L2dldC1wcm90b3R5cGUtb2YiKTsKCnZhciBfZ2V0UHJvdG90eXBlT2YyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfZ2V0UHJvdG90eXBlT2YpOwoKdmFyIF9nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IgPSByZXF1aXJlKCIuLi9jb3JlLWpzL29iamVjdC9nZXQtb3duLXByb3BlcnR5LWRlc2NyaXB0b3IiKTsKCnZhciBfZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2dldE93blByb3BlcnR5RGVzY3JpcHRvcik7CgpmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyBkZWZhdWx0OiBvYmogfTsgfQoKZXhwb3J0cy5kZWZhdWx0ID0gZnVuY3Rpb24gZ2V0KG9iamVjdCwgcHJvcGVydHksIHJlY2VpdmVyKSB7CiAgaWYgKG9iamVjdCA9PT0gbnVsbCkgb2JqZWN0ID0gRnVuY3Rpb24ucHJvdG90eXBlOwogIHZhciBkZXNjID0gKDAsIF9nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IyLmRlZmF1bHQpKG9iamVjdCwgcHJvcGVydHkpOwoKICBpZiAoZGVzYyA9PT0gdW5kZWZpbmVkKSB7CiAgICB2YXIgcGFyZW50ID0gKDAsIF9nZXRQcm90b3R5cGVPZjIuZGVmYXVsdCkob2JqZWN0KTsKCiAgICBpZiAocGFyZW50ID09PSBudWxsKSB7CiAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gZ2V0KHBhcmVudCwgcHJvcGVydHksIHJlY2VpdmVyKTsKICAgIH0KICB9IGVsc2UgaWYgKCJ2YWx1ZSIgaW4gZGVzYykgewogICAgcmV0dXJuIGRlc2MudmFsdWU7CiAgfSBlbHNlIHsKICAgIHZhciBnZXR0ZXIgPSBkZXNjLmdldDsKCiAgICBpZiAoZ2V0dGVyID09PSB1bmRlZmluZWQpIHsKICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgIH0KCiAgICByZXR1cm4gZ2V0dGVyLmNhbGwocmVjZWl2ZXIpOwogIH0KfTsKfSx7Ii4uL2NvcmUtanMvb2JqZWN0L2dldC1vd24tcHJvcGVydHktZGVzY3JpcHRvciI6MywiLi4vY29yZS1qcy9vYmplY3QvZ2V0LXByb3RvdHlwZS1vZiI6NH1dLDE0OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKInVzZSBzdHJpY3QiOwoKZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTsKCnZhciBfc2V0UHJvdG90eXBlT2YgPSByZXF1aXJlKCIuLi9jb3JlLWpzL29iamVjdC9zZXQtcHJvdG90eXBlLW9mIik7Cgp2YXIgX3NldFByb3RvdHlwZU9mMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3NldFByb3RvdHlwZU9mKTsKCnZhciBfY3JlYXRlID0gcmVxdWlyZSgiLi4vY29yZS1qcy9vYmplY3QvY3JlYXRlIik7Cgp2YXIgX2NyZWF0ZTIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9jcmVhdGUpOwoKdmFyIF90eXBlb2YyID0gcmVxdWlyZSgiLi4vaGVscGVycy90eXBlb2YiKTsKCnZhciBfdHlwZW9mMyA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3R5cGVvZjIpOwoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgZGVmYXVsdDogb2JqIH07IH0KCmV4cG9ydHMuZGVmYXVsdCA9IGZ1bmN0aW9uIChzdWJDbGFzcywgc3VwZXJDbGFzcykgewogIGlmICh0eXBlb2Ygc3VwZXJDbGFzcyAhPT0gImZ1bmN0aW9uIiAmJiBzdXBlckNsYXNzICE9PSBudWxsKSB7CiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiwgbm90ICIgKyAodHlwZW9mIHN1cGVyQ2xhc3MgPT09ICJ1bmRlZmluZWQiID8gInVuZGVmaW5lZCIgOiAoMCwgX3R5cGVvZjMuZGVmYXVsdCkoc3VwZXJDbGFzcykpKTsKICB9CgogIHN1YkNsYXNzLnByb3RvdHlwZSA9ICgwLCBfY3JlYXRlMi5kZWZhdWx0KShzdXBlckNsYXNzICYmIHN1cGVyQ2xhc3MucHJvdG90eXBlLCB7CiAgICBjb25zdHJ1Y3RvcjogewogICAgICB2YWx1ZTogc3ViQ2xhc3MsCiAgICAgIGVudW1lcmFibGU6IGZhbHNlLAogICAgICB3cml0YWJsZTogdHJ1ZSwKICAgICAgY29uZmlndXJhYmxlOiB0cnVlCiAgICB9CiAgfSk7CiAgaWYgKHN1cGVyQ2xhc3MpIF9zZXRQcm90b3R5cGVPZjIuZGVmYXVsdCA/ICgwLCBfc2V0UHJvdG90eXBlT2YyLmRlZmF1bHQpKHN1YkNsYXNzLCBzdXBlckNsYXNzKSA6IHN1YkNsYXNzLl9fcHJvdG9fXyA9IHN1cGVyQ2xhc3M7Cn07Cn0seyIuLi9jb3JlLWpzL29iamVjdC9jcmVhdGUiOjEsIi4uL2NvcmUtanMvb2JqZWN0L3NldC1wcm90b3R5cGUtb2YiOjYsIi4uL2hlbHBlcnMvdHlwZW9mIjoxN31dLDE1OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKbW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKCIuL2ludGVyb3BSZXF1aXJlRGVmYXVsdC5qcyIpOwp9LHsiLi9pbnRlcm9wUmVxdWlyZURlZmF1bHQuanMiOjE2fV0sMTY6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewoidXNlIHN0cmljdCI7CgpleHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlOwoKZXhwb3J0cy5kZWZhdWx0ID0gZnVuY3Rpb24gKG9iaikgewogIHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7CiAgICBkZWZhdWx0OiBvYmoKICB9Owp9Owp9LHt9XSwxNzpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7CiJ1c2Ugc3RyaWN0IjsKCmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7Cgp2YXIgX3N5bWJvbCA9IHJlcXVpcmUoIi4uL2NvcmUtanMvc3ltYm9sIik7Cgp2YXIgX3N5bWJvbDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9zeW1ib2wpOwoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgZGVmYXVsdDogb2JqIH07IH0KCmZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7IHJldHVybiBvYmogJiYgdHlwZW9mIF9TeW1ib2wgIT09ICJ1bmRlZmluZWQiICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gX1N5bWJvbCA/ICJzeW1ib2wiIDogdHlwZW9mIG9iajsgfQoKZXhwb3J0cy5kZWZhdWx0ID0gZnVuY3Rpb24gKG9iaikgewogIHJldHVybiBvYmogJiYgdHlwZW9mIF9zeW1ib2wyLmRlZmF1bHQgIT09ICJ1bmRlZmluZWQiICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gX3N5bWJvbDIuZGVmYXVsdCA/ICJzeW1ib2wiIDogdHlwZW9mIG9iaiA9PT0gInVuZGVmaW5lZCIgPyAidW5kZWZpbmVkIiA6IF90eXBlb2Yob2JqKTsKfTsKfSx7Ii4uL2NvcmUtanMvc3ltYm9sIjo4fV0sMTg6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewp2YXIgJCA9IHJlcXVpcmUoJy4uLy4uL21vZHVsZXMvJCcpOwptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIGNyZWF0ZShQLCBEKXsKICByZXR1cm4gJC5jcmVhdGUoUCwgRCk7Cn07Cn0seyIuLi8uLi9tb2R1bGVzLyQiOjU2fV0sMTk6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewp2YXIgJCA9IHJlcXVpcmUoJy4uLy4uL21vZHVsZXMvJCcpOwptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIGRlZmluZVByb3BlcnR5KGl0LCBrZXksIGRlc2MpewogIHJldHVybiAkLnNldERlc2MoaXQsIGtleSwgZGVzYyk7Cn07Cn0seyIuLi8uLi9tb2R1bGVzLyQiOjU2fV0sMjA6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewp2YXIgJCA9IHJlcXVpcmUoJy4uLy4uL21vZHVsZXMvJCcpOwpyZXF1aXJlKCcuLi8uLi9tb2R1bGVzL2VzNi5vYmplY3QuZ2V0LW93bi1wcm9wZXJ0eS1kZXNjcmlwdG9yJyk7Cm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKGl0LCBrZXkpewogIHJldHVybiAkLmdldERlc2MoaXQsIGtleSk7Cn07Cn0seyIuLi8uLi9tb2R1bGVzLyQiOjU2LCIuLi8uLi9tb2R1bGVzL2VzNi5vYmplY3QuZ2V0LW93bi1wcm9wZXJ0eS1kZXNjcmlwdG9yIjo4MX1dLDIxOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKcmVxdWlyZSgnLi4vLi4vbW9kdWxlcy9lczYub2JqZWN0LmdldC1wcm90b3R5cGUtb2YnKTsKbW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKCcuLi8uLi9tb2R1bGVzLyQuY29yZScpLk9iamVjdC5nZXRQcm90b3R5cGVPZjsKfSx7Ii4uLy4uL21vZHVsZXMvJC5jb3JlIjozMSwiLi4vLi4vbW9kdWxlcy9lczYub2JqZWN0LmdldC1wcm90b3R5cGUtb2YiOjgyfV0sMjI6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewpyZXF1aXJlKCcuLi8uLi9tb2R1bGVzL2VzNi5vYmplY3Qua2V5cycpOwptb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoJy4uLy4uL21vZHVsZXMvJC5jb3JlJykuT2JqZWN0LmtleXM7Cn0seyIuLi8uLi9tb2R1bGVzLyQuY29yZSI6MzEsIi4uLy4uL21vZHVsZXMvZXM2Lm9iamVjdC5rZXlzIjo4M31dLDIzOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKcmVxdWlyZSgnLi4vLi4vbW9kdWxlcy9lczYub2JqZWN0LnNldC1wcm90b3R5cGUtb2YnKTsKbW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKCcuLi8uLi9tb2R1bGVzLyQuY29yZScpLk9iamVjdC5zZXRQcm90b3R5cGVPZjsKfSx7Ii4uLy4uL21vZHVsZXMvJC5jb3JlIjozMSwiLi4vLi4vbW9kdWxlcy9lczYub2JqZWN0LnNldC1wcm90b3R5cGUtb2YiOjg0fV0sMjQ6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewpyZXF1aXJlKCcuLi9tb2R1bGVzL2VzNi5vYmplY3QudG8tc3RyaW5nJyk7CnJlcXVpcmUoJy4uL21vZHVsZXMvZXM2LnN0cmluZy5pdGVyYXRvcicpOwpyZXF1aXJlKCcuLi9tb2R1bGVzL3dlYi5kb20uaXRlcmFibGUnKTsKcmVxdWlyZSgnLi4vbW9kdWxlcy9lczYucHJvbWlzZScpOwptb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoJy4uL21vZHVsZXMvJC5jb3JlJykuUHJvbWlzZTsKfSx7Ii4uL21vZHVsZXMvJC5jb3JlIjozMSwiLi4vbW9kdWxlcy9lczYub2JqZWN0LnRvLXN0cmluZyI6ODUsIi4uL21vZHVsZXMvZXM2LnByb21pc2UiOjg2LCIuLi9tb2R1bGVzL2VzNi5zdHJpbmcuaXRlcmF0b3IiOjg3LCIuLi9tb2R1bGVzL3dlYi5kb20uaXRlcmFibGUiOjg5fV0sMjU6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewpyZXF1aXJlKCcuLi8uLi9tb2R1bGVzL2VzNi5zeW1ib2wnKTsKcmVxdWlyZSgnLi4vLi4vbW9kdWxlcy9lczYub2JqZWN0LnRvLXN0cmluZycpOwptb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoJy4uLy4uL21vZHVsZXMvJC5jb3JlJykuU3ltYm9sOwp9LHsiLi4vLi4vbW9kdWxlcy8kLmNvcmUiOjMxLCIuLi8uLi9tb2R1bGVzL2VzNi5vYmplY3QudG8tc3RyaW5nIjo4NSwiLi4vLi4vbW9kdWxlcy9lczYuc3ltYm9sIjo4OH1dLDI2OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihpdCl7CiAgaWYodHlwZW9mIGl0ICE9ICdmdW5jdGlvbicpdGhyb3cgVHlwZUVycm9yKGl0ICsgJyBpcyBub3QgYSBmdW5jdGlvbiEnKTsKICByZXR1cm4gaXQ7Cn07Cn0se31dLDI3OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbigpeyAvKiBlbXB0eSAqLyB9Owp9LHt9XSwyODpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7CnZhciBpc09iamVjdCA9IHJlcXVpcmUoJy4vJC5pcy1vYmplY3QnKTsKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihpdCl7CiAgaWYoIWlzT2JqZWN0KGl0KSl0aHJvdyBUeXBlRXJyb3IoaXQgKyAnIGlzIG5vdCBhbiBvYmplY3QhJyk7CiAgcmV0dXJuIGl0Owp9Owp9LHsiLi8kLmlzLW9iamVjdCI6NDl9XSwyOTpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Ci8vIGdldHRpbmcgdGFnIGZyb20gMTkuMS4zLjYgT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZygpCnZhciBjb2YgPSByZXF1aXJlKCcuLyQuY29mJykKICAsIFRBRyA9IHJlcXVpcmUoJy4vJC53a3MnKSgndG9TdHJpbmdUYWcnKQogIC8vIEVTMyB3cm9uZyBoZXJlCiAgLCBBUkcgPSBjb2YoZnVuY3Rpb24oKXsgcmV0dXJuIGFyZ3VtZW50czsgfSgpKSA9PSAnQXJndW1lbnRzJzsKCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oaXQpewogIHZhciBPLCBULCBCOwogIHJldHVybiBpdCA9PT0gdW5kZWZpbmVkID8gJ1VuZGVmaW5lZCcgOiBpdCA9PT0gbnVsbCA/ICdOdWxsJwogICAgLy8gQEB0b1N0cmluZ1RhZyBjYXNlCiAgICA6IHR5cGVvZiAoVCA9IChPID0gT2JqZWN0KGl0KSlbVEFHXSkgPT0gJ3N0cmluZycgPyBUCiAgICAvLyBidWlsdGluVGFnIGNhc2UKICAgIDogQVJHID8gY29mKE8pCiAgICAvLyBFUzMgYXJndW1lbnRzIGZhbGxiYWNrCiAgICA6IChCID0gY29mKE8pKSA9PSAnT2JqZWN0JyAmJiB0eXBlb2YgTy5jYWxsZWUgPT0gJ2Z1bmN0aW9uJyA/ICdBcmd1bWVudHMnIDogQjsKfTsKfSx7Ii4vJC5jb2YiOjMwLCIuLyQud2tzIjo3OH1dLDMwOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKdmFyIHRvU3RyaW5nID0ge30udG9TdHJpbmc7Cgptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGl0KXsKICByZXR1cm4gdG9TdHJpbmcuY2FsbChpdCkuc2xpY2UoOCwgLTEpOwp9Owp9LHt9XSwzMTpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7CnZhciBjb3JlID0gbW9kdWxlLmV4cG9ydHMgPSB7dmVyc2lvbjogJzEuMi42J307CmlmKHR5cGVvZiBfX2UgPT0gJ251bWJlcicpX19lID0gY29yZTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby11bmRlZgp9LHt9XSwzMjpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Ci8vIG9wdGlvbmFsIC8gc2ltcGxlIGNvbnRleHQgYmluZGluZwp2YXIgYUZ1bmN0aW9uID0gcmVxdWlyZSgnLi8kLmEtZnVuY3Rpb24nKTsKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihmbiwgdGhhdCwgbGVuZ3RoKXsKICBhRnVuY3Rpb24oZm4pOwogIGlmKHRoYXQgPT09IHVuZGVmaW5lZClyZXR1cm4gZm47CiAgc3dpdGNoKGxlbmd0aCl7CiAgICBjYXNlIDE6IHJldHVybiBmdW5jdGlvbihhKXsKICAgICAgcmV0dXJuIGZuLmNhbGwodGhhdCwgYSk7CiAgICB9OwogICAgY2FzZSAyOiByZXR1cm4gZnVuY3Rpb24oYSwgYil7CiAgICAgIHJldHVybiBmbi5jYWxsKHRoYXQsIGEsIGIpOwogICAgfTsKICAgIGNhc2UgMzogcmV0dXJuIGZ1bmN0aW9uKGEsIGIsIGMpewogICAgICByZXR1cm4gZm4uY2FsbCh0aGF0LCBhLCBiLCBjKTsKICAgIH07CiAgfQogIHJldHVybiBmdW5jdGlvbigvKiAuLi5hcmdzICovKXsKICAgIHJldHVybiBmbi5hcHBseSh0aGF0LCBhcmd1bWVudHMpOwogIH07Cn07Cn0seyIuLyQuYS1mdW5jdGlvbiI6MjZ9XSwzMzpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Ci8vIDcuMi4xIFJlcXVpcmVPYmplY3RDb2VyY2libGUoYXJndW1lbnQpCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oaXQpewogIGlmKGl0ID09IHVuZGVmaW5lZCl0aHJvdyBUeXBlRXJyb3IoIkNhbid0IGNhbGwgbWV0aG9kIG9uICAiICsgaXQpOwogIHJldHVybiBpdDsKfTsKfSx7fV0sMzQ6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewovLyBUaGFuaydzIElFOCBmb3IgaGlzIGZ1bm55IGRlZmluZVByb3BlcnR5Cm1vZHVsZS5leHBvcnRzID0gIXJlcXVpcmUoJy4vJC5mYWlscycpKGZ1bmN0aW9uKCl7CiAgcmV0dXJuIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh7fSwgJ2EnLCB7Z2V0OiBmdW5jdGlvbigpeyByZXR1cm4gNzsgfX0pLmEgIT0gNzsKfSk7Cn0seyIuLyQuZmFpbHMiOjM4fV0sMzU6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewp2YXIgaXNPYmplY3QgPSByZXF1aXJlKCcuLyQuaXMtb2JqZWN0JykKICAsIGRvY3VtZW50ID0gcmVxdWlyZSgnLi8kLmdsb2JhbCcpLmRvY3VtZW50CiAgLy8gaW4gb2xkIElFIHR5cGVvZiBkb2N1bWVudC5jcmVhdGVFbGVtZW50IGlzICdvYmplY3QnCiAgLCBpcyA9IGlzT2JqZWN0KGRvY3VtZW50KSAmJiBpc09iamVjdChkb2N1bWVudC5jcmVhdGVFbGVtZW50KTsKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihpdCl7CiAgcmV0dXJuIGlzID8gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChpdCkgOiB7fTsKfTsKfSx7Ii4vJC5nbG9iYWwiOjQxLCIuLyQuaXMtb2JqZWN0Ijo0OX1dLDM2OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKLy8gYWxsIGVudW1lcmFibGUgb2JqZWN0IGtleXMsIGluY2x1ZGVzIHN5bWJvbHMKdmFyICQgPSByZXF1aXJlKCcuLyQnKTsKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihpdCl7CiAgdmFyIGtleXMgICAgICAgPSAkLmdldEtleXMoaXQpCiAgICAsIGdldFN5bWJvbHMgPSAkLmdldFN5bWJvbHM7CiAgaWYoZ2V0U3ltYm9scyl7CiAgICB2YXIgc3ltYm9scyA9IGdldFN5bWJvbHMoaXQpCiAgICAgICwgaXNFbnVtICA9ICQuaXNFbnVtCiAgICAgICwgaSAgICAgICA9IDAKICAgICAgLCBrZXk7CiAgICB3aGlsZShzeW1ib2xzLmxlbmd0aCA+IGkpaWYoaXNFbnVtLmNhbGwoaXQsIGtleSA9IHN5bWJvbHNbaSsrXSkpa2V5cy5wdXNoKGtleSk7CiAgfQogIHJldHVybiBrZXlzOwp9Owp9LHsiLi8kIjo1Nn1dLDM3OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKdmFyIGdsb2JhbCAgICA9IHJlcXVpcmUoJy4vJC5nbG9iYWwnKQogICwgY29yZSAgICAgID0gcmVxdWlyZSgnLi8kLmNvcmUnKQogICwgY3R4ICAgICAgID0gcmVxdWlyZSgnLi8kLmN0eCcpCiAgLCBQUk9UT1RZUEUgPSAncHJvdG90eXBlJzsKCnZhciAkZXhwb3J0ID0gZnVuY3Rpb24odHlwZSwgbmFtZSwgc291cmNlKXsKICB2YXIgSVNfRk9SQ0VEID0gdHlwZSAmICRleHBvcnQuRgogICAgLCBJU19HTE9CQUwgPSB0eXBlICYgJGV4cG9ydC5HCiAgICAsIElTX1NUQVRJQyA9IHR5cGUgJiAkZXhwb3J0LlMKICAgICwgSVNfUFJPVE8gID0gdHlwZSAmICRleHBvcnQuUAogICAgLCBJU19CSU5EICAgPSB0eXBlICYgJGV4cG9ydC5CCiAgICAsIElTX1dSQVAgICA9IHR5cGUgJiAkZXhwb3J0LlcKICAgICwgZXhwb3J0cyAgID0gSVNfR0xPQkFMID8gY29yZSA6IGNvcmVbbmFtZV0gfHwgKGNvcmVbbmFtZV0gPSB7fSkKICAgICwgdGFyZ2V0ICAgID0gSVNfR0xPQkFMID8gZ2xvYmFsIDogSVNfU1RBVElDID8gZ2xvYmFsW25hbWVdIDogKGdsb2JhbFtuYW1lXSB8fCB7fSlbUFJPVE9UWVBFXQogICAgLCBrZXksIG93biwgb3V0OwogIGlmKElTX0dMT0JBTClzb3VyY2UgPSBuYW1lOwogIGZvcihrZXkgaW4gc291cmNlKXsKICAgIC8vIGNvbnRhaW5zIGluIG5hdGl2ZQogICAgb3duID0gIUlTX0ZPUkNFRCAmJiB0YXJnZXQgJiYga2V5IGluIHRhcmdldDsKICAgIGlmKG93biAmJiBrZXkgaW4gZXhwb3J0cyljb250aW51ZTsKICAgIC8vIGV4cG9ydCBuYXRpdmUgb3IgcGFzc2VkCiAgICBvdXQgPSBvd24gPyB0YXJnZXRba2V5XSA6IHNvdXJjZVtrZXldOwogICAgLy8gcHJldmVudCBnbG9iYWwgcG9sbHV0aW9uIGZvciBuYW1lc3BhY2VzCiAgICBleHBvcnRzW2tleV0gPSBJU19HTE9CQUwgJiYgdHlwZW9mIHRhcmdldFtrZXldICE9ICdmdW5jdGlvbicgPyBzb3VyY2Vba2V5XQogICAgLy8gYmluZCB0aW1lcnMgdG8gZ2xvYmFsIGZvciBjYWxsIGZyb20gZXhwb3J0IGNvbnRleHQKICAgIDogSVNfQklORCAmJiBvd24gPyBjdHgob3V0LCBnbG9iYWwpCiAgICAvLyB3cmFwIGdsb2JhbCBjb25zdHJ1Y3RvcnMgZm9yIHByZXZlbnQgY2hhbmdlIHRoZW0gaW4gbGlicmFyeQogICAgOiBJU19XUkFQICYmIHRhcmdldFtrZXldID09IG91dCA/IChmdW5jdGlvbihDKXsKICAgICAgdmFyIEYgPSBmdW5jdGlvbihwYXJhbSl7CiAgICAgICAgcmV0dXJuIHRoaXMgaW5zdGFuY2VvZiBDID8gbmV3IEMocGFyYW0pIDogQyhwYXJhbSk7CiAgICAgIH07CiAgICAgIEZbUFJPVE9UWVBFXSA9IENbUFJPVE9UWVBFXTsKICAgICAgcmV0dXJuIEY7CiAgICAvLyBtYWtlIHN0YXRpYyB2ZXJzaW9ucyBmb3IgcHJvdG90eXBlIG1ldGhvZHMKICAgIH0pKG91dCkgOiBJU19QUk9UTyAmJiB0eXBlb2Ygb3V0ID09ICdmdW5jdGlvbicgPyBjdHgoRnVuY3Rpb24uY2FsbCwgb3V0KSA6IG91dDsKICAgIGlmKElTX1BST1RPKShleHBvcnRzW1BST1RPVFlQRV0gfHwgKGV4cG9ydHNbUFJPVE9UWVBFXSA9IHt9KSlba2V5XSA9IG91dDsKICB9Cn07Ci8vIHR5cGUgYml0bWFwCiRleHBvcnQuRiA9IDE7ICAvLyBmb3JjZWQKJGV4cG9ydC5HID0gMjsgIC8vIGdsb2JhbAokZXhwb3J0LlMgPSA0OyAgLy8gc3RhdGljCiRleHBvcnQuUCA9IDg7ICAvLyBwcm90bwokZXhwb3J0LkIgPSAxNjsgLy8gYmluZAokZXhwb3J0LlcgPSAzMjsgLy8gd3JhcAptb2R1bGUuZXhwb3J0cyA9ICRleHBvcnQ7Cn0seyIuLyQuY29yZSI6MzEsIi4vJC5jdHgiOjMyLCIuLyQuZ2xvYmFsIjo0MX1dLDM4OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihleGVjKXsKICB0cnkgewogICAgcmV0dXJuICEhZXhlYygpOwogIH0gY2F0Y2goZSl7CiAgICByZXR1cm4gdHJ1ZTsKICB9Cn07Cn0se31dLDM5OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKdmFyIGN0eCAgICAgICAgID0gcmVxdWlyZSgnLi8kLmN0eCcpCiAgLCBjYWxsICAgICAgICA9IHJlcXVpcmUoJy4vJC5pdGVyLWNhbGwnKQogICwgaXNBcnJheUl0ZXIgPSByZXF1aXJlKCcuLyQuaXMtYXJyYXktaXRlcicpCiAgLCBhbk9iamVjdCAgICA9IHJlcXVpcmUoJy4vJC5hbi1vYmplY3QnKQogICwgdG9MZW5ndGggICAgPSByZXF1aXJlKCcuLyQudG8tbGVuZ3RoJykKICAsIGdldEl0ZXJGbiAgID0gcmVxdWlyZSgnLi9jb3JlLmdldC1pdGVyYXRvci1tZXRob2QnKTsKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihpdGVyYWJsZSwgZW50cmllcywgZm4sIHRoYXQpewogIHZhciBpdGVyRm4gPSBnZXRJdGVyRm4oaXRlcmFibGUpCiAgICAsIGYgICAgICA9IGN0eChmbiwgdGhhdCwgZW50cmllcyA/IDIgOiAxKQogICAgLCBpbmRleCAgPSAwCiAgICAsIGxlbmd0aCwgc3RlcCwgaXRlcmF0b3I7CiAgaWYodHlwZW9mIGl0ZXJGbiAhPSAnZnVuY3Rpb24nKXRocm93IFR5cGVFcnJvcihpdGVyYWJsZSArICcgaXMgbm90IGl0ZXJhYmxlIScpOwogIC8vIGZhc3QgY2FzZSBmb3IgYXJyYXlzIHdpdGggZGVmYXVsdCBpdGVyYXRvcgogIGlmKGlzQXJyYXlJdGVyKGl0ZXJGbikpZm9yKGxlbmd0aCA9IHRvTGVuZ3RoKGl0ZXJhYmxlLmxlbmd0aCk7IGxlbmd0aCA+IGluZGV4OyBpbmRleCsrKXsKICAgIGVudHJpZXMgPyBmKGFuT2JqZWN0KHN0ZXAgPSBpdGVyYWJsZVtpbmRleF0pWzBdLCBzdGVwWzFdKSA6IGYoaXRlcmFibGVbaW5kZXhdKTsKICB9IGVsc2UgZm9yKGl0ZXJhdG9yID0gaXRlckZuLmNhbGwoaXRlcmFibGUpOyAhKHN0ZXAgPSBpdGVyYXRvci5uZXh0KCkpLmRvbmU7ICl7CiAgICBjYWxsKGl0ZXJhdG9yLCBmLCBzdGVwLnZhbHVlLCBlbnRyaWVzKTsKICB9Cn07Cn0seyIuLyQuYW4tb2JqZWN0IjoyOCwiLi8kLmN0eCI6MzIsIi4vJC5pcy1hcnJheS1pdGVyIjo0NywiLi8kLml0ZXItY2FsbCI6NTAsIi4vJC50by1sZW5ndGgiOjc1LCIuL2NvcmUuZ2V0LWl0ZXJhdG9yLW1ldGhvZCI6Nzl9XSw0MDpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Ci8vIGZhbGxiYWNrIGZvciBJRTExIGJ1Z2d5IE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzIHdpdGggaWZyYW1lIGFuZCB3aW5kb3cKdmFyIHRvSU9iamVjdCA9IHJlcXVpcmUoJy4vJC50by1pb2JqZWN0JykKICAsIGdldE5hbWVzICA9IHJlcXVpcmUoJy4vJCcpLmdldE5hbWVzCiAgLCB0b1N0cmluZyAgPSB7fS50b1N0cmluZzsKCnZhciB3aW5kb3dOYW1lcyA9IHR5cGVvZiB3aW5kb3cgPT0gJ29iamVjdCcgJiYgT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMKICA/IE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKHdpbmRvdykgOiBbXTsKCnZhciBnZXRXaW5kb3dOYW1lcyA9IGZ1bmN0aW9uKGl0KXsKICB0cnkgewogICAgcmV0dXJuIGdldE5hbWVzKGl0KTsKICB9IGNhdGNoKGUpewogICAgcmV0dXJuIHdpbmRvd05hbWVzLnNsaWNlKCk7CiAgfQp9OwoKbW9kdWxlLmV4cG9ydHMuZ2V0ID0gZnVuY3Rpb24gZ2V0T3duUHJvcGVydHlOYW1lcyhpdCl7CiAgaWYod2luZG93TmFtZXMgJiYgdG9TdHJpbmcuY2FsbChpdCkgPT0gJ1tvYmplY3QgV2luZG93XScpcmV0dXJuIGdldFdpbmRvd05hbWVzKGl0KTsKICByZXR1cm4gZ2V0TmFtZXModG9JT2JqZWN0KGl0KSk7Cn07Cn0seyIuLyQiOjU2LCIuLyQudG8taW9iamVjdCI6NzR9XSw0MTpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Ci8vIGh0dHBzOi8vZ2l0aHViLmNvbS96bG9pcm9jay9jb3JlLWpzL2lzc3Vlcy84NiNpc3N1ZWNvbW1lbnQtMTE1NzU5MDI4CnZhciBnbG9iYWwgPSBtb2R1bGUuZXhwb3J0cyA9IHR5cGVvZiB3aW5kb3cgIT0gJ3VuZGVmaW5lZCcgJiYgd2luZG93Lk1hdGggPT0gTWF0aAogID8gd2luZG93IDogdHlwZW9mIHNlbGYgIT0gJ3VuZGVmaW5lZCcgJiYgc2VsZi5NYXRoID09IE1hdGggPyBzZWxmIDogRnVuY3Rpb24oJ3JldHVybiB0aGlzJykoKTsKaWYodHlwZW9mIF9fZyA9PSAnbnVtYmVyJylfX2cgPSBnbG9iYWw7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tdW5kZWYKfSx7fV0sNDI6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewp2YXIgaGFzT3duUHJvcGVydHkgPSB7fS5oYXNPd25Qcm9wZXJ0eTsKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihpdCwga2V5KXsKICByZXR1cm4gaGFzT3duUHJvcGVydHkuY2FsbChpdCwga2V5KTsKfTsKfSx7fV0sNDM6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewp2YXIgJCAgICAgICAgICA9IHJlcXVpcmUoJy4vJCcpCiAgLCBjcmVhdGVEZXNjID0gcmVxdWlyZSgnLi8kLnByb3BlcnR5LWRlc2MnKTsKbW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKCcuLyQuZGVzY3JpcHRvcnMnKSA/IGZ1bmN0aW9uKG9iamVjdCwga2V5LCB2YWx1ZSl7CiAgcmV0dXJuICQuc2V0RGVzYyhvYmplY3QsIGtleSwgY3JlYXRlRGVzYygxLCB2YWx1ZSkpOwp9IDogZnVuY3Rpb24ob2JqZWN0LCBrZXksIHZhbHVlKXsKICBvYmplY3Rba2V5XSA9IHZhbHVlOwogIHJldHVybiBvYmplY3Q7Cn07Cn0seyIuLyQiOjU2LCIuLyQuZGVzY3JpcHRvcnMiOjM0LCIuLyQucHJvcGVydHktZGVzYyI6NjF9XSw0NDpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Cm1vZHVsZS5leHBvcnRzID0gcmVxdWlyZSgnLi8kLmdsb2JhbCcpLmRvY3VtZW50ICYmIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudDsKfSx7Ii4vJC5nbG9iYWwiOjQxfV0sNDU6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewovLyBmYXN0IGFwcGx5LCBodHRwOi8vanNwZXJmLmxua2l0LmNvbS9mYXN0LWFwcGx5LzUKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihmbiwgYXJncywgdGhhdCl7CiAgdmFyIHVuID0gdGhhdCA9PT0gdW5kZWZpbmVkOwogIHN3aXRjaChhcmdzLmxlbmd0aCl7CiAgICBjYXNlIDA6IHJldHVybiB1biA/IGZuKCkKICAgICAgICAgICAgICAgICAgICAgIDogZm4uY2FsbCh0aGF0KTsKICAgIGNhc2UgMTogcmV0dXJuIHVuID8gZm4oYXJnc1swXSkKICAgICAgICAgICAgICAgICAgICAgIDogZm4uY2FsbCh0aGF0LCBhcmdzWzBdKTsKICAgIGNhc2UgMjogcmV0dXJuIHVuID8gZm4oYXJnc1swXSwgYXJnc1sxXSkKICAgICAgICAgICAgICAgICAgICAgIDogZm4uY2FsbCh0aGF0LCBhcmdzWzBdLCBhcmdzWzFdKTsKICAgIGNhc2UgMzogcmV0dXJuIHVuID8gZm4oYXJnc1swXSwgYXJnc1sxXSwgYXJnc1syXSkKICAgICAgICAgICAgICAgICAgICAgIDogZm4uY2FsbCh0aGF0LCBhcmdzWzBdLCBhcmdzWzFdLCBhcmdzWzJdKTsKICAgIGNhc2UgNDogcmV0dXJuIHVuID8gZm4oYXJnc1swXSwgYXJnc1sxXSwgYXJnc1syXSwgYXJnc1szXSkKICAgICAgICAgICAgICAgICAgICAgIDogZm4uY2FsbCh0aGF0LCBhcmdzWzBdLCBhcmdzWzFdLCBhcmdzWzJdLCBhcmdzWzNdKTsKICB9IHJldHVybiAgICAgICAgICAgICAgZm4uYXBwbHkodGhhdCwgYXJncyk7Cn07Cn0se31dLDQ2OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKLy8gZmFsbGJhY2sgZm9yIG5vbi1hcnJheS1saWtlIEVTMyBhbmQgbm9uLWVudW1lcmFibGUgb2xkIFY4IHN0cmluZ3MKdmFyIGNvZiA9IHJlcXVpcmUoJy4vJC5jb2YnKTsKbW9kdWxlLmV4cG9ydHMgPSBPYmplY3QoJ3onKS5wcm9wZXJ0eUlzRW51bWVyYWJsZSgwKSA/IE9iamVjdCA6IGZ1bmN0aW9uKGl0KXsKICByZXR1cm4gY29mKGl0KSA9PSAnU3RyaW5nJyA/IGl0LnNwbGl0KCcnKSA6IE9iamVjdChpdCk7Cn07Cn0seyIuLyQuY29mIjozMH1dLDQ3OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKLy8gY2hlY2sgb24gZGVmYXVsdCBBcnJheSBpdGVyYXRvcgp2YXIgSXRlcmF0b3JzICA9IHJlcXVpcmUoJy4vJC5pdGVyYXRvcnMnKQogICwgSVRFUkFUT1IgICA9IHJlcXVpcmUoJy4vJC53a3MnKSgnaXRlcmF0b3InKQogICwgQXJyYXlQcm90byA9IEFycmF5LnByb3RvdHlwZTsKCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oaXQpewogIHJldHVybiBpdCAhPT0gdW5kZWZpbmVkICYmIChJdGVyYXRvcnMuQXJyYXkgPT09IGl0IHx8IEFycmF5UHJvdG9bSVRFUkFUT1JdID09PSBpdCk7Cn07Cn0seyIuLyQuaXRlcmF0b3JzIjo1NSwiLi8kLndrcyI6Nzh9XSw0ODpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Ci8vIDcuMi4yIElzQXJyYXkoYXJndW1lbnQpCnZhciBjb2YgPSByZXF1aXJlKCcuLyQuY29mJyk7Cm1vZHVsZS5leHBvcnRzID0gQXJyYXkuaXNBcnJheSB8fCBmdW5jdGlvbihhcmcpewogIHJldHVybiBjb2YoYXJnKSA9PSAnQXJyYXknOwp9Owp9LHsiLi8kLmNvZiI6MzB9XSw0OTpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Cm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oaXQpewogIHJldHVybiB0eXBlb2YgaXQgPT09ICdvYmplY3QnID8gaXQgIT09IG51bGwgOiB0eXBlb2YgaXQgPT09ICdmdW5jdGlvbic7Cn07Cn0se31dLDUwOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKLy8gY2FsbCBzb21ldGhpbmcgb24gaXRlcmF0b3Igc3RlcCB3aXRoIHNhZmUgY2xvc2luZyBvbiBlcnJvcgp2YXIgYW5PYmplY3QgPSByZXF1aXJlKCcuLyQuYW4tb2JqZWN0Jyk7Cm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oaXRlcmF0b3IsIGZuLCB2YWx1ZSwgZW50cmllcyl7CiAgdHJ5IHsKICAgIHJldHVybiBlbnRyaWVzID8gZm4oYW5PYmplY3QodmFsdWUpWzBdLCB2YWx1ZVsxXSkgOiBmbih2YWx1ZSk7CiAgLy8gNy40LjYgSXRlcmF0b3JDbG9zZShpdGVyYXRvciwgY29tcGxldGlvbikKICB9IGNhdGNoKGUpewogICAgdmFyIHJldCA9IGl0ZXJhdG9yWydyZXR1cm4nXTsKICAgIGlmKHJldCAhPT0gdW5kZWZpbmVkKWFuT2JqZWN0KHJldC5jYWxsKGl0ZXJhdG9yKSk7CiAgICB0aHJvdyBlOwogIH0KfTsKfSx7Ii4vJC5hbi1vYmplY3QiOjI4fV0sNTE6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewondXNlIHN0cmljdCc7CnZhciAkICAgICAgICAgICAgICA9IHJlcXVpcmUoJy4vJCcpCiAgLCBkZXNjcmlwdG9yICAgICA9IHJlcXVpcmUoJy4vJC5wcm9wZXJ0eS1kZXNjJykKICAsIHNldFRvU3RyaW5nVGFnID0gcmVxdWlyZSgnLi8kLnNldC10by1zdHJpbmctdGFnJykKICAsIEl0ZXJhdG9yUHJvdG90eXBlID0ge307CgovLyAyNS4xLjIuMS4xICVJdGVyYXRvclByb3RvdHlwZSVbQEBpdGVyYXRvcl0oKQpyZXF1aXJlKCcuLyQuaGlkZScpKEl0ZXJhdG9yUHJvdG90eXBlLCByZXF1aXJlKCcuLyQud2tzJykoJ2l0ZXJhdG9yJyksIGZ1bmN0aW9uKCl7IHJldHVybiB0aGlzOyB9KTsKCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oQ29uc3RydWN0b3IsIE5BTUUsIG5leHQpewogIENvbnN0cnVjdG9yLnByb3RvdHlwZSA9ICQuY3JlYXRlKEl0ZXJhdG9yUHJvdG90eXBlLCB7bmV4dDogZGVzY3JpcHRvcigxLCBuZXh0KX0pOwogIHNldFRvU3RyaW5nVGFnKENvbnN0cnVjdG9yLCBOQU1FICsgJyBJdGVyYXRvcicpOwp9Owp9LHsiLi8kIjo1NiwiLi8kLmhpZGUiOjQzLCIuLyQucHJvcGVydHktZGVzYyI6NjEsIi4vJC5zZXQtdG8tc3RyaW5nLXRhZyI6NjcsIi4vJC53a3MiOjc4fV0sNTI6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewondXNlIHN0cmljdCc7CnZhciBMSUJSQVJZICAgICAgICA9IHJlcXVpcmUoJy4vJC5saWJyYXJ5JykKICAsICRleHBvcnQgICAgICAgID0gcmVxdWlyZSgnLi8kLmV4cG9ydCcpCiAgLCByZWRlZmluZSAgICAgICA9IHJlcXVpcmUoJy4vJC5yZWRlZmluZScpCiAgLCBoaWRlICAgICAgICAgICA9IHJlcXVpcmUoJy4vJC5oaWRlJykKICAsIGhhcyAgICAgICAgICAgID0gcmVxdWlyZSgnLi8kLmhhcycpCiAgLCBJdGVyYXRvcnMgICAgICA9IHJlcXVpcmUoJy4vJC5pdGVyYXRvcnMnKQogICwgJGl0ZXJDcmVhdGUgICAgPSByZXF1aXJlKCcuLyQuaXRlci1jcmVhdGUnKQogICwgc2V0VG9TdHJpbmdUYWcgPSByZXF1aXJlKCcuLyQuc2V0LXRvLXN0cmluZy10YWcnKQogICwgZ2V0UHJvdG8gICAgICAgPSByZXF1aXJlKCcuLyQnKS5nZXRQcm90bwogICwgSVRFUkFUT1IgICAgICAgPSByZXF1aXJlKCcuLyQud2tzJykoJ2l0ZXJhdG9yJykKICAsIEJVR0dZICAgICAgICAgID0gIShbXS5rZXlzICYmICduZXh0JyBpbiBbXS5rZXlzKCkpIC8vIFNhZmFyaSBoYXMgYnVnZ3kgaXRlcmF0b3JzIHcvbyBgbmV4dGAKICAsIEZGX0lURVJBVE9SICAgID0gJ0BAaXRlcmF0b3InCiAgLCBLRVlTICAgICAgICAgICA9ICdrZXlzJwogICwgVkFMVUVTICAgICAgICAgPSAndmFsdWVzJzsKCnZhciByZXR1cm5UaGlzID0gZnVuY3Rpb24oKXsgcmV0dXJuIHRoaXM7IH07Cgptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKEJhc2UsIE5BTUUsIENvbnN0cnVjdG9yLCBuZXh0LCBERUZBVUxULCBJU19TRVQsIEZPUkNFRCl7CiAgJGl0ZXJDcmVhdGUoQ29uc3RydWN0b3IsIE5BTUUsIG5leHQpOwogIHZhciBnZXRNZXRob2QgPSBmdW5jdGlvbihraW5kKXsKICAgIGlmKCFCVUdHWSAmJiBraW5kIGluIHByb3RvKXJldHVybiBwcm90b1traW5kXTsKICAgIHN3aXRjaChraW5kKXsKICAgICAgY2FzZSBLRVlTOiByZXR1cm4gZnVuY3Rpb24ga2V5cygpeyByZXR1cm4gbmV3IENvbnN0cnVjdG9yKHRoaXMsIGtpbmQpOyB9OwogICAgICBjYXNlIFZBTFVFUzogcmV0dXJuIGZ1bmN0aW9uIHZhbHVlcygpeyByZXR1cm4gbmV3IENvbnN0cnVjdG9yKHRoaXMsIGtpbmQpOyB9OwogICAgfSByZXR1cm4gZnVuY3Rpb24gZW50cmllcygpeyByZXR1cm4gbmV3IENvbnN0cnVjdG9yKHRoaXMsIGtpbmQpOyB9OwogIH07CiAgdmFyIFRBRyAgICAgICAgPSBOQU1FICsgJyBJdGVyYXRvcicKICAgICwgREVGX1ZBTFVFUyA9IERFRkFVTFQgPT0gVkFMVUVTCiAgICAsIFZBTFVFU19CVUcgPSBmYWxzZQogICAgLCBwcm90byAgICAgID0gQmFzZS5wcm90b3R5cGUKICAgICwgJG5hdGl2ZSAgICA9IHByb3RvW0lURVJBVE9SXSB8fCBwcm90b1tGRl9JVEVSQVRPUl0gfHwgREVGQVVMVCAmJiBwcm90b1tERUZBVUxUXQogICAgLCAkZGVmYXVsdCAgID0gJG5hdGl2ZSB8fCBnZXRNZXRob2QoREVGQVVMVCkKICAgICwgbWV0aG9kcywga2V5OwogIC8vIEZpeCBuYXRpdmUKICBpZigkbmF0aXZlKXsKICAgIHZhciBJdGVyYXRvclByb3RvdHlwZSA9IGdldFByb3RvKCRkZWZhdWx0LmNhbGwobmV3IEJhc2UpKTsKICAgIC8vIFNldCBAQHRvU3RyaW5nVGFnIHRvIG5hdGl2ZSBpdGVyYXRvcnMKICAgIHNldFRvU3RyaW5nVGFnKEl0ZXJhdG9yUHJvdG90eXBlLCBUQUcsIHRydWUpOwogICAgLy8gRkYgZml4CiAgICBpZighTElCUkFSWSAmJiBoYXMocHJvdG8sIEZGX0lURVJBVE9SKSloaWRlKEl0ZXJhdG9yUHJvdG90eXBlLCBJVEVSQVRPUiwgcmV0dXJuVGhpcyk7CiAgICAvLyBmaXggQXJyYXkje3ZhbHVlcywgQEBpdGVyYXRvcn0ubmFtZSBpbiBWOCAvIEZGCiAgICBpZihERUZfVkFMVUVTICYmICRuYXRpdmUubmFtZSAhPT0gVkFMVUVTKXsKICAgICAgVkFMVUVTX0JVRyA9IHRydWU7CiAgICAgICRkZWZhdWx0ID0gZnVuY3Rpb24gdmFsdWVzKCl7IHJldHVybiAkbmF0aXZlLmNhbGwodGhpcyk7IH07CiAgICB9CiAgfQogIC8vIERlZmluZSBpdGVyYXRvcgogIGlmKCghTElCUkFSWSB8fCBGT1JDRUQpICYmIChCVUdHWSB8fCBWQUxVRVNfQlVHIHx8ICFwcm90b1tJVEVSQVRPUl0pKXsKICAgIGhpZGUocHJvdG8sIElURVJBVE9SLCAkZGVmYXVsdCk7CiAgfQogIC8vIFBsdWcgZm9yIGxpYnJhcnkKICBJdGVyYXRvcnNbTkFNRV0gPSAkZGVmYXVsdDsKICBJdGVyYXRvcnNbVEFHXSAgPSByZXR1cm5UaGlzOwogIGlmKERFRkFVTFQpewogICAgbWV0aG9kcyA9IHsKICAgICAgdmFsdWVzOiAgREVGX1ZBTFVFUyAgPyAkZGVmYXVsdCA6IGdldE1ldGhvZChWQUxVRVMpLAogICAgICBrZXlzOiAgICBJU19TRVQgICAgICA/ICRkZWZhdWx0IDogZ2V0TWV0aG9kKEtFWVMpLAogICAgICBlbnRyaWVzOiAhREVGX1ZBTFVFUyA/ICRkZWZhdWx0IDogZ2V0TWV0aG9kKCdlbnRyaWVzJykKICAgIH07CiAgICBpZihGT1JDRUQpZm9yKGtleSBpbiBtZXRob2RzKXsKICAgICAgaWYoIShrZXkgaW4gcHJvdG8pKXJlZGVmaW5lKHByb3RvLCBrZXksIG1ldGhvZHNba2V5XSk7CiAgICB9IGVsc2UgJGV4cG9ydCgkZXhwb3J0LlAgKyAkZXhwb3J0LkYgKiAoQlVHR1kgfHwgVkFMVUVTX0JVRyksIE5BTUUsIG1ldGhvZHMpOwogIH0KICByZXR1cm4gbWV0aG9kczsKfTsKfSx7Ii4vJCI6NTYsIi4vJC5leHBvcnQiOjM3LCIuLyQuaGFzIjo0MiwiLi8kLmhpZGUiOjQzLCIuLyQuaXRlci1jcmVhdGUiOjUxLCIuLyQuaXRlcmF0b3JzIjo1NSwiLi8kLmxpYnJhcnkiOjU4LCIuLyQucmVkZWZpbmUiOjYzLCIuLyQuc2V0LXRvLXN0cmluZy10YWciOjY3LCIuLyQud2tzIjo3OH1dLDUzOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKdmFyIElURVJBVE9SICAgICA9IHJlcXVpcmUoJy4vJC53a3MnKSgnaXRlcmF0b3InKQogICwgU0FGRV9DTE9TSU5HID0gZmFsc2U7Cgp0cnkgewogIHZhciByaXRlciA9IFs3XVtJVEVSQVRPUl0oKTsKICByaXRlclsncmV0dXJuJ10gPSBmdW5jdGlvbigpeyBTQUZFX0NMT1NJTkcgPSB0cnVlOyB9OwogIEFycmF5LmZyb20ocml0ZXIsIGZ1bmN0aW9uKCl7IHRocm93IDI7IH0pOwp9IGNhdGNoKGUpeyAvKiBlbXB0eSAqLyB9Cgptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGV4ZWMsIHNraXBDbG9zaW5nKXsKICBpZighc2tpcENsb3NpbmcgJiYgIVNBRkVfQ0xPU0lORylyZXR1cm4gZmFsc2U7CiAgdmFyIHNhZmUgPSBmYWxzZTsKICB0cnkgewogICAgdmFyIGFyciAgPSBbN10KICAgICAgLCBpdGVyID0gYXJyW0lURVJBVE9SXSgpOwogICAgaXRlci5uZXh0ID0gZnVuY3Rpb24oKXsgc2FmZSA9IHRydWU7IH07CiAgICBhcnJbSVRFUkFUT1JdID0gZnVuY3Rpb24oKXsgcmV0dXJuIGl0ZXI7IH07CiAgICBleGVjKGFycik7CiAgfSBjYXRjaChlKXsgLyogZW1wdHkgKi8gfQogIHJldHVybiBzYWZlOwp9Owp9LHsiLi8kLndrcyI6Nzh9XSw1NDpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Cm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oZG9uZSwgdmFsdWUpewogIHJldHVybiB7dmFsdWU6IHZhbHVlLCBkb25lOiAhIWRvbmV9Owp9Owp9LHt9XSw1NTpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Cm1vZHVsZS5leHBvcnRzID0ge307Cn0se31dLDU2OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKdmFyICRPYmplY3QgPSBPYmplY3Q7Cm1vZHVsZS5leHBvcnRzID0gewogIGNyZWF0ZTogICAgICRPYmplY3QuY3JlYXRlLAogIGdldFByb3RvOiAgICRPYmplY3QuZ2V0UHJvdG90eXBlT2YsCiAgaXNFbnVtOiAgICAge30ucHJvcGVydHlJc0VudW1lcmFibGUsCiAgZ2V0RGVzYzogICAgJE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IsCiAgc2V0RGVzYzogICAgJE9iamVjdC5kZWZpbmVQcm9wZXJ0eSwKICBzZXREZXNjczogICAkT2JqZWN0LmRlZmluZVByb3BlcnRpZXMsCiAgZ2V0S2V5czogICAgJE9iamVjdC5rZXlzLAogIGdldE5hbWVzOiAgICRPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcywKICBnZXRTeW1ib2xzOiAkT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scywKICBlYWNoOiAgICAgICBbXS5mb3JFYWNoCn07Cn0se31dLDU3OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKdmFyICQgICAgICAgICA9IHJlcXVpcmUoJy4vJCcpCiAgLCB0b0lPYmplY3QgPSByZXF1aXJlKCcuLyQudG8taW9iamVjdCcpOwptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKG9iamVjdCwgZWwpewogIHZhciBPICAgICAgPSB0b0lPYmplY3Qob2JqZWN0KQogICAgLCBrZXlzICAgPSAkLmdldEtleXMoTykKICAgICwgbGVuZ3RoID0ga2V5cy5sZW5ndGgKICAgICwgaW5kZXggID0gMAogICAgLCBrZXk7CiAgd2hpbGUobGVuZ3RoID4gaW5kZXgpaWYoT1trZXkgPSBrZXlzW2luZGV4KytdXSA9PT0gZWwpcmV0dXJuIGtleTsKfTsKfSx7Ii4vJCI6NTYsIi4vJC50by1pb2JqZWN0Ijo3NH1dLDU4OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKbW9kdWxlLmV4cG9ydHMgPSB0cnVlOwp9LHt9XSw1OTpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7CnZhciBnbG9iYWwgICAgPSByZXF1aXJlKCcuLyQuZ2xvYmFsJykKICAsIG1hY3JvdGFzayA9IHJlcXVpcmUoJy4vJC50YXNrJykuc2V0CiAgLCBPYnNlcnZlciAgPSBnbG9iYWwuTXV0YXRpb25PYnNlcnZlciB8fCBnbG9iYWwuV2ViS2l0TXV0YXRpb25PYnNlcnZlcgogICwgcHJvY2VzcyAgID0gZ2xvYmFsLnByb2Nlc3MKICAsIFByb21pc2UgICA9IGdsb2JhbC5Qcm9taXNlCiAgLCBpc05vZGUgICAgPSByZXF1aXJlKCcuLyQuY29mJykocHJvY2VzcykgPT0gJ3Byb2Nlc3MnCiAgLCBoZWFkLCBsYXN0LCBub3RpZnk7Cgp2YXIgZmx1c2ggPSBmdW5jdGlvbigpewogIHZhciBwYXJlbnQsIGRvbWFpbiwgZm47CiAgaWYoaXNOb2RlICYmIChwYXJlbnQgPSBwcm9jZXNzLmRvbWFpbikpewogICAgcHJvY2Vzcy5kb21haW4gPSBudWxsOwogICAgcGFyZW50LmV4aXQoKTsKICB9CiAgd2hpbGUoaGVhZCl7CiAgICBkb21haW4gPSBoZWFkLmRvbWFpbjsKICAgIGZuICAgICA9IGhlYWQuZm47CiAgICBpZihkb21haW4pZG9tYWluLmVudGVyKCk7CiAgICBmbigpOyAvLyA8LSBjdXJyZW50bHkgd2UgdXNlIGl0IG9ubHkgZm9yIFByb21pc2UgLSB0cnkgLyBjYXRjaCBub3QgcmVxdWlyZWQKICAgIGlmKGRvbWFpbilkb21haW4uZXhpdCgpOwogICAgaGVhZCA9IGhlYWQubmV4dDsKICB9IGxhc3QgPSB1bmRlZmluZWQ7CiAgaWYocGFyZW50KXBhcmVudC5lbnRlcigpOwp9OwoKLy8gTm9kZS5qcwppZihpc05vZGUpewogIG5vdGlmeSA9IGZ1bmN0aW9uKCl7CiAgICBwcm9jZXNzLm5leHRUaWNrKGZsdXNoKTsKICB9OwovLyBicm93c2VycyB3aXRoIE11dGF0aW9uT2JzZXJ2ZXIKfSBlbHNlIGlmKE9ic2VydmVyKXsKICB2YXIgdG9nZ2xlID0gMQogICAgLCBub2RlICAgPSBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnJyk7CiAgbmV3IE9ic2VydmVyKGZsdXNoKS5vYnNlcnZlKG5vZGUsIHtjaGFyYWN0ZXJEYXRhOiB0cnVlfSk7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tbmV3CiAgbm90aWZ5ID0gZnVuY3Rpb24oKXsKICAgIG5vZGUuZGF0YSA9IHRvZ2dsZSA9IC10b2dnbGU7CiAgfTsKLy8gZW52aXJvbm1lbnRzIHdpdGggbWF5YmUgbm9uLWNvbXBsZXRlbHkgY29ycmVjdCwgYnV0IGV4aXN0ZW50IFByb21pc2UKfSBlbHNlIGlmKFByb21pc2UgJiYgUHJvbWlzZS5yZXNvbHZlKXsKICBub3RpZnkgPSBmdW5jdGlvbigpewogICAgUHJvbWlzZS5yZXNvbHZlKCkudGhlbihmbHVzaCk7CiAgfTsKLy8gZm9yIG90aGVyIGVudmlyb25tZW50cyAtIG1hY3JvdGFzayBiYXNlZCBvbjoKLy8gLSBzZXRJbW1lZGlhdGUKLy8gLSBNZXNzYWdlQ2hhbm5lbAovLyAtIHdpbmRvdy5wb3N0TWVzc2FnCi8vIC0gb25yZWFkeXN0YXRlY2hhbmdlCi8vIC0gc2V0VGltZW91dAp9IGVsc2UgewogIG5vdGlmeSA9IGZ1bmN0aW9uKCl7CiAgICAvLyBzdHJhbmdlIElFICsgd2VicGFjayBkZXYgc2VydmVyIGJ1ZyAtIHVzZSAuY2FsbChnbG9iYWwpCiAgICBtYWNyb3Rhc2suY2FsbChnbG9iYWwsIGZsdXNoKTsKICB9Owp9Cgptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIGFzYXAoZm4pewogIHZhciB0YXNrID0ge2ZuOiBmbiwgbmV4dDogdW5kZWZpbmVkLCBkb21haW46IGlzTm9kZSAmJiBwcm9jZXNzLmRvbWFpbn07CiAgaWYobGFzdClsYXN0Lm5leHQgPSB0YXNrOwogIGlmKCFoZWFkKXsKICAgIGhlYWQgPSB0YXNrOwogICAgbm90aWZ5KCk7CiAgfSBsYXN0ID0gdGFzazsKfTsKfSx7Ii4vJC5jb2YiOjMwLCIuLyQuZ2xvYmFsIjo0MSwiLi8kLnRhc2siOjcyfV0sNjA6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewovLyBtb3N0IE9iamVjdCBtZXRob2RzIGJ5IEVTNiBzaG91bGQgYWNjZXB0IHByaW1pdGl2ZXMKdmFyICRleHBvcnQgPSByZXF1aXJlKCcuLyQuZXhwb3J0JykKICAsIGNvcmUgICAgPSByZXF1aXJlKCcuLyQuY29yZScpCiAgLCBmYWlscyAgID0gcmVxdWlyZSgnLi8kLmZhaWxzJyk7Cm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oS0VZLCBleGVjKXsKICB2YXIgZm4gID0gKGNvcmUuT2JqZWN0IHx8IHt9KVtLRVldIHx8IE9iamVjdFtLRVldCiAgICAsIGV4cCA9IHt9OwogIGV4cFtLRVldID0gZXhlYyhmbik7CiAgJGV4cG9ydCgkZXhwb3J0LlMgKyAkZXhwb3J0LkYgKiBmYWlscyhmdW5jdGlvbigpeyBmbigxKTsgfSksICdPYmplY3QnLCBleHApOwp9Owp9LHsiLi8kLmNvcmUiOjMxLCIuLyQuZXhwb3J0IjozNywiLi8kLmZhaWxzIjozOH1dLDYxOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihiaXRtYXAsIHZhbHVlKXsKICByZXR1cm4gewogICAgZW51bWVyYWJsZSAgOiAhKGJpdG1hcCAmIDEpLAogICAgY29uZmlndXJhYmxlOiAhKGJpdG1hcCAmIDIpLAogICAgd3JpdGFibGUgICAgOiAhKGJpdG1hcCAmIDQpLAogICAgdmFsdWUgICAgICAgOiB2YWx1ZQogIH07Cn07Cn0se31dLDYyOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKdmFyIHJlZGVmaW5lID0gcmVxdWlyZSgnLi8kLnJlZGVmaW5lJyk7Cm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24odGFyZ2V0LCBzcmMpewogIGZvcih2YXIga2V5IGluIHNyYylyZWRlZmluZSh0YXJnZXQsIGtleSwgc3JjW2tleV0pOwogIHJldHVybiB0YXJnZXQ7Cn07Cn0seyIuLyQucmVkZWZpbmUiOjYzfV0sNjM6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewptb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoJy4vJC5oaWRlJyk7Cn0seyIuLyQuaGlkZSI6NDN9XSw2NDpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Ci8vIDcuMi45IFNhbWVWYWx1ZSh4LCB5KQptb2R1bGUuZXhwb3J0cyA9IE9iamVjdC5pcyB8fCBmdW5jdGlvbiBpcyh4LCB5KXsKICByZXR1cm4geCA9PT0geSA/IHggIT09IDAgfHwgMSAvIHggPT09IDEgLyB5IDogeCAhPSB4ICYmIHkgIT0geTsKfTsKfSx7fV0sNjU6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewovLyBXb3JrcyB3aXRoIF9fcHJvdG9fXyBvbmx5LiBPbGQgdjggY2FuJ3Qgd29yayB3aXRoIG51bGwgcHJvdG8gb2JqZWN0cy4KLyogZXNsaW50LWRpc2FibGUgbm8tcHJvdG8gKi8KdmFyIGdldERlc2MgID0gcmVxdWlyZSgnLi8kJykuZ2V0RGVzYwogICwgaXNPYmplY3QgPSByZXF1aXJlKCcuLyQuaXMtb2JqZWN0JykKICAsIGFuT2JqZWN0ID0gcmVxdWlyZSgnLi8kLmFuLW9iamVjdCcpOwp2YXIgY2hlY2sgPSBmdW5jdGlvbihPLCBwcm90byl7CiAgYW5PYmplY3QoTyk7CiAgaWYoIWlzT2JqZWN0KHByb3RvKSAmJiBwcm90byAhPT0gbnVsbCl0aHJvdyBUeXBlRXJyb3IocHJvdG8gKyAiOiBjYW4ndCBzZXQgYXMgcHJvdG90eXBlISIpOwp9Owptb2R1bGUuZXhwb3J0cyA9IHsKICBzZXQ6IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fCAoJ19fcHJvdG9fXycgaW4ge30gPyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lCiAgICBmdW5jdGlvbih0ZXN0LCBidWdneSwgc2V0KXsKICAgICAgdHJ5IHsKICAgICAgICBzZXQgPSByZXF1aXJlKCcuLyQuY3R4JykoRnVuY3Rpb24uY2FsbCwgZ2V0RGVzYyhPYmplY3QucHJvdG90eXBlLCAnX19wcm90b19fJykuc2V0LCAyKTsKICAgICAgICBzZXQodGVzdCwgW10pOwogICAgICAgIGJ1Z2d5ID0gISh0ZXN0IGluc3RhbmNlb2YgQXJyYXkpOwogICAgICB9IGNhdGNoKGUpeyBidWdneSA9IHRydWU7IH0KICAgICAgcmV0dXJuIGZ1bmN0aW9uIHNldFByb3RvdHlwZU9mKE8sIHByb3RvKXsKICAgICAgICBjaGVjayhPLCBwcm90byk7CiAgICAgICAgaWYoYnVnZ3kpTy5fX3Byb3RvX18gPSBwcm90bzsKICAgICAgICBlbHNlIHNldChPLCBwcm90byk7CiAgICAgICAgcmV0dXJuIE87CiAgICAgIH07CiAgICB9KHt9LCBmYWxzZSkgOiB1bmRlZmluZWQpLAogIGNoZWNrOiBjaGVjawp9Owp9LHsiLi8kIjo1NiwiLi8kLmFuLW9iamVjdCI6MjgsIi4vJC5jdHgiOjMyLCIuLyQuaXMtb2JqZWN0Ijo0OX1dLDY2OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKJ3VzZSBzdHJpY3QnOwp2YXIgY29yZSAgICAgICAgPSByZXF1aXJlKCcuLyQuY29yZScpCiAgLCAkICAgICAgICAgICA9IHJlcXVpcmUoJy4vJCcpCiAgLCBERVNDUklQVE9SUyA9IHJlcXVpcmUoJy4vJC5kZXNjcmlwdG9ycycpCiAgLCBTUEVDSUVTICAgICA9IHJlcXVpcmUoJy4vJC53a3MnKSgnc3BlY2llcycpOwoKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihLRVkpewogIHZhciBDID0gY29yZVtLRVldOwogIGlmKERFU0NSSVBUT1JTICYmIEMgJiYgIUNbU1BFQ0lFU10pJC5zZXREZXNjKEMsIFNQRUNJRVMsIHsKICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgIGdldDogZnVuY3Rpb24oKXsgcmV0dXJuIHRoaXM7IH0KICB9KTsKfTsKfSx7Ii4vJCI6NTYsIi4vJC5jb3JlIjozMSwiLi8kLmRlc2NyaXB0b3JzIjozNCwiLi8kLndrcyI6Nzh9XSw2NzpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7CnZhciBkZWYgPSByZXF1aXJlKCcuLyQnKS5zZXREZXNjCiAgLCBoYXMgPSByZXF1aXJlKCcuLyQuaGFzJykKICAsIFRBRyA9IHJlcXVpcmUoJy4vJC53a3MnKSgndG9TdHJpbmdUYWcnKTsKCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oaXQsIHRhZywgc3RhdCl7CiAgaWYoaXQgJiYgIWhhcyhpdCA9IHN0YXQgPyBpdCA6IGl0LnByb3RvdHlwZSwgVEFHKSlkZWYoaXQsIFRBRywge2NvbmZpZ3VyYWJsZTogdHJ1ZSwgdmFsdWU6IHRhZ30pOwp9Owp9LHsiLi8kIjo1NiwiLi8kLmhhcyI6NDIsIi4vJC53a3MiOjc4fV0sNjg6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewp2YXIgZ2xvYmFsID0gcmVxdWlyZSgnLi8kLmdsb2JhbCcpCiAgLCBTSEFSRUQgPSAnX19jb3JlLWpzX3NoYXJlZF9fJwogICwgc3RvcmUgID0gZ2xvYmFsW1NIQVJFRF0gfHwgKGdsb2JhbFtTSEFSRURdID0ge30pOwptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGtleSl7CiAgcmV0dXJuIHN0b3JlW2tleV0gfHwgKHN0b3JlW2tleV0gPSB7fSk7Cn07Cn0seyIuLyQuZ2xvYmFsIjo0MX1dLDY5OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKLy8gNy4zLjIwIFNwZWNpZXNDb25zdHJ1Y3RvcihPLCBkZWZhdWx0Q29uc3RydWN0b3IpCnZhciBhbk9iamVjdCAgPSByZXF1aXJlKCcuLyQuYW4tb2JqZWN0JykKICAsIGFGdW5jdGlvbiA9IHJlcXVpcmUoJy4vJC5hLWZ1bmN0aW9uJykKICAsIFNQRUNJRVMgICA9IHJlcXVpcmUoJy4vJC53a3MnKSgnc3BlY2llcycpOwptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKE8sIEQpewogIHZhciBDID0gYW5PYmplY3QoTykuY29uc3RydWN0b3IsIFM7CiAgcmV0dXJuIEMgPT09IHVuZGVmaW5lZCB8fCAoUyA9IGFuT2JqZWN0KEMpW1NQRUNJRVNdKSA9PSB1bmRlZmluZWQgPyBEIDogYUZ1bmN0aW9uKFMpOwp9Owp9LHsiLi8kLmEtZnVuY3Rpb24iOjI2LCIuLyQuYW4tb2JqZWN0IjoyOCwiLi8kLndrcyI6Nzh9XSw3MDpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Cm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oaXQsIENvbnN0cnVjdG9yLCBuYW1lKXsKICBpZighKGl0IGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKXRocm93IFR5cGVFcnJvcihuYW1lICsgIjogdXNlIHRoZSAnbmV3JyBvcGVyYXRvciEiKTsKICByZXR1cm4gaXQ7Cn07Cn0se31dLDcxOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKdmFyIHRvSW50ZWdlciA9IHJlcXVpcmUoJy4vJC50by1pbnRlZ2VyJykKICAsIGRlZmluZWQgICA9IHJlcXVpcmUoJy4vJC5kZWZpbmVkJyk7Ci8vIHRydWUgIC0+IFN0cmluZyNhdAovLyBmYWxzZSAtPiBTdHJpbmcjY29kZVBvaW50QXQKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihUT19TVFJJTkcpewogIHJldHVybiBmdW5jdGlvbih0aGF0LCBwb3MpewogICAgdmFyIHMgPSBTdHJpbmcoZGVmaW5lZCh0aGF0KSkKICAgICAgLCBpID0gdG9JbnRlZ2VyKHBvcykKICAgICAgLCBsID0gcy5sZW5ndGgKICAgICAgLCBhLCBiOwogICAgaWYoaSA8IDAgfHwgaSA+PSBsKXJldHVybiBUT19TVFJJTkcgPyAnJyA6IHVuZGVmaW5lZDsKICAgIGEgPSBzLmNoYXJDb2RlQXQoaSk7CiAgICByZXR1cm4gYSA8IDB4ZDgwMCB8fCBhID4gMHhkYmZmIHx8IGkgKyAxID09PSBsIHx8IChiID0gcy5jaGFyQ29kZUF0KGkgKyAxKSkgPCAweGRjMDAgfHwgYiA+IDB4ZGZmZgogICAgICA/IFRPX1NUUklORyA/IHMuY2hhckF0KGkpIDogYQogICAgICA6IFRPX1NUUklORyA/IHMuc2xpY2UoaSwgaSArIDIpIDogKGEgLSAweGQ4MDAgPDwgMTApICsgKGIgLSAweGRjMDApICsgMHgxMDAwMDsKICB9Owp9Owp9LHsiLi8kLmRlZmluZWQiOjMzLCIuLyQudG8taW50ZWdlciI6NzN9XSw3MjpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7CnZhciBjdHggICAgICAgICAgICAgICAgPSByZXF1aXJlKCcuLyQuY3R4JykKICAsIGludm9rZSAgICAgICAgICAgICA9IHJlcXVpcmUoJy4vJC5pbnZva2UnKQogICwgaHRtbCAgICAgICAgICAgICAgID0gcmVxdWlyZSgnLi8kLmh0bWwnKQogICwgY2VsICAgICAgICAgICAgICAgID0gcmVxdWlyZSgnLi8kLmRvbS1jcmVhdGUnKQogICwgZ2xvYmFsICAgICAgICAgICAgID0gcmVxdWlyZSgnLi8kLmdsb2JhbCcpCiAgLCBwcm9jZXNzICAgICAgICAgICAgPSBnbG9iYWwucHJvY2VzcwogICwgc2V0VGFzayAgICAgICAgICAgID0gZ2xvYmFsLnNldEltbWVkaWF0ZQogICwgY2xlYXJUYXNrICAgICAgICAgID0gZ2xvYmFsLmNsZWFySW1tZWRpYXRlCiAgLCBNZXNzYWdlQ2hhbm5lbCAgICAgPSBnbG9iYWwuTWVzc2FnZUNoYW5uZWwKICAsIGNvdW50ZXIgICAgICAgICAgICA9IDAKICAsIHF1ZXVlICAgICAgICAgICAgICA9IHt9CiAgLCBPTlJFQURZU1RBVEVDSEFOR0UgPSAnb25yZWFkeXN0YXRlY2hhbmdlJwogICwgZGVmZXIsIGNoYW5uZWwsIHBvcnQ7CnZhciBydW4gPSBmdW5jdGlvbigpewogIHZhciBpZCA9ICt0aGlzOwogIGlmKHF1ZXVlLmhhc093blByb3BlcnR5KGlkKSl7CiAgICB2YXIgZm4gPSBxdWV1ZVtpZF07CiAgICBkZWxldGUgcXVldWVbaWRdOwogICAgZm4oKTsKICB9Cn07CnZhciBsaXN0bmVyID0gZnVuY3Rpb24oZXZlbnQpewogIHJ1bi5jYWxsKGV2ZW50LmRhdGEpOwp9OwovLyBOb2RlLmpzIDAuOSsgJiBJRTEwKyBoYXMgc2V0SW1tZWRpYXRlLCBvdGhlcndpc2U6CmlmKCFzZXRUYXNrIHx8ICFjbGVhclRhc2spewogIHNldFRhc2sgPSBmdW5jdGlvbiBzZXRJbW1lZGlhdGUoZm4pewogICAgdmFyIGFyZ3MgPSBbXSwgaSA9IDE7CiAgICB3aGlsZShhcmd1bWVudHMubGVuZ3RoID4gaSlhcmdzLnB1c2goYXJndW1lbnRzW2krK10pOwogICAgcXVldWVbKytjb3VudGVyXSA9IGZ1bmN0aW9uKCl7CiAgICAgIGludm9rZSh0eXBlb2YgZm4gPT0gJ2Z1bmN0aW9uJyA/IGZuIDogRnVuY3Rpb24oZm4pLCBhcmdzKTsKICAgIH07CiAgICBkZWZlcihjb3VudGVyKTsKICAgIHJldHVybiBjb3VudGVyOwogIH07CiAgY2xlYXJUYXNrID0gZnVuY3Rpb24gY2xlYXJJbW1lZGlhdGUoaWQpewogICAgZGVsZXRlIHF1ZXVlW2lkXTsKICB9OwogIC8vIE5vZGUuanMgMC44LQogIGlmKHJlcXVpcmUoJy4vJC5jb2YnKShwcm9jZXNzKSA9PSAncHJvY2VzcycpewogICAgZGVmZXIgPSBmdW5jdGlvbihpZCl7CiAgICAgIHByb2Nlc3MubmV4dFRpY2soY3R4KHJ1biwgaWQsIDEpKTsKICAgIH07CiAgLy8gQnJvd3NlcnMgd2l0aCBNZXNzYWdlQ2hhbm5lbCwgaW5jbHVkZXMgV2ViV29ya2VycwogIH0gZWxzZSBpZihNZXNzYWdlQ2hhbm5lbCl7CiAgICBjaGFubmVsID0gbmV3IE1lc3NhZ2VDaGFubmVsOwogICAgcG9ydCAgICA9IGNoYW5uZWwucG9ydDI7CiAgICBjaGFubmVsLnBvcnQxLm9ubWVzc2FnZSA9IGxpc3RuZXI7CiAgICBkZWZlciA9IGN0eChwb3J0LnBvc3RNZXNzYWdlLCBwb3J0LCAxKTsKICAvLyBCcm93c2VycyB3aXRoIHBvc3RNZXNzYWdlLCBza2lwIFdlYldvcmtlcnMKICAvLyBJRTggaGFzIHBvc3RNZXNzYWdlLCBidXQgaXQncyBzeW5jICYgdHlwZW9mIGl0cyBwb3N0TWVzc2FnZSBpcyAnb2JqZWN0JwogIH0gZWxzZSBpZihnbG9iYWwuYWRkRXZlbnRMaXN0ZW5lciAmJiB0eXBlb2YgcG9zdE1lc3NhZ2UgPT0gJ2Z1bmN0aW9uJyAmJiAhZ2xvYmFsLmltcG9ydFNjcmlwdHMpewogICAgZGVmZXIgPSBmdW5jdGlvbihpZCl7CiAgICAgIGdsb2JhbC5wb3N0TWVzc2FnZShpZCArICcnLCAnKicpOwogICAgfTsKICAgIGdsb2JhbC5hZGRFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgbGlzdG5lciwgZmFsc2UpOwogIC8vIElFOC0KICB9IGVsc2UgaWYoT05SRUFEWVNUQVRFQ0hBTkdFIGluIGNlbCgnc2NyaXB0JykpewogICAgZGVmZXIgPSBmdW5jdGlvbihpZCl7CiAgICAgIGh0bWwuYXBwZW5kQ2hpbGQoY2VsKCdzY3JpcHQnKSlbT05SRUFEWVNUQVRFQ0hBTkdFXSA9IGZ1bmN0aW9uKCl7CiAgICAgICAgaHRtbC5yZW1vdmVDaGlsZCh0aGlzKTsKICAgICAgICBydW4uY2FsbChpZCk7CiAgICAgIH07CiAgICB9OwogIC8vIFJlc3Qgb2xkIGJyb3dzZXJzCiAgfSBlbHNlIHsKICAgIGRlZmVyID0gZnVuY3Rpb24oaWQpewogICAgICBzZXRUaW1lb3V0KGN0eChydW4sIGlkLCAxKSwgMCk7CiAgICB9OwogIH0KfQptb2R1bGUuZXhwb3J0cyA9IHsKICBzZXQ6ICAgc2V0VGFzaywKICBjbGVhcjogY2xlYXJUYXNrCn07Cn0seyIuLyQuY29mIjozMCwiLi8kLmN0eCI6MzIsIi4vJC5kb20tY3JlYXRlIjozNSwiLi8kLmdsb2JhbCI6NDEsIi4vJC5odG1sIjo0NCwiLi8kLmludm9rZSI6NDV9XSw3MzpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Ci8vIDcuMS40IFRvSW50ZWdlcgp2YXIgY2VpbCAgPSBNYXRoLmNlaWwKICAsIGZsb29yID0gTWF0aC5mbG9vcjsKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihpdCl7CiAgcmV0dXJuIGlzTmFOKGl0ID0gK2l0KSA/IDAgOiAoaXQgPiAwID8gZmxvb3IgOiBjZWlsKShpdCk7Cn07Cn0se31dLDc0OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKLy8gdG8gaW5kZXhlZCBvYmplY3QsIHRvT2JqZWN0IHdpdGggZmFsbGJhY2sgZm9yIG5vbi1hcnJheS1saWtlIEVTMyBzdHJpbmdzCnZhciBJT2JqZWN0ID0gcmVxdWlyZSgnLi8kLmlvYmplY3QnKQogICwgZGVmaW5lZCA9IHJlcXVpcmUoJy4vJC5kZWZpbmVkJyk7Cm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oaXQpewogIHJldHVybiBJT2JqZWN0KGRlZmluZWQoaXQpKTsKfTsKfSx7Ii4vJC5kZWZpbmVkIjozMywiLi8kLmlvYmplY3QiOjQ2fV0sNzU6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewovLyA3LjEuMTUgVG9MZW5ndGgKdmFyIHRvSW50ZWdlciA9IHJlcXVpcmUoJy4vJC50by1pbnRlZ2VyJykKICAsIG1pbiAgICAgICA9IE1hdGgubWluOwptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGl0KXsKICByZXR1cm4gaXQgPiAwID8gbWluKHRvSW50ZWdlcihpdCksIDB4MWZmZmZmZmZmZmZmZmYpIDogMDsgLy8gcG93KDIsIDUzKSAtIDEgPT0gOTAwNzE5OTI1NDc0MDk5MQp9Owp9LHsiLi8kLnRvLWludGVnZXIiOjczfV0sNzY6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewovLyA3LjEuMTMgVG9PYmplY3QoYXJndW1lbnQpCnZhciBkZWZpbmVkID0gcmVxdWlyZSgnLi8kLmRlZmluZWQnKTsKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihpdCl7CiAgcmV0dXJuIE9iamVjdChkZWZpbmVkKGl0KSk7Cn07Cn0seyIuLyQuZGVmaW5lZCI6MzN9XSw3NzpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7CnZhciBpZCA9IDAKICAsIHB4ID0gTWF0aC5yYW5kb20oKTsKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihrZXkpewogIHJldHVybiAnU3ltYm9sKCcuY29uY2F0KGtleSA9PT0gdW5kZWZpbmVkID8gJycgOiBrZXksICcpXycsICgrK2lkICsgcHgpLnRvU3RyaW5nKDM2KSk7Cn07Cn0se31dLDc4OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKdmFyIHN0b3JlICA9IHJlcXVpcmUoJy4vJC5zaGFyZWQnKSgnd2tzJykKICAsIHVpZCAgICA9IHJlcXVpcmUoJy4vJC51aWQnKQogICwgU3ltYm9sID0gcmVxdWlyZSgnLi8kLmdsb2JhbCcpLlN5bWJvbDsKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihuYW1lKXsKICByZXR1cm4gc3RvcmVbbmFtZV0gfHwgKHN0b3JlW25hbWVdID0KICAgIFN5bWJvbCAmJiBTeW1ib2xbbmFtZV0gfHwgKFN5bWJvbCB8fCB1aWQpKCdTeW1ib2wuJyArIG5hbWUpKTsKfTsKfSx7Ii4vJC5nbG9iYWwiOjQxLCIuLyQuc2hhcmVkIjo2OCwiLi8kLnVpZCI6Nzd9XSw3OTpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7CnZhciBjbGFzc29mICAgPSByZXF1aXJlKCcuLyQuY2xhc3NvZicpCiAgLCBJVEVSQVRPUiAgPSByZXF1aXJlKCcuLyQud2tzJykoJ2l0ZXJhdG9yJykKICAsIEl0ZXJhdG9ycyA9IHJlcXVpcmUoJy4vJC5pdGVyYXRvcnMnKTsKbW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKCcuLyQuY29yZScpLmdldEl0ZXJhdG9yTWV0aG9kID0gZnVuY3Rpb24oaXQpewogIGlmKGl0ICE9IHVuZGVmaW5lZClyZXR1cm4gaXRbSVRFUkFUT1JdCiAgICB8fCBpdFsnQEBpdGVyYXRvciddCiAgICB8fCBJdGVyYXRvcnNbY2xhc3NvZihpdCldOwp9Owp9LHsiLi8kLmNsYXNzb2YiOjI5LCIuLyQuY29yZSI6MzEsIi4vJC5pdGVyYXRvcnMiOjU1LCIuLyQud2tzIjo3OH1dLDgwOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKJ3VzZSBzdHJpY3QnOwp2YXIgYWRkVG9VbnNjb3BhYmxlcyA9IHJlcXVpcmUoJy4vJC5hZGQtdG8tdW5zY29wYWJsZXMnKQogICwgc3RlcCAgICAgICAgICAgICA9IHJlcXVpcmUoJy4vJC5pdGVyLXN0ZXAnKQogICwgSXRlcmF0b3JzICAgICAgICA9IHJlcXVpcmUoJy4vJC5pdGVyYXRvcnMnKQogICwgdG9JT2JqZWN0ICAgICAgICA9IHJlcXVpcmUoJy4vJC50by1pb2JqZWN0Jyk7CgovLyAyMi4xLjMuNCBBcnJheS5wcm90b3R5cGUuZW50cmllcygpCi8vIDIyLjEuMy4xMyBBcnJheS5wcm90b3R5cGUua2V5cygpCi8vIDIyLjEuMy4yOSBBcnJheS5wcm90b3R5cGUudmFsdWVzKCkKLy8gMjIuMS4zLjMwIEFycmF5LnByb3RvdHlwZVtAQGl0ZXJhdG9yXSgpCm1vZHVsZS5leHBvcnRzID0gcmVxdWlyZSgnLi8kLml0ZXItZGVmaW5lJykoQXJyYXksICdBcnJheScsIGZ1bmN0aW9uKGl0ZXJhdGVkLCBraW5kKXsKICB0aGlzLl90ID0gdG9JT2JqZWN0KGl0ZXJhdGVkKTsgLy8gdGFyZ2V0CiAgdGhpcy5faSA9IDA7ICAgICAgICAgICAgICAgICAgIC8vIG5leHQgaW5kZXgKICB0aGlzLl9rID0ga2luZDsgICAgICAgICAgICAgICAgLy8ga2luZAovLyAyMi4xLjUuMi4xICVBcnJheUl0ZXJhdG9yUHJvdG90eXBlJS5uZXh0KCkKfSwgZnVuY3Rpb24oKXsKICB2YXIgTyAgICAgPSB0aGlzLl90CiAgICAsIGtpbmQgID0gdGhpcy5fawogICAgLCBpbmRleCA9IHRoaXMuX2krKzsKICBpZighTyB8fCBpbmRleCA+PSBPLmxlbmd0aCl7CiAgICB0aGlzLl90ID0gdW5kZWZpbmVkOwogICAgcmV0dXJuIHN0ZXAoMSk7CiAgfQogIGlmKGtpbmQgPT0gJ2tleXMnICApcmV0dXJuIHN0ZXAoMCwgaW5kZXgpOwogIGlmKGtpbmQgPT0gJ3ZhbHVlcycpcmV0dXJuIHN0ZXAoMCwgT1tpbmRleF0pOwogIHJldHVybiBzdGVwKDAsIFtpbmRleCwgT1tpbmRleF1dKTsKfSwgJ3ZhbHVlcycpOwoKLy8gYXJndW1lbnRzTGlzdFtAQGl0ZXJhdG9yXSBpcyAlQXJyYXlQcm90b192YWx1ZXMlICg5LjQuNC42LCA5LjQuNC43KQpJdGVyYXRvcnMuQXJndW1lbnRzID0gSXRlcmF0b3JzLkFycmF5OwoKYWRkVG9VbnNjb3BhYmxlcygna2V5cycpOwphZGRUb1Vuc2NvcGFibGVzKCd2YWx1ZXMnKTsKYWRkVG9VbnNjb3BhYmxlcygnZW50cmllcycpOwp9LHsiLi8kLmFkZC10by11bnNjb3BhYmxlcyI6MjcsIi4vJC5pdGVyLWRlZmluZSI6NTIsIi4vJC5pdGVyLXN0ZXAiOjU0LCIuLyQuaXRlcmF0b3JzIjo1NSwiLi8kLnRvLWlvYmplY3QiOjc0fV0sODE6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewovLyAxOS4xLjIuNiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKE8sIFApCnZhciB0b0lPYmplY3QgPSByZXF1aXJlKCcuLyQudG8taW9iamVjdCcpOwoKcmVxdWlyZSgnLi8kLm9iamVjdC1zYXAnKSgnZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yJywgZnVuY3Rpb24oJGdldE93blByb3BlcnR5RGVzY3JpcHRvcil7CiAgcmV0dXJuIGZ1bmN0aW9uIGdldE93blByb3BlcnR5RGVzY3JpcHRvcihpdCwga2V5KXsKICAgIHJldHVybiAkZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHRvSU9iamVjdChpdCksIGtleSk7CiAgfTsKfSk7Cn0seyIuLyQub2JqZWN0LXNhcCI6NjAsIi4vJC50by1pb2JqZWN0Ijo3NH1dLDgyOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKLy8gMTkuMS4yLjkgT2JqZWN0LmdldFByb3RvdHlwZU9mKE8pCnZhciB0b09iamVjdCA9IHJlcXVpcmUoJy4vJC50by1vYmplY3QnKTsKCnJlcXVpcmUoJy4vJC5vYmplY3Qtc2FwJykoJ2dldFByb3RvdHlwZU9mJywgZnVuY3Rpb24oJGdldFByb3RvdHlwZU9mKXsKICByZXR1cm4gZnVuY3Rpb24gZ2V0UHJvdG90eXBlT2YoaXQpewogICAgcmV0dXJuICRnZXRQcm90b3R5cGVPZih0b09iamVjdChpdCkpOwogIH07Cn0pOwp9LHsiLi8kLm9iamVjdC1zYXAiOjYwLCIuLyQudG8tb2JqZWN0Ijo3Nn1dLDgzOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKLy8gMTkuMS4yLjE0IE9iamVjdC5rZXlzKE8pCnZhciB0b09iamVjdCA9IHJlcXVpcmUoJy4vJC50by1vYmplY3QnKTsKCnJlcXVpcmUoJy4vJC5vYmplY3Qtc2FwJykoJ2tleXMnLCBmdW5jdGlvbigka2V5cyl7CiAgcmV0dXJuIGZ1bmN0aW9uIGtleXMoaXQpewogICAgcmV0dXJuICRrZXlzKHRvT2JqZWN0KGl0KSk7CiAgfTsKfSk7Cn0seyIuLyQub2JqZWN0LXNhcCI6NjAsIi4vJC50by1vYmplY3QiOjc2fV0sODQ6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewovLyAxOS4xLjMuMTkgT2JqZWN0LnNldFByb3RvdHlwZU9mKE8sIHByb3RvKQp2YXIgJGV4cG9ydCA9IHJlcXVpcmUoJy4vJC5leHBvcnQnKTsKJGV4cG9ydCgkZXhwb3J0LlMsICdPYmplY3QnLCB7c2V0UHJvdG90eXBlT2Y6IHJlcXVpcmUoJy4vJC5zZXQtcHJvdG8nKS5zZXR9KTsKfSx7Ii4vJC5leHBvcnQiOjM3LCIuLyQuc2V0LXByb3RvIjo2NX1dLDg1OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKCn0se31dLDg2OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKJ3VzZSBzdHJpY3QnOwp2YXIgJCAgICAgICAgICA9IHJlcXVpcmUoJy4vJCcpCiAgLCBMSUJSQVJZICAgID0gcmVxdWlyZSgnLi8kLmxpYnJhcnknKQogICwgZ2xvYmFsICAgICA9IHJlcXVpcmUoJy4vJC5nbG9iYWwnKQogICwgY3R4ICAgICAgICA9IHJlcXVpcmUoJy4vJC5jdHgnKQogICwgY2xhc3NvZiAgICA9IHJlcXVpcmUoJy4vJC5jbGFzc29mJykKICAsICRleHBvcnQgICAgPSByZXF1aXJlKCcuLyQuZXhwb3J0JykKICAsIGlzT2JqZWN0ICAgPSByZXF1aXJlKCcuLyQuaXMtb2JqZWN0JykKICAsIGFuT2JqZWN0ICAgPSByZXF1aXJlKCcuLyQuYW4tb2JqZWN0JykKICAsIGFGdW5jdGlvbiAgPSByZXF1aXJlKCcuLyQuYS1mdW5jdGlvbicpCiAgLCBzdHJpY3ROZXcgID0gcmVxdWlyZSgnLi8kLnN0cmljdC1uZXcnKQogICwgZm9yT2YgICAgICA9IHJlcXVpcmUoJy4vJC5mb3Itb2YnKQogICwgc2V0UHJvdG8gICA9IHJlcXVpcmUoJy4vJC5zZXQtcHJvdG8nKS5zZXQKICAsIHNhbWUgICAgICAgPSByZXF1aXJlKCcuLyQuc2FtZS12YWx1ZScpCiAgLCBTUEVDSUVTICAgID0gcmVxdWlyZSgnLi8kLndrcycpKCdzcGVjaWVzJykKICAsIHNwZWNpZXNDb25zdHJ1Y3RvciA9IHJlcXVpcmUoJy4vJC5zcGVjaWVzLWNvbnN0cnVjdG9yJykKICAsIGFzYXAgICAgICAgPSByZXF1aXJlKCcuLyQubWljcm90YXNrJykKICAsIFBST01JU0UgICAgPSAnUHJvbWlzZScKICAsIHByb2Nlc3MgICAgPSBnbG9iYWwucHJvY2VzcwogICwgaXNOb2RlICAgICA9IGNsYXNzb2YocHJvY2VzcykgPT0gJ3Byb2Nlc3MnCiAgLCBQICAgICAgICAgID0gZ2xvYmFsW1BST01JU0VdCiAgLCBXcmFwcGVyOwoKdmFyIHRlc3RSZXNvbHZlID0gZnVuY3Rpb24oc3ViKXsKICB2YXIgdGVzdCA9IG5ldyBQKGZ1bmN0aW9uKCl7fSk7CiAgaWYoc3ViKXRlc3QuY29uc3RydWN0b3IgPSBPYmplY3Q7CiAgcmV0dXJuIFAucmVzb2x2ZSh0ZXN0KSA9PT0gdGVzdDsKfTsKCnZhciBVU0VfTkFUSVZFID0gZnVuY3Rpb24oKXsKICB2YXIgd29ya3MgPSBmYWxzZTsKICBmdW5jdGlvbiBQMih4KXsKICAgIHZhciBzZWxmID0gbmV3IFAoeCk7CiAgICBzZXRQcm90byhzZWxmLCBQMi5wcm90b3R5cGUpOwogICAgcmV0dXJuIHNlbGY7CiAgfQogIHRyeSB7CiAgICB3b3JrcyA9IFAgJiYgUC5yZXNvbHZlICYmIHRlc3RSZXNvbHZlKCk7CiAgICBzZXRQcm90byhQMiwgUCk7CiAgICBQMi5wcm90b3R5cGUgPSAkLmNyZWF0ZShQLnByb3RvdHlwZSwge2NvbnN0cnVjdG9yOiB7dmFsdWU6IFAyfX0pOwogICAgLy8gYWN0dWFsIEZpcmVmb3ggaGFzIGJyb2tlbiBzdWJjbGFzcyBzdXBwb3J0LCB0ZXN0IHRoYXQKICAgIGlmKCEoUDIucmVzb2x2ZSg1KS50aGVuKGZ1bmN0aW9uKCl7fSkgaW5zdGFuY2VvZiBQMikpewogICAgICB3b3JrcyA9IGZhbHNlOwogICAgfQogICAgLy8gYWN0dWFsIFY4IGJ1ZywgaHR0cHM6Ly9jb2RlLmdvb2dsZS5jb20vcC92OC9pc3N1ZXMvZGV0YWlsP2lkPTQxNjIKICAgIGlmKHdvcmtzICYmIHJlcXVpcmUoJy4vJC5kZXNjcmlwdG9ycycpKXsKICAgICAgdmFyIHRoZW5hYmxlVGhlbkdvdHRlbiA9IGZhbHNlOwogICAgICBQLnJlc29sdmUoJC5zZXREZXNjKHt9LCAndGhlbicsIHsKICAgICAgICBnZXQ6IGZ1bmN0aW9uKCl7IHRoZW5hYmxlVGhlbkdvdHRlbiA9IHRydWU7IH0KICAgICAgfSkpOwogICAgICB3b3JrcyA9IHRoZW5hYmxlVGhlbkdvdHRlbjsKICAgIH0KICB9IGNhdGNoKGUpeyB3b3JrcyA9IGZhbHNlOyB9CiAgcmV0dXJuIHdvcmtzOwp9KCk7CgovLyBoZWxwZXJzCnZhciBzYW1lQ29uc3RydWN0b3IgPSBmdW5jdGlvbihhLCBiKXsKICAvLyBsaWJyYXJ5IHdyYXBwZXIgc3BlY2lhbCBjYXNlCiAgaWYoTElCUkFSWSAmJiBhID09PSBQICYmIGIgPT09IFdyYXBwZXIpcmV0dXJuIHRydWU7CiAgcmV0dXJuIHNhbWUoYSwgYik7Cn07CnZhciBnZXRDb25zdHJ1Y3RvciA9IGZ1bmN0aW9uKEMpewogIHZhciBTID0gYW5PYmplY3QoQylbU1BFQ0lFU107CiAgcmV0dXJuIFMgIT0gdW5kZWZpbmVkID8gUyA6IEM7Cn07CnZhciBpc1RoZW5hYmxlID0gZnVuY3Rpb24oaXQpewogIHZhciB0aGVuOwogIHJldHVybiBpc09iamVjdChpdCkgJiYgdHlwZW9mICh0aGVuID0gaXQudGhlbikgPT0gJ2Z1bmN0aW9uJyA/IHRoZW4gOiBmYWxzZTsKfTsKdmFyIFByb21pc2VDYXBhYmlsaXR5ID0gZnVuY3Rpb24oQyl7CiAgdmFyIHJlc29sdmUsIHJlamVjdDsKICB0aGlzLnByb21pc2UgPSBuZXcgQyhmdW5jdGlvbigkJHJlc29sdmUsICQkcmVqZWN0KXsKICAgIGlmKHJlc29sdmUgIT09IHVuZGVmaW5lZCB8fCByZWplY3QgIT09IHVuZGVmaW5lZCl0aHJvdyBUeXBlRXJyb3IoJ0JhZCBQcm9taXNlIGNvbnN0cnVjdG9yJyk7CiAgICByZXNvbHZlID0gJCRyZXNvbHZlOwogICAgcmVqZWN0ICA9ICQkcmVqZWN0OwogIH0pOwogIHRoaXMucmVzb2x2ZSA9IGFGdW5jdGlvbihyZXNvbHZlKSwKICB0aGlzLnJlamVjdCAgPSBhRnVuY3Rpb24ocmVqZWN0KQp9Owp2YXIgcGVyZm9ybSA9IGZ1bmN0aW9uKGV4ZWMpewogIHRyeSB7CiAgICBleGVjKCk7CiAgfSBjYXRjaChlKXsKICAgIHJldHVybiB7ZXJyb3I6IGV9OwogIH0KfTsKdmFyIG5vdGlmeSA9IGZ1bmN0aW9uKHJlY29yZCwgaXNSZWplY3QpewogIGlmKHJlY29yZC5uKXJldHVybjsKICByZWNvcmQubiA9IHRydWU7CiAgdmFyIGNoYWluID0gcmVjb3JkLmM7CiAgYXNhcChmdW5jdGlvbigpewogICAgdmFyIHZhbHVlID0gcmVjb3JkLnYKICAgICAgLCBvayAgICA9IHJlY29yZC5zID09IDEKICAgICAgLCBpICAgICA9IDA7CiAgICB2YXIgcnVuID0gZnVuY3Rpb24ocmVhY3Rpb24pewogICAgICB2YXIgaGFuZGxlciA9IG9rID8gcmVhY3Rpb24ub2sgOiByZWFjdGlvbi5mYWlsCiAgICAgICAgLCByZXNvbHZlID0gcmVhY3Rpb24ucmVzb2x2ZQogICAgICAgICwgcmVqZWN0ICA9IHJlYWN0aW9uLnJlamVjdAogICAgICAgICwgcmVzdWx0LCB0aGVuOwogICAgICB0cnkgewogICAgICAgIGlmKGhhbmRsZXIpewogICAgICAgICAgaWYoIW9rKXJlY29yZC5oID0gdHJ1ZTsKICAgICAgICAgIHJlc3VsdCA9IGhhbmRsZXIgPT09IHRydWUgPyB2YWx1ZSA6IGhhbmRsZXIodmFsdWUpOwogICAgICAgICAgaWYocmVzdWx0ID09PSByZWFjdGlvbi5wcm9taXNlKXsKICAgICAgICAgICAgcmVqZWN0KFR5cGVFcnJvcignUHJvbWlzZS1jaGFpbiBjeWNsZScpKTsKICAgICAgICAgIH0gZWxzZSBpZih0aGVuID0gaXNUaGVuYWJsZShyZXN1bHQpKXsKICAgICAgICAgICAgdGhlbi5jYWxsKHJlc3VsdCwgcmVzb2x2ZSwgcmVqZWN0KTsKICAgICAgICAgIH0gZWxzZSByZXNvbHZlKHJlc3VsdCk7CiAgICAgICAgfSBlbHNlIHJlamVjdCh2YWx1ZSk7CiAgICAgIH0gY2F0Y2goZSl7CiAgICAgICAgcmVqZWN0KGUpOwogICAgICB9CiAgICB9OwogICAgd2hpbGUoY2hhaW4ubGVuZ3RoID4gaSlydW4oY2hhaW5baSsrXSk7IC8vIHZhcmlhYmxlIGxlbmd0aCAtIGNhbid0IHVzZSBmb3JFYWNoCiAgICBjaGFpbi5sZW5ndGggPSAwOwogICAgcmVjb3JkLm4gPSBmYWxzZTsKICAgIGlmKGlzUmVqZWN0KXNldFRpbWVvdXQoZnVuY3Rpb24oKXsKICAgICAgdmFyIHByb21pc2UgPSByZWNvcmQucAogICAgICAgICwgaGFuZGxlciwgY29uc29sZTsKICAgICAgaWYoaXNVbmhhbmRsZWQocHJvbWlzZSkpewogICAgICAgIGlmKGlzTm9kZSl7CiAgICAgICAgICBwcm9jZXNzLmVtaXQoJ3VuaGFuZGxlZFJlamVjdGlvbicsIHZhbHVlLCBwcm9taXNlKTsKICAgICAgICB9IGVsc2UgaWYoaGFuZGxlciA9IGdsb2JhbC5vbnVuaGFuZGxlZHJlamVjdGlvbil7CiAgICAgICAgICBoYW5kbGVyKHtwcm9taXNlOiBwcm9taXNlLCByZWFzb246IHZhbHVlfSk7CiAgICAgICAgfSBlbHNlIGlmKChjb25zb2xlID0gZ2xvYmFsLmNvbnNvbGUpICYmIGNvbnNvbGUuZXJyb3IpewogICAgICAgICAgY29uc29sZS5lcnJvcignVW5oYW5kbGVkIHByb21pc2UgcmVqZWN0aW9uJywgdmFsdWUpOwogICAgICAgIH0KICAgICAgfSByZWNvcmQuYSA9IHVuZGVmaW5lZDsKICAgIH0sIDEpOwogIH0pOwp9Owp2YXIgaXNVbmhhbmRsZWQgPSBmdW5jdGlvbihwcm9taXNlKXsKICB2YXIgcmVjb3JkID0gcHJvbWlzZS5fZAogICAgLCBjaGFpbiAgPSByZWNvcmQuYSB8fCByZWNvcmQuYwogICAgLCBpICAgICAgPSAwCiAgICAsIHJlYWN0aW9uOwogIGlmKHJlY29yZC5oKXJldHVybiBmYWxzZTsKICB3aGlsZShjaGFpbi5sZW5ndGggPiBpKXsKICAgIHJlYWN0aW9uID0gY2hhaW5baSsrXTsKICAgIGlmKHJlYWN0aW9uLmZhaWwgfHwgIWlzVW5oYW5kbGVkKHJlYWN0aW9uLnByb21pc2UpKXJldHVybiBmYWxzZTsKICB9IHJldHVybiB0cnVlOwp9Owp2YXIgJHJlamVjdCA9IGZ1bmN0aW9uKHZhbHVlKXsKICB2YXIgcmVjb3JkID0gdGhpczsKICBpZihyZWNvcmQuZClyZXR1cm47CiAgcmVjb3JkLmQgPSB0cnVlOwogIHJlY29yZCA9IHJlY29yZC5yIHx8IHJlY29yZDsgLy8gdW53cmFwCiAgcmVjb3JkLnYgPSB2YWx1ZTsKICByZWNvcmQucyA9IDI7CiAgcmVjb3JkLmEgPSByZWNvcmQuYy5zbGljZSgpOwogIG5vdGlmeShyZWNvcmQsIHRydWUpOwp9Owp2YXIgJHJlc29sdmUgPSBmdW5jdGlvbih2YWx1ZSl7CiAgdmFyIHJlY29yZCA9IHRoaXMKICAgICwgdGhlbjsKICBpZihyZWNvcmQuZClyZXR1cm47CiAgcmVjb3JkLmQgPSB0cnVlOwogIHJlY29yZCA9IHJlY29yZC5yIHx8IHJlY29yZDsgLy8gdW53cmFwCiAgdHJ5IHsKICAgIGlmKHJlY29yZC5wID09PSB2YWx1ZSl0aHJvdyBUeXBlRXJyb3IoIlByb21pc2UgY2FuJ3QgYmUgcmVzb2x2ZWQgaXRzZWxmIik7CiAgICBpZih0aGVuID0gaXNUaGVuYWJsZSh2YWx1ZSkpewogICAgICBhc2FwKGZ1bmN0aW9uKCl7CiAgICAgICAgdmFyIHdyYXBwZXIgPSB7cjogcmVjb3JkLCBkOiBmYWxzZX07IC8vIHdyYXAKICAgICAgICB0cnkgewogICAgICAgICAgdGhlbi5jYWxsKHZhbHVlLCBjdHgoJHJlc29sdmUsIHdyYXBwZXIsIDEpLCBjdHgoJHJlamVjdCwgd3JhcHBlciwgMSkpOwogICAgICAgIH0gY2F0Y2goZSl7CiAgICAgICAgICAkcmVqZWN0LmNhbGwod3JhcHBlciwgZSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgIHJlY29yZC52ID0gdmFsdWU7CiAgICAgIHJlY29yZC5zID0gMTsKICAgICAgbm90aWZ5KHJlY29yZCwgZmFsc2UpOwogICAgfQogIH0gY2F0Y2goZSl7CiAgICAkcmVqZWN0LmNhbGwoe3I6IHJlY29yZCwgZDogZmFsc2V9LCBlKTsgLy8gd3JhcAogIH0KfTsKCi8vIGNvbnN0cnVjdG9yIHBvbHlmaWxsCmlmKCFVU0VfTkFUSVZFKXsKICAvLyAyNS40LjMuMSBQcm9taXNlKGV4ZWN1dG9yKQogIFAgPSBmdW5jdGlvbiBQcm9taXNlKGV4ZWN1dG9yKXsKICAgIGFGdW5jdGlvbihleGVjdXRvcik7CiAgICB2YXIgcmVjb3JkID0gdGhpcy5fZCA9IHsKICAgICAgcDogc3RyaWN0TmV3KHRoaXMsIFAsIFBST01JU0UpLCAgICAgICAgIC8vIDwtIHByb21pc2UKICAgICAgYzogW10sICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIDwtIGF3YWl0aW5nIHJlYWN0aW9ucwogICAgICBhOiB1bmRlZmluZWQsICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gPC0gY2hlY2tlZCBpbiBpc1VuaGFuZGxlZCByZWFjdGlvbnMKICAgICAgczogMCwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIDwtIHN0YXRlCiAgICAgIGQ6IGZhbHNlLCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyA8LSBkb25lCiAgICAgIHY6IHVuZGVmaW5lZCwgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyA8LSB2YWx1ZQogICAgICBoOiBmYWxzZSwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gPC0gaGFuZGxlZCByZWplY3Rpb24KICAgICAgbjogZmFsc2UgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIDwtIG5vdGlmeQogICAgfTsKICAgIHRyeSB7CiAgICAgIGV4ZWN1dG9yKGN0eCgkcmVzb2x2ZSwgcmVjb3JkLCAxKSwgY3R4KCRyZWplY3QsIHJlY29yZCwgMSkpOwogICAgfSBjYXRjaChlcnIpewogICAgICAkcmVqZWN0LmNhbGwocmVjb3JkLCBlcnIpOwogICAgfQogIH07CiAgcmVxdWlyZSgnLi8kLnJlZGVmaW5lLWFsbCcpKFAucHJvdG90eXBlLCB7CiAgICAvLyAyNS40LjUuMyBQcm9taXNlLnByb3RvdHlwZS50aGVuKG9uRnVsZmlsbGVkLCBvblJlamVjdGVkKQogICAgdGhlbjogZnVuY3Rpb24gdGhlbihvbkZ1bGZpbGxlZCwgb25SZWplY3RlZCl7CiAgICAgIHZhciByZWFjdGlvbiA9IG5ldyBQcm9taXNlQ2FwYWJpbGl0eShzcGVjaWVzQ29uc3RydWN0b3IodGhpcywgUCkpCiAgICAgICAgLCBwcm9taXNlICA9IHJlYWN0aW9uLnByb21pc2UKICAgICAgICAsIHJlY29yZCAgID0gdGhpcy5fZDsKICAgICAgcmVhY3Rpb24ub2sgICA9IHR5cGVvZiBvbkZ1bGZpbGxlZCA9PSAnZnVuY3Rpb24nID8gb25GdWxmaWxsZWQgOiB0cnVlOwogICAgICByZWFjdGlvbi5mYWlsID0gdHlwZW9mIG9uUmVqZWN0ZWQgPT0gJ2Z1bmN0aW9uJyAmJiBvblJlamVjdGVkOwogICAgICByZWNvcmQuYy5wdXNoKHJlYWN0aW9uKTsKICAgICAgaWYocmVjb3JkLmEpcmVjb3JkLmEucHVzaChyZWFjdGlvbik7CiAgICAgIGlmKHJlY29yZC5zKW5vdGlmeShyZWNvcmQsIGZhbHNlKTsKICAgICAgcmV0dXJuIHByb21pc2U7CiAgICB9LAogICAgLy8gMjUuNC41LjEgUHJvbWlzZS5wcm90b3R5cGUuY2F0Y2gob25SZWplY3RlZCkKICAgICdjYXRjaCc6IGZ1bmN0aW9uKG9uUmVqZWN0ZWQpewogICAgICByZXR1cm4gdGhpcy50aGVuKHVuZGVmaW5lZCwgb25SZWplY3RlZCk7CiAgICB9CiAgfSk7Cn0KCiRleHBvcnQoJGV4cG9ydC5HICsgJGV4cG9ydC5XICsgJGV4cG9ydC5GICogIVVTRV9OQVRJVkUsIHtQcm9taXNlOiBQfSk7CnJlcXVpcmUoJy4vJC5zZXQtdG8tc3RyaW5nLXRhZycpKFAsIFBST01JU0UpOwpyZXF1aXJlKCcuLyQuc2V0LXNwZWNpZXMnKShQUk9NSVNFKTsKV3JhcHBlciA9IHJlcXVpcmUoJy4vJC5jb3JlJylbUFJPTUlTRV07CgovLyBzdGF0aWNzCiRleHBvcnQoJGV4cG9ydC5TICsgJGV4cG9ydC5GICogIVVTRV9OQVRJVkUsIFBST01JU0UsIHsKICAvLyAyNS40LjQuNSBQcm9taXNlLnJlamVjdChyKQogIHJlamVjdDogZnVuY3Rpb24gcmVqZWN0KHIpewogICAgdmFyIGNhcGFiaWxpdHkgPSBuZXcgUHJvbWlzZUNhcGFiaWxpdHkodGhpcykKICAgICAgLCAkJHJlamVjdCAgID0gY2FwYWJpbGl0eS5yZWplY3Q7CiAgICAkJHJlamVjdChyKTsKICAgIHJldHVybiBjYXBhYmlsaXR5LnByb21pc2U7CiAgfQp9KTsKJGV4cG9ydCgkZXhwb3J0LlMgKyAkZXhwb3J0LkYgKiAoIVVTRV9OQVRJVkUgfHwgdGVzdFJlc29sdmUodHJ1ZSkpLCBQUk9NSVNFLCB7CiAgLy8gMjUuNC40LjYgUHJvbWlzZS5yZXNvbHZlKHgpCiAgcmVzb2x2ZTogZnVuY3Rpb24gcmVzb2x2ZSh4KXsKICAgIC8vIGluc3RhbmNlb2YgaW5zdGVhZCBvZiBpbnRlcm5hbCBzbG90IGNoZWNrIGJlY2F1c2Ugd2Ugc2hvdWxkIGZpeCBpdCB3aXRob3V0IHJlcGxhY2VtZW50IG5hdGl2ZSBQcm9taXNlIGNvcmUKICAgIGlmKHggaW5zdGFuY2VvZiBQICYmIHNhbWVDb25zdHJ1Y3Rvcih4LmNvbnN0cnVjdG9yLCB0aGlzKSlyZXR1cm4geDsKICAgIHZhciBjYXBhYmlsaXR5ID0gbmV3IFByb21pc2VDYXBhYmlsaXR5KHRoaXMpCiAgICAgICwgJCRyZXNvbHZlICA9IGNhcGFiaWxpdHkucmVzb2x2ZTsKICAgICQkcmVzb2x2ZSh4KTsKICAgIHJldHVybiBjYXBhYmlsaXR5LnByb21pc2U7CiAgfQp9KTsKJGV4cG9ydCgkZXhwb3J0LlMgKyAkZXhwb3J0LkYgKiAhKFVTRV9OQVRJVkUgJiYgcmVxdWlyZSgnLi8kLml0ZXItZGV0ZWN0JykoZnVuY3Rpb24oaXRlcil7CiAgUC5hbGwoaXRlcilbJ2NhdGNoJ10oZnVuY3Rpb24oKXt9KTsKfSkpLCBQUk9NSVNFLCB7CiAgLy8gMjUuNC40LjEgUHJvbWlzZS5hbGwoaXRlcmFibGUpCiAgYWxsOiBmdW5jdGlvbiBhbGwoaXRlcmFibGUpewogICAgdmFyIEMgICAgICAgICAgPSBnZXRDb25zdHJ1Y3Rvcih0aGlzKQogICAgICAsIGNhcGFiaWxpdHkgPSBuZXcgUHJvbWlzZUNhcGFiaWxpdHkoQykKICAgICAgLCByZXNvbHZlICAgID0gY2FwYWJpbGl0eS5yZXNvbHZlCiAgICAgICwgcmVqZWN0ICAgICA9IGNhcGFiaWxpdHkucmVqZWN0CiAgICAgICwgdmFsdWVzICAgICA9IFtdOwogICAgdmFyIGFicnVwdCA9IHBlcmZvcm0oZnVuY3Rpb24oKXsKICAgICAgZm9yT2YoaXRlcmFibGUsIGZhbHNlLCB2YWx1ZXMucHVzaCwgdmFsdWVzKTsKICAgICAgdmFyIHJlbWFpbmluZyA9IHZhbHVlcy5sZW5ndGgKICAgICAgICAsIHJlc3VsdHMgICA9IEFycmF5KHJlbWFpbmluZyk7CiAgICAgIGlmKHJlbWFpbmluZykkLmVhY2guY2FsbCh2YWx1ZXMsIGZ1bmN0aW9uKHByb21pc2UsIGluZGV4KXsKICAgICAgICB2YXIgYWxyZWFkeUNhbGxlZCA9IGZhbHNlOwogICAgICAgIEMucmVzb2x2ZShwcm9taXNlKS50aGVuKGZ1bmN0aW9uKHZhbHVlKXsKICAgICAgICAgIGlmKGFscmVhZHlDYWxsZWQpcmV0dXJuOwogICAgICAgICAgYWxyZWFkeUNhbGxlZCA9IHRydWU7CiAgICAgICAgICByZXN1bHRzW2luZGV4XSA9IHZhbHVlOwogICAgICAgICAgLS1yZW1haW5pbmcgfHwgcmVzb2x2ZShyZXN1bHRzKTsKICAgICAgICB9LCByZWplY3QpOwogICAgICB9KTsKICAgICAgZWxzZSByZXNvbHZlKHJlc3VsdHMpOwogICAgfSk7CiAgICBpZihhYnJ1cHQpcmVqZWN0KGFicnVwdC5lcnJvcik7CiAgICByZXR1cm4gY2FwYWJpbGl0eS5wcm9taXNlOwogIH0sCiAgLy8gMjUuNC40LjQgUHJvbWlzZS5yYWNlKGl0ZXJhYmxlKQogIHJhY2U6IGZ1bmN0aW9uIHJhY2UoaXRlcmFibGUpewogICAgdmFyIEMgICAgICAgICAgPSBnZXRDb25zdHJ1Y3Rvcih0aGlzKQogICAgICAsIGNhcGFiaWxpdHkgPSBuZXcgUHJvbWlzZUNhcGFiaWxpdHkoQykKICAgICAgLCByZWplY3QgICAgID0gY2FwYWJpbGl0eS5yZWplY3Q7CiAgICB2YXIgYWJydXB0ID0gcGVyZm9ybShmdW5jdGlvbigpewogICAgICBmb3JPZihpdGVyYWJsZSwgZmFsc2UsIGZ1bmN0aW9uKHByb21pc2UpewogICAgICAgIEMucmVzb2x2ZShwcm9taXNlKS50aGVuKGNhcGFiaWxpdHkucmVzb2x2ZSwgcmVqZWN0KTsKICAgICAgfSk7CiAgICB9KTsKICAgIGlmKGFicnVwdClyZWplY3QoYWJydXB0LmVycm9yKTsKICAgIHJldHVybiBjYXBhYmlsaXR5LnByb21pc2U7CiAgfQp9KTsKfSx7Ii4vJCI6NTYsIi4vJC5hLWZ1bmN0aW9uIjoyNiwiLi8kLmFuLW9iamVjdCI6MjgsIi4vJC5jbGFzc29mIjoyOSwiLi8kLmNvcmUiOjMxLCIuLyQuY3R4IjozMiwiLi8kLmRlc2NyaXB0b3JzIjozNCwiLi8kLmV4cG9ydCI6MzcsIi4vJC5mb3Itb2YiOjM5LCIuLyQuZ2xvYmFsIjo0MSwiLi8kLmlzLW9iamVjdCI6NDksIi4vJC5pdGVyLWRldGVjdCI6NTMsIi4vJC5saWJyYXJ5Ijo1OCwiLi8kLm1pY3JvdGFzayI6NTksIi4vJC5yZWRlZmluZS1hbGwiOjYyLCIuLyQuc2FtZS12YWx1ZSI6NjQsIi4vJC5zZXQtcHJvdG8iOjY1LCIuLyQuc2V0LXNwZWNpZXMiOjY2LCIuLyQuc2V0LXRvLXN0cmluZy10YWciOjY3LCIuLyQuc3BlY2llcy1jb25zdHJ1Y3RvciI6NjksIi4vJC5zdHJpY3QtbmV3Ijo3MCwiLi8kLndrcyI6Nzh9XSw4NzpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Cid1c2Ugc3RyaWN0JzsKdmFyICRhdCAgPSByZXF1aXJlKCcuLyQuc3RyaW5nLWF0JykodHJ1ZSk7CgovLyAyMS4xLjMuMjcgU3RyaW5nLnByb3RvdHlwZVtAQGl0ZXJhdG9yXSgpCnJlcXVpcmUoJy4vJC5pdGVyLWRlZmluZScpKFN0cmluZywgJ1N0cmluZycsIGZ1bmN0aW9uKGl0ZXJhdGVkKXsKICB0aGlzLl90ID0gU3RyaW5nKGl0ZXJhdGVkKTsgLy8gdGFyZ2V0CiAgdGhpcy5faSA9IDA7ICAgICAgICAgICAgICAgIC8vIG5leHQgaW5kZXgKLy8gMjEuMS41LjIuMSAlU3RyaW5nSXRlcmF0b3JQcm90b3R5cGUlLm5leHQoKQp9LCBmdW5jdGlvbigpewogIHZhciBPICAgICA9IHRoaXMuX3QKICAgICwgaW5kZXggPSB0aGlzLl9pCiAgICAsIHBvaW50OwogIGlmKGluZGV4ID49IE8ubGVuZ3RoKXJldHVybiB7dmFsdWU6IHVuZGVmaW5lZCwgZG9uZTogdHJ1ZX07CiAgcG9pbnQgPSAkYXQoTywgaW5kZXgpOwogIHRoaXMuX2kgKz0gcG9pbnQubGVuZ3RoOwogIHJldHVybiB7dmFsdWU6IHBvaW50LCBkb25lOiBmYWxzZX07Cn0pOwp9LHsiLi8kLml0ZXItZGVmaW5lIjo1MiwiLi8kLnN0cmluZy1hdCI6NzF9XSw4ODpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Cid1c2Ugc3RyaWN0JzsKLy8gRUNNQVNjcmlwdCA2IHN5bWJvbHMgc2hpbQp2YXIgJCAgICAgICAgICAgICAgPSByZXF1aXJlKCcuLyQnKQogICwgZ2xvYmFsICAgICAgICAgPSByZXF1aXJlKCcuLyQuZ2xvYmFsJykKICAsIGhhcyAgICAgICAgICAgID0gcmVxdWlyZSgnLi8kLmhhcycpCiAgLCBERVNDUklQVE9SUyAgICA9IHJlcXVpcmUoJy4vJC5kZXNjcmlwdG9ycycpCiAgLCAkZXhwb3J0ICAgICAgICA9IHJlcXVpcmUoJy4vJC5leHBvcnQnKQogICwgcmVkZWZpbmUgICAgICAgPSByZXF1aXJlKCcuLyQucmVkZWZpbmUnKQogICwgJGZhaWxzICAgICAgICAgPSByZXF1aXJlKCcuLyQuZmFpbHMnKQogICwgc2hhcmVkICAgICAgICAgPSByZXF1aXJlKCcuLyQuc2hhcmVkJykKICAsIHNldFRvU3RyaW5nVGFnID0gcmVxdWlyZSgnLi8kLnNldC10by1zdHJpbmctdGFnJykKICAsIHVpZCAgICAgICAgICAgID0gcmVxdWlyZSgnLi8kLnVpZCcpCiAgLCB3a3MgICAgICAgICAgICA9IHJlcXVpcmUoJy4vJC53a3MnKQogICwga2V5T2YgICAgICAgICAgPSByZXF1aXJlKCcuLyQua2V5b2YnKQogICwgJG5hbWVzICAgICAgICAgPSByZXF1aXJlKCcuLyQuZ2V0LW5hbWVzJykKICAsIGVudW1LZXlzICAgICAgID0gcmVxdWlyZSgnLi8kLmVudW0ta2V5cycpCiAgLCBpc0FycmF5ICAgICAgICA9IHJlcXVpcmUoJy4vJC5pcy1hcnJheScpCiAgLCBhbk9iamVjdCAgICAgICA9IHJlcXVpcmUoJy4vJC5hbi1vYmplY3QnKQogICwgdG9JT2JqZWN0ICAgICAgPSByZXF1aXJlKCcuLyQudG8taW9iamVjdCcpCiAgLCBjcmVhdGVEZXNjICAgICA9IHJlcXVpcmUoJy4vJC5wcm9wZXJ0eS1kZXNjJykKICAsIGdldERlc2MgICAgICAgID0gJC5nZXREZXNjCiAgLCBzZXREZXNjICAgICAgICA9ICQuc2V0RGVzYwogICwgX2NyZWF0ZSAgICAgICAgPSAkLmNyZWF0ZQogICwgZ2V0TmFtZXMgICAgICAgPSAkbmFtZXMuZ2V0CiAgLCAkU3ltYm9sICAgICAgICA9IGdsb2JhbC5TeW1ib2wKICAsICRKU09OICAgICAgICAgID0gZ2xvYmFsLkpTT04KICAsIF9zdHJpbmdpZnkgICAgID0gJEpTT04gJiYgJEpTT04uc3RyaW5naWZ5CiAgLCBzZXR0ZXIgICAgICAgICA9IGZhbHNlCiAgLCBISURERU4gICAgICAgICA9IHdrcygnX2hpZGRlbicpCiAgLCBpc0VudW0gICAgICAgICA9ICQuaXNFbnVtCiAgLCBTeW1ib2xSZWdpc3RyeSA9IHNoYXJlZCgnc3ltYm9sLXJlZ2lzdHJ5JykKICAsIEFsbFN5bWJvbHMgICAgID0gc2hhcmVkKCdzeW1ib2xzJykKICAsIHVzZU5hdGl2ZSAgICAgID0gdHlwZW9mICRTeW1ib2wgPT0gJ2Z1bmN0aW9uJwogICwgT2JqZWN0UHJvdG8gICAgPSBPYmplY3QucHJvdG90eXBlOwoKLy8gZmFsbGJhY2sgZm9yIG9sZCBBbmRyb2lkLCBodHRwczovL2NvZGUuZ29vZ2xlLmNvbS9wL3Y4L2lzc3Vlcy9kZXRhaWw/aWQ9Njg3CnZhciBzZXRTeW1ib2xEZXNjID0gREVTQ1JJUFRPUlMgJiYgJGZhaWxzKGZ1bmN0aW9uKCl7CiAgcmV0dXJuIF9jcmVhdGUoc2V0RGVzYyh7fSwgJ2EnLCB7CiAgICBnZXQ6IGZ1bmN0aW9uKCl7IHJldHVybiBzZXREZXNjKHRoaXMsICdhJywge3ZhbHVlOiA3fSkuYTsgfQogIH0pKS5hICE9IDc7Cn0pID8gZnVuY3Rpb24oaXQsIGtleSwgRCl7CiAgdmFyIHByb3RvRGVzYyA9IGdldERlc2MoT2JqZWN0UHJvdG8sIGtleSk7CiAgaWYocHJvdG9EZXNjKWRlbGV0ZSBPYmplY3RQcm90b1trZXldOwogIHNldERlc2MoaXQsIGtleSwgRCk7CiAgaWYocHJvdG9EZXNjICYmIGl0ICE9PSBPYmplY3RQcm90bylzZXREZXNjKE9iamVjdFByb3RvLCBrZXksIHByb3RvRGVzYyk7Cn0gOiBzZXREZXNjOwoKdmFyIHdyYXAgPSBmdW5jdGlvbih0YWcpewogIHZhciBzeW0gPSBBbGxTeW1ib2xzW3RhZ10gPSBfY3JlYXRlKCRTeW1ib2wucHJvdG90eXBlKTsKICBzeW0uX2sgPSB0YWc7CiAgREVTQ1JJUFRPUlMgJiYgc2V0dGVyICYmIHNldFN5bWJvbERlc2MoT2JqZWN0UHJvdG8sIHRhZywgewogICAgY29uZmlndXJhYmxlOiB0cnVlLAogICAgc2V0OiBmdW5jdGlvbih2YWx1ZSl7CiAgICAgIGlmKGhhcyh0aGlzLCBISURERU4pICYmIGhhcyh0aGlzW0hJRERFTl0sIHRhZykpdGhpc1tISURERU5dW3RhZ10gPSBmYWxzZTsKICAgICAgc2V0U3ltYm9sRGVzYyh0aGlzLCB0YWcsIGNyZWF0ZURlc2MoMSwgdmFsdWUpKTsKICAgIH0KICB9KTsKICByZXR1cm4gc3ltOwp9OwoKdmFyIGlzU3ltYm9sID0gZnVuY3Rpb24oaXQpewogIHJldHVybiB0eXBlb2YgaXQgPT0gJ3N5bWJvbCc7Cn07Cgp2YXIgJGRlZmluZVByb3BlcnR5ID0gZnVuY3Rpb24gZGVmaW5lUHJvcGVydHkoaXQsIGtleSwgRCl7CiAgaWYoRCAmJiBoYXMoQWxsU3ltYm9scywga2V5KSl7CiAgICBpZighRC5lbnVtZXJhYmxlKXsKICAgICAgaWYoIWhhcyhpdCwgSElEREVOKSlzZXREZXNjKGl0LCBISURERU4sIGNyZWF0ZURlc2MoMSwge30pKTsKICAgICAgaXRbSElEREVOXVtrZXldID0gdHJ1ZTsKICAgIH0gZWxzZSB7CiAgICAgIGlmKGhhcyhpdCwgSElEREVOKSAmJiBpdFtISURERU5dW2tleV0paXRbSElEREVOXVtrZXldID0gZmFsc2U7CiAgICAgIEQgPSBfY3JlYXRlKEQsIHtlbnVtZXJhYmxlOiBjcmVhdGVEZXNjKDAsIGZhbHNlKX0pOwogICAgfSByZXR1cm4gc2V0U3ltYm9sRGVzYyhpdCwga2V5LCBEKTsKICB9IHJldHVybiBzZXREZXNjKGl0LCBrZXksIEQpOwp9Owp2YXIgJGRlZmluZVByb3BlcnRpZXMgPSBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0aWVzKGl0LCBQKXsKICBhbk9iamVjdChpdCk7CiAgdmFyIGtleXMgPSBlbnVtS2V5cyhQID0gdG9JT2JqZWN0KFApKQogICAgLCBpICAgID0gMAogICAgLCBsID0ga2V5cy5sZW5ndGgKICAgICwga2V5OwogIHdoaWxlKGwgPiBpKSRkZWZpbmVQcm9wZXJ0eShpdCwga2V5ID0ga2V5c1tpKytdLCBQW2tleV0pOwogIHJldHVybiBpdDsKfTsKdmFyICRjcmVhdGUgPSBmdW5jdGlvbiBjcmVhdGUoaXQsIFApewogIHJldHVybiBQID09PSB1bmRlZmluZWQgPyBfY3JlYXRlKGl0KSA6ICRkZWZpbmVQcm9wZXJ0aWVzKF9jcmVhdGUoaXQpLCBQKTsKfTsKdmFyICRwcm9wZXJ0eUlzRW51bWVyYWJsZSA9IGZ1bmN0aW9uIHByb3BlcnR5SXNFbnVtZXJhYmxlKGtleSl7CiAgdmFyIEUgPSBpc0VudW0uY2FsbCh0aGlzLCBrZXkpOwogIHJldHVybiBFIHx8ICFoYXModGhpcywga2V5KSB8fCAhaGFzKEFsbFN5bWJvbHMsIGtleSkgfHwgaGFzKHRoaXMsIEhJRERFTikgJiYgdGhpc1tISURERU5dW2tleV0KICAgID8gRSA6IHRydWU7Cn07CnZhciAkZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yID0gZnVuY3Rpb24gZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKGl0LCBrZXkpewogIHZhciBEID0gZ2V0RGVzYyhpdCA9IHRvSU9iamVjdChpdCksIGtleSk7CiAgaWYoRCAmJiBoYXMoQWxsU3ltYm9scywga2V5KSAmJiAhKGhhcyhpdCwgSElEREVOKSAmJiBpdFtISURERU5dW2tleV0pKUQuZW51bWVyYWJsZSA9IHRydWU7CiAgcmV0dXJuIEQ7Cn07CnZhciAkZ2V0T3duUHJvcGVydHlOYW1lcyA9IGZ1bmN0aW9uIGdldE93blByb3BlcnR5TmFtZXMoaXQpewogIHZhciBuYW1lcyAgPSBnZXROYW1lcyh0b0lPYmplY3QoaXQpKQogICAgLCByZXN1bHQgPSBbXQogICAgLCBpICAgICAgPSAwCiAgICAsIGtleTsKICB3aGlsZShuYW1lcy5sZW5ndGggPiBpKWlmKCFoYXMoQWxsU3ltYm9scywga2V5ID0gbmFtZXNbaSsrXSkgJiYga2V5ICE9IEhJRERFTilyZXN1bHQucHVzaChrZXkpOwogIHJldHVybiByZXN1bHQ7Cn07CnZhciAkZ2V0T3duUHJvcGVydHlTeW1ib2xzID0gZnVuY3Rpb24gZ2V0T3duUHJvcGVydHlTeW1ib2xzKGl0KXsKICB2YXIgbmFtZXMgID0gZ2V0TmFtZXModG9JT2JqZWN0KGl0KSkKICAgICwgcmVzdWx0ID0gW10KICAgICwgaSAgICAgID0gMAogICAgLCBrZXk7CiAgd2hpbGUobmFtZXMubGVuZ3RoID4gaSlpZihoYXMoQWxsU3ltYm9scywga2V5ID0gbmFtZXNbaSsrXSkpcmVzdWx0LnB1c2goQWxsU3ltYm9sc1trZXldKTsKICByZXR1cm4gcmVzdWx0Owp9Owp2YXIgJHN0cmluZ2lmeSA9IGZ1bmN0aW9uIHN0cmluZ2lmeShpdCl7CiAgaWYoaXQgPT09IHVuZGVmaW5lZCB8fCBpc1N5bWJvbChpdCkpcmV0dXJuOyAvLyBJRTggcmV0dXJucyBzdHJpbmcgb24gdW5kZWZpbmVkCiAgdmFyIGFyZ3MgPSBbaXRdCiAgICAsIGkgICAgPSAxCiAgICAsICQkICAgPSBhcmd1bWVudHMKICAgICwgcmVwbGFjZXIsICRyZXBsYWNlcjsKICB3aGlsZSgkJC5sZW5ndGggPiBpKWFyZ3MucHVzaCgkJFtpKytdKTsKICByZXBsYWNlciA9IGFyZ3NbMV07CiAgaWYodHlwZW9mIHJlcGxhY2VyID09ICdmdW5jdGlvbicpJHJlcGxhY2VyID0gcmVwbGFjZXI7CiAgaWYoJHJlcGxhY2VyIHx8ICFpc0FycmF5KHJlcGxhY2VyKSlyZXBsYWNlciA9IGZ1bmN0aW9uKGtleSwgdmFsdWUpewogICAgaWYoJHJlcGxhY2VyKXZhbHVlID0gJHJlcGxhY2VyLmNhbGwodGhpcywga2V5LCB2YWx1ZSk7CiAgICBpZighaXNTeW1ib2wodmFsdWUpKXJldHVybiB2YWx1ZTsKICB9OwogIGFyZ3NbMV0gPSByZXBsYWNlcjsKICByZXR1cm4gX3N0cmluZ2lmeS5hcHBseSgkSlNPTiwgYXJncyk7Cn07CnZhciBidWdneUpTT04gPSAkZmFpbHMoZnVuY3Rpb24oKXsKICB2YXIgUyA9ICRTeW1ib2woKTsKICAvLyBNUyBFZGdlIGNvbnZlcnRzIHN5bWJvbCB2YWx1ZXMgdG8gSlNPTiBhcyB7fQogIC8vIFdlYktpdCBjb252ZXJ0cyBzeW1ib2wgdmFsdWVzIHRvIEpTT04gYXMgbnVsbAogIC8vIFY4IHRocm93cyBvbiBib3hlZCBzeW1ib2xzCiAgcmV0dXJuIF9zdHJpbmdpZnkoW1NdKSAhPSAnW251bGxdJyB8fCBfc3RyaW5naWZ5KHthOiBTfSkgIT0gJ3t9JyB8fCBfc3RyaW5naWZ5KE9iamVjdChTKSkgIT0gJ3t9JzsKfSk7CgovLyAxOS40LjEuMSBTeW1ib2woW2Rlc2NyaXB0aW9uXSkKaWYoIXVzZU5hdGl2ZSl7CiAgJFN5bWJvbCA9IGZ1bmN0aW9uIFN5bWJvbCgpewogICAgaWYoaXNTeW1ib2wodGhpcykpdGhyb3cgVHlwZUVycm9yKCdTeW1ib2wgaXMgbm90IGEgY29uc3RydWN0b3InKTsKICAgIHJldHVybiB3cmFwKHVpZChhcmd1bWVudHMubGVuZ3RoID4gMCA/IGFyZ3VtZW50c1swXSA6IHVuZGVmaW5lZCkpOwogIH07CiAgcmVkZWZpbmUoJFN5bWJvbC5wcm90b3R5cGUsICd0b1N0cmluZycsIGZ1bmN0aW9uIHRvU3RyaW5nKCl7CiAgICByZXR1cm4gdGhpcy5fazsKICB9KTsKCiAgaXNTeW1ib2wgPSBmdW5jdGlvbihpdCl7CiAgICByZXR1cm4gaXQgaW5zdGFuY2VvZiAkU3ltYm9sOwogIH07CgogICQuY3JlYXRlICAgICA9ICRjcmVhdGU7CiAgJC5pc0VudW0gICAgID0gJHByb3BlcnR5SXNFbnVtZXJhYmxlOwogICQuZ2V0RGVzYyAgICA9ICRnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3I7CiAgJC5zZXREZXNjICAgID0gJGRlZmluZVByb3BlcnR5OwogICQuc2V0RGVzY3MgICA9ICRkZWZpbmVQcm9wZXJ0aWVzOwogICQuZ2V0TmFtZXMgICA9ICRuYW1lcy5nZXQgPSAkZ2V0T3duUHJvcGVydHlOYW1lczsKICAkLmdldFN5bWJvbHMgPSAkZ2V0T3duUHJvcGVydHlTeW1ib2xzOwoKICBpZihERVNDUklQVE9SUyAmJiAhcmVxdWlyZSgnLi8kLmxpYnJhcnknKSl7CiAgICByZWRlZmluZShPYmplY3RQcm90bywgJ3Byb3BlcnR5SXNFbnVtZXJhYmxlJywgJHByb3BlcnR5SXNFbnVtZXJhYmxlLCB0cnVlKTsKICB9Cn0KCnZhciBzeW1ib2xTdGF0aWNzID0gewogIC8vIDE5LjQuMi4xIFN5bWJvbC5mb3Ioa2V5KQogICdmb3InOiBmdW5jdGlvbihrZXkpewogICAgcmV0dXJuIGhhcyhTeW1ib2xSZWdpc3RyeSwga2V5ICs9ICcnKQogICAgICA/IFN5bWJvbFJlZ2lzdHJ5W2tleV0KICAgICAgOiBTeW1ib2xSZWdpc3RyeVtrZXldID0gJFN5bWJvbChrZXkpOwogIH0sCiAgLy8gMTkuNC4yLjUgU3ltYm9sLmtleUZvcihzeW0pCiAga2V5Rm9yOiBmdW5jdGlvbiBrZXlGb3Ioa2V5KXsKICAgIHJldHVybiBrZXlPZihTeW1ib2xSZWdpc3RyeSwga2V5KTsKICB9LAogIHVzZVNldHRlcjogZnVuY3Rpb24oKXsgc2V0dGVyID0gdHJ1ZTsgfSwKICB1c2VTaW1wbGU6IGZ1bmN0aW9uKCl7IHNldHRlciA9IGZhbHNlOyB9Cn07Ci8vIDE5LjQuMi4yIFN5bWJvbC5oYXNJbnN0YW5jZQovLyAxOS40LjIuMyBTeW1ib2wuaXNDb25jYXRTcHJlYWRhYmxlCi8vIDE5LjQuMi40IFN5bWJvbC5pdGVyYXRvcgovLyAxOS40LjIuNiBTeW1ib2wubWF0Y2gKLy8gMTkuNC4yLjggU3ltYm9sLnJlcGxhY2UKLy8gMTkuNC4yLjkgU3ltYm9sLnNlYXJjaAovLyAxOS40LjIuMTAgU3ltYm9sLnNwZWNpZXMKLy8gMTkuNC4yLjExIFN5bWJvbC5zcGxpdAovLyAxOS40LjIuMTIgU3ltYm9sLnRvUHJpbWl0aXZlCi8vIDE5LjQuMi4xMyBTeW1ib2wudG9TdHJpbmdUYWcKLy8gMTkuNC4yLjE0IFN5bWJvbC51bnNjb3BhYmxlcwokLmVhY2guY2FsbCgoCiAgJ2hhc0luc3RhbmNlLGlzQ29uY2F0U3ByZWFkYWJsZSxpdGVyYXRvcixtYXRjaCxyZXBsYWNlLHNlYXJjaCwnICsKICAnc3BlY2llcyxzcGxpdCx0b1ByaW1pdGl2ZSx0b1N0cmluZ1RhZyx1bnNjb3BhYmxlcycKKS5zcGxpdCgnLCcpLCBmdW5jdGlvbihpdCl7CiAgdmFyIHN5bSA9IHdrcyhpdCk7CiAgc3ltYm9sU3RhdGljc1tpdF0gPSB1c2VOYXRpdmUgPyBzeW0gOiB3cmFwKHN5bSk7Cn0pOwoKc2V0dGVyID0gdHJ1ZTsKCiRleHBvcnQoJGV4cG9ydC5HICsgJGV4cG9ydC5XLCB7U3ltYm9sOiAkU3ltYm9sfSk7CgokZXhwb3J0KCRleHBvcnQuUywgJ1N5bWJvbCcsIHN5bWJvbFN0YXRpY3MpOwoKJGV4cG9ydCgkZXhwb3J0LlMgKyAkZXhwb3J0LkYgKiAhdXNlTmF0aXZlLCAnT2JqZWN0JywgewogIC8vIDE5LjEuMi4yIE9iamVjdC5jcmVhdGUoTyBbLCBQcm9wZXJ0aWVzXSkKICBjcmVhdGU6ICRjcmVhdGUsCiAgLy8gMTkuMS4yLjQgT2JqZWN0LmRlZmluZVByb3BlcnR5KE8sIFAsIEF0dHJpYnV0ZXMpCiAgZGVmaW5lUHJvcGVydHk6ICRkZWZpbmVQcm9wZXJ0eSwKICAvLyAxOS4xLjIuMyBPYmplY3QuZGVmaW5lUHJvcGVydGllcyhPLCBQcm9wZXJ0aWVzKQogIGRlZmluZVByb3BlcnRpZXM6ICRkZWZpbmVQcm9wZXJ0aWVzLAogIC8vIDE5LjEuMi42IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTywgUCkKICBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3I6ICRnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IsCiAgLy8gMTkuMS4yLjcgT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMoTykKICBnZXRPd25Qcm9wZXJ0eU5hbWVzOiAkZ2V0T3duUHJvcGVydHlOYW1lcywKICAvLyAxOS4xLjIuOCBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKE8pCiAgZ2V0T3duUHJvcGVydHlTeW1ib2xzOiAkZ2V0T3duUHJvcGVydHlTeW1ib2xzCn0pOwoKLy8gMjQuMy4yIEpTT04uc3RyaW5naWZ5KHZhbHVlIFssIHJlcGxhY2VyIFssIHNwYWNlXV0pCiRKU09OICYmICRleHBvcnQoJGV4cG9ydC5TICsgJGV4cG9ydC5GICogKCF1c2VOYXRpdmUgfHwgYnVnZ3lKU09OKSwgJ0pTT04nLCB7c3RyaW5naWZ5OiAkc3RyaW5naWZ5fSk7CgovLyAxOS40LjMuNSBTeW1ib2wucHJvdG90eXBlW0BAdG9TdHJpbmdUYWddCnNldFRvU3RyaW5nVGFnKCRTeW1ib2wsICdTeW1ib2wnKTsKLy8gMjAuMi4xLjkgTWF0aFtAQHRvU3RyaW5nVGFnXQpzZXRUb1N0cmluZ1RhZyhNYXRoLCAnTWF0aCcsIHRydWUpOwovLyAyNC4zLjMgSlNPTltAQHRvU3RyaW5nVGFnXQpzZXRUb1N0cmluZ1RhZyhnbG9iYWwuSlNPTiwgJ0pTT04nLCB0cnVlKTsKfSx7Ii4vJCI6NTYsIi4vJC5hbi1vYmplY3QiOjI4LCIuLyQuZGVzY3JpcHRvcnMiOjM0LCIuLyQuZW51bS1rZXlzIjozNiwiLi8kLmV4cG9ydCI6MzcsIi4vJC5mYWlscyI6MzgsIi4vJC5nZXQtbmFtZXMiOjQwLCIuLyQuZ2xvYmFsIjo0MSwiLi8kLmhhcyI6NDIsIi4vJC5pcy1hcnJheSI6NDgsIi4vJC5rZXlvZiI6NTcsIi4vJC5saWJyYXJ5Ijo1OCwiLi8kLnByb3BlcnR5LWRlc2MiOjYxLCIuLyQucmVkZWZpbmUiOjYzLCIuLyQuc2V0LXRvLXN0cmluZy10YWciOjY3LCIuLyQuc2hhcmVkIjo2OCwiLi8kLnRvLWlvYmplY3QiOjc0LCIuLyQudWlkIjo3NywiLi8kLndrcyI6Nzh9XSw4OTpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7CnJlcXVpcmUoJy4vZXM2LmFycmF5Lml0ZXJhdG9yJyk7CnZhciBJdGVyYXRvcnMgPSByZXF1aXJlKCcuLyQuaXRlcmF0b3JzJyk7Ckl0ZXJhdG9ycy5Ob2RlTGlzdCA9IEl0ZXJhdG9ycy5IVE1MQ29sbGVjdGlvbiA9IEl0ZXJhdG9ycy5BcnJheTsKfSx7Ii4vJC5pdGVyYXRvcnMiOjU1LCIuL2VzNi5hcnJheS5pdGVyYXRvciI6ODB9XSw5MDpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Ci8qCiAqICBDb3B5cmlnaHQgKGMpIDIwMTQgVGhlIFdlYlJUQyBwcm9qZWN0IGF1dGhvcnMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuCiAqCiAqICBVc2Ugb2YgdGhpcyBzb3VyY2UgY29kZSBpcyBnb3Zlcm5lZCBieSBhIEJTRC1zdHlsZSBsaWNlbnNlCiAqICB0aGF0IGNhbiBiZSBmb3VuZCBpbiB0aGUgTElDRU5TRSBmaWxlIGluIHRoZSByb290IG9mIHRoZSBzb3VyY2UKICogIHRyZWUuCiAqLwoKLyogTW9yZSBpbmZvcm1hdGlvbiBhYm91dCB0aGVzZSBvcHRpb25zIGF0IGpzaGludC5jb20vZG9jcy9vcHRpb25zICovCi8qIGpzaGludCBicm93c2VyOiB0cnVlLCBjYW1lbGNhc2U6IHRydWUsIGN1cmx5OiB0cnVlLCBkZXZlbDogdHJ1ZSwKICAgZXFlcWVxOiB0cnVlLCBmb3JpbjogZmFsc2UsIGdsb2JhbHN0cmljdDogdHJ1ZSwgbm9kZTogdHJ1ZSwKICAgcXVvdG1hcms6IHNpbmdsZSwgdW5kZWY6IHRydWUsIHVudXNlZDogc3RyaWN0ICovCi8qIGdsb2JhbCBtb3pSVENJY2VDYW5kaWRhdGUsIG1velJUQ1BlZXJDb25uZWN0aW9uLCBQcm9taXNlLAptb3pSVENTZXNzaW9uRGVzY3JpcHRpb24sIHdlYmtpdFJUQ1BlZXJDb25uZWN0aW9uLCBNZWRpYVN0cmVhbVRyYWNrICovCi8qIGV4cG9ydGVkIHRyYWNlLHJlcXVlc3RVc2VyTWVkaWEgKi8KCid1c2Ugc3RyaWN0JzsKCnZhciBnZXRVc2VyTWVkaWEgPSBudWxsOwp2YXIgYXR0YWNoTWVkaWFTdHJlYW0gPSBudWxsOwp2YXIgcmVhdHRhY2hNZWRpYVN0cmVhbSA9IG51bGw7CnZhciB3ZWJydGNEZXRlY3RlZEJyb3dzZXIgPSBudWxsOwp2YXIgd2VicnRjRGV0ZWN0ZWRWZXJzaW9uID0gbnVsbDsKdmFyIHdlYnJ0Y01pbmltdW1WZXJzaW9uID0gbnVsbDsKdmFyIHdlYnJ0Y1V0aWxzID0gewogIGxvZzogZnVuY3Rpb24oKSB7CiAgICAvLyBzdXBwcmVzcyBjb25zb2xlLmxvZyBvdXRwdXQgd2hlbiBiZWluZyBpbmNsdWRlZCBhcyBhIG1vZHVsZS4KICAgIGlmICh0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJyB8fAogICAgICAgIHR5cGVvZiByZXF1aXJlID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc29sZS5sb2cuYXBwbHkoY29uc29sZSwgYXJndW1lbnRzKTsKICB9LAogIGV4dHJhY3RWZXJzaW9uOiBmdW5jdGlvbih1YXN0cmluZywgZXhwciwgcG9zKSB7CiAgICB2YXIgbWF0Y2ggPSB1YXN0cmluZy5tYXRjaChleHByKTsKICAgIHJldHVybiBtYXRjaCAmJiBtYXRjaC5sZW5ndGggPj0gcG9zICYmIHBhcnNlSW50KG1hdGNoW3Bvc10pOwogIH0KfTsKCmZ1bmN0aW9uIHRyYWNlKHRleHQpIHsKICAvLyBUaGlzIGZ1bmN0aW9uIGlzIHVzZWQgZm9yIGxvZ2dpbmcuCiAgaWYgKHRleHRbdGV4dC5sZW5ndGggLSAxXSA9PT0gJ1xuJykgewogICAgdGV4dCA9IHRleHQuc3Vic3RyaW5nKDAsIHRleHQubGVuZ3RoIC0gMSk7CiAgfQogIGlmICh3aW5kb3cucGVyZm9ybWFuY2UpIHsKICAgIHZhciBub3cgPSAod2luZG93LnBlcmZvcm1hbmNlLm5vdygpIC8gMTAwMCkudG9GaXhlZCgzKTsKICAgIHdlYnJ0Y1V0aWxzLmxvZyhub3cgKyAnOiAnICsgdGV4dCk7CiAgfSBlbHNlIHsKICAgIHdlYnJ0Y1V0aWxzLmxvZyh0ZXh0KTsKICB9Cn0KCmlmICh0eXBlb2Ygd2luZG93ID09PSAnb2JqZWN0JykgewogIGlmICh3aW5kb3cuSFRNTE1lZGlhRWxlbWVudCAmJgogICAgISgnc3JjT2JqZWN0JyBpbiB3aW5kb3cuSFRNTE1lZGlhRWxlbWVudC5wcm90b3R5cGUpKSB7CiAgICAvLyBTaGltIHRoZSBzcmNPYmplY3QgcHJvcGVydHksIG9uY2UsIHdoZW4gSFRNTE1lZGlhRWxlbWVudCBpcyBmb3VuZC4KICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh3aW5kb3cuSFRNTE1lZGlhRWxlbWVudC5wcm90b3R5cGUsICdzcmNPYmplY3QnLCB7CiAgICAgIGdldDogZnVuY3Rpb24oKSB7CiAgICAgICAgLy8gSWYgcHJlZml4ZWQgc3JjT2JqZWN0IHByb3BlcnR5IGV4aXN0cywgcmV0dXJuIGl0LgogICAgICAgIC8vIE90aGVyd2lzZSB1c2UgdGhlIHNoaW1tZWQgcHJvcGVydHksIF9zcmNPYmplY3QKICAgICAgICByZXR1cm4gJ21velNyY09iamVjdCcgaW4gdGhpcyA/IHRoaXMubW96U3JjT2JqZWN0IDogdGhpcy5fc3JjT2JqZWN0OwogICAgICB9LAogICAgICBzZXQ6IGZ1bmN0aW9uKHN0cmVhbSkgewogICAgICAgIGlmICgnbW96U3JjT2JqZWN0JyBpbiB0aGlzKSB7CiAgICAgICAgICB0aGlzLm1velNyY09iamVjdCA9IHN0cmVhbTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgLy8gVXNlIF9zcmNPYmplY3QgYXMgYSBwcml2YXRlIHByb3BlcnR5IGZvciB0aGlzIHNoaW0KICAgICAgICAgIHRoaXMuX3NyY09iamVjdCA9IHN0cmVhbTsKICAgICAgICAgIC8vIFRPRE86IHJldm9rZU9iamVjdFVybCh0aGlzLnNyYykgd2hlbiAhc3RyZWFtIHRvIHJlbGVhc2UgcmVzb3VyY2VzPwogICAgICAgICAgdGhpcy5zcmMgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKHN0cmVhbSk7CiAgICAgICAgfQogICAgICB9CiAgICB9KTsKICB9CiAgLy8gUHJveHkgZXhpc3RpbmcgZ2xvYmFscwogIGdldFVzZXJNZWRpYSA9IHdpbmRvdy5uYXZpZ2F0b3IgJiYgd2luZG93Lm5hdmlnYXRvci5nZXRVc2VyTWVkaWE7Cn0KCi8vIEF0dGFjaCBhIG1lZGlhIHN0cmVhbSB0byBhbiBlbGVtZW50LgphdHRhY2hNZWRpYVN0cmVhbSA9IGZ1bmN0aW9uKGVsZW1lbnQsIHN0cmVhbSkgewogIGVsZW1lbnQuc3JjT2JqZWN0ID0gc3RyZWFtOwp9OwoKcmVhdHRhY2hNZWRpYVN0cmVhbSA9IGZ1bmN0aW9uKHRvLCBmcm9tKSB7CiAgdG8uc3JjT2JqZWN0ID0gZnJvbS5zcmNPYmplY3Q7Cn07CgppZiAodHlwZW9mIHdpbmRvdyA9PT0gJ3VuZGVmaW5lZCcgfHwgIXdpbmRvdy5uYXZpZ2F0b3IpIHsKICB3ZWJydGNVdGlscy5sb2coJ1RoaXMgZG9lcyBub3QgYXBwZWFyIHRvIGJlIGEgYnJvd3NlcicpOwogIHdlYnJ0Y0RldGVjdGVkQnJvd3NlciA9ICdub3QgYSBicm93c2VyJzsKfSBlbHNlIGlmIChuYXZpZ2F0b3IubW96R2V0VXNlck1lZGlhICYmIHdpbmRvdy5tb3pSVENQZWVyQ29ubmVjdGlvbikgewogIHdlYnJ0Y1V0aWxzLmxvZygnVGhpcyBhcHBlYXJzIHRvIGJlIEZpcmVmb3gnKTsKCiAgd2VicnRjRGV0ZWN0ZWRCcm93c2VyID0gJ2ZpcmVmb3gnOwoKICAvLyB0aGUgZGV0ZWN0ZWQgZmlyZWZveCB2ZXJzaW9uLgogIHdlYnJ0Y0RldGVjdGVkVmVyc2lvbiA9IHdlYnJ0Y1V0aWxzLmV4dHJhY3RWZXJzaW9uKG5hdmlnYXRvci51c2VyQWdlbnQsCiAgICAgIC9GaXJlZm94XC8oWzAtOV0rKVwuLywgMSk7CgogIC8vIHRoZSBtaW5pbXVtIGZpcmVmb3ggdmVyc2lvbiBzdGlsbCBzdXBwb3J0ZWQgYnkgYWRhcHRlci4KICB3ZWJydGNNaW5pbXVtVmVyc2lvbiA9IDMxOwoKICAvLyBUaGUgUlRDUGVlckNvbm5lY3Rpb24gb2JqZWN0LgogIHdpbmRvdy5SVENQZWVyQ29ubmVjdGlvbiA9IGZ1bmN0aW9uKHBjQ29uZmlnLCBwY0NvbnN0cmFpbnRzKSB7CiAgICBpZiAod2VicnRjRGV0ZWN0ZWRWZXJzaW9uIDwgMzgpIHsKICAgICAgLy8gLnVybHMgaXMgbm90IHN1cHBvcnRlZCBpbiBGRiA8IDM4LgogICAgICAvLyBjcmVhdGUgUlRDSWNlU2VydmVycyB3aXRoIGEgc2luZ2xlIHVybC4KICAgICAgaWYgKHBjQ29uZmlnICYmIHBjQ29uZmlnLmljZVNlcnZlcnMpIHsKICAgICAgICB2YXIgbmV3SWNlU2VydmVycyA9IFtdOwogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcGNDb25maWcuaWNlU2VydmVycy5sZW5ndGg7IGkrKykgewogICAgICAgICAgdmFyIHNlcnZlciA9IHBjQ29uZmlnLmljZVNlcnZlcnNbaV07CiAgICAgICAgICBpZiAoc2VydmVyLmhhc093blByb3BlcnR5KCd1cmxzJykpIHsKICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBzZXJ2ZXIudXJscy5sZW5ndGg7IGorKykgewogICAgICAgICAgICAgIHZhciBuZXdTZXJ2ZXIgPSB7CiAgICAgICAgICAgICAgICB1cmw6IHNlcnZlci51cmxzW2pdCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICBpZiAoc2VydmVyLnVybHNbal0uaW5kZXhPZigndHVybicpID09PSAwKSB7CiAgICAgICAgICAgICAgICBuZXdTZXJ2ZXIudXNlcm5hbWUgPSBzZXJ2ZXIudXNlcm5hbWU7CiAgICAgICAgICAgICAgICBuZXdTZXJ2ZXIuY3JlZGVudGlhbCA9IHNlcnZlci5jcmVkZW50aWFsOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBuZXdJY2VTZXJ2ZXJzLnB1c2gobmV3U2VydmVyKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbmV3SWNlU2VydmVycy5wdXNoKHBjQ29uZmlnLmljZVNlcnZlcnNbaV0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBwY0NvbmZpZy5pY2VTZXJ2ZXJzID0gbmV3SWNlU2VydmVyczsKICAgICAgfQogICAgfQogICAgcmV0dXJuIG5ldyBtb3pSVENQZWVyQ29ubmVjdGlvbihwY0NvbmZpZywgcGNDb25zdHJhaW50cyk7IC8vIGpzY3M6aWdub3JlIHJlcXVpcmVDYXBpdGFsaXplZENvbnN0cnVjdG9ycwogIH07CgogIC8vIFRoZSBSVENTZXNzaW9uRGVzY3JpcHRpb24gb2JqZWN0LgogIGlmICghd2luZG93LlJUQ1Nlc3Npb25EZXNjcmlwdGlvbikgewogICAgd2luZG93LlJUQ1Nlc3Npb25EZXNjcmlwdGlvbiA9IG1velJUQ1Nlc3Npb25EZXNjcmlwdGlvbjsKICB9CgogIC8vIFRoZSBSVENJY2VDYW5kaWRhdGUgb2JqZWN0LgogIGlmICghd2luZG93LlJUQ0ljZUNhbmRpZGF0ZSkgewogICAgd2luZG93LlJUQ0ljZUNhbmRpZGF0ZSA9IG1velJUQ0ljZUNhbmRpZGF0ZTsKICB9CgogIC8vIGdldFVzZXJNZWRpYSBjb25zdHJhaW50cyBzaGltLgogIGdldFVzZXJNZWRpYSA9IGZ1bmN0aW9uKGNvbnN0cmFpbnRzLCBvblN1Y2Nlc3MsIG9uRXJyb3IpIHsKICAgIHZhciBjb25zdHJhaW50c1RvRkYzNyA9IGZ1bmN0aW9uKGMpIHsKICAgICAgaWYgKHR5cGVvZiBjICE9PSAnb2JqZWN0JyB8fCBjLnJlcXVpcmUpIHsKICAgICAgICByZXR1cm4gYzsKICAgICAgfQogICAgICB2YXIgcmVxdWlyZSA9IFtdOwogICAgICBPYmplY3Qua2V5cyhjKS5mb3JFYWNoKGZ1bmN0aW9uKGtleSkgewogICAgICAgIGlmIChrZXkgPT09ICdyZXF1aXJlJyB8fCBrZXkgPT09ICdhZHZhbmNlZCcgfHwga2V5ID09PSAnbWVkaWFTb3VyY2UnKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHZhciByID0gY1trZXldID0gKHR5cGVvZiBjW2tleV0gPT09ICdvYmplY3QnKSA/CiAgICAgICAgICAgIGNba2V5XSA6IHtpZGVhbDogY1trZXldfTsKICAgICAgICBpZiAoci5taW4gIT09IHVuZGVmaW5lZCB8fAogICAgICAgICAgICByLm1heCAhPT0gdW5kZWZpbmVkIHx8IHIuZXhhY3QgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgcmVxdWlyZS5wdXNoKGtleSk7CiAgICAgICAgfQogICAgICAgIGlmIChyLmV4YWN0ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIGlmICh0eXBlb2Ygci5leGFjdCA9PT0gJ251bWJlcicpIHsKICAgICAgICAgICAgci5taW4gPSByLm1heCA9IHIuZXhhY3Q7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjW2tleV0gPSByLmV4YWN0OwogICAgICAgICAgfQogICAgICAgICAgZGVsZXRlIHIuZXhhY3Q7CiAgICAgICAgfQogICAgICAgIGlmIChyLmlkZWFsICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIGMuYWR2YW5jZWQgPSBjLmFkdmFuY2VkIHx8IFtdOwogICAgICAgICAgdmFyIG9jID0ge307CiAgICAgICAgICBpZiAodHlwZW9mIHIuaWRlYWwgPT09ICdudW1iZXInKSB7CiAgICAgICAgICAgIG9jW2tleV0gPSB7bWluOiByLmlkZWFsLCBtYXg6IHIuaWRlYWx9OwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgb2Nba2V5XSA9IHIuaWRlYWw7CiAgICAgICAgICB9CiAgICAgICAgICBjLmFkdmFuY2VkLnB1c2gob2MpOwogICAgICAgICAgZGVsZXRlIHIuaWRlYWw7CiAgICAgICAgICBpZiAoIU9iamVjdC5rZXlzKHIpLmxlbmd0aCkgewogICAgICAgICAgICBkZWxldGUgY1trZXldOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICAgIGlmIChyZXF1aXJlLmxlbmd0aCkgewogICAgICAgIGMucmVxdWlyZSA9IHJlcXVpcmU7CiAgICAgIH0KICAgICAgcmV0dXJuIGM7CiAgICB9OwogICAgaWYgKHdlYnJ0Y0RldGVjdGVkVmVyc2lvbiA8IDM4KSB7CiAgICAgIHdlYnJ0Y1V0aWxzLmxvZygnc3BlYzogJyArIEpTT04uc3RyaW5naWZ5KGNvbnN0cmFpbnRzKSk7CiAgICAgIGlmIChjb25zdHJhaW50cy5hdWRpbykgewogICAgICAgIGNvbnN0cmFpbnRzLmF1ZGlvID0gY29uc3RyYWludHNUb0ZGMzcoY29uc3RyYWludHMuYXVkaW8pOwogICAgICB9CiAgICAgIGlmIChjb25zdHJhaW50cy52aWRlbykgewogICAgICAgIGNvbnN0cmFpbnRzLnZpZGVvID0gY29uc3RyYWludHNUb0ZGMzcoY29uc3RyYWludHMudmlkZW8pOwogICAgICB9CiAgICAgIHdlYnJ0Y1V0aWxzLmxvZygnZmYzNzogJyArIEpTT04uc3RyaW5naWZ5KGNvbnN0cmFpbnRzKSk7CiAgICB9CiAgICByZXR1cm4gbmF2aWdhdG9yLm1vekdldFVzZXJNZWRpYShjb25zdHJhaW50cywgb25TdWNjZXNzLCBvbkVycm9yKTsKICB9OwoKICBuYXZpZ2F0b3IuZ2V0VXNlck1lZGlhID0gZ2V0VXNlck1lZGlhOwoKICAvLyBTaGltIGZvciBtZWRpYURldmljZXMgb24gb2xkZXIgdmVyc2lvbnMuCiAgaWYgKCFuYXZpZ2F0b3IubWVkaWFEZXZpY2VzKSB7CiAgICBuYXZpZ2F0b3IubWVkaWFEZXZpY2VzID0ge2dldFVzZXJNZWRpYTogcmVxdWVzdFVzZXJNZWRpYSwKICAgICAgYWRkRXZlbnRMaXN0ZW5lcjogZnVuY3Rpb24oKSB7IH0sCiAgICAgIHJlbW92ZUV2ZW50TGlzdGVuZXI6IGZ1bmN0aW9uKCkgeyB9CiAgICB9OwogIH0KICBuYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmVudW1lcmF0ZURldmljZXMgPQogICAgICBuYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmVudW1lcmF0ZURldmljZXMgfHwgZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSkgewogICAgICB2YXIgaW5mb3MgPSBbCiAgICAgICAge2tpbmQ6ICdhdWRpb2lucHV0JywgZGV2aWNlSWQ6ICdkZWZhdWx0JywgbGFiZWw6ICcnLCBncm91cElkOiAnJ30sCiAgICAgICAge2tpbmQ6ICd2aWRlb2lucHV0JywgZGV2aWNlSWQ6ICdkZWZhdWx0JywgbGFiZWw6ICcnLCBncm91cElkOiAnJ30KICAgICAgXTsKICAgICAgcmVzb2x2ZShpbmZvcyk7CiAgICB9KTsKICB9OwoKICBpZiAod2VicnRjRGV0ZWN0ZWRWZXJzaW9uIDwgNDEpIHsKICAgIC8vIFdvcmsgYXJvdW5kIGh0dHA6Ly9idWd6aWwubGEvMTE2OTY2NQogICAgdmFyIG9yZ0VudW1lcmF0ZURldmljZXMgPQogICAgICAgIG5hdmlnYXRvci5tZWRpYURldmljZXMuZW51bWVyYXRlRGV2aWNlcy5iaW5kKG5hdmlnYXRvci5tZWRpYURldmljZXMpOwogICAgbmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5lbnVtZXJhdGVEZXZpY2VzID0gZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBvcmdFbnVtZXJhdGVEZXZpY2VzKCkudGhlbih1bmRlZmluZWQsIGZ1bmN0aW9uKGUpIHsKICAgICAgICBpZiAoZS5uYW1lID09PSAnTm90Rm91bmRFcnJvcicpIHsKICAgICAgICAgIHJldHVybiBbXTsKICAgICAgICB9CiAgICAgICAgdGhyb3cgZTsKICAgICAgfSk7CiAgICB9OwogIH0KfSBlbHNlIGlmIChuYXZpZ2F0b3Iud2Via2l0R2V0VXNlck1lZGlhICYmIHdpbmRvdy53ZWJraXRSVENQZWVyQ29ubmVjdGlvbikgewogIHdlYnJ0Y1V0aWxzLmxvZygnVGhpcyBhcHBlYXJzIHRvIGJlIENocm9tZScpOwoKICB3ZWJydGNEZXRlY3RlZEJyb3dzZXIgPSAnY2hyb21lJzsKCiAgLy8gdGhlIGRldGVjdGVkIGNocm9tZSB2ZXJzaW9uLgogIHdlYnJ0Y0RldGVjdGVkVmVyc2lvbiA9IHdlYnJ0Y1V0aWxzLmV4dHJhY3RWZXJzaW9uKG5hdmlnYXRvci51c2VyQWdlbnQsCiAgICAgIC9DaHJvbShlfGl1bSlcLyhbMC05XSspXC4vLCAyKTsKCiAgLy8gdGhlIG1pbmltdW0gY2hyb21lIHZlcnNpb24gc3RpbGwgc3VwcG9ydGVkIGJ5IGFkYXB0ZXIuCiAgd2VicnRjTWluaW11bVZlcnNpb24gPSAzODsKCiAgLy8gVGhlIFJUQ1BlZXJDb25uZWN0aW9uIG9iamVjdC4KICB3aW5kb3cuUlRDUGVlckNvbm5lY3Rpb24gPSBmdW5jdGlvbihwY0NvbmZpZywgcGNDb25zdHJhaW50cykgewogICAgLy8gVHJhbnNsYXRlIGljZVRyYW5zcG9ydFBvbGljeSB0byBpY2VUcmFuc3BvcnRzLAogICAgLy8gc2VlIGh0dHBzOi8vY29kZS5nb29nbGUuY29tL3Avd2VicnRjL2lzc3Vlcy9kZXRhaWw/aWQ9NDg2OQogICAgaWYgKHBjQ29uZmlnICYmIHBjQ29uZmlnLmljZVRyYW5zcG9ydFBvbGljeSkgewogICAgICBwY0NvbmZpZy5pY2VUcmFuc3BvcnRzID0gcGNDb25maWcuaWNlVHJhbnNwb3J0UG9saWN5OwogICAgfQoKICAgIHZhciBwYyA9IG5ldyB3ZWJraXRSVENQZWVyQ29ubmVjdGlvbihwY0NvbmZpZywgcGNDb25zdHJhaW50cyk7IC8vIGpzY3M6aWdub3JlIHJlcXVpcmVDYXBpdGFsaXplZENvbnN0cnVjdG9ycwogICAgdmFyIG9yaWdHZXRTdGF0cyA9IHBjLmdldFN0YXRzLmJpbmQocGMpOwogICAgcGMuZ2V0U3RhdHMgPSBmdW5jdGlvbihzZWxlY3Rvciwgc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrKSB7IC8vIGpzaGludCBpZ25vcmU6IGxpbmUKICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICB2YXIgYXJncyA9IGFyZ3VtZW50czsKCiAgICAgIC8vIElmIHNlbGVjdG9yIGlzIGEgZnVuY3Rpb24gdGhlbiB3ZSBhcmUgaW4gdGhlIG9sZCBzdHlsZSBzdGF0cyBzbyBqdXN0CiAgICAgIC8vIHBhc3MgYmFjayB0aGUgb3JpZ2luYWwgZ2V0U3RhdHMgZm9ybWF0IHRvIGF2b2lkIGJyZWFraW5nIG9sZCB1c2Vycy4KICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIHR5cGVvZiBzZWxlY3RvciA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgIHJldHVybiBvcmlnR2V0U3RhdHMoc2VsZWN0b3IsIHN1Y2Nlc3NDYWxsYmFjayk7CiAgICAgIH0KCiAgICAgIHZhciBmaXhDaHJvbWVTdGF0cyA9IGZ1bmN0aW9uKHJlc3BvbnNlKSB7CiAgICAgICAgdmFyIHN0YW5kYXJkUmVwb3J0ID0ge307CiAgICAgICAgdmFyIHJlcG9ydHMgPSByZXNwb25zZS5yZXN1bHQoKTsKICAgICAgICByZXBvcnRzLmZvckVhY2goZnVuY3Rpb24ocmVwb3J0KSB7CiAgICAgICAgICB2YXIgc3RhbmRhcmRTdGF0cyA9IHsKICAgICAgICAgICAgaWQ6IHJlcG9ydC5pZCwKICAgICAgICAgICAgdGltZXN0YW1wOiByZXBvcnQudGltZXN0YW1wLAogICAgICAgICAgICB0eXBlOiByZXBvcnQudHlwZQogICAgICAgICAgfTsKICAgICAgICAgIHJlcG9ydC5uYW1lcygpLmZvckVhY2goZnVuY3Rpb24obmFtZSkgewogICAgICAgICAgICBzdGFuZGFyZFN0YXRzW25hbWVdID0gcmVwb3J0LnN0YXQobmFtZSk7CiAgICAgICAgICB9KTsKICAgICAgICAgIHN0YW5kYXJkUmVwb3J0W3N0YW5kYXJkU3RhdHMuaWRdID0gc3RhbmRhcmRTdGF0czsKICAgICAgICB9KTsKCiAgICAgICAgcmV0dXJuIHN0YW5kYXJkUmVwb3J0OwogICAgICB9OwoKICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPj0gMikgewogICAgICAgIHZhciBzdWNjZXNzQ2FsbGJhY2tXcmFwcGVyID0gZnVuY3Rpb24ocmVzcG9uc2UpIHsKICAgICAgICAgIGFyZ3NbMV0oZml4Q2hyb21lU3RhdHMocmVzcG9uc2UpKTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gb3JpZ0dldFN0YXRzLmFwcGx5KHRoaXMsIFtzdWNjZXNzQ2FsbGJhY2tXcmFwcGVyLCBhcmd1bWVudHNbMF1dKTsKICAgICAgfQoKICAgICAgLy8gcHJvbWlzZS1zdXBwb3J0CiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHsKICAgICAgICBpZiAoYXJncy5sZW5ndGggPT09IDEgJiYgc2VsZWN0b3IgPT09IG51bGwpIHsKICAgICAgICAgIG9yaWdHZXRTdGF0cy5hcHBseShzZWxmLCBbCiAgICAgICAgICAgICAgZnVuY3Rpb24ocmVzcG9uc2UpIHsKICAgICAgICAgICAgICAgIHJlc29sdmUuYXBwbHkobnVsbCwgW2ZpeENocm9tZVN0YXRzKHJlc3BvbnNlKV0pOwogICAgICAgICAgICAgIH0sIHJlamVjdF0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBvcmlnR2V0U3RhdHMuYXBwbHkoc2VsZiwgW3Jlc29sdmUsIHJlamVjdF0pOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9OwoKICAgIHJldHVybiBwYzsKICB9OwoKICAvLyBhZGQgcHJvbWlzZSBzdXBwb3J0CiAgWydjcmVhdGVPZmZlcicsICdjcmVhdGVBbnN3ZXInXS5mb3JFYWNoKGZ1bmN0aW9uKG1ldGhvZCkgewogICAgdmFyIG5hdGl2ZU1ldGhvZCA9IHdlYmtpdFJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZVttZXRob2RdOwogICAgd2Via2l0UlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlW21ldGhvZF0gPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA8IDEgfHwgKGFyZ3VtZW50cy5sZW5ndGggPT09IDEgJiYKICAgICAgICAgIHR5cGVvZihhcmd1bWVudHNbMF0pID09PSAnb2JqZWN0JykpIHsKICAgICAgICB2YXIgb3B0cyA9IGFyZ3VtZW50cy5sZW5ndGggPT09IDEgPyBhcmd1bWVudHNbMF0gOiB1bmRlZmluZWQ7CiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgICAgbmF0aXZlTWV0aG9kLmFwcGx5KHNlbGYsIFtyZXNvbHZlLCByZWplY3QsIG9wdHNdKTsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gbmF0aXZlTWV0aG9kLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KICAgIH07CiAgfSk7CgogIFsnc2V0TG9jYWxEZXNjcmlwdGlvbicsICdzZXRSZW1vdGVEZXNjcmlwdGlvbicsCiAgICAgICdhZGRJY2VDYW5kaWRhdGUnXS5mb3JFYWNoKGZ1bmN0aW9uKG1ldGhvZCkgewogICAgdmFyIG5hdGl2ZU1ldGhvZCA9IHdlYmtpdFJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZVttZXRob2RdOwogICAgd2Via2l0UlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlW21ldGhvZF0gPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIGFyZ3MgPSBhcmd1bWVudHM7CiAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgIG5hdGl2ZU1ldGhvZC5hcHBseShzZWxmLCBbYXJnc1swXSwKICAgICAgICAgICAgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgcmVzb2x2ZSgpOwogICAgICAgICAgICAgIGlmIChhcmdzLmxlbmd0aCA+PSAyKSB7CiAgICAgICAgICAgICAgICBhcmdzWzFdLmFwcGx5KG51bGwsIFtdKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGZ1bmN0aW9uKGVycikgewogICAgICAgICAgICAgIHJlamVjdChlcnIpOwogICAgICAgICAgICAgIGlmIChhcmdzLmxlbmd0aCA+PSAzKSB7CiAgICAgICAgICAgICAgICBhcmdzWzJdLmFwcGx5KG51bGwsIFtlcnJdKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH1dCiAgICAgICAgICApOwogICAgICB9KTsKICAgIH07CiAgfSk7CgogIC8vIGdldFVzZXJNZWRpYSBjb25zdHJhaW50cyBzaGltLgogIHZhciBjb25zdHJhaW50c1RvQ2hyb21lID0gZnVuY3Rpb24oYykgewogICAgaWYgKHR5cGVvZiBjICE9PSAnb2JqZWN0JyB8fCBjLm1hbmRhdG9yeSB8fCBjLm9wdGlvbmFsKSB7CiAgICAgIHJldHVybiBjOwogICAgfQogICAgdmFyIGNjID0ge307CiAgICBPYmplY3Qua2V5cyhjKS5mb3JFYWNoKGZ1bmN0aW9uKGtleSkgewogICAgICBpZiAoa2V5ID09PSAncmVxdWlyZScgfHwga2V5ID09PSAnYWR2YW5jZWQnIHx8IGtleSA9PT0gJ21lZGlhU291cmNlJykgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICB2YXIgciA9ICh0eXBlb2YgY1trZXldID09PSAnb2JqZWN0JykgPyBjW2tleV0gOiB7aWRlYWw6IGNba2V5XX07CiAgICAgIGlmIChyLmV4YWN0ICE9PSB1bmRlZmluZWQgJiYgdHlwZW9mIHIuZXhhY3QgPT09ICdudW1iZXInKSB7CiAgICAgICAgci5taW4gPSByLm1heCA9IHIuZXhhY3Q7CiAgICAgIH0KICAgICAgdmFyIG9sZG5hbWUgPSBmdW5jdGlvbihwcmVmaXgsIG5hbWUpIHsKICAgICAgICBpZiAocHJlZml4KSB7CiAgICAgICAgICByZXR1cm4gcHJlZml4ICsgbmFtZS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIG5hbWUuc2xpY2UoMSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiAobmFtZSA9PT0gJ2RldmljZUlkJykgPyAnc291cmNlSWQnIDogbmFtZTsKICAgICAgfTsKICAgICAgaWYgKHIuaWRlYWwgIT09IHVuZGVmaW5lZCkgewogICAgICAgIGNjLm9wdGlvbmFsID0gY2Mub3B0aW9uYWwgfHwgW107CiAgICAgICAgdmFyIG9jID0ge307CiAgICAgICAgaWYgKHR5cGVvZiByLmlkZWFsID09PSAnbnVtYmVyJykgewogICAgICAgICAgb2Nbb2xkbmFtZSgnbWluJywga2V5KV0gPSByLmlkZWFsOwogICAgICAgICAgY2Mub3B0aW9uYWwucHVzaChvYyk7CiAgICAgICAgICBvYyA9IHt9OwogICAgICAgICAgb2Nbb2xkbmFtZSgnbWF4Jywga2V5KV0gPSByLmlkZWFsOwogICAgICAgICAgY2Mub3B0aW9uYWwucHVzaChvYyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG9jW29sZG5hbWUoJycsIGtleSldID0gci5pZGVhbDsKICAgICAgICAgIGNjLm9wdGlvbmFsLnB1c2gob2MpOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoci5leGFjdCAhPT0gdW5kZWZpbmVkICYmIHR5cGVvZiByLmV4YWN0ICE9PSAnbnVtYmVyJykgewogICAgICAgIGNjLm1hbmRhdG9yeSA9IGNjLm1hbmRhdG9yeSB8fCB7fTsKICAgICAgICBjYy5tYW5kYXRvcnlbb2xkbmFtZSgnJywga2V5KV0gPSByLmV4YWN0OwogICAgICB9IGVsc2UgewogICAgICAgIFsnbWluJywgJ21heCddLmZvckVhY2goZnVuY3Rpb24obWl4KSB7CiAgICAgICAgICBpZiAoclttaXhdICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgY2MubWFuZGF0b3J5ID0gY2MubWFuZGF0b3J5IHx8IHt9OwogICAgICAgICAgICBjYy5tYW5kYXRvcnlbb2xkbmFtZShtaXgsIGtleSldID0gclttaXhdOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CiAgICB9KTsKICAgIGlmIChjLmFkdmFuY2VkKSB7CiAgICAgIGNjLm9wdGlvbmFsID0gKGNjLm9wdGlvbmFsIHx8IFtdKS5jb25jYXQoYy5hZHZhbmNlZCk7CiAgICB9CiAgICByZXR1cm4gY2M7CiAgfTsKCiAgZ2V0VXNlck1lZGlhID0gZnVuY3Rpb24oY29uc3RyYWludHMsIG9uU3VjY2Vzcywgb25FcnJvcikgewogICAgaWYgKGNvbnN0cmFpbnRzLmF1ZGlvKSB7CiAgICAgIGNvbnN0cmFpbnRzLmF1ZGlvID0gY29uc3RyYWludHNUb0Nocm9tZShjb25zdHJhaW50cy5hdWRpbyk7CiAgICB9CiAgICBpZiAoY29uc3RyYWludHMudmlkZW8pIHsKICAgICAgY29uc3RyYWludHMudmlkZW8gPSBjb25zdHJhaW50c1RvQ2hyb21lKGNvbnN0cmFpbnRzLnZpZGVvKTsKICAgIH0KICAgIHdlYnJ0Y1V0aWxzLmxvZygnY2hyb21lOiAnICsgSlNPTi5zdHJpbmdpZnkoY29uc3RyYWludHMpKTsKICAgIHJldHVybiBuYXZpZ2F0b3Iud2Via2l0R2V0VXNlck1lZGlhKGNvbnN0cmFpbnRzLCBvblN1Y2Nlc3MsIG9uRXJyb3IpOwogIH07CiAgbmF2aWdhdG9yLmdldFVzZXJNZWRpYSA9IGdldFVzZXJNZWRpYTsKCiAgaWYgKCFuYXZpZ2F0b3IubWVkaWFEZXZpY2VzKSB7CiAgICBuYXZpZ2F0b3IubWVkaWFEZXZpY2VzID0ge2dldFVzZXJNZWRpYTogcmVxdWVzdFVzZXJNZWRpYSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW51bWVyYXRlRGV2aWNlczogZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlKSB7CiAgICAgICAgdmFyIGtpbmRzID0ge2F1ZGlvOiAnYXVkaW9pbnB1dCcsIHZpZGVvOiAndmlkZW9pbnB1dCd9OwogICAgICAgIHJldHVybiBNZWRpYVN0cmVhbVRyYWNrLmdldFNvdXJjZXMoZnVuY3Rpb24oZGV2aWNlcykgewogICAgICAgICAgcmVzb2x2ZShkZXZpY2VzLm1hcChmdW5jdGlvbihkZXZpY2UpIHsKICAgICAgICAgICAgcmV0dXJuIHtsYWJlbDogZGV2aWNlLmxhYmVsLAogICAgICAgICAgICAgICAgICAgIGtpbmQ6IGtpbmRzW2RldmljZS5raW5kXSwKICAgICAgICAgICAgICAgICAgICBkZXZpY2VJZDogZGV2aWNlLmlkLAogICAgICAgICAgICAgICAgICAgIGdyb3VwSWQ6ICcnfTsKICAgICAgICAgIH0pKTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9fTsKICB9CgogIC8vIEEgc2hpbSBmb3IgZ2V0VXNlck1lZGlhIG1ldGhvZCBvbiB0aGUgbWVkaWFEZXZpY2VzIG9iamVjdC4KICAvLyBUT0RPKEthcHRlbkphbnNzb24pIHJlbW92ZSBvbmNlIGltcGxlbWVudGVkIGluIENocm9tZSBzdGFibGUuCiAgaWYgKCFuYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmdldFVzZXJNZWRpYSkgewogICAgbmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5nZXRVc2VyTWVkaWEgPSBmdW5jdGlvbihjb25zdHJhaW50cykgewogICAgICByZXR1cm4gcmVxdWVzdFVzZXJNZWRpYShjb25zdHJhaW50cyk7CiAgICB9OwogIH0gZWxzZSB7CiAgICAvLyBFdmVuIHRob3VnaCBDaHJvbWUgNDUgaGFzIG5hdmlnYXRvci5tZWRpYURldmljZXMgYW5kIGEgZ2V0VXNlck1lZGlhCiAgICAvLyBmdW5jdGlvbiB3aGljaCByZXR1cm5zIGEgUHJvbWlzZSwgaXQgZG9lcyBub3QgYWNjZXB0IHNwZWMtc3R5bGUKICAgIC8vIGNvbnN0cmFpbnRzLgogICAgdmFyIG9yaWdHZXRVc2VyTWVkaWEgPSBuYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmdldFVzZXJNZWRpYS4KICAgICAgICBiaW5kKG5hdmlnYXRvci5tZWRpYURldmljZXMpOwogICAgbmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5nZXRVc2VyTWVkaWEgPSBmdW5jdGlvbihjKSB7CiAgICAgIHdlYnJ0Y1V0aWxzLmxvZygnc3BlYzogICAnICsgSlNPTi5zdHJpbmdpZnkoYykpOyAvLyB3aGl0ZXNwYWNlIGZvciBhbGlnbm1lbnQKICAgICAgYy5hdWRpbyA9IGNvbnN0cmFpbnRzVG9DaHJvbWUoYy5hdWRpbyk7CiAgICAgIGMudmlkZW8gPSBjb25zdHJhaW50c1RvQ2hyb21lKGMudmlkZW8pOwogICAgICB3ZWJydGNVdGlscy5sb2coJ2Nocm9tZTogJyArIEpTT04uc3RyaW5naWZ5KGMpKTsKICAgICAgcmV0dXJuIG9yaWdHZXRVc2VyTWVkaWEoYyk7CiAgICB9OwogIH0KCiAgLy8gRHVtbXkgZGV2aWNlY2hhbmdlIGV2ZW50IG1ldGhvZHMuCiAgLy8gVE9ETyhLYXB0ZW5KYW5zc29uKSByZW1vdmUgb25jZSBpbXBsZW1lbnRlZCBpbiBDaHJvbWUgc3RhYmxlLgogIGlmICh0eXBlb2YgbmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5hZGRFdmVudExpc3RlbmVyID09PSAndW5kZWZpbmVkJykgewogICAgbmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5hZGRFdmVudExpc3RlbmVyID0gZnVuY3Rpb24oKSB7CiAgICAgIHdlYnJ0Y1V0aWxzLmxvZygnRHVtbXkgbWVkaWFEZXZpY2VzLmFkZEV2ZW50TGlzdGVuZXIgY2FsbGVkLicpOwogICAgfTsKICB9CiAgaWYgKHR5cGVvZiBuYXZpZ2F0b3IubWVkaWFEZXZpY2VzLnJlbW92ZUV2ZW50TGlzdGVuZXIgPT09ICd1bmRlZmluZWQnKSB7CiAgICBuYXZpZ2F0b3IubWVkaWFEZXZpY2VzLnJlbW92ZUV2ZW50TGlzdGVuZXIgPSBmdW5jdGlvbigpIHsKICAgICAgd2VicnRjVXRpbHMubG9nKCdEdW1teSBtZWRpYURldmljZXMucmVtb3ZlRXZlbnRMaXN0ZW5lciBjYWxsZWQuJyk7CiAgICB9OwogIH0KCiAgLy8gQXR0YWNoIGEgbWVkaWEgc3RyZWFtIHRvIGFuIGVsZW1lbnQuCiAgYXR0YWNoTWVkaWFTdHJlYW0gPSBmdW5jdGlvbihlbGVtZW50LCBzdHJlYW0pIHsKICAgIGlmICh3ZWJydGNEZXRlY3RlZFZlcnNpb24gPj0gNDMpIHsKICAgICAgZWxlbWVudC5zcmNPYmplY3QgPSBzdHJlYW07CiAgICB9IGVsc2UgaWYgKHR5cGVvZiBlbGVtZW50LnNyYyAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgZWxlbWVudC5zcmMgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKHN0cmVhbSk7CiAgICB9IGVsc2UgewogICAgICB3ZWJydGNVdGlscy5sb2coJ0Vycm9yIGF0dGFjaGluZyBzdHJlYW0gdG8gZWxlbWVudC4nKTsKICAgIH0KICB9OwogIHJlYXR0YWNoTWVkaWFTdHJlYW0gPSBmdW5jdGlvbih0bywgZnJvbSkgewogICAgaWYgKHdlYnJ0Y0RldGVjdGVkVmVyc2lvbiA+PSA0MykgewogICAgICB0by5zcmNPYmplY3QgPSBmcm9tLnNyY09iamVjdDsKICAgIH0gZWxzZSB7CiAgICAgIHRvLnNyYyA9IGZyb20uc3JjOwogICAgfQogIH07Cgp9IGVsc2UgaWYgKG5hdmlnYXRvci5tZWRpYURldmljZXMgJiYgbmF2aWdhdG9yLnVzZXJBZ2VudC5tYXRjaCgKICAgIC9FZGdlXC8oXGQrKS4oXGQrKSQvKSkgewogIHdlYnJ0Y1V0aWxzLmxvZygnVGhpcyBhcHBlYXJzIHRvIGJlIEVkZ2UnKTsKICB3ZWJydGNEZXRlY3RlZEJyb3dzZXIgPSAnZWRnZSc7CgogIHdlYnJ0Y0RldGVjdGVkVmVyc2lvbiA9IHdlYnJ0Y1V0aWxzLmV4dHJhY3RWZXJzaW9uKG5hdmlnYXRvci51c2VyQWdlbnQsCiAgICAgIC9FZGdlXC8oXGQrKS4oXGQrKSQvLCAyKTsKCiAgLy8gdGhlIG1pbmltdW0gdmVyc2lvbiBzdGlsbCBzdXBwb3J0ZWQgYnkgYWRhcHRlci4KICB3ZWJydGNNaW5pbXVtVmVyc2lvbiA9IDEyOwp9IGVsc2UgewogIHdlYnJ0Y1V0aWxzLmxvZygnQnJvd3NlciBkb2VzIG5vdCBhcHBlYXIgdG8gYmUgV2ViUlRDLWNhcGFibGUnKTsKfQoKLy8gUmV0dXJucyB0aGUgcmVzdWx0IG9mIGdldFVzZXJNZWRpYSBhcyBhIFByb21pc2UuCmZ1bmN0aW9uIHJlcXVlc3RVc2VyTWVkaWEoY29uc3RyYWludHMpIHsKICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICBnZXRVc2VyTWVkaWEoY29uc3RyYWludHMsIHJlc29sdmUsIHJlamVjdCk7CiAgfSk7Cn0KCnZhciB3ZWJydGNUZXN0aW5nID0ge307CnRyeSB7CiAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHdlYnJ0Y1Rlc3RpbmcsICd2ZXJzaW9uJywgewogICAgc2V0OiBmdW5jdGlvbih2ZXJzaW9uKSB7CiAgICAgIHdlYnJ0Y0RldGVjdGVkVmVyc2lvbiA9IHZlcnNpb247CiAgICB9CiAgfSk7Cn0gY2F0Y2ggKGUpIHt9CgppZiAodHlwZW9mIG1vZHVsZSAhPT0gJ3VuZGVmaW5lZCcpIHsKICB2YXIgUlRDUGVlckNvbm5lY3Rpb247CiAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSB7CiAgICBSVENQZWVyQ29ubmVjdGlvbiA9IHdpbmRvdy5SVENQZWVyQ29ubmVjdGlvbjsKICB9CiAgbW9kdWxlLmV4cG9ydHMgPSB7CiAgICBSVENQZWVyQ29ubmVjdGlvbjogUlRDUGVlckNvbm5lY3Rpb24sCiAgICBnZXRVc2VyTWVkaWE6IGdldFVzZXJNZWRpYSwKICAgIGF0dGFjaE1lZGlhU3RyZWFtOiBhdHRhY2hNZWRpYVN0cmVhbSwKICAgIHJlYXR0YWNoTWVkaWFTdHJlYW06IHJlYXR0YWNoTWVkaWFTdHJlYW0sCiAgICB3ZWJydGNEZXRlY3RlZEJyb3dzZXI6IHdlYnJ0Y0RldGVjdGVkQnJvd3NlciwKICAgIHdlYnJ0Y0RldGVjdGVkVmVyc2lvbjogd2VicnRjRGV0ZWN0ZWRWZXJzaW9uLAogICAgd2VicnRjTWluaW11bVZlcnNpb246IHdlYnJ0Y01pbmltdW1WZXJzaW9uLAogICAgd2VicnRjVGVzdGluZzogd2VicnRjVGVzdGluZywKICAgIHdlYnJ0Y1V0aWxzOiB3ZWJydGNVdGlscwogICAgLy9yZXF1ZXN0VXNlck1lZGlhOiBub3QgZXhwb3NlZCBvbiBwdXJwb3NlLgogICAgLy90cmFjZTogbm90IGV4cG9zZWQgb24gcHVycG9zZS4KICB9Owp9IGVsc2UgaWYgKCh0eXBlb2YgcmVxdWlyZSA9PT0gJ2Z1bmN0aW9uJykgJiYgKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicpKSB7CiAgLy8gRXhwb3NlIG9iamVjdHMgYW5kIGZ1bmN0aW9ucyB3aGVuIFJlcXVpcmVKUyBpcyBkb2luZyB0aGUgbG9hZGluZy4KICBkZWZpbmUoW10sIGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIHsKICAgICAgUlRDUGVlckNvbm5lY3Rpb246IHdpbmRvdy5SVENQZWVyQ29ubmVjdGlvbiwKICAgICAgZ2V0VXNlck1lZGlhOiBnZXRVc2VyTWVkaWEsCiAgICAgIGF0dGFjaE1lZGlhU3RyZWFtOiBhdHRhY2hNZWRpYVN0cmVhbSwKICAgICAgcmVhdHRhY2hNZWRpYVN0cmVhbTogcmVhdHRhY2hNZWRpYVN0cmVhbSwKICAgICAgd2VicnRjRGV0ZWN0ZWRCcm93c2VyOiB3ZWJydGNEZXRlY3RlZEJyb3dzZXIsCiAgICAgIHdlYnJ0Y0RldGVjdGVkVmVyc2lvbjogd2VicnRjRGV0ZWN0ZWRWZXJzaW9uLAogICAgICB3ZWJydGNNaW5pbXVtVmVyc2lvbjogd2VicnRjTWluaW11bVZlcnNpb24sCiAgICAgIHdlYnJ0Y1Rlc3Rpbmc6IHdlYnJ0Y1Rlc3RpbmcsCiAgICAgIHdlYnJ0Y1V0aWxzOiB3ZWJydGNVdGlscwogICAgICAvL3JlcXVlc3RVc2VyTWVkaWE6IG5vdCBleHBvc2VkIG9uIHB1cnBvc2UuCiAgICAgIC8vdHJhY2U6IG5vdCBleHBvc2VkIG9uIHB1cnBvc2UuCiAgICB9OwogIH0pOwp9Cgp9LHt9XSw5MTpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Ci8qIGpzaGludCB1bmRlZjogdHJ1ZSAqLwovKiBnbG9iYWxzIFJUQ1BlZXJDb25uZWN0aW9uICovCi8qIGdsb2JhbHMgUlRDU2Vzc2lvbkRlc2NyaXB0aW9uICovCi8qIGdsb2JhbHMgUlRDSWNlQ2FuZGlkYXRlICovCgondXNlIHN0cmljdCc7Cgp2YXIgX2dldCA9IHJlcXVpcmUoJ2JhYmVsLXJ1bnRpbWUvaGVscGVycy9nZXQnKVsnZGVmYXVsdCddOwoKdmFyIF9pbmhlcml0cyA9IHJlcXVpcmUoJ2JhYmVsLXJ1bnRpbWUvaGVscGVycy9pbmhlcml0cycpWydkZWZhdWx0J107Cgp2YXIgX2NyZWF0ZUNsYXNzID0gcmVxdWlyZSgnYmFiZWwtcnVudGltZS9oZWxwZXJzL2NyZWF0ZS1jbGFzcycpWydkZWZhdWx0J107Cgp2YXIgX2NsYXNzQ2FsbENoZWNrID0gcmVxdWlyZSgnYmFiZWwtcnVudGltZS9oZWxwZXJzL2NsYXNzLWNhbGwtY2hlY2snKVsnZGVmYXVsdCddOwoKdmFyIF9Qcm9taXNlID0gcmVxdWlyZSgnYmFiZWwtcnVudGltZS9jb3JlLWpzL3Byb21pc2UnKVsnZGVmYXVsdCddOwoKdmFyIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQgPSByZXF1aXJlKCdiYWJlbC1ydW50aW1lL2hlbHBlcnMvaW50ZXJvcC1yZXF1aXJlLWRlZmF1bHQnKVsnZGVmYXVsdCddOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgewogIHZhbHVlOiB0cnVlCn0pOwoKcmVxdWlyZSgnd2VicnRjLWFkYXB0ZXItdGVzdCcpOwoKdmFyIF91dGlsc0V2ZW50RW1pdHRlciA9IHJlcXVpcmUoJy4uL3V0aWxzL0V2ZW50RW1pdHRlcicpOwoKdmFyIF91dGlsc0V2ZW50RW1pdHRlcjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF91dGlsc0V2ZW50RW1pdHRlcik7Cgp2YXIgX2Nvbm5lY3Rpb24gPSByZXF1aXJlKCcuL2Nvbm5lY3Rpb24nKTsKCnZhciBfY29ubmVjdGlvbjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9jb25uZWN0aW9uKTsKCnZhciBfcGVlciA9IHJlcXVpcmUoJy4vcGVlcicpOwoKdmFyIF9wZWVyMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3BlZXIpOwoKdmFyIENvbm5lY3Rpb25Db250cm9sbGVyID0gKGZ1bmN0aW9uIChfRXZlbnRFbWl0dGVyKSB7CiAgX2luaGVyaXRzKENvbm5lY3Rpb25Db250cm9sbGVyLCBfRXZlbnRFbWl0dGVyKTsKCiAgZnVuY3Rpb24gQ29ubmVjdGlvbkNvbnRyb2xsZXIoc3luY2hlciwgZG9tYWluKSB7CiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgQ29ubmVjdGlvbkNvbnRyb2xsZXIpOwoKICAgIF9nZXQoT2JqZWN0LmdldFByb3RvdHlwZU9mKENvbm5lY3Rpb25Db250cm9sbGVyLnByb3RvdHlwZSksICdjb25zdHJ1Y3RvcicsIHRoaXMpLmNhbGwodGhpcywgc3luY2hlcik7CgogICAgdmFyIF90aGlzID0gdGhpczsKCiAgICBfdGhpcy5zeW5jaGVyID0gc3luY2hlcjsKICAgIF90aGlzLm1vZGUgPSAnb2ZmZXInOwoKICAgIF90aGlzLl9vYmplY3REZXNjVVJMID0gJ2h5cGVydHktY2F0YWxvZ3VlOi8vJyArIGRvbWFpbiArICcvLndlbGwta25vd24vZGF0YXNjaGVtYXMvRmFrZURhdGFTY2hlbWEnOwoKICAgIF90aGlzLm1lZGlhQ29uc3RyYWludHMgPSB7CiAgICAgIG9wdGlvbmFsOiBbXSwKICAgICAgbWFuZGF0b3J5OiB7CiAgICAgICAgb2ZmZXJUb1JlY2VpdmVBdWRpbzogdHJ1ZSwKICAgICAgICBvZmZlclRvUmVjZWl2ZVZpZGVvOiB0cnVlCiAgICAgIH0KICAgIH07CgogICAgLy8gUHJlcGFyZSB0aGUgUGVlckNvbm5lY3Rpb24KICAgIHZhciBwZWVyQ29ubmVjdGlvbiA9IG5ldyBSVENQZWVyQ29ubmVjdGlvbigpOwoKICAgIHBlZXJDb25uZWN0aW9uLmFkZEV2ZW50TGlzdGVuZXIoJ3NpZ25hbGluZ3N0YXRlY2hhbmdlJywgZnVuY3Rpb24gKGV2ZW50KSB7CgogICAgICBjb25zb2xlLmluZm8oJ3NpZ25hbGluZ3N0YXRlY2hhbmdlJywgZXZlbnQuY3VycmVudFRhcmdldC5zaWduYWxpbmdTdGF0ZSk7CgogICAgICBpZiAoZXZlbnQuY3VycmVudFRhcmdldC5zaWduYWxpbmdTdGF0ZSA9PT0gJ2hhdmUtbG9jYWwtb2ZmZXInKSB7CiAgICAgICAgX3RoaXMudHJpZ2dlcignY29udHJvbGxlcjpzdGF0ZTpjaGFuZ2UnLCBfdGhpcy5tb2RlKTsKICAgICAgfQoKICAgICAgaWYgKGV2ZW50LmN1cnJlbnRUYXJnZXQuc2lnbmFsaW5nU3RhdGUgPT09ICdoYXZlLXJlbW90ZS1vZmZlcicpIHsKICAgICAgICBfdGhpcy5tb2RlID0gJ2Fuc3dlcic7CiAgICAgICAgX3RoaXMudHJpZ2dlcignY29udHJvbGxlcjpzdGF0ZTpjaGFuZ2UnLCBfdGhpcy5tb2RlKTsKICAgICAgfQogICAgfSk7CgogICAgcGVlckNvbm5lY3Rpb24uYWRkRXZlbnRMaXN0ZW5lcignaWNlY29ubmVjdGlvbnN0YXRlY2hhbmdlJywgZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgIGNvbnNvbGUuaW5mbygnaWNlY29ubmVjdGlvbnN0YXRlY2hhbmdlJywgZXZlbnQuY3VycmVudFRhcmdldC5pY2VDb25uZWN0aW9uU3RhdGUpOwogICAgICB2YXIgZGF0YSA9IF90aGlzLl9kYXRhT2JqZWN0UmVwb3J0ZXIuZGF0YTsKICAgICAgaWYgKGRhdGEuaGFzT3duUHJvcGVydHkoJ2Nvbm5lY3Rpb24nKSkgewogICAgICAgIGRhdGEuY29ubmVjdGlvbi5zdGF0dXMgPSBldmVudC5jdXJyZW50VGFyZ2V0LmljZUNvbm5lY3Rpb25TdGF0ZTsKICAgICAgfQogICAgfSk7CgogICAgcGVlckNvbm5lY3Rpb24uYWRkRXZlbnRMaXN0ZW5lcignaWNlY2FuZGlkYXRlJywgZnVuY3Rpb24gKGV2ZW50KSB7CgogICAgICBpZiAoIWV2ZW50LmNhbmRpZGF0ZSkgcmV0dXJuOwoKICAgICAgdmFyIGljZWNhbmRpZGF0ZSA9IHsKICAgICAgICB0eXBlOiAnY2FuZGlkYXRlJywKICAgICAgICBjYW5kaWRhdGU6IGV2ZW50LmNhbmRpZGF0ZS5jYW5kaWRhdGUsCiAgICAgICAgc2RwTWlkOiBldmVudC5jYW5kaWRhdGUuc2RwTWlkLAogICAgICAgIHNkcE1MaW5lSW5kZXg6IGV2ZW50LmNhbmRpZGF0ZS5zZHBNTGluZUluZGV4CiAgICAgIH07CgogICAgICB2YXIgZGF0YSA9IF90aGlzLl9kYXRhT2JqZWN0UmVwb3J0ZXIuZGF0YTsKCiAgICAgIGlmIChfdGhpcy5tb2RlID09PSAnb2ZmZXInKSB7CiAgICAgICAgZGF0YS5jb25uZWN0aW9uLm93bmVyUGVlci5pY2VDYW5kaWRhdGVzLnB1c2goaWNlY2FuZGlkYXRlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBkYXRhLnBlZXIuaWNlQ2FuZGlkYXRlcy5wdXNoKGljZWNhbmRpZGF0ZSk7CiAgICAgIH0KICAgIH0pOwoKICAgIC8vIEFkZCBzdHJlYW0gdG8gUGVlckNvbm5lY3Rpb24KICAgIHBlZXJDb25uZWN0aW9uLmFkZEV2ZW50TGlzdGVuZXIoJ2FkZHN0cmVhbScsIGZ1bmN0aW9uIChldmVudCkgewogICAgICBfdGhpcy50cmlnZ2VyKCdzdHJlYW06YWRkZWQnLCBVUkwuY3JlYXRlT2JqZWN0VVJMKGV2ZW50LnN0cmVhbSksIF90aGlzLmRhdGFPYmplY3RSZXBvcnRlciwgX3RoaXMuZGF0YU9iamVjdE9ic2VydmVyKTsKICAgIH0pOwoKICAgIF90aGlzLnBlZXJDb25uZWN0aW9uID0gcGVlckNvbm5lY3Rpb247CiAgfQoKICAvLyBUT0RPOiBjaGVjayBpZiBpdCBpcyByZWFseSBuZWNlc3NhcnkgdGhpcyByZW1vdGVQZWVySW5mb3JtYXRpb247CiAgLyoqDQogICAqIFNldCBSZW1vdGUgcGVlciBpbmZvcm1hdGlvbiwgbGlrZSBIeXBlcnR5Lg0KICAgKiBAcGFyYW0gIHtPYmplY3R9IHJlbW90ZVBlZXJJbmZvcm1hdGlvbiBpbmZvcm1hdGlvbiBhYm91dCB0aGUgcGVlcjsNCiAgICovCgogIF9jcmVhdGVDbGFzcyhDb25uZWN0aW9uQ29udHJvbGxlciwgW3sKICAgIGtleTogJ2dldFVzZXJNZWRpYScsCgogICAgLyoqDQogICAgICogR2V0IFdlYlJUQyBBUEkgcmVzb3VyY2VzDQogICAgICogQHBhcmFtICB7T2JqZWN0fSAgICAgb3B0aW9ucyBPYmplY3QgY29udGFpbmluZyB0aGUgaW5mb3JtYXRpb24gdGhhdCByZXNvdXJjZXMgd2lsbCBiZSB1c2VkIChjYW1lcmEsIG1pYywgcmVzb2x1dGlvbiwgZXRjKTsNCiAgICAgKiBAcmV0dXJuIHtQcm9taXNlfQ0KICAgICAqLwogICAgdmFsdWU6IGZ1bmN0aW9uIGdldFVzZXJNZWRpYShjb25zdHJhaW50cykgewoKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIHJldHVybiBuZXcgX1Byb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewoKICAgICAgICBuYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmdldFVzZXJNZWRpYShjb25zdHJhaW50cykudGhlbihmdW5jdGlvbiAobWVkaWFTdHJlYW0pIHsKICAgICAgICAgIF90aGlzLnBlZXJDb25uZWN0aW9uLmFkZFN0cmVhbShtZWRpYVN0cmVhbSk7CiAgICAgICAgICByZXNvbHZlKG1lZGlhU3RyZWFtKTsKICAgICAgICB9KVsnY2F0Y2gnXShmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgICAgICByZWplY3QocmVhc29uKTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAnY2hhbmdlUGVlckluZm9ybWF0aW9uJywKICAgIHZhbHVlOiBmdW5jdGlvbiBjaGFuZ2VQZWVySW5mb3JtYXRpb24oZGF0YU9iamVjdE9ic2VydmVyKSB7CgogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgY29uc29sZS5pbmZvKEpTT04uc3RyaW5naWZ5KGRhdGFPYmplY3RPYnNlcnZlci5kYXRhKSk7CgogICAgICBfdGhpcy5wcm9jZXNzUGVlckluZm9ybWF0aW9uKGRhdGFPYmplY3RPYnNlcnZlci5kYXRhKTsKCiAgICAgIGRhdGFPYmplY3RPYnNlcnZlci5vbkNoYW5nZSgnKicsIGZ1bmN0aW9uIChldmVudCkgewogICAgICAgIGNvbnNvbGUuaW5mbygnT2JzZXJ2ZXIgb24gY2hhbmdlIG1lc3NhZ2U6ICcsIGV2ZW50KTsKICAgICAgICBfdGhpcy5wcm9jZXNzUGVlckluZm9ybWF0aW9uKGRhdGFPYmplY3RPYnNlcnZlci5kYXRhKTsKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAncHJvY2Vzc1BlZXJJbmZvcm1hdGlvbicsCiAgICB2YWx1ZTogZnVuY3Rpb24gcHJvY2Vzc1BlZXJJbmZvcm1hdGlvbihkYXRhKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICBjb25zb2xlLmRlYnVnKEpTT04uc3RyaW5naWZ5KGRhdGEpKTsKCiAgICAgIHZhciBpc093bmVyID0gZGF0YS5oYXNPd25Qcm9wZXJ0eSgnY29ubmVjdGlvbicpOwoKICAgICAgdmFyIGNvbm5lY3Rpb25EZXNjcmlwdGlvbiA9IGlzT3duZXIgPyBkYXRhLmNvbm5lY3Rpb24ub3duZXJQZWVyLmNvbm5lY3Rpb25EZXNjcmlwdGlvbiA6IGRhdGEucGVlci5jb25uZWN0aW9uRGVzY3JpcHRpb247CiAgICAgIHZhciBpY2VDYW5kaWRhdGVzID0gaXNPd25lciA/IGRhdGEuY29ubmVjdGlvbi5vd25lclBlZXIuaWNlQ2FuZGlkYXRlcyA6IGRhdGEucGVlci5pY2VDYW5kaWRhdGVzOwoKICAgICAgY29uc29sZS5sb2coY29ubmVjdGlvbkRlc2NyaXB0aW9uLCBpY2VDYW5kaWRhdGVzKTsKCiAgICAgIGlmIChjb25uZWN0aW9uRGVzY3JpcHRpb24udHlwZSA9PT0gJ29mZmVyJyB8fCBjb25uZWN0aW9uRGVzY3JpcHRpb24udHlwZSA9PT0gJ2Fuc3dlcicpIHsKICAgICAgICBjb25zb2xlLmluZm8oJ1Byb2Nlc3MgQ29ubmVjdGlvbiBEZXNjcmlwdGlvbjogJywgY29ubmVjdGlvbkRlc2NyaXB0aW9uKTsKICAgICAgICBfdGhpcy5wZWVyQ29ubmVjdGlvbi5zZXRSZW1vdGVEZXNjcmlwdGlvbihuZXcgUlRDU2Vzc2lvbkRlc2NyaXB0aW9uKGNvbm5lY3Rpb25EZXNjcmlwdGlvbiksIF90aGlzLnJlbW90ZURlc2NyaXB0aW9uU3VjY2VzcywgX3RoaXMucmVtb3RlRGVzY3JpcHRpb25FcnJvcik7CiAgICAgIH0KCiAgICAgIGlmIChpY2VDYW5kaWRhdGVzKSB7CiAgICAgICAgaWNlQ2FuZGlkYXRlcy5mb3JFYWNoKGZ1bmN0aW9uIChpY2UpIHsKICAgICAgICAgIGlmIChpY2UudHlwZSA9PT0gJ2NhbmRpZGF0ZScpIHsKICAgICAgICAgICAgY29uc29sZS5pbmZvKCdQcm9jZXNzIEljZSBDYW5kaWRhdGU6ICcsIGljZSk7CiAgICAgICAgICAgIF90aGlzLnBlZXJDb25uZWN0aW9uLmFkZEljZUNhbmRpZGF0ZShuZXcgUlRDSWNlQ2FuZGlkYXRlKHsgY2FuZGlkYXRlOiBpY2UuY2FuZGlkYXRlIH0pLCBfdGhpcy5yZW1vdGVEZXNjcmlwdGlvblN1Y2Nlc3MsIF90aGlzLnJlbW90ZURlc2NyaXB0aW9uRXJyb3IpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAncmVtb3RlRGVzY3JpcHRpb25TdWNjZXNzJywKICAgIHZhbHVlOiBmdW5jdGlvbiByZW1vdGVEZXNjcmlwdGlvblN1Y2Nlc3MoKSB7CiAgICAgIGNvbnNvbGUuaW5mbygncmVtb3RlIHN1Y2Nlc3MnKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICdyZW1vdGVEZXNjcmlwdGlvbkVycm9yJywKICAgIHZhbHVlOiBmdW5jdGlvbiByZW1vdGVEZXNjcmlwdGlvbkVycm9yKGVycm9yKSB7CiAgICAgIGNvbnNvbGUuZXJyb3IoJ2Vycm9yOiAnLCBlcnJvcik7CiAgICB9CiAgfSwgewogICAga2V5OiAnY3JlYXRlT2ZmZXInLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNyZWF0ZU9mZmVyKCkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgX3RoaXMucGVlckNvbm5lY3Rpb24uY3JlYXRlT2ZmZXIoZnVuY3Rpb24gKGRlc2NyaXB0aW9uKSB7CiAgICAgICAgX3RoaXMub25Mb2NhbFNlc3Npb25DcmVhdGVkKGRlc2NyaXB0aW9uKTsKICAgICAgfSwgX3RoaXMuaW5mb0Vycm9yLCBfdGhpcy5tZWRpYUNvbnN0cmFpbnRzKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICdjcmVhdGVBbnN3ZXInLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNyZWF0ZUFuc3dlcigpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIF90aGlzLnBlZXJDb25uZWN0aW9uLmNyZWF0ZUFuc3dlcihmdW5jdGlvbiAoZGVzY3JpcHRpb24pIHsKICAgICAgICBfdGhpcy5vbkxvY2FsU2Vzc2lvbkNyZWF0ZWQoZGVzY3JpcHRpb24pOwogICAgICB9LCBfdGhpcy5pbmZvRXJyb3IpOwogICAgfQogIH0sIHsKICAgIGtleTogJ29uTG9jYWxTZXNzaW9uQ3JlYXRlZCcsCiAgICB2YWx1ZTogZnVuY3Rpb24gb25Mb2NhbFNlc3Npb25DcmVhdGVkKGRlc2NyaXB0aW9uKSB7CgogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgX3RoaXMucGVlckNvbm5lY3Rpb24uc2V0TG9jYWxEZXNjcmlwdGlvbihkZXNjcmlwdGlvbiwgZnVuY3Rpb24gKCkgewoKICAgICAgICB2YXIgZGF0YSA9IF90aGlzLl9kYXRhT2JqZWN0UmVwb3J0ZXIuZGF0YTsKICAgICAgICB2YXIgc2RwQ29ubmVjdGlvbiA9IHsKICAgICAgICAgIHNkcDogZGVzY3JpcHRpb24uc2RwLAogICAgICAgICAgdHlwZTogZGVzY3JpcHRpb24udHlwZQogICAgICAgIH07CgogICAgICAgIGlmIChfdGhpcy5tb2RlID09PSAnb2ZmZXInKSB7CiAgICAgICAgICBkYXRhLmNvbm5lY3Rpb24ub3duZXJQZWVyLmNvbm5lY3Rpb25EZXNjcmlwdGlvbiA9IHNkcENvbm5lY3Rpb247CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGRhdGEucGVlci5jb25uZWN0aW9uRGVzY3JpcHRpb24gPSBzZHBDb25uZWN0aW9uOwogICAgICAgIH0KICAgICAgfSwgX3RoaXMuaW5mb0Vycm9yKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICdpbmZvRXJyb3InLAogICAgdmFsdWU6IGZ1bmN0aW9uIGluZm9FcnJvcihlcnIpIHsKICAgICAgY29uc29sZS5lcnJvcihlcnIudG9TdHJpbmcoKSwgZXJyKTsKICAgIH0KCiAgICAvKioNCiAgICAgKiBVc2VkIHRvIGFjY2VwdCBhbiBpbmNvbWluZyBjb25uZWN0aW9uIHJlcXVlc3QuDQogICAgICogQG1ldGhvZCBhY2NlcHQNCiAgICAgKiBAcmV0dXJuIHtQcm9taXNlfQ0KICAgICAqLwogIH0sIHsKICAgIGtleTogJ2FjY2VwdCcsCiAgICB2YWx1ZTogZnVuY3Rpb24gYWNjZXB0KG9wdGlvbnMpIHsKCiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgIHZhciBzeW5jaGVyID0gX3RoaXMuc3luY2hlcjsKCiAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHsgdmlkZW86IHRydWUsIGF1ZGlvOiB0cnVlIH07CgogICAgICBjb25zb2xlLmxvZygnUmVtb3RlIFBlZXIgSW5mb3JtYXRpb246ICcsIF90aGlzLl9yZW1vdGVQZWVySW5mb3JtYXRpb24pOwogICAgICB2YXIgcmVtb3RlUGVlciA9IF90aGlzLl9yZW1vdGVQZWVySW5mb3JtYXRpb24uZnJvbTsKCiAgICAgIHJldHVybiBuZXcgX1Byb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewoKICAgICAgICB0cnkgewoKICAgICAgICAgIGNvbnNvbGUuaW5mbygnLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIFN5bmNoZXIgQ3JlYXRlIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gXG4nKTsKICAgICAgICAgIF90aGlzLmdldFVzZXJNZWRpYShvcHRpb25zKS50aGVuKGZ1bmN0aW9uIChtZWRpYUNvbnN0cmFpbnRzKSB7CiAgICAgICAgICAgIGNvbnNvbGUuaW5mbygnMS4gUmV0dXJuIG1lZGlhIGNvbnN0cmFpbnRzICcsIG1lZGlhQ29uc3RyYWludHMpOwogICAgICAgICAgICByZXR1cm4gc3luY2hlci5jcmVhdGUoX3RoaXMuX29iamVjdERlc2NVUkwsIFtyZW1vdGVQZWVyXSwge30pOwogICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAoZGF0YU9iamVjdFJlcG9ydGVyKSB7CiAgICAgICAgICAgIGNvbnNvbGUuaW5mbygnMi4gUmV0dXJuIHRoZSBEYXRhIE9iamVjdCBSZXBvcnRlciAnLCBkYXRhT2JqZWN0UmVwb3J0ZXIpOwogICAgICAgICAgICBfdGhpcy5kYXRhT2JqZWN0UmVwb3J0ZXIgPSBkYXRhT2JqZWN0UmVwb3J0ZXI7CiAgICAgICAgICAgIHJlc29sdmUoJ2FjY2VwdGVkJyk7CiAgICAgICAgICB9KVsnY2F0Y2gnXShmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgICAgICAgIHJlamVjdChyZWFzb24pOwogICAgICAgICAgfSk7CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgcmVqZWN0KCdlcnJvciBhY2NlcHRpbmcgY29ubmVjdGlvbicpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CgogICAgLyoqDQogICAgKiBVc2VkIHRvIGRlY2xpbmUgYW4gaW5jb21pbmcgY29ubmVjdGlvbiByZXF1ZXN0Lg0KICAgICogQG1ldGhvZCBkZWNsaW5lDQogICAgKiBAcmV0dXJuIHtQcm9taXNlfQ0KICAgICovCiAgfSwgewogICAga2V5OiAnZGVjbGluZScsCiAgICB2YWx1ZTogZnVuY3Rpb24gZGVjbGluZSgpIHsKCiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgIHZhciBzeW5jaGVyID0gX3RoaXMuc3luY2hlcjsKCiAgICAgIHJldHVybiBuZXcgX1Byb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewoKICAgICAgICB0cnkgewogICAgICAgICAgY29uc29sZS5sb2coJ3N5bmNoZXI6ICcsIHN5bmNoZXIpOwogICAgICAgICAgcmVzb2x2ZSgnRGVjbGluZWQnKTsKICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICByZWplY3QoZSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KCiAgICAvKioNCiAgICAgKiBVc2VkIHRvIGNsb3NlIGFuIGV4aXN0aW5nIGNvbm5lY3Rpb24gaW5zdGFuY2UuDQogICAgICogQG1ldGhvZCBkaXNjb25uZWN0DQogICAgICogQHJldHVybiB7UHJvbWlzZX0NCiAgICAgKi8KICB9LCB7CiAgICBrZXk6ICdkaXNjb25uZWN0JywKICAgIHZhbHVlOiBmdW5jdGlvbiBkaXNjb25uZWN0KCkgewoKICAgICAgLy8gVE9ETzogb3B0aW1pemUgdGhlIGRpc2Nvbm5lY3QgZnVuY3Rpb24KCiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICByZXR1cm4gbmV3IF9Qcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKCiAgICAgICAgdHJ5IHsKCiAgICAgICAgICBfdGhpcy5wZWVyQ29ubmVjdGlvbi5jbG9zZSgpOwoKICAgICAgICAgIHJlc29sdmUodHJ1ZSk7CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgcmVqZWN0KCdlcnJvciBkaXNjb25uZWN0aW5nIGNvbm5lY3Rpb24nKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQoKICAgIC8qKg0KICAgICAqIFVzZWQgdG8gYWRkL2ludml0ZSBuZXcgcGVlcnMgb24gYW4gZXhpc3RpbmcgY29ubmVjdGlvbiBpbnN0YW5jZSAoZm9yIG11bHRpcGFydHkgY29ubmVjdGlvbnMpLg0KICAgICAqIEBtZXRob2QgYWRkUGVlcg0KICAgICAqIEByZXR1cm4ge1Byb21pc2V9DQogICAgICovCiAgfSwgewogICAga2V5OiAnYWRkUGVlcicsCiAgICB2YWx1ZTogZnVuY3Rpb24gYWRkUGVlcigpIHt9CgogICAgLyoqDQogICAgICogVXNlZCB0byByZW1vdmUgYSBwZWVyIGZyb20gYW4gZXhpc3RpbmcgY29ubmVjdGlvbiBpbnN0YW5jZS4NCiAgICAgKiBAbWV0aG9kIHJlbW92ZVBlZXINCiAgICAgKiBAcmV0dXJuIHtQcm9taXNlfQ0KICAgICAqLwogIH0sIHsKICAgIGtleTogJ3JlbW92ZVBlZXInLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbW92ZVBlZXIoKSB7fQoKICAgIC8vIFBlZXIgQWN0aW9ucwogIH0sIHsKICAgIGtleTogJ2Rpc2FibGVNaWMnLAogICAgdmFsdWU6IGZ1bmN0aW9uIGRpc2FibGVNaWMoKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICByZXR1cm4gbmV3IF9Qcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgIHZhciBsb2NhbFN0cmVhbSA9IF90aGlzLnBlZXJDb25uZWN0aW9uLmdldExvY2FsU3RyZWFtcygpWzBdOwogICAgICAgICAgdmFyIGF1ZGlvVHJhY2sgPSBsb2NhbFN0cmVhbS5nZXRBdWRpb1RyYWNrcygpWzBdOwoKICAgICAgICAgIGF1ZGlvVHJhY2suZW5hYmxlZCA9IGF1ZGlvVHJhY2suZW5hYmxlZCA/IGZhbHNlIDogdHJ1ZTsKICAgICAgICAgIHJlc29sdmUoYXVkaW9UcmFjay5lbmFibGVkKTsKICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICByZWplY3QoZSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICdkaXNhYmxlQ2FtJywKICAgIHZhbHVlOiBmdW5jdGlvbiBkaXNhYmxlQ2FtKCkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgcmV0dXJuIG5ldyBfUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CgogICAgICAgIHRyeSB7CiAgICAgICAgICB2YXIgbG9jYWxTdHJlYW0gPSBfdGhpcy5wZWVyQ29ubmVjdGlvbi5nZXRMb2NhbFN0cmVhbXMoKVswXTsKICAgICAgICAgIHZhciB2aWRlb1RyYWNrID0gbG9jYWxTdHJlYW0uZ2V0VmlkZW9UcmFja3MoKVswXTsKCiAgICAgICAgICB2aWRlb1RyYWNrLmVuYWJsZWQgPSB2aWRlb1RyYWNrLmVuYWJsZWQgPyBmYWxzZSA6IHRydWU7CgogICAgICAgICAgcmVzb2x2ZSh2aWRlb1RyYWNrLmVuYWJsZWQpOwogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgIHJlamVjdChlKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogJ211dGUnLAogICAgdmFsdWU6IGZ1bmN0aW9uIG11dGUoKSB7CgogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgcmV0dXJuIG5ldyBfUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CgogICAgICAgIHRyeSB7CiAgICAgICAgICB2YXIgcmVtb3RlU3RyZWFtID0gX3RoaXMucGVlckNvbm5lY3Rpb24uZ2V0UmVtb3RlU3RyZWFtcygpWzBdOwogICAgICAgICAgdmFyIGF1ZGlvVHJhY2sgPSByZW1vdGVTdHJlYW0uZ2V0QXVkaW9UcmFja3MoKVswXTsKCiAgICAgICAgICBhdWRpb1RyYWNrLmVuYWJsZWQgPSBhdWRpb1RyYWNrLmVuYWJsZWQgPyBmYWxzZSA6IHRydWU7CgogICAgICAgICAgcmVzb2x2ZShhdWRpb1RyYWNrLmVuYWJsZWQpOwogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgIHJlamVjdChlKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogJ3JlbW90ZVBlZXJJbmZvcm1hdGlvbicsCiAgICBzZXQ6IGZ1bmN0aW9uIHNldChyZW1vdGVQZWVySW5mb3JtYXRpb24pIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgX3RoaXMuX3JlbW90ZVBlZXJJbmZvcm1hdGlvbiA9IHJlbW90ZVBlZXJJbmZvcm1hdGlvbjsKICAgIH0sCgogICAgLyoqDQogICAgICogR2V0IGluZm9ybWF0aW9uIHJlbGF0aXZlIHRvIHRoZSBSZW1vdGUgUGVlcjsNCiAgICAgKiBAcmV0dXJuIHtPYmplY3R9IHJlbW90ZVBlZXJJbmZvcm1hdGlvbjsNCiAgICAgKi8KICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICByZXR1cm4gX3RoaXMuX3JlbW90ZVBlZXJJbmZvcm1hdGlvbjsKICAgIH0KCiAgICAvKioNCiAgICAqIFNldCB0aGUgZGF0YU9iamVjdCBpbiB0aGUgY29udHJvbGxlcg0KICAgICogQHBhcmFtIHtDb25uZWN0aW9uRGF0YU9iamVjdH0gZGF0YU9iamVjdCAtIGhhdmUgYWxsIGluZm9ybWF0aW9uIGFib3V0IHRoZSBzeW5jaGVyIG9iamVjdDsNCiAgICAqLwogIH0sIHsKICAgIGtleTogJ2RhdGFPYmplY3RSZXBvcnRlcicsCiAgICBzZXQ6IGZ1bmN0aW9uIHNldChkYXRhT2JqZWN0UmVwb3J0ZXIpIHsKICAgICAgaWYgKCFkYXRhT2JqZWN0UmVwb3J0ZXIpIHRocm93IG5ldyBFcnJvcignVGhlIERhdGEgT2JqZWN0IFJlcG9ydGVyIGlzIGEgbmVlZGVkIHBhcmFtZXRlcicpOwoKICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgX3RoaXMuX2RhdGFPYmplY3RSZXBvcnRlciA9IGRhdGFPYmplY3RSZXBvcnRlcjsKCiAgICAgIHZhciBkYXRhID0gX3RoaXMuX2RhdGFPYmplY3RSZXBvcnRlci5kYXRhOwoKICAgICAgZGF0YU9iamVjdFJlcG9ydGVyLm9uU3Vic2NyaXB0aW9uKGZ1bmN0aW9uIChldmVudCkgewogICAgICAgIGV2ZW50LmFjY2VwdCgpOwogICAgICB9KTsKCiAgICAgIGlmIChfdGhpcy5tb2RlID09PSAnb2ZmZXInKSB7CiAgICAgICAgZGF0YS5jb25uZWN0aW9uID0gX2Nvbm5lY3Rpb24yWydkZWZhdWx0J107CgogICAgICAgIF90aGlzLmNyZWF0ZU9mZmVyKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZGF0YS5wZWVyID0gX3BlZXIyWydkZWZhdWx0J107CgogICAgICAgIF90aGlzLmNyZWF0ZUFuc3dlcigpOwogICAgICB9CgogICAgICBjb25zb2xlLmRlYnVnKF90aGlzLl9kYXRhT2JqZWN0UmVwb3J0ZXIpOwogICAgfSwKCiAgICAvKioNCiAgICAqIHJldHVybiB0aGUgZGF0YU9iamVjdCBpbiB0aGUgY29udHJvbGxlcg0KICAgICogQHJldHVybiB7Q29ubmVjdGlvbkRhdGFPYmplY3R9IGRhdGFPYmplY3QNCiAgICAqLwogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgIHJldHVybiBfdGhpcy5fZGF0YU9iamVjdFJlcG9ydGVyOwogICAgfQoKICAgIC8qKg0KICAgICogU2V0IHRoZSBkYXRhT2JqZWN0IGluIHRoZSBjb250cm9sbGVyDQogICAgKiBAcGFyYW0ge0Nvbm5lY3Rpb25EYXRhT2JqZWN0fSBkYXRhT2JqZWN0IC0gaGF2ZSBhbGwgaW5mb3JtYXRpb24gYWJvdXQgdGhlIHN5bmNoZXIgb2JqZWN0Ow0KICAgICovCiAgfSwgewogICAga2V5OiAnZGF0YU9iamVjdE9ic2VydmVyJywKICAgIHNldDogZnVuY3Rpb24gc2V0KGRhdGFPYmplY3RPYnNlcnZlcikgewogICAgICBpZiAoIWRhdGFPYmplY3RPYnNlcnZlcikgdGhyb3cgbmV3IEVycm9yKCdUaGUgRGF0YSBPYmplY3QgT2JzZXJ2ZXIgaXMgYSBuZWVkZWQgcGFyYW1ldGVyJyk7CgogICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICBfdGhpcy5fZGF0YU9iamVjdE9ic2VydmVyID0gZGF0YU9iamVjdE9ic2VydmVyOwogICAgICBfdGhpcy5jaGFuZ2VQZWVySW5mb3JtYXRpb24oZGF0YU9iamVjdE9ic2VydmVyKTsKICAgIH0sCgogICAgLyoqDQogICAgKiByZXR1cm4gdGhlIGRhdGFPYmplY3QgaW4gdGhlIGNvbnRyb2xsZXINCiAgICAqIEByZXR1cm4ge0Nvbm5lY3Rpb25EYXRhT2JqZWN0fSBkYXRhT2JqZWN0DQogICAgKi8KICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICByZXR1cm4gX3RoaXMuX2RhdGFPYmplY3RPYnNlcnZlcjsKICAgIH0KICB9XSk7CgogIHJldHVybiBDb25uZWN0aW9uQ29udHJvbGxlcjsKfSkoX3V0aWxzRXZlbnRFbWl0dGVyMlsnZGVmYXVsdCddKTsKCmV4cG9ydHNbJ2RlZmF1bHQnXSA9IENvbm5lY3Rpb25Db250cm9sbGVyOwptb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbJ2RlZmF1bHQnXTsKCn0seyIuLi91dGlscy9FdmVudEVtaXR0ZXIiOjEwMywiLi9jb25uZWN0aW9uIjo5MywiLi9wZWVyIjo5NCwiYmFiZWwtcnVudGltZS9jb3JlLWpzL3Byb21pc2UiOjcsImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jbGFzcy1jYWxsLWNoZWNrIjo5LCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY3JlYXRlLWNsYXNzIjoxMSwiYmFiZWwtcnVudGltZS9oZWxwZXJzL2dldCI6MTMsImJhYmVsLXJ1bnRpbWUvaGVscGVycy9pbmhlcml0cyI6MTQsImJhYmVsLXJ1bnRpbWUvaGVscGVycy9pbnRlcm9wLXJlcXVpcmUtZGVmYXVsdCI6MTUsIndlYnJ0Yy1hZGFwdGVyLXRlc3QiOjkwfV0sOTI6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewovKiBqc2hpbnQgdW5kZWY6IHRydWUgKi8KCid1c2Ugc3RyaWN0JzsKCnZhciBfZ2V0ID0gcmVxdWlyZSgnYmFiZWwtcnVudGltZS9oZWxwZXJzL2dldCcpWydkZWZhdWx0J107Cgp2YXIgX2luaGVyaXRzID0gcmVxdWlyZSgnYmFiZWwtcnVudGltZS9oZWxwZXJzL2luaGVyaXRzJylbJ2RlZmF1bHQnXTsKCnZhciBfY3JlYXRlQ2xhc3MgPSByZXF1aXJlKCdiYWJlbC1ydW50aW1lL2hlbHBlcnMvY3JlYXRlLWNsYXNzJylbJ2RlZmF1bHQnXTsKCnZhciBfY2xhc3NDYWxsQ2hlY2sgPSByZXF1aXJlKCdiYWJlbC1ydW50aW1lL2hlbHBlcnMvY2xhc3MtY2FsbC1jaGVjaycpWydkZWZhdWx0J107Cgp2YXIgX1Byb21pc2UgPSByZXF1aXJlKCdiYWJlbC1ydW50aW1lL2NvcmUtanMvcHJvbWlzZScpWydkZWZhdWx0J107Cgp2YXIgX2ludGVyb3BSZXF1aXJlRGVmYXVsdCA9IHJlcXVpcmUoJ2JhYmVsLXJ1bnRpbWUvaGVscGVycy9pbnRlcm9wLXJlcXVpcmUtZGVmYXVsdCcpWydkZWZhdWx0J107CgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7CiAgdmFsdWU6IHRydWUKfSk7CmV4cG9ydHNbJ2RlZmF1bHQnXSA9IGFjdGl2YXRlOwoKdmFyIF9oeXBlcnR5RGlzY292ZXJ5SHlwZXJ0eURpc2NvdmVyeSA9IHJlcXVpcmUoJy4uL2h5cGVydHktZGlzY292ZXJ5L0h5cGVydHlEaXNjb3ZlcnknKTsKCnZhciBfaHlwZXJ0eURpc2NvdmVyeUh5cGVydHlEaXNjb3ZlcnkyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfaHlwZXJ0eURpc2NvdmVyeUh5cGVydHlEaXNjb3ZlcnkpOwoKdmFyIF9Db25uZWN0aW9uQ29udHJvbGxlciA9IHJlcXVpcmUoJy4vQ29ubmVjdGlvbkNvbnRyb2xsZXInKTsKCnZhciBfQ29ubmVjdGlvbkNvbnRyb2xsZXIyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfQ29ubmVjdGlvbkNvbnRyb2xsZXIpOwoKdmFyIF91dGlsc0V2ZW50RW1pdHRlciA9IHJlcXVpcmUoJy4uL3V0aWxzL0V2ZW50RW1pdHRlcicpOwoKdmFyIF91dGlsc0V2ZW50RW1pdHRlcjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF91dGlsc0V2ZW50RW1pdHRlcik7Cgp2YXIgX3N5bmNoZXJTeW5jaGVyID0gcmVxdWlyZSgnLi4vc3luY2hlci9TeW5jaGVyJyk7Cgp2YXIgX3N5bmNoZXJTeW5jaGVyMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3N5bmNoZXJTeW5jaGVyKTsKCnZhciBfdXRpbHNVdGlscyA9IHJlcXVpcmUoJy4uL3V0aWxzL3V0aWxzJyk7CgovKioNCiogSHlwZXJ0eSBDb25uZWN0b3I7DQoqIEBhdXRob3IgVml0b3IgU2lsdmEgW3ZpdG9yLXQtc2lsdmFAdGVsZWNvbS5wdF0NCiogQHZlcnNpb24gMC4xLjANCiovCgp2YXIgSHlwZXJ0eUNvbm5lY3RvciA9IChmdW5jdGlvbiAoX0V2ZW50RW1pdHRlcikgewogIF9pbmhlcml0cyhIeXBlcnR5Q29ubmVjdG9yLCBfRXZlbnRFbWl0dGVyKTsKCiAgLyoqDQogICogQ3JlYXRlIGEgbmV3IEh5cGVydHkgQ29ubmVjdG9yDQogICogQHBhcmFtICB7U3luY2hlcn0gc3luY2hlciAtIFN5bmNoZXIgcHJvdmlkZWQgZnJvbSB0aGUgcnVudGltZSBjb3JlDQogICovCgogIGZ1bmN0aW9uIEh5cGVydHlDb25uZWN0b3IoaHlwZXJ0eVVSTCwgYnVzLCBjb25maWd1cmF0aW9uKSB7CiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgSHlwZXJ0eUNvbm5lY3Rvcik7CgogICAgaWYgKCFoeXBlcnR5VVJMKSB0aHJvdyBuZXcgRXJyb3IoJ1RoZSBoeXBlcnR5VVJMIGlzIGEgbmVlZGVkIHBhcmFtZXRlcicpOwogICAgaWYgKCFidXMpIHRocm93IG5ldyBFcnJvcignVGhlIE1pbmlCdXMgaXMgYSBuZWVkZWQgcGFyYW1ldGVyJyk7CiAgICBpZiAoIWNvbmZpZ3VyYXRpb24pIHRocm93IG5ldyBFcnJvcignVGhlIGNvbmZpZ3VyYXRpb24gaXMgYSBuZWVkZWQgcGFyYW1ldGVyJyk7CgogICAgX2dldChPYmplY3QuZ2V0UHJvdG90eXBlT2YoSHlwZXJ0eUNvbm5lY3Rvci5wcm90b3R5cGUpLCAnY29uc3RydWN0b3InLCB0aGlzKS5jYWxsKHRoaXMsIGh5cGVydHlVUkwsIGJ1cywgY29uZmlndXJhdGlvbik7CgogICAgdmFyIF90aGlzID0gdGhpczsKICAgIF90aGlzLl9oeXBlcnR5VVJMID0gaHlwZXJ0eVVSTDsKICAgIF90aGlzLl9idXMgPSBidXM7CiAgICBfdGhpcy5fY29uZmlndXJhdGlvbiA9IGNvbmZpZ3VyYXRpb247CiAgICBfdGhpcy5fZG9tYWluID0gKDAsIF91dGlsc1V0aWxzLmRpdmlkZVVSTCkoaHlwZXJ0eVVSTCkuZG9tYWluOwoKICAgIF90aGlzLl9vYmplY3REZXNjVVJMID0gJ2h5cGVydHktY2F0YWxvZ3VlOi8vJyArIF90aGlzLl9kb21haW4gKyAnLy53ZWxsLWtub3duL2RhdGFzY2hlbWFzL0Zha2VEYXRhU2NoZW1hJzsKCiAgICBfdGhpcy5fY29udHJvbGxlcnMgPSB7fTsKCiAgICB2YXIgZG9tYWluID0gKDAsIF91dGlsc1V0aWxzLmRpdmlkZVVSTCkoaHlwZXJ0eVVSTCkuZG9tYWluOwogICAgX3RoaXMuaHlwZXJ0eURpc2NvdmVyeSA9IG5ldyBfaHlwZXJ0eURpc2NvdmVyeUh5cGVydHlEaXNjb3ZlcnkyWydkZWZhdWx0J10oZG9tYWluLCBidXMpOwoKICAgIHZhciBzeW5jaGVyID0gbmV3IF9zeW5jaGVyU3luY2hlcjJbJ2RlZmF1bHQnXShoeXBlcnR5VVJMLCBidXMsIGNvbmZpZ3VyYXRpb24pOwogICAgc3luY2hlci5vbk5vdGlmaWNhdGlvbihmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgX3RoaXMuX29uTm90aWZpY2F0aW9uKGV2ZW50KTsKICAgIH0pOwoKICAgIF90aGlzLl9zeW5jaGVyID0gc3luY2hlcjsKICB9CgogIF9jcmVhdGVDbGFzcyhIeXBlcnR5Q29ubmVjdG9yLCBbewogICAga2V5OiAnX29uTm90aWZpY2F0aW9uJywKICAgIHZhbHVlOiBmdW5jdGlvbiBfb25Ob3RpZmljYXRpb24oZXZlbnQpIHsKCiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICBjb25zb2xlLmluZm8oJy0tLS0tLS0tLS0tLSBBY2tub3dsZWRnZXMgdGhlIFJlcG9ydGVyIC0tLS0tLS0tLS0tLSBcbicpOwogICAgICBldmVudC5hY2soKTsKICAgICAgY29uc29sZS5pbmZvKCctLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gRU5EIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gXG4nKTsKCiAgICAgIGNvbnNvbGUubG9nKF90aGlzLl9jb250cm9sbGVyc1tldmVudC5mcm9tXSk7CiAgICAgIGlmIChfdGhpcy5fY29udHJvbGxlcnNbZXZlbnQuZnJvbV0pIHsKICAgICAgICBfdGhpcy5fYXV0b1N1YnNjcmliZShldmVudCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgX3RoaXMuX2F1dG9BY2NlcHQoZXZlbnQpOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAnX2F1dG9BY2NlcHQnLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9hdXRvQWNjZXB0KGV2ZW50KSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgIHZhciBzeW5jaGVyID0gX3RoaXMuX3N5bmNoZXI7CgogICAgICBjb25zb2xlLmluZm8oJy0tLS0tLS0tLS0tLS0tLS0gU3luY2hlciBTdWJzY3JpYmUgLS0tLS0tLS0tLS0tLS0tLSBcbicpOwogICAgICBjb25zb2xlLmluZm8oJ1N1YnNjcmliZSBVUkwgT2JqZWN0ICcsIGV2ZW50LCBzeW5jaGVyKTsKCiAgICAgIHN5bmNoZXIuc3Vic2NyaWJlKF90aGlzLl9vYmplY3REZXNjVVJMLCBldmVudC51cmwpLnRoZW4oZnVuY3Rpb24gKGRhdGFPYmplY3RPYnNlcnZlcikgewogICAgICAgIGNvbnNvbGUuaW5mbygnMS4gUmV0dXJuIFN1YnNjcmliZSBEYXRhIE9iamVjdCBPYnNlcnZlcicsIGRhdGFPYmplY3RPYnNlcnZlcik7CgogICAgICAgIHZhciBjb25uZWN0aW9uQ29udHJvbGxlciA9IG5ldyBfQ29ubmVjdGlvbkNvbnRyb2xsZXIyWydkZWZhdWx0J10oc3luY2hlciwgX3RoaXMuX2RvbWFpbik7CgogICAgICAgIC8vIFRPRE86IHJlbW92ZSB0aGlzIHJlbW90ZVBlZXJJbmZvcm1hdGlvbjsKICAgICAgICBjb25uZWN0aW9uQ29udHJvbGxlci5yZW1vdGVQZWVySW5mb3JtYXRpb24gPSBldmVudDsKICAgICAgICBjb25uZWN0aW9uQ29udHJvbGxlci5kYXRhT2JqZWN0T2JzZXJ2ZXIgPSBkYXRhT2JqZWN0T2JzZXJ2ZXI7CgogICAgICAgIGNvbnNvbGUuaW5mbygnMi4gRGF0YSBPYmplY3QgT2JzZXJ2ZXIgZGF0YTogJywgSlNPTi5zdHJpbmdpZnkoZGF0YU9iamVjdE9ic2VydmVyLmRhdGEpKTsKCiAgICAgICAgX3RoaXMudHJpZ2dlcignY29ubmVjdG9yOmNvbm5lY3RlZCcsIGNvbm5lY3Rpb25Db250cm9sbGVyKTsKICAgICAgICBfdGhpcy50cmlnZ2VyKCdoYXZlOm5vdGlmaWNhdGlvbicsIGV2ZW50KTsKCiAgICAgICAgY29uc29sZS5pbmZvKCctLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gRU5EIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gXG4nKTsKICAgICAgfSlbJ2NhdGNoJ10oZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgIGNvbnNvbGUuZXJyb3IocmVhc29uKTsKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAnX2F1dG9TdWJzY3JpYmUnLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9hdXRvU3Vic2NyaWJlKGV2ZW50KSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgIHZhciBzeW5jaGVyID0gX3RoaXMuX3N5bmNoZXI7CgogICAgICBjb25zb2xlLmluZm8oJy0tLS0tLS0tLS0tLS0tLS0gU3luY2hlciBTdWJzY3JpYmUgLS0tLS0tLS0tLS0tLS0tLSBcbicpOwogICAgICBjb25zb2xlLmluZm8oJ1N1YnNjcmliZSBVUkwgT2JqZWN0ICcsIGV2ZW50LCBzeW5jaGVyKTsKICAgICAgc3luY2hlci5zdWJzY3JpYmUoX3RoaXMuX29iamVjdERlc2NVUkwsIGV2ZW50LnVybCkudGhlbihmdW5jdGlvbiAoZGF0YU9iamVjdE9ic2VydmVyKSB7CiAgICAgICAgY29uc29sZS5pbmZvKCcxLiBSZXR1cm4gU3Vic2NyaWJlIERhdGEgT2JqZWN0IE9ic2VydmVyJywgZGF0YU9iamVjdE9ic2VydmVyKTsKCiAgICAgICAgX3RoaXMuX2NvbnRyb2xsZXJzW2V2ZW50LmZyb21dLmRhdGFPYmplY3RPYnNlcnZlciA9IGRhdGFPYmplY3RPYnNlcnZlcjsKICAgICAgfSlbJ2NhdGNoJ10oZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgIGNvbnNvbGUuZXJyb3IocmVhc29uKTsKICAgICAgfSk7CiAgICB9CgogICAgLyoqDQogICAgKiBFc3RhYmxpc2ggY29ubmVjdGlvbiB3aXRoIG90aGVyIGNsaWVudCBpZGVudGlmaWVyDQogICAgKiBAcGFyYW0gIHtIeXBlcnR5VVJMfSBIeXBlcnR5VVJMIC0gRGVmaW5lIHRoZSBpZGVudGlmaWVyIG9mIHRoZSBvdGhlciBjb21wb25lbnQNCiAgICAqIEBwYXJhbSAge09iamVjdH0gb3B0aW9ucyAtIE9iamVjdCB3aXRoIG9wdGlvbnMgdG8gaW1wcm92ZSB0aGUgY29ubmVjdA0KICAgICovCiAgfSwgewogICAga2V5OiAnY29ubmVjdCcsCiAgICB2YWx1ZTogZnVuY3Rpb24gY29ubmVjdChoeXBlcnR5VVJMLCBvcHRpb25zKSB7CiAgICAgIC8vIFRPRE86IENIYW5nZSB0aGUgaHlwZXJ0eVVSTCBmb3IgYSBsaXN0IG9mIFVSTFMKICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgdmFyIHN5bmNoZXIgPSBfdGhpcy5fc3luY2hlcjsKCiAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHsgdmlkZW86IHRydWUsIGF1ZGlvOiB0cnVlIH07CgogICAgICByZXR1cm4gbmV3IF9Qcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKCiAgICAgICAgdmFyIGNvbm5lY3Rpb25Db250cm9sbGVyID0gdW5kZWZpbmVkOwogICAgICAgIHZhciBfZGF0YU9iamVjdFJlcG9ydGVyID0gdW5kZWZpbmVkOwoKICAgICAgICBjb25zb2xlLmluZm8oJy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSBTeW5jaGVyIENyZWF0ZSAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tIFxuJyk7CiAgICAgICAgc3luY2hlci5jcmVhdGUoX3RoaXMuX29iamVjdERlc2NVUkwsIFtoeXBlcnR5VVJMXSwge30pLnRoZW4oZnVuY3Rpb24gKGRhdGFPYmplY3RSZXBvcnRlcikgewogICAgICAgICAgY29uc29sZS5pbmZvKCcxLiBSZXR1cm4gQ3JlYXRlIERhdGEgT2JqZWN0IFJlcG9ydGVyJywgZGF0YU9iamVjdFJlcG9ydGVyKTsKCiAgICAgICAgICBfZGF0YU9iamVjdFJlcG9ydGVyID0gZGF0YU9iamVjdFJlcG9ydGVyOwoKICAgICAgICAgIGNvbm5lY3Rpb25Db250cm9sbGVyID0gbmV3IF9Db25uZWN0aW9uQ29udHJvbGxlcjJbJ2RlZmF1bHQnXShzeW5jaGVyLCBfdGhpcy5fZG9tYWluKTsKICAgICAgICAgIHJldHVybiBjb25uZWN0aW9uQ29udHJvbGxlci5nZXRVc2VyTWVkaWEob3B0aW9ucyk7CiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAobWVkaWFDb25zdHJhaW50cykgewogICAgICAgICAgY29uc29sZS5pbmZvKCcyLiBSZXR1cm4gdGhlIG1lZGlhIGNvbnN0cmFpbnRzIGZyb20gY29udHJvbGxlcjogJywgbWVkaWFDb25zdHJhaW50cyk7CgogICAgICAgICAgY29ubmVjdGlvbkNvbnRyb2xsZXIuZGF0YU9iamVjdFJlcG9ydGVyID0gX2RhdGFPYmplY3RSZXBvcnRlcjsKICAgICAgICAgIF90aGlzLl9jb250cm9sbGVyc1toeXBlcnR5VVJMXSA9IGNvbm5lY3Rpb25Db250cm9sbGVyOwoKICAgICAgICAgIHJlc29sdmUoY29ubmVjdGlvbkNvbnRyb2xsZXIpOwogICAgICAgICAgY29uc29sZS5pbmZvKCctLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gRU5EIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSBcbicpOwogICAgICAgIH0pWydjYXRjaCddKGZ1bmN0aW9uIChyZWFzb24pIHsKICAgICAgICAgIGNvbnNvbGUuZXJyb3IocmVhc29uKTsKICAgICAgICAgIHJlamVjdChyZWFzb24pOwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0KCiAgICAvLyAvKioKICAgIC8vICogQWNjZXB0IHRoZSBpbmNvbWluZyBjYWxsCiAgICAvLyAqIEBtZXRob2QgYWNjZXB0CiAgICAvLyAqIEByZXR1cm4ge1Byb21pc2V9CiAgICAvLyAqLwogICAgLy8gYWNjZXB0KCkgewogICAgLy8gICBsZXQgX3RoaXMgPSB0aGlzOwogICAgLy8KICAgIC8vICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkgewogICAgLy8KICAgIC8vICAgICBsZXQgb2JqZWN0VVJMID0gX3RoaXMubm90aWZpY2F0aW9uRXZlbnQudXJsOwogICAgLy8KICAgIC8vICAgICAvLyBzdGVwIDYgLSBodHRwczovL2dpdGh1Yi5jb20vcmVUSElOSy1wcm9qZWN0L3NjZW5hcmlvLXNlcnZpY2UtaW1wbGVtZW50YXRpb24vdHJlZS9tYXN0ZXIvZG9jcy9oeXBlcnRpZXMvY29ubmVjdG9yI25vdGlmaWNhdGlvbi1hYm91dC1pbmNvbWluZy1jb25uZWN0aW9uLXJlcXVlc3QKICAgIC8vICAgICAvLyBhZnRlciB3YWl0aW5nIGZvciBhbiBhbnN3ZXIsIHdlIGNhbiBub3cgc3Vic2NyaWJlIHRoZSBvYmplY3RVUkwKICAgIC8vICAgICBfdGhpcy5fc3luY2hlci5zdWJzY3JpYmUob2JqZWN0VVJMKS50aGVuKGZ1bmN0aW9uKGNvbm5lY3Rpb25EYXRhT2JqZWN0KSB7CiAgICAvLyAgICAgICBjb25zb2xlLmluZm8oJ1JldHVybiBTdWJzY3JpYmUgQ29ubmVjdGlvbiBEYXRhIE9iamVjdCcsIGNvbm5lY3Rpb25EYXRhT2JqZWN0KTsKICAgIC8vCiAgICAvLyAgICAgICAvLyBzdGVwIDcgYW5kIDEwIC0gaHR0cHM6Ly9naXRodWIuY29tL3JlVEhJTkstcHJvamVjdC9zY2VuYXJpby1zZXJ2aWNlLWltcGxlbWVudGF0aW9uL3RyZWUvbWFzdGVyL2RvY3MvaHlwZXJ0aWVzL2Nvbm5lY3RvciNub3RpZmljYXRpb24tYWJvdXQtaW5jb21pbmctY29ubmVjdGlvbi1yZXF1ZXN0CiAgICAvLyAgICAgICBfdGhpcy5jb25uZWN0aW9uQ29udHJvbGxlci5kYXRhT2JqZWN0T2JzZXJ2ZXIgPSBjb25uZWN0aW9uRGF0YU9iamVjdDsKICAgIC8vICAgICAgIHJlc29sdmUoX3RoaXMuY29ubmVjdGlvbkNvbnRyb2xsZXIpOwogICAgLy8KICAgIC8vICAgICAgIGxldCByZXNvdXJjZXMgPSBjb25uZWN0aW9uRGF0YU9iamVjdC5kYXRhLnJlc291cmNlczsKICAgIC8vICAgICAgIHJldHVybiBfdGhpcy5jb25uZWN0aW9uQ29udHJvbGxlci5nZXRVc2VyTWVkaWEocmVzb3VyY2VzKTsKICAgIC8vICAgICB9KQogICAgLy8gICAgIC50aGVuKGZ1bmN0aW9uKGNvbW1SZXNvdXJjZXMpIHsKICAgIC8vICAgICAgIGNvbnNvbGUuaW5mbygnR2V0IHdlYlJUQyBjb21tb24gcmVzb3VyY2VzJywgY29tbVJlc291cmNlcyk7CiAgICAvLyAgICAgfSkKICAgIC8vICAgICAuY2F0Y2goZnVuY3Rpb24ocmVhc29uKSB7CiAgICAvLyAgICAgICBjb25zb2xlLmVycm9yKHJlYXNvbik7CiAgICAvLyAgICAgICByZWplY3QocmVhc29uKTsKICAgIC8vICAgICB9KTsKICAgIC8vICAgfSk7CiAgICAvLyB9CiAgICAvLwogICAgLy8gLyoqCiAgICAvLyAqIENvbm5lY3Rpb24gaXMgY2xvc2VkIGJ5IGxvY2FsIHBlZXIgYW5kIGRpc2Nvbm5lY3RlZDsKICAgIC8vICogQG1ldGhvZCBkaXNjb25uZWN0CiAgICAvLyAqIEByZXR1cm4ge1Byb21pc2V9CiAgICAvLyAqLwogICAgLy8gZGlzY29ubmVjdCgpIHsKICAgIC8vCiAgICAvLyAgIGxldCBfdGhpcyA9IHRoaXM7CiAgICAvLwogICAgLy8gICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAvLwogICAgLy8gICAgIF90aGlzLmNvbm5lY3Rpb25Db250cm9sbGVyLmRpc2Nvbm5lY3QoKQogICAgLy8gICAgIC50aGVuKGZ1bmN0aW9uKGRpc2Nvbm5lY3RlZCkgewogICAgLy8KICAgIC8vICAgICAgIGNvbnNvbGUuaW5mbygnZGlzY29ubmVjdGVkOiAnLCBkaXNjb25uZWN0ZWQpOwogICAgLy8KICAgIC8vICAgICAgIHJlc29sdmUoZGlzY29ubmVjdGVkKTsKICAgIC8vICAgICB9KQogICAgLy8gICAgIC5jYXRjaChmdW5jdGlvbihyZWFzb24pIHsKICAgIC8vICAgICAgIHJlamVjdChyZWFzb24pOwogICAgLy8gICAgIH0pOwogICAgLy8KICAgIC8vICAgfSk7CiAgICAvLwogICAgLy8gfQogICAgLy8KICAgIC8vIF9hdXRvQ29ubmVjdChoeXBlcnR5VVJMKSB7CiAgICAvLyAgIGxldCBfdGhpcyA9IHRoaXM7CiAgICAvLwogICAgLy8gICBfdGhpcy5fc3luY2hlci5jcmVhdGUoe30sIFtoeXBlcnR5VVJMXSwge30pLnRoZW4oZnVuY3Rpb24oY29ubmVjdGlvbkRhdGFPYmplY3QpIHsKICAgIC8vICAgICBjb25zb2xlLmluZm8oJ1JldHVybiBDcmVhdGUgQ29ubmVjdGlvbiBEYXRhIE9iamVjdCcsIGNvbm5lY3Rpb25EYXRhT2JqZWN0KTsKICAgIC8vICAgICBfdGhpcy5jb25uZWN0aW9uQ29udHJvbGxlci5jb25uZWN0aW9uRGF0YU9iamVjdFJlcG9ydGVyID0gY29ubmVjdGlvbkRhdGFPYmplY3Q7CiAgICAvLyAgIH0pLmNhdGNoKGZ1bmN0aW9uKHJlYXNvbikgewogICAgLy8gICAgIGNvbnNvbGUuZXJyb3IocmVhc29uKTsKICAgIC8vICAgfSk7CiAgICAvLyB9CgogIH1dKTsKCiAgcmV0dXJuIEh5cGVydHlDb25uZWN0b3I7Cn0pKF91dGlsc0V2ZW50RW1pdHRlcjJbJ2RlZmF1bHQnXSk7CgpmdW5jdGlvbiBhY3RpdmF0ZShoeXBlcnR5VVJMLCBidXMsIGNvbmZpZ3VyYXRpb24pIHsKCiAgcmV0dXJuIHsKICAgIG5hbWU6ICdIeXBlcnR5Q29ubmVjdG9yJywKICAgIGluc3RhbmNlOiBuZXcgSHlwZXJ0eUNvbm5lY3RvcihoeXBlcnR5VVJMLCBidXMsIGNvbmZpZ3VyYXRpb24pCiAgfTsKfQoKbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWydkZWZhdWx0J107Cgp9LHsiLi4vaHlwZXJ0eS1kaXNjb3ZlcnkvSHlwZXJ0eURpc2NvdmVyeSI6OTUsIi4uL3N5bmNoZXIvU3luY2hlciI6MTAyLCIuLi91dGlscy9FdmVudEVtaXR0ZXIiOjEwMywiLi4vdXRpbHMvdXRpbHMiOjEwNCwiLi9Db25uZWN0aW9uQ29udHJvbGxlciI6OTEsImJhYmVsLXJ1bnRpbWUvY29yZS1qcy9wcm9taXNlIjo3LCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY2xhc3MtY2FsbC1jaGVjayI6OSwiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NyZWF0ZS1jbGFzcyI6MTEsImJhYmVsLXJ1bnRpbWUvaGVscGVycy9nZXQiOjEzLCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvaW5oZXJpdHMiOjE0LCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvaW50ZXJvcC1yZXF1aXJlLWRlZmF1bHQiOjE1fV0sOTM6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewovLyBkYXRhT2JqZWN0UmVwb3J0ZXIuZGF0YSA9IHsKLy8gICAgc3RhdHVzIDogImNvbm5lY3RlZCIsCi8vICAgIG93bmVyIDogImh5cGVydHk6Ly9leGFtcGxlLmNvbS9hbGljZWh5IiwKLy8gICAgcGVlciA6ICJjb25uZWN0aW9uOi8vZXhhbXBsZS5jb20vYWxpY2UvYm9iMjcwMTIwMTYiLAovLyAgICBvd25lclBlZXIgOiB7Ci8vICAgICAgICAgIGNvbm5lY3Rpb25EZXNjcmlwdGlvbjogewovLyAgICAgICAgICAgICBzZHA6ICdzNGRmYWYxc2EzZjFhc2Q1ZjRzZGFmYScsCi8vICAgICAgICAgICAgIHR5cGU6ICdvZmZlcicKLy8gICAgICAgICAgfSwKLy8gICAgICAgICAgaWNlQ2FuZGlkYXRlczogW3sKLy8gICAgICAgICAgICAgIHR5cGU6ICdjYW5kaWRhdGUnLAovLyAgICAgICAgICAgICAgY2FuZGlkYXRlOiBldmVudC5jYW5kaWRhdGUuY2FuZGlkYXRlLAovLyAgICAgICAgICAgICAgc2RwTWlkOiBldmVudC5jYW5kaWRhdGUuc2RwTWlkLAovLyAgICAgICAgICAgICAgc2RwTUxpbmVJbmRleDogZXZlbnQuY2FuZGlkYXRlLnNkcE1MaW5lSW5kZXgKLy8gICAgICAgICAgICB9LAovLyAgICAgICAgICAgIHsKLy8gICAgICAgICAgICAgIHR5cGU6ICdjYW5kaWRhdGUnLAovLyAgICAgICAgICAgICAgY2FuZGlkYXRlOiBldmVudC5jYW5kaWRhdGUuY2FuZGlkYXRlLAovLyAgICAgICAgICAgICAgc2RwTWlkOiBldmVudC5jYW5kaWRhdGUuc2RwTWlkLAovLyAgICAgICAgICAgICAgc2RwTUxpbmVJbmRleDogZXZlbnQuY2FuZGlkYXRlLnNkcE1MaW5lSW5kZXgKLy8gICAgICAgICAgICB9LAovLyAgICAgICAgICAgIC4uLi4uCi8vICAgICAgICBdCi8vICAgICAgfQovLyAgfQoKInVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogICB2YWx1ZTogdHJ1ZQp9KTsKdmFyIGNvbm5lY3Rpb24gPSB7CiAgIHN0YXR1czogImNvbm5lY3RlZCIsCiAgIG93bmVyOiAiaHlwZXJ0eTovL2V4YW1wbGUuY29tL2FsaWNlaHkiLAogICBwZWVyOiAiY29ubmVjdGlvbjovL2V4YW1wbGUuY29tL2FsaWNlL2JvYjI3MDEyMDE2IiwKICAgb3duZXJQZWVyOiB7CiAgICAgIGNvbm5lY3Rpb25EZXNjcmlwdGlvbjoge30sCiAgICAgIGljZUNhbmRpZGF0ZXM6IFtdCiAgIH0KfTsKCmV4cG9ydHNbImRlZmF1bHQiXSA9IGNvbm5lY3Rpb247Cm1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1siZGVmYXVsdCJdOwoKfSx7fV0sOTQ6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewoidXNlIHN0cmljdCI7CgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgdmFsdWU6IHRydWUKfSk7CnZhciBwZWVyID0gewogIGNvbm5lY3Rpb25EZXNjcmlwdGlvbjoge30sCiAgaWNlQ2FuZGlkYXRlczogW10KfTsKCmV4cG9ydHNbImRlZmF1bHQiXSA9IHBlZXI7Cm1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1siZGVmYXVsdCJdOwoKfSx7fV0sOTU6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewovKioNCiogQ29yZSBIeXBlcnR5RGlzY292ZXJ5IGludGVyZmFjZQ0KKiBDbGFzcyB0byBhbGxvdyBhcHBsaWNhdGlvbnMgdG8gc2VhcmNoIGZvciBoeXBlcnRpZXMgdXNpbmcgdGhlIG1lc3NhZ2UgYnVzDQoqLwondXNlIHN0cmljdCc7Cgp2YXIgX2NyZWF0ZUNsYXNzID0gcmVxdWlyZSgnYmFiZWwtcnVudGltZS9oZWxwZXJzL2NyZWF0ZS1jbGFzcycpWydkZWZhdWx0J107Cgp2YXIgX2NsYXNzQ2FsbENoZWNrID0gcmVxdWlyZSgnYmFiZWwtcnVudGltZS9oZWxwZXJzL2NsYXNzLWNhbGwtY2hlY2snKVsnZGVmYXVsdCddOwoKdmFyIF9Qcm9taXNlID0gcmVxdWlyZSgnYmFiZWwtcnVudGltZS9jb3JlLWpzL3Byb21pc2UnKVsnZGVmYXVsdCddOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgewogIHZhbHVlOiB0cnVlCn0pOwoKdmFyIEh5cGVydHlEaXNjb3ZlcnkgPSAoZnVuY3Rpb24gKCkgewoKICAvKioNCiAgKiBUbyBpbml0aWFsaXNlIHRoZSBIeXBlcnR5RGlzY292ZXIsIHdoaWNoIHdpbGwgcHJvdmlkZSB0aGUgc3VwcG9ydCBmb3IgaHlwZXJ0aWVzIHRvDQogICogcXVlcnkgdXNlcnMgcmVnaXN0ZXJlZCBpbiBvdXRzaWRlIHRoZSBpbnRlcm5hbCBjb3JlLg0KICAqIEBwYXJhbSAge01lc3NhZ2VCdXN9ICAgICAgICAgIG1zZ2J1cyAgICAgICAgICAgICAgICBtc2didXMNCiAgKiBAcGFyYW0gIHtSdW50aW1lVVJMfSAgICAgICAgICBydW50aW1lVVJMICAgICAgICAgICAgcnVudGltZVVSTA0KICAqLwoKICBmdW5jdGlvbiBIeXBlcnR5RGlzY292ZXJ5KGRvbWFpbiwgbXNnQnVzKSB7CiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgSHlwZXJ0eURpc2NvdmVyeSk7CgogICAgdmFyIF90aGlzID0gdGhpczsKICAgIF90aGlzLm1lc3NhZ2VCdXMgPSBtc2dCdXM7CgogICAgX3RoaXMuZG9tYWluID0gZG9tYWluOwogICAgX3RoaXMuZGlzY292ZXJ5VVJMID0gJ2h5cGVydHk6Ly8nICsgZG9tYWluICsgJy9oeXBlcnR5RGlzb3ZlcnknOwogIH0KCiAgLyoqDQogICogZnVuY3Rpb24gdG8gcmVxdWVzdCBhYm91dCB1c2VycyByZWdpc3RlcmVkIGluIGRvbWFpbiByZWdpc3RyeSwgYW5kDQogICogcmV0dXJuIHRoZSBoeXBlcnR5IGluc3RhbmNlIGlmIGZvdW5kLg0KICAqIEBwYXJhbSAge2VtYWlsfSAgICAgICAgICAgICAgZW1haWwNCiAgKiBAcmV0dXJuIHtQcm9taXNlfSAgICAgICAgICBQcm9taXNlDQogICovCgogIF9jcmVhdGVDbGFzcyhIeXBlcnR5RGlzY292ZXJ5LCBbewogICAga2V5OiAnZGlzY292ZXJIeXBlcnR5UGVyVXNlcicsCiAgICB2YWx1ZTogZnVuY3Rpb24gZGlzY292ZXJIeXBlcnR5UGVyVXNlcihlbWFpbCkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICB2YXIgaWRlbnRpdHlVUkwgPSAndXNlcjovLycgKyBlbWFpbC5zdWJzdHJpbmcoZW1haWwuaW5kZXhPZignQCcpICsgMSwgZW1haWwubGVuZ3RoKSArICcvJyArIGVtYWlsLnN1YnN0cmluZygwLCBlbWFpbC5pbmRleE9mKCdAJykpOwoKICAgICAgLy8gbWVzc2FnZSB0byBxdWVyeSBkb21haW4gcmVnaXN0cnksIGFza2luZyBmb3IgYSB1c2VyIGh5cGVydHkuCiAgICAgIHZhciBtZXNzYWdlID0gewogICAgICAgIHR5cGU6ICdSRUFEJywgZnJvbTogX3RoaXMuZGlzY292ZXJ5VVJMLCB0bzogJ2RvbWFpbjovL3JlZ2lzdHJ5LicgKyBfdGhpcy5kb21haW4gKyAnLycsIGJvZHk6IHsgcmVzb3VyY2U6IGlkZW50aXR5VVJMIH0KICAgICAgfTsKCiAgICAgIHJldHVybiBuZXcgX1Byb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewoKICAgICAgICBfdGhpcy5tZXNzYWdlQnVzLnBvc3RNZXNzYWdlKG1lc3NhZ2UsIGZ1bmN0aW9uIChyZXBseSkgewogICAgICAgICAgLy9jb25zb2xlLmxvZygnTUVTU0FHRScsIHJlcGx5KTsKCiAgICAgICAgICB2YXIgaHlwZXJ0eSA9IHVuZGVmaW5lZDsKICAgICAgICAgIHZhciBtb3N0UmVjZW50ID0gdW5kZWZpbmVkOwogICAgICAgICAgdmFyIGxhc3RIeXBlcnR5ID0gdW5kZWZpbmVkOwogICAgICAgICAgdmFyIHZhbHVlID0gcmVwbHkuYm9keS52YWx1ZTsKCiAgICAgICAgICAvL2NvbnNvbGUubG9nKCd2YWx1ZVBhcnNlZCcsIHZhbHVlUGFyc2VkKTsKICAgICAgICAgIGZvciAoaHlwZXJ0eSBpbiB2YWx1ZSkgewogICAgICAgICAgICBpZiAodmFsdWVbaHlwZXJ0eV0ubGFzdE1vZGlmaWVkICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICBpZiAobW9zdFJlY2VudCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICBtb3N0UmVjZW50ID0gbmV3IERhdGUodmFsdWVbaHlwZXJ0eV0ubGFzdE1vZGlmaWVkKTsKICAgICAgICAgICAgICAgIGxhc3RIeXBlcnR5ID0gaHlwZXJ0eTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdmFyIGh5cGVydHlEYXRlID0gbmV3IERhdGUodmFsdWVbaHlwZXJ0eV0ubGFzdE1vZGlmaWVkKTsKICAgICAgICAgICAgICAgIGlmIChtb3N0UmVjZW50LmdldFRpbWUoKSA8IGh5cGVydHlEYXRlLmdldFRpbWUoKSkgewogICAgICAgICAgICAgICAgICBtb3N0UmVjZW50ID0gaHlwZXJ0eURhdGU7CiAgICAgICAgICAgICAgICAgIGxhc3RIeXBlcnR5ID0gaHlwZXJ0eTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHZhciBoeXBlcnR5VVJMID0gbGFzdEh5cGVydHk7CgogICAgICAgICAgaWYgKGh5cGVydHlVUkwgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICByZXR1cm4gcmVqZWN0KCdVc2VyIEh5cGVydHkgbm90IGZvdW5kJyk7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGlkUGFja2FnZSA9IHsKICAgICAgICAgICAgaWQ6IGVtYWlsLAogICAgICAgICAgICBkZXNjcmlwdG9yOiB2YWx1ZVtoeXBlcnR5VVJMXS5kZXNjcmlwdG9yLAogICAgICAgICAgICBoeXBlcnR5VVJMOiBoeXBlcnR5VVJMCiAgICAgICAgICB9OwoKICAgICAgICAgIGNvbnNvbGUubG9nKCc9PT0+IFJlZ2lzdGVySHlwZXJ0eSBtZXNzYWdlQnVuZGxlOiAnLCBpZFBhY2thZ2UpOwogICAgICAgICAgcmVzb2x2ZShpZFBhY2thZ2UpOwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0KICB9XSk7CgogIHJldHVybiBIeXBlcnR5RGlzY292ZXJ5Owp9KSgpOwoKZXhwb3J0c1snZGVmYXVsdCddID0gSHlwZXJ0eURpc2NvdmVyeTsKbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWydkZWZhdWx0J107Cgp9LHsiYmFiZWwtcnVudGltZS9jb3JlLWpzL3Byb21pc2UiOjcsImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jbGFzcy1jYWxsLWNoZWNrIjo5LCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY3JlYXRlLWNsYXNzIjoxMX1dLDk2OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKJ3VzZSBzdHJpY3QnOwoKdmFyIF9jcmVhdGVDbGFzcyA9IHJlcXVpcmUoJ2JhYmVsLXJ1bnRpbWUvaGVscGVycy9jcmVhdGUtY2xhc3MnKVsnZGVmYXVsdCddOwoKdmFyIF9jbGFzc0NhbGxDaGVjayA9IHJlcXVpcmUoJ2JhYmVsLXJ1bnRpbWUvaGVscGVycy9jbGFzcy1jYWxsLWNoZWNrJylbJ2RlZmF1bHQnXTsKCnZhciBfUHJvbWlzZSA9IHJlcXVpcmUoJ2JhYmVsLXJ1bnRpbWUvY29yZS1qcy9wcm9taXNlJylbJ2RlZmF1bHQnXTsKCnZhciBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0ID0gcmVxdWlyZSgnYmFiZWwtcnVudGltZS9oZWxwZXJzL2ludGVyb3AtcmVxdWlyZS1kZWZhdWx0JylbJ2RlZmF1bHQnXTsKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsKICB2YWx1ZTogdHJ1ZQp9KTsKCnZhciBfU3luY09iamVjdCA9IHJlcXVpcmUoJy4vU3luY09iamVjdCcpOwoKdmFyIF9TeW5jT2JqZWN0MiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX1N5bmNPYmplY3QpOwoKdmFyIF9EYXRhT2JqZWN0Q2hpbGQgPSByZXF1aXJlKCcuL0RhdGFPYmplY3RDaGlsZCcpOwoKdmFyIF9EYXRhT2JqZWN0Q2hpbGQyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfRGF0YU9iamVjdENoaWxkKTsKCnZhciBfdXRpbHNVdGlsc0pzID0gcmVxdWlyZSgnLi4vdXRpbHMvdXRpbHMuanMnKTsKCi8qKg0KICogTWFpbiBleHRlbnNpb24gY2xhc3MgZm9yIG9ic2VydmVycyBhbmQgcmVwb3J0ZXJzLCB3aXRoIGNvbW1vbiBwcm9wZXJ0aWVzIGFuZCBtZXRob2RzLg0KICogQ2hpbGRyZW4gbWFuYWdlbWVudCBpcyBjb21tb24gZm9yIG9ic2VydmVycyBhbmQgcmVwb3J0ZXJzLg0KICovCgp2YXIgRGF0YU9iamVjdCA9IChmdW5jdGlvbiAoKSB7CiAgLyogcHJpdmF0ZQ0KICBfdmVyc2lvbjogbnVtYmVyDQogICAgX293bmVyOiBIeXBlcnR5VVJMDQogIF91cmw6IE9iamVjdFVSTA0KICBfc2NoZW1hOiBTY2hlbWENCiAgX2J1czogTWluaUJ1cw0KICBfc3RhdHVzOiBvbiB8IHBhdXNlZA0KICBfc3luY09iajogU3luY0RhdGENCiAgICBfY2hpbGRyZW46IHsgaWQ6IERhdGFPYmplY3RDaGlsZCB9DQogICAgLS0tLWV2ZW50IGhhbmRsZXJzLS0tLQ0KICBfb25BZGRDaGlsZHJlbkhhbmRsZXI6IChldmVudCkgPT4gdm9pZA0KICAqLwoKICAvKioNCiAgICogQGlnbm9yZQ0KICAgKiBTaG91bGQgbm90IGJlIHVzZWQgZGlyZWN0bHkgYnkgSHlwZXJ0aWVzLiBJdCdzIGNhbGxlZCBieSB0aGUgU3luY2hlciBjcmVhdGUgb3Igc3Vic2NyaWJlIG1ldGhvZCdzDQogICAqLwoKICBmdW5jdGlvbiBEYXRhT2JqZWN0KG93bmVyLCB1cmwsIHNjaGVtYSwgYnVzLCBpbml0aWFsU3RhdHVzLCBpbml0aWFsRGF0YSwgY2hpbGRyZW4pIHsKICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBEYXRhT2JqZWN0KTsKCiAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgIF90aGlzLl92ZXJzaW9uID0gMDsKCiAgICBfdGhpcy5fb3duZXIgPSBvd25lcjsKICAgIF90aGlzLl91cmwgPSB1cmw7CiAgICBfdGhpcy5fc2NoZW1hID0gc2NoZW1hOwogICAgX3RoaXMuX2J1cyA9IGJ1czsKICAgIF90aGlzLl9zdGF0dXMgPSBpbml0aWFsU3RhdHVzOwogICAgX3RoaXMuX3N5bmNPYmogPSBuZXcgX1N5bmNPYmplY3QyWydkZWZhdWx0J10oaW5pdGlhbERhdGEpOwoKICAgIF90aGlzLl9jaGlsZElkID0gMDsKICAgIF90aGlzLl9jaGlsZHJlbiA9IHt9OwoKICAgIHZhciBjaGlsZEJhc2VVUkwgPSB1cmwgKyAnL2NoaWxkcmVuLyc7CgogICAgaWYgKGNoaWxkcmVuKSB7CiAgICAgIGNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGNoaWxkKSB7CiAgICAgICAgdmFyIGNoaWxkVVJMID0gY2hpbGRCYXNlVVJMICsgY2hpbGQ7CiAgICAgICAgYnVzLmFkZExpc3RlbmVyKGNoaWxkVVJMLCBmdW5jdGlvbiAobXNnKSB7CiAgICAgICAgICAvL2lnbm9yZSBtc2cgc2VudCBieSBoaW1zZWxmCiAgICAgICAgICBpZiAobXNnLmZyb20gIT09IF90aGlzMi5fb3duZXIpIHsKICAgICAgICAgICAgc3dpdGNoIChtc2cudHlwZSkgewogICAgICAgICAgICAgIGNhc2UgJ2NyZWF0ZSc6CiAgICAgICAgICAgICAgICBfdGhpcy5fb25DaGlsZHJlbkNyZWF0ZShtc2cpO2JyZWFrOwogICAgICAgICAgICAgIGNhc2UgJ2RlbGV0ZSc6CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhtc2cpO2JyZWFrOwogICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICBfdGhpcy5fY2hhbmdlQ2hpbGRyZW4obXNnKTticmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0KICB9CgogIC8qKg0KICAgKiBPYmplY3QgVVJMIG9mIHJlcG9ydGVyIG9yIG9ic2VydmVyDQogICAqIEB0eXBlIHtPYmplY3RVUkx9DQogICAqLwoKICBfY3JlYXRlQ2xhc3MoRGF0YU9iamVjdCwgW3sKICAgIGtleTogJ3BhdXNlJywKCiAgICAvKioNCiAgICAgKiBAaWdub3JlDQogICAgICovCiAgICB2YWx1ZTogZnVuY3Rpb24gcGF1c2UoKSB7CiAgICAgIC8vVE9ETzogdGhpcyBmZWF0dXJlIG5lZWRzIG1vcmUgYW5hbGlzZQogICAgICB0aHJvdyAnTm90IGltcGxlbWVudGVkJzsKICAgIH0KCiAgICAvKioNCiAgICAgKiBAaWdub3JlDQogICAgICovCiAgfSwgewogICAga2V5OiAncmVzdW1lJywKICAgIHZhbHVlOiBmdW5jdGlvbiByZXN1bWUoKSB7CiAgICAgIC8vVE9ETzogdGhpcyBmZWF0dXJlIG5lZWRzIG1vcmUgYW5hbGlzZQogICAgICB0aHJvdyAnTm90IGltcGxlbWVudGVkJzsKICAgIH0KCiAgICAvKioNCiAgICAgKiBAaWdub3JlDQogICAgICovCiAgfSwgewogICAga2V5OiAnc3RvcCcsCiAgICB2YWx1ZTogZnVuY3Rpb24gc3RvcCgpIHsKICAgICAgLy9UT0RPOiBzaG91bGQgcmVtb3ZlIHRoZSBzdWJzY3JpcHRpb24gYW5kIHNlbmQgbWVzc2FnZSB1bnN1YnNjcmliZT8KICAgICAgdGhyb3cgJ05vdCBpbXBsZW1lbnRlZCc7CiAgICB9CgogICAgLyoqDQogICAgICogQGlnbm9yZQ0KICAgICAqLwogIH0sIHsKICAgIGtleTogJ3JlbGVhc2UnLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbGVhc2UoKSB7fQogICAgLy9UT0RPOiByZW1vdmUgYWxsIGxpc3RlbmVycyBmb3IgdGhpcyBvYmplY3QKCiAgICAvKioNCiAgICAgKiBDcmVhdGUgYW5kIGFkZCBhIGNoaWxkcmVuIHRvIHRoZSBzdWJzY3JpcHRpb24gZ3JvdXAuDQogICAgICogQHBhcmFtIHtTdHJpbmd9IHJlc291cmNlIC0gUmVzb3VyY2UgbmFtZSwgb25lIG9mIHRoZSBpdGVtcyBpbiB0aGUgc2NoZW1hLnByb3BlcnRpZXMuc2NoZW1lIG9mIHRoZSBwYXJlbnQgb2JqZWN0Lg0KICAgICAqIEBwYXJhbSB7SlNPTn0gaW5pdGlhbERhdGEgLSBJbml0aWFsIGRhdGEgb2YgdGhlIGNoaWxkDQogICAgICogQHJldHVybiB7UHJvbWlzZTxEYXRhT2JqZWN0Q2hpbGQ+fSAtIFJldHVybiBQcm9taXNlIHRvIGEgbmV3IENoaWxkcmVuLg0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICdhZGRDaGlsZHJlbicsCiAgICB2YWx1ZTogZnVuY3Rpb24gYWRkQ2hpbGRyZW4ocmVzb3VyY2UsIGluaXRpYWxEYXRhKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICAvL2NyZWF0ZSBuZXcgY2hpbGQgdW5pcXVlIElELCBiYXNlZCBvbiBoeXBlcnR5VVJMCiAgICAgIF90aGlzLl9jaGlsZElkKys7CiAgICAgIHZhciBtc2dDaGlsZElkID0gX3RoaXMuX293bmVyICsgJyMnICsgX3RoaXMuX2NoaWxkSWQ7CiAgICAgIHZhciBtc2dDaGlsZFBhdGggPSBfdGhpcy5fdXJsICsgJy9jaGlsZHJlbi8nICsgcmVzb3VyY2U7CgogICAgICB2YXIgcmVxdWVzdE1zZyA9IHsKICAgICAgICB0eXBlOiAnY3JlYXRlJywgZnJvbTogX3RoaXMuX293bmVyLCB0bzogbXNnQ2hpbGRQYXRoLAogICAgICAgIGJvZHk6IHsgcmVzb3VyY2U6IG1zZ0NoaWxkSWQsIHZhbHVlOiBpbml0aWFsRGF0YSB9CiAgICAgIH07CgogICAgICAvL3JldHVybnMgcHJvbWlzZSwgaW4gdGhlIGZ1dHVyZSwgdGhlIEFQSSBtYXkgY2hhbmdlIHRvIGFzeW5jaHJvbm91cyBjYWxsCiAgICAgIHJldHVybiBuZXcgX1Byb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHsKICAgICAgICB2YXIgbXNnSWQgPSBfdGhpcy5fYnVzLnBvc3RNZXNzYWdlKHJlcXVlc3RNc2cpOwoKICAgICAgICBjb25zb2xlLmxvZygnY3JlYXRlLXJlcG9ydGVyLWNoaWxkKCAnICsgX3RoaXMuX293bmVyICsgJyApOiAnLCByZXF1ZXN0TXNnKTsKICAgICAgICB2YXIgbmV3Q2hpbGQgPSBuZXcgX0RhdGFPYmplY3RDaGlsZDJbJ2RlZmF1bHQnXShfdGhpcy5fb3duZXIsIG1zZ0NoaWxkSWQsIG1zZ0lkLCBfdGhpcy5fYnVzLCBpbml0aWFsRGF0YSk7CiAgICAgICAgbmV3Q2hpbGQub25DaGFuZ2UoZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgICBfdGhpcy5fb25DaGFuZ2UoZXZlbnQsIHsgcGF0aDogbXNnQ2hpbGRQYXRoLCBjaGlsZElkOiBtc2dDaGlsZElkIH0pOwogICAgICAgIH0pOwoKICAgICAgICBfdGhpcy5fY2hpbGRyZW5bbXNnQ2hpbGRJZF0gPSBuZXdDaGlsZDsKCiAgICAgICAgcmVzb2x2ZShuZXdDaGlsZCk7CiAgICAgIH0pOwogICAgfQoKICAgIC8qKg0KICAgICAqIFNldHVwIHRoZSBjYWxsYmFjayB0byBwcm9jZXNzIGNyZWF0ZSBhbmQgZGVsZXRlIGNoaWxkcmVucw0KICAgICAqIEBwYXJhbSB7ZnVuY3Rpb24oZXZlbnQ6IE1zZ0V2ZW50KX0gY2FsbGJhY2sNCiAgICAgKi8KICB9LCB7CiAgICBrZXk6ICdvbkFkZENoaWxkcmVuJywKICAgIHZhbHVlOiBmdW5jdGlvbiBvbkFkZENoaWxkcmVuKGNhbGxiYWNrKSB7CiAgICAgIHRoaXMuX29uQWRkQ2hpbGRyZW5IYW5kbGVyID0gY2FsbGJhY2s7CiAgICB9CiAgfSwgewogICAga2V5OiAnX29uQ2hpbGRyZW5DcmVhdGUnLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9vbkNoaWxkcmVuQ3JlYXRlKG1zZykgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICB2YXIgbXNnQ2hpbGRJZCA9IG1zZy5ib2R5LnJlc291cmNlOwoKICAgICAgY29uc29sZS5sb2coJ2NyZWF0ZS1vYnNlcnZlci1jaGlsZCggJyArIF90aGlzLl9vd25lciArICcgKTogJywgbXNnKTsKICAgICAgdmFyIG5ld0NoaWxkID0gbmV3IF9EYXRhT2JqZWN0Q2hpbGQyWydkZWZhdWx0J10obXNnLmZyb20sIG1zZ0NoaWxkSWQsIDAsIF90aGlzLl9idXMsIG1zZy5ib2R5LnZhbHVlKTsKICAgICAgX3RoaXMuX2NoaWxkcmVuW21zZ0NoaWxkSWRdID0gbmV3Q2hpbGQ7CgogICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICBfdGhpcy5fYnVzLnBvc3RNZXNzYWdlKHsKICAgICAgICAgIGlkOiBtc2cuaWQsIHR5cGU6ICdyZXNwb25zZScsIGZyb206IG1zZy50bywgdG86IG1zZy5mcm9tLAogICAgICAgICAgYm9keTogeyBjb2RlOiAyMDAsIHNvdXJjZTogX3RoaXMuX293bmVyIH0KICAgICAgICB9KTsKICAgICAgfSk7CgogICAgICB2YXIgZXZlbnQgPSB7CiAgICAgICAgdHlwZTogbXNnLnR5cGUsCiAgICAgICAgZnJvbTogbXNnLmZyb20sCiAgICAgICAgdXJsOiBtc2cudG8sCiAgICAgICAgdmFsdWU6IG1zZy5ib2R5LnZhbHVlLAogICAgICAgIGNoaWxkSWQ6IG1zZ0NoaWxkSWQKICAgICAgfTsKCiAgICAgIGlmIChfdGhpcy5fb25BZGRDaGlsZHJlbkhhbmRsZXIpIHsKICAgICAgICBfdGhpcy5fb25BZGRDaGlsZHJlbkhhbmRsZXIoZXZlbnQpOwogICAgICB9CiAgICB9CgogICAgLy9zZW5kIGRlbHRhIG1lc3NhZ2VzIHRvIHN1YnNjcmlwdGlvbnMKICB9LCB7CiAgICBrZXk6ICdfb25DaGFuZ2UnLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9vbkNoYW5nZShldmVudCwgY2hpbGRJbmZvKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICBfdGhpcy5fdmVyc2lvbisrOwoKICAgICAgaWYgKF90aGlzLl9zdGF0dXMgPT09ICdvbicpIHsKICAgICAgICB2YXIgY2hhbmdlTXNnID0gewogICAgICAgICAgdHlwZTogJ3VwZGF0ZScsIGZyb206IF90aGlzLl91cmwsIHRvOiBfdGhpcy5fdXJsICsgJy9jaGFuZ2VzJywKICAgICAgICAgIGJvZHk6IHsgdmVyc2lvbjogX3RoaXMuX3ZlcnNpb24sIGF0dHJpYnV0ZTogZXZlbnQuZmllbGQgfQogICAgICAgIH07CgogICAgICAgIGlmIChldmVudC5vVHlwZSA9PT0gX1N5bmNPYmplY3QuT2JqZWN0VHlwZS5PQkpFQ1QpIHsKICAgICAgICAgIGlmIChldmVudC5jVHlwZSAhPT0gX1N5bmNPYmplY3QuQ2hhbmdlVHlwZS5SRU1PVkUpIHsKICAgICAgICAgICAgY2hhbmdlTXNnLmJvZHkudmFsdWUgPSBldmVudC5kYXRhOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjaGFuZ2VNc2cuYm9keS5hdHRyaWJ1dGVUeXBlID0gZXZlbnQub1R5cGU7CiAgICAgICAgICBjaGFuZ2VNc2cuYm9keS52YWx1ZSA9IGV2ZW50LmRhdGE7CiAgICAgICAgICBpZiAoZXZlbnQuY1R5cGUgIT09IF9TeW5jT2JqZWN0LkNoYW5nZVR5cGUuVVBEQVRFKSB7CiAgICAgICAgICAgIGNoYW5nZU1zZy5ib2R5Lm9wZXJhdGlvbiA9IGV2ZW50LmNUeXBlOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy9jaGlsZEluZm8gbXVzdCBoYXZlIChwYXRoLCBjaGlsZElkKQogICAgICAgIGlmIChjaGlsZEluZm8pIHsKICAgICAgICAgIGNoYW5nZU1zZy50byA9IGNoaWxkSW5mby5wYXRoOwogICAgICAgICAgY2hhbmdlTXNnLmJvZHkuY2hpbGRJZCA9IGNoaWxkSW5mby5jaGlsZElkOwogICAgICAgIH0KCiAgICAgICAgX3RoaXMuX2J1cy5wb3N0TWVzc2FnZShjaGFuZ2VNc2cpOwogICAgICB9CiAgICB9CgogICAgLy9yZWNlaXZlIGFuZCBwcm9jZXNzIGRlbHRhIG1lc3NhZ2VzCiAgfSwgewogICAga2V5OiAnX2NoYW5nZU9iamVjdCcsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2NoYW5nZU9iamVjdChzeW5jT2JqLCBtc2cpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIC8vVE9ETzogdXBkYXRlIHZlcnNpb24gPwogICAgICAvL2hvdyB0byBoYW5kbGUgYW4gaW5jb3JyZWN0IHZlcnNpb24gPyBFeGFtcGxlOiByZWNlaXZlIGEgdmVyc2lvbiAzIHdoZW4gdGhlIG9ic2VydmVyIGlzIGluIHZlcnNpb24gMSwgd2hlcmUgaXMgdGhlIHZlcnNpb24gMiA/CiAgICAgIC8vd2lsbCB3ZSBuZWVkIHRvIGNvbmZpcm0gdGhlIHJlY2VwdGlvbiA/CiAgICAgIGlmIChfdGhpcy5fdmVyc2lvbiArIDEgPT09IG1zZy5ib2R5LnZlcnNpb24pIHsKICAgICAgICBfdGhpcy5fdmVyc2lvbisrOwogICAgICAgIHZhciBwYXRoID0gbXNnLmJvZHkuYXR0cmlidXRlOwogICAgICAgIHZhciB2YWx1ZSA9ICgwLCBfdXRpbHNVdGlsc0pzLmRlZXBDbG9uZSkobXNnLmJvZHkudmFsdWUpOwogICAgICAgIHZhciBmaW5kUmVzdWx0ID0gc3luY09iai5maW5kQmVmb3JlKHBhdGgpOwoKICAgICAgICBpZiAobXNnLmJvZHkuYXR0cmlidXRlVHlwZSA9PT0gX1N5bmNPYmplY3QuT2JqZWN0VHlwZS5BUlJBWSkgewogICAgICAgICAgaWYgKG1zZy5ib2R5Lm9wZXJhdGlvbiA9PT0gX1N5bmNPYmplY3QuQ2hhbmdlVHlwZS5BREQpIHsKICAgICAgICAgICAgdmFyIGFyciA9IGZpbmRSZXN1bHQub2JqOwogICAgICAgICAgICB2YXIgaW5kZXggPSBmaW5kUmVzdWx0Lmxhc3Q7CiAgICAgICAgICAgIEFycmF5LnByb3RvdHlwZS5zcGxpY2UuYXBwbHkoYXJyLCBbaW5kZXgsIDBdLmNvbmNhdCh2YWx1ZSkpOwogICAgICAgICAgfSBlbHNlIGlmIChtc2cuYm9keS5vcGVyYXRpb24gPT09IF9TeW5jT2JqZWN0LkNoYW5nZVR5cGUuUkVNT1ZFKSB7CiAgICAgICAgICAgIHZhciBhcnIgPSBmaW5kUmVzdWx0Lm9iajsKICAgICAgICAgICAgdmFyIGluZGV4ID0gZmluZFJlc3VsdC5sYXN0OwogICAgICAgICAgICBhcnIuc3BsaWNlKGluZGV4LCB2YWx1ZSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBmaW5kUmVzdWx0Lm9ialtmaW5kUmVzdWx0Lmxhc3RdID0gdmFsdWU7IC8vIFVQREFURQogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmIChtc2cuYm9keS52YWx1ZSkgewogICAgICAgICAgICAgIGZpbmRSZXN1bHQub2JqW2ZpbmRSZXN1bHQubGFzdF0gPSB2YWx1ZTsgLy8gVVBEQVRFIG9yIEFERAogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgZGVsZXRlIGZpbmRSZXN1bHQub2JqW2ZpbmRSZXN1bHQubGFzdF07IC8vIFJFTU9WRQogICAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICAgIC8vVE9ETzogaG93IHRvIGhhbmRsZSB1bnN5bmNocm9uaXplZCB2ZXJzaW9ucz8KICAgICAgICAgIGNvbnNvbGUubG9nKCdVTlNZTkNIUk9OSVpFRCBWRVJTSU9OOiAoZGF0YSA9PiAnICsgX3RoaXMuX3ZlcnNpb24gKyAnLCBtc2cgPT4gJyArIG1zZy5ib2R5LnZlcnNpb24gKyAnKScpOwogICAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICdfY2hhbmdlQ2hpbGRyZW4nLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9jaGFuZ2VDaGlsZHJlbihtc2cpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgY29uc29sZS5sb2coJ0NoYW5nZSBjaGlsZHJlbjogJywgX3RoaXMuX293bmVyLCBtc2cpOwoKICAgICAgdmFyIGNoaWxkSWQgPSBtc2cuYm9keS5jaGlsZElkOwogICAgICB2YXIgY2hpbGRyZW4gPSBfdGhpcy5fY2hpbGRyZW5bY2hpbGRJZF07CgogICAgICBpZiAoY2hpbGRyZW4pIHsKICAgICAgICBfdGhpcy5fY2hhbmdlT2JqZWN0KGNoaWxkcmVuLl9zeW5jT2JqLCBtc2cpOwogICAgICB9IGVsc2UgewogICAgICAgIGNvbnNvbGUubG9nKCdObyBjaGlsZHJlbiBmb3VuZCBmb3I6ICcsIGNoaWxkSWQpOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAndXJsJywKICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICByZXR1cm4gdGhpcy5fdXJsOwogICAgfQoKICAgIC8qKg0KICAgICAqIE9iamVjdCBzY2hlbWEgVVJMICh0aGlzIGZpZWxkIGlzIG5vdCB5ZXQgc3RhYmxlLCBhbmQgaXMgc3Vic2plY3QgdG8gY2hhbmdlKQ0KICAgICAqIEB0eXBlIHtTY2hlbWFVUkx9DQogICAgICovCiAgfSwgewogICAga2V5OiAnc2NoZW1hJywKICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICByZXR1cm4gdGhpcy5fc2NoZW1hOwogICAgfQoKICAgIC8qKg0KICAgICAqIFN0YXR1cyBvZiB0aGUgcmVwb3J0ZXIgb3Igb2JzZXJ2ZXIgY29ubmVjdGlvbiAodGhpcyBmaWVsZCBpcyBub3QgeWV0IHN0YWJsZSwgYW5kIGlzIHN1YnNqZWN0IHRvIGNoYW5nZSkNCiAgICAgKiBAdHlwZSB7U3RhdHVzfSAtIEVudW0gb2Y6IG9uIHwgcGF1c2VkDQogICAgICovCiAgfSwgewogICAga2V5OiAnc3RhdHVzJywKICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICByZXR1cm4gdGhpcy5fc3RhdHVzOwogICAgfQoKICAgIC8qKg0KICAgICAqIERhdGEgc3RydWN0dXJlIHRvIGJlIHN5bmNocm9uaXplZC4NCiAgICAgKiBAdHlwZSB7SlNPTn0gLSBKU09OIHN0cnVjdHVyZSB0aGF0IHNob3VsZCBmb2xsb3cgdGhlIGRlZmluZWQgc2NoZW1hLCBpZiBhbnkuDQogICAgICovCiAgfSwgewogICAga2V5OiAnZGF0YScsCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgcmV0dXJuIHRoaXMuX3N5bmNPYmouZGF0YTsKICAgIH0KCiAgICAvKioNCiAgICAgKiBBbGwgY3JlYXRlZCBjaGlsZHJlbidzIHNpbmNlIHRoZSBzdWJzY3JpcHRpb24sIGRvZXNuJ3QgY29udGFpbiBhbGwgY2hpbGRyZW4ncyBzaW5jZSByZXBvcnRlciBjcmVhdGlvbi4NCiAgICAgKiBAdHlwZSB7T2JqZWN0PENoaWxkSWQsIERhdGFPYmplY3RDaGlsZD59DQogICAgICovCiAgfSwgewogICAga2V5OiAnY2hpbGRyZW4nLAogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgIHJldHVybiB0aGlzLl9jaGlsZHJlbjsKICAgIH0KICB9XSk7CgogIHJldHVybiBEYXRhT2JqZWN0Owp9KSgpOwoKZXhwb3J0c1snZGVmYXVsdCddID0gRGF0YU9iamVjdDsKbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWydkZWZhdWx0J107Cgp9LHsiLi4vdXRpbHMvdXRpbHMuanMiOjEwNCwiLi9EYXRhT2JqZWN0Q2hpbGQiOjk3LCIuL1N5bmNPYmplY3QiOjEwMSwiYmFiZWwtcnVudGltZS9jb3JlLWpzL3Byb21pc2UiOjcsImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jbGFzcy1jYWxsLWNoZWNrIjo5LCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY3JlYXRlLWNsYXNzIjoxMSwiYmFiZWwtcnVudGltZS9oZWxwZXJzL2ludGVyb3AtcmVxdWlyZS1kZWZhdWx0IjoxNX1dLDk3OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKJ3VzZSBzdHJpY3QnOwoKdmFyIF9jcmVhdGVDbGFzcyA9IHJlcXVpcmUoJ2JhYmVsLXJ1bnRpbWUvaGVscGVycy9jcmVhdGUtY2xhc3MnKVsnZGVmYXVsdCddOwoKdmFyIF9jbGFzc0NhbGxDaGVjayA9IHJlcXVpcmUoJ2JhYmVsLXJ1bnRpbWUvaGVscGVycy9jbGFzcy1jYWxsLWNoZWNrJylbJ2RlZmF1bHQnXTsKCnZhciBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0ID0gcmVxdWlyZSgnYmFiZWwtcnVudGltZS9oZWxwZXJzL2ludGVyb3AtcmVxdWlyZS1kZWZhdWx0JylbJ2RlZmF1bHQnXTsKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsKICB2YWx1ZTogdHJ1ZQp9KTsKCnZhciBfU3luY09iamVjdCA9IHJlcXVpcmUoJy4vU3luY09iamVjdCcpOwoKdmFyIF9TeW5jT2JqZWN0MiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX1N5bmNPYmplY3QpOwoKLyoqDQogKiBUaGUgY2xhc3MgcmV0dXJuZWQgZnJvbSB0aGUgRGF0YU9iamVjdCBhZGRDaGlsZHJlbiBjYWxsIG9yIGZyb20gb25BZGRDaGlsZHJlbiBpZiByZW1vdGVseSBjcmVhdGVkLg0KICogQ2hpbGRyZW4gb2JqZWN0IHN5bmNocm9uaXphdGlvbiBpcyBhIGEgZmFzdCBmb3J3YXJkIG1lY2hhbmlzbSwgbm8gbmVlZCBmb3IgZGlyZWN0IHN1YnNjcmlwdGlvbnMsIGl0IHVzZXMgdGhlIGFscmVhZHkgYXV0aG9yaXplZCBzdWJzY3JpcHRpb24gZnJvbSB0aGUgcGFyZW50IERhdGFPYmplY3QuDQogKi8KCnZhciBEYXRhT2JqZWN0Q2hpbGQgLyogaW1wbGVtZW50cyBTeW5jU3RhdHVzICovID0gKGZ1bmN0aW9uICgpIHsKICAvKiBwcml2YXRlDQogICAgLS0tLWV2ZW50IGhhbmRsZXJzLS0tLQ0KICBfb25SZXNwb25zZUhhbmRsZXI6IChldmVudCkgPT4gdm9pZA0KICAqLwoKICAvKioNCiAgICogQGlnbm9yZQ0KICAgKiBTaG91bGQgbm90IGJlIHVzZWQgZGlyZWN0bHkgYnkgSHlwZXJ0aWVzLiBJdCdzIGNhbGxlZCBieSB0aGUgRGF0YU9iamVjdC5hZGRDaGlsZHJlbg0KICAgKi8KCiAgZnVuY3Rpb24gRGF0YU9iamVjdENoaWxkKG93bmVyLCBjaGlsZElkLCBtc2dJZCwgYnVzLCBpbml0aWFsRGF0YSkgewogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIERhdGFPYmplY3RDaGlsZCk7CgogICAgdmFyIF90aGlzID0gdGhpczsKCiAgICBfdGhpcy5fb3duZXIgPSBvd25lcjsKICAgIF90aGlzLl9jaGlsZElkID0gY2hpbGRJZDsKICAgIF90aGlzLl9idXMgPSBidXM7CiAgICBfdGhpcy5fc3luY09iaiA9IG5ldyBfU3luY09iamVjdDJbJ2RlZmF1bHQnXShpbml0aWFsRGF0YSk7CgogICAgYnVzLmFkZExpc3RlbmVyKG93bmVyLCBmdW5jdGlvbiAobXNnKSB7CiAgICAgIGlmIChtc2cudHlwZSA9PT0gJ3Jlc3BvbnNlJyAmJiBtc2cuaWQgPT09IG1zZ0lkKSB7CiAgICAgICAgY29uc29sZS5sb2coJ0RhdGFPYmplY3RDaGlsZC5vblJlc3BvbnNlOicsIG1zZyk7CiAgICAgICAgX3RoaXMuX29uUmVzcG9uc2UobXNnKTsKICAgICAgfQogICAgfSk7CiAgfQoKICAvKioNCiAgICogQ2hpbGRyZW4gSUQgZ2VuZXJhdGVkIG9uIGFkZENoaWxkcmVuLiBVbmlxdWUgaWRlbnRpZmllcg0KICAgKiBAdHlwZSB7VVJMfSAtIFVSTCBvZiB0aGUgZm9ybWF0IDxIeXBlcnR5VVJMPiM8bnVtZXJpYy1zZXF1ZW5jZT4NCiAgICovCgogIF9jcmVhdGVDbGFzcyhEYXRhT2JqZWN0Q2hpbGQsIFt7CiAgICBrZXk6ICdvbkNoYW5nZScsCgogICAgLyoqDQogICAgICogUmVnaXN0ZXIgdGhlIGNoYW5nZSBsaXN0ZW5lcnMgc2VudCBieSB0aGUgcmVwb3J0ZXIgY2hpbGQNCiAgICAgKiBAcGFyYW0ge2Z1bmN0aW9uKGV2ZW50OiBNc2dFdmVudCl9IGNhbGxiYWNrDQogICAgICovCiAgICB2YWx1ZTogZnVuY3Rpb24gb25DaGFuZ2UoY2FsbGJhY2spIHsKICAgICAgdGhpcy5fc3luY09iai5vYnNlcnZlKGZ1bmN0aW9uIChldmVudCkgewogICAgICAgIGNhbGxiYWNrKGV2ZW50KTsKICAgICAgfSk7CiAgICB9CgogICAgLyoqDQogICAgICogU2V0dXAgdGhlIGNhbGxiYWNrIHRvIHByb2Nlc3MgcmVzcG9uc2Ugbm90aWZpY2F0aW9ucyBvZiB0aGUgY3JlYXRlcw0KICAgICAqIEBwYXJhbSB7ZnVuY3Rpb24oZXZlbnQ6IE1zZ0V2ZW50KX0gY2FsbGJhY2sNCiAgICAgKi8KICB9LCB7CiAgICBrZXk6ICdvblJlc3BvbnNlJywKICAgIHZhbHVlOiBmdW5jdGlvbiBvblJlc3BvbnNlKGNhbGxiYWNrKSB7CiAgICAgIHRoaXMuX29uUmVzcG9uc2VIYW5kbGVyID0gY2FsbGJhY2s7CiAgICB9CiAgfSwgewogICAga2V5OiAnX29uUmVzcG9uc2UnLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9vblJlc3BvbnNlKG1zZykgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgdmFyIGV2ZW50ID0gewogICAgICAgIHR5cGU6IG1zZy50eXBlLAogICAgICAgIHVybDogbXNnLmJvZHkuc291cmNlLAogICAgICAgIGNvZGU6IG1zZy5ib2R5LmNvZGUKICAgICAgfTsKCiAgICAgIGlmIChfdGhpcy5fb25SZXNwb25zZUhhbmRsZXIpIHsKICAgICAgICBfdGhpcy5fb25SZXNwb25zZUhhbmRsZXIoZXZlbnQpOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAnY2hpbGRJZCcsCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2NoaWxkSWQ7CiAgICB9CgogICAgLyoqDQogICAgICogRGF0YSBTdHJ1Y3R1cmUgdG8gYmUgc3luY2hyb25pemVkLg0KICAgICAqIEB0eXBlIHtKU09OfSAtIEpTT04gc3RydWN0dXJlIHRoYXQgc2hvdWxkIGZvbGxvdyB0aGUgZGVmaW5lZCBzY2hlbWEsIGlmIGFueS4NCiAgICAgKi8KICB9LCB7CiAgICBrZXk6ICdkYXRhJywKICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICByZXR1cm4gdGhpcy5fc3luY09iai5kYXRhOwogICAgfQogIH1dKTsKCiAgcmV0dXJuIERhdGFPYmplY3RDaGlsZDsKfSkoKTsKCmV4cG9ydHNbJ2RlZmF1bHQnXSA9IERhdGFPYmplY3RDaGlsZDsKbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWydkZWZhdWx0J107Cgp9LHsiLi9TeW5jT2JqZWN0IjoxMDEsImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jbGFzcy1jYWxsLWNoZWNrIjo5LCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY3JlYXRlLWNsYXNzIjoxMSwiYmFiZWwtcnVudGltZS9oZWxwZXJzL2ludGVyb3AtcmVxdWlyZS1kZWZhdWx0IjoxNX1dLDk4OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKJ3VzZSBzdHJpY3QnOwoKdmFyIF9nZXQgPSByZXF1aXJlKCdiYWJlbC1ydW50aW1lL2hlbHBlcnMvZ2V0JylbJ2RlZmF1bHQnXTsKCnZhciBfaW5oZXJpdHMgPSByZXF1aXJlKCdiYWJlbC1ydW50aW1lL2hlbHBlcnMvaW5oZXJpdHMnKVsnZGVmYXVsdCddOwoKdmFyIF9jcmVhdGVDbGFzcyA9IHJlcXVpcmUoJ2JhYmVsLXJ1bnRpbWUvaGVscGVycy9jcmVhdGUtY2xhc3MnKVsnZGVmYXVsdCddOwoKdmFyIF9jbGFzc0NhbGxDaGVjayA9IHJlcXVpcmUoJ2JhYmVsLXJ1bnRpbWUvaGVscGVycy9jbGFzcy1jYWxsLWNoZWNrJylbJ2RlZmF1bHQnXTsKCnZhciBfT2JqZWN0JGtleXMgPSByZXF1aXJlKCdiYWJlbC1ydW50aW1lL2NvcmUtanMvb2JqZWN0L2tleXMnKVsnZGVmYXVsdCddOwoKdmFyIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQgPSByZXF1aXJlKCdiYWJlbC1ydW50aW1lL2hlbHBlcnMvaW50ZXJvcC1yZXF1aXJlLWRlZmF1bHQnKVsnZGVmYXVsdCddOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgewogIHZhbHVlOiB0cnVlCn0pOwoKdmFyIF9EYXRhT2JqZWN0MiA9IHJlcXVpcmUoJy4vRGF0YU9iamVjdCcpOwoKdmFyIF9EYXRhT2JqZWN0MyA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX0RhdGFPYmplY3QyKTsKCnZhciBGaWx0ZXJUeXBlID0geyBBTlk6ICdhbnknLCBTVEFSVDogJ3N0YXJ0JywgRVhBQ1Q6ICdleGFjdCcgfTsKCi8qKg0KICogVGhlIGNsYXNzIHJldHVybmVkIGZyb20gdGhlIFN5bmNoZXIgc3Vic2NyaWJlIGNhbGwuDQogKiBUbyBiZSB1c2VkIGFzIGFuIG9ic2VydmF0aW9uIHBvaW50IGZyb20gYSBEYXRhT2JqZWN0UmVwb3J0ZXIgY2hhbmdlLg0KICovCgp2YXIgRGF0YU9iamVjdE9ic2VydmVyID0gKGZ1bmN0aW9uIChfRGF0YU9iamVjdCkgewogIF9pbmhlcml0cyhEYXRhT2JqZWN0T2JzZXJ2ZXIsIF9EYXRhT2JqZWN0KTsKCiAgLyogcHJpdmF0ZQ0KICAgIC0tLS1ldmVudCBoYW5kbGVycy0tLS0NCiAgX2ZpbHRlcnM6IHs8ZmlsdGVyPjoge3R5cGU6IDxzdGFydCwgZXhhY3Q+LCBjYWxsYmFjazogPGZ1bmN0aW9uPn0gfQ0KICAqLwoKICAvKioNCiAgICogQGlnbm9yZQ0KICAgKiBTaG91bGQgbm90IGJlIHVzZWQgZGlyZWN0bHkgYnkgSHlwZXJ0aWVzLiBJdCdzIGNhbGxlZCBieSB0aGUgU3luY2hlci5zdWJzY3JpYmUgbWV0aG9kDQogICAqLwoKICBmdW5jdGlvbiBEYXRhT2JqZWN0T2JzZXJ2ZXIob3duZXIsIHVybCwgc2NoZW1hLCBidXMsIGluaXRpYWxTdGF0dXMsIGluaXRpYWxEYXRhLCBjaGlsZHJlbiwgaW5pdGlhbFZlcnNpb24pIHsKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBEYXRhT2JqZWN0T2JzZXJ2ZXIpOwoKICAgIF9nZXQoT2JqZWN0LmdldFByb3RvdHlwZU9mKERhdGFPYmplY3RPYnNlcnZlci5wcm90b3R5cGUpLCAnY29uc3RydWN0b3InLCB0aGlzKS5jYWxsKHRoaXMsIG93bmVyLCB1cmwsIHNjaGVtYSwgYnVzLCBpbml0aWFsU3RhdHVzLCBpbml0aWFsRGF0YSwgY2hpbGRyZW4pOwogICAgdmFyIF90aGlzID0gdGhpczsKCiAgICBfdGhpcy5fdmVyc2lvbiA9IGluaXRpYWxWZXJzaW9uOwoKICAgIC8vYWRkIGxpc3RlbmVyIGZvciBvYmpVUkwKICAgIGJ1cy5hZGRMaXN0ZW5lcih1cmwgKyAnL2NoYW5nZXMnLCBmdW5jdGlvbiAobXNnKSB7CiAgICAgIGNvbnNvbGUubG9nKCdEYXRhT2JqZWN0T2JzZXJ2ZXItJyArIHVybCArICctUkNWOiAnLCBtc2cpOwogICAgICBfdGhpcy5fY2hhbmdlT2JqZWN0KF90aGlzLl9zeW5jT2JqLCBtc2cpOwogICAgfSk7CgogICAgX3RoaXMuX3N5bmNPYmoub2JzZXJ2ZShmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgX3RoaXMuX29uRmlsdGVyKGV2ZW50KTsKICAgIH0pOwoKICAgIF90aGlzLl9maWx0ZXJzID0ge307CiAgfQoKICAvKioNCiAgICogUmVnaXN0ZXIgdGhlIGNoYW5nZSBsaXN0ZW5lcnMgc2VudCBieSB0aGUgcmVwb3J0ZXINCiAgICogQHBhcmFtIHtzdHJpbmd9IGZpbHRlciAtIEZpbHRlciB0aGF0IGlkZW50aWZpZXMgdGhlIGZpZWxkIChzZXBhcmV0ZWQgZG90IHBhdGgpLiBBY2NlcHRzICogYXQgdGhlIGVuZCBmb3IgYSBtb3JlIHVucmVzdHJpY3RlZCBmaWx0ZXJpbmcuDQogICAqIEBwYXJhbSB7ZnVuY3Rpb24oZXZlbnQ6IE1zZ0V2ZW50KX0gY2FsbGJhY2sNCiAgICovCgogIF9jcmVhdGVDbGFzcyhEYXRhT2JqZWN0T2JzZXJ2ZXIsIFt7CiAgICBrZXk6ICdvbkNoYW5nZScsCiAgICB2YWx1ZTogZnVuY3Rpb24gb25DaGFuZ2UoZmlsdGVyLCBjYWxsYmFjaykgewogICAgICB2YXIga2V5ID0gZmlsdGVyOwogICAgICB2YXIgZmlsdGVyT2JqID0gewogICAgICAgIHR5cGU6IEZpbHRlclR5cGUuRVhBQ1QsCiAgICAgICAgY2FsbGJhY2s6IGNhbGxiYWNrCiAgICAgIH07CgogICAgICB2YXIgaWR4ID0gZmlsdGVyLmluZGV4T2YoJyonKTsKICAgICAgaWYgKGlkeCA9PT0gZmlsdGVyLmxlbmd0aCAtIDEpIHsKICAgICAgICBpZiAoaWR4ID09PSAwKSB7CiAgICAgICAgICBmaWx0ZXJPYmoudHlwZSA9IEZpbHRlclR5cGUuQU5ZOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBmaWx0ZXJPYmoudHlwZSA9IEZpbHRlclR5cGUuU1RBUlQ7CiAgICAgICAgICBrZXkgPSBmaWx0ZXIuc3Vic3RyKDAsIGZpbHRlci5sZW5ndGggLSAxKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuX2ZpbHRlcnNba2V5XSA9IGZpbHRlck9iajsKICAgIH0KICB9LCB7CiAgICBrZXk6ICdfb25GaWx0ZXInLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9vbkZpbHRlcihldmVudCkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgX09iamVjdCRrZXlzKF90aGlzLl9maWx0ZXJzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICB2YXIgZmlsdGVyID0gX3RoaXMuX2ZpbHRlcnNba2V5XTsKICAgICAgICBpZiAoZmlsdGVyLnR5cGUgPT09IEZpbHRlclR5cGUuQU5ZKSB7CiAgICAgICAgICAvL21hdGNoIGFueXRoaW5nCiAgICAgICAgICBmaWx0ZXIuY2FsbGJhY2soZXZlbnQpOwogICAgICAgIH0gZWxzZSBpZiAoZmlsdGVyLnR5cGUgPT09IEZpbHRlclR5cGUuU1RBUlQpIHsKICAgICAgICAgIC8vaWYgc3RhcnRzIHdpdGggZmlsdGVyLi4uCiAgICAgICAgICBpZiAoZXZlbnQuZmllbGQuaW5kZXhPZihrZXkpID09PSAwKSB7CiAgICAgICAgICAgIGZpbHRlci5jYWxsYmFjayhldmVudCk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChmaWx0ZXIudHlwZSA9PT0gRmlsdGVyVHlwZS5FWEFDVCkgewogICAgICAgICAgLy9leGFjdCBtYXRjaAogICAgICAgICAgaWYgKGV2ZW50LmZpZWxkID09PSBrZXkpIHsKICAgICAgICAgICAgZmlsdGVyLmNhbGxiYWNrKGV2ZW50KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pOwogICAgfQogIH1dKTsKCiAgcmV0dXJuIERhdGFPYmplY3RPYnNlcnZlcjsKfSkoX0RhdGFPYmplY3QzWydkZWZhdWx0J10gLyogaW1wbGVtZW50cyBTeW5jU3RhdHVzICovKTsKCmV4cG9ydHNbJ2RlZmF1bHQnXSA9IERhdGFPYmplY3RPYnNlcnZlcjsKbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWydkZWZhdWx0J107Cgp9LHsiLi9EYXRhT2JqZWN0Ijo5NiwiYmFiZWwtcnVudGltZS9jb3JlLWpzL29iamVjdC9rZXlzIjo1LCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY2xhc3MtY2FsbC1jaGVjayI6OSwiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NyZWF0ZS1jbGFzcyI6MTEsImJhYmVsLXJ1bnRpbWUvaGVscGVycy9nZXQiOjEzLCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvaW5oZXJpdHMiOjE0LCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvaW50ZXJvcC1yZXF1aXJlLWRlZmF1bHQiOjE1fV0sOTk6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewondXNlIHN0cmljdCc7Cgp2YXIgX2dldCA9IHJlcXVpcmUoJ2JhYmVsLXJ1bnRpbWUvaGVscGVycy9nZXQnKVsnZGVmYXVsdCddOwoKdmFyIF9pbmhlcml0cyA9IHJlcXVpcmUoJ2JhYmVsLXJ1bnRpbWUvaGVscGVycy9pbmhlcml0cycpWydkZWZhdWx0J107Cgp2YXIgX2NyZWF0ZUNsYXNzID0gcmVxdWlyZSgnYmFiZWwtcnVudGltZS9oZWxwZXJzL2NyZWF0ZS1jbGFzcycpWydkZWZhdWx0J107Cgp2YXIgX2NsYXNzQ2FsbENoZWNrID0gcmVxdWlyZSgnYmFiZWwtcnVudGltZS9oZWxwZXJzL2NsYXNzLWNhbGwtY2hlY2snKVsnZGVmYXVsdCddOwoKdmFyIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQgPSByZXF1aXJlKCdiYWJlbC1ydW50aW1lL2hlbHBlcnMvaW50ZXJvcC1yZXF1aXJlLWRlZmF1bHQnKVsnZGVmYXVsdCddOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgewogIHZhbHVlOiB0cnVlCn0pOwoKdmFyIF9EYXRhT2JqZWN0MiA9IHJlcXVpcmUoJy4vRGF0YU9iamVjdCcpOwoKdmFyIF9EYXRhT2JqZWN0MyA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX0RhdGFPYmplY3QyKTsKCnZhciBfdXRpbHNVdGlsc0pzID0gcmVxdWlyZSgnLi4vdXRpbHMvdXRpbHMuanMnKTsKCi8qKg0KICogVGhlIGNsYXNzIHJldHVybmVkIGZyb20gdGhlIFN5bmNoZXIgY3JlYXRlIGNhbGwuDQogKiBUbyBiZSB1c2VkIGFzIGEgcmVwb3J0ZXIgcG9pbnQsIGNoYW5nZXMgd2lsbCBiZSBzdWJtaXRlZCB0byBEYXRhT2JqZWN0T2JzZXJ2ZXIgaW5zdGFuY2VzLg0KICovCgp2YXIgRGF0YU9iamVjdFJlcG9ydGVyID0gKGZ1bmN0aW9uIChfRGF0YU9iamVjdCkgewogIF9pbmhlcml0cyhEYXRhT2JqZWN0UmVwb3J0ZXIsIF9EYXRhT2JqZWN0KTsKCiAgLyogcHJpdmF0ZQ0KICBfc3Vic2NyaXB0aW9uczogPGh5cGVydHlVcmw6IHsgc3RhdHVzOiBzdHJpbmcgfSB9Pg0KICAgIC0tLS1ldmVudCBoYW5kbGVycy0tLS0NCiAgX29uU3Vic2NyaXB0aW9uSGFuZGxlcjogKGV2ZW50KSA9PiB2b2lkDQogIF9vblJlc3BvbnNlSGFuZGxlcjogKGV2ZW50KSA9PiB2b2lkDQogICovCgogIC8qKg0KICAgKiBAaWdub3JlDQogICAqIFNob3VsZCBub3QgYmUgdXNlZCBkaXJlY3RseSBieSBIeXBlcnRpZXMuIEl0J3MgY2FsbGVkIGJ5IHRoZSBTeW5jaGVyLmNyZWF0ZSBtZXRob2QNCiAgICovCgogIGZ1bmN0aW9uIERhdGFPYmplY3RSZXBvcnRlcihvd25lciwgdXJsLCBzY2hlbWEsIGJ1cywgaW5pdGlhbFN0YXR1cywgaW5pdGlhbERhdGEsIGNoaWxkcmVuKSB7CiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgRGF0YU9iamVjdFJlcG9ydGVyKTsKCiAgICBfZ2V0KE9iamVjdC5nZXRQcm90b3R5cGVPZihEYXRhT2JqZWN0UmVwb3J0ZXIucHJvdG90eXBlKSwgJ2NvbnN0cnVjdG9yJywgdGhpcykuY2FsbCh0aGlzLCBvd25lciwgdXJsLCBzY2hlbWEsIGJ1cywgaW5pdGlhbFN0YXR1cywgaW5pdGlhbERhdGEsIGNoaWxkcmVuKTsKICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgYnVzLmFkZExpc3RlbmVyKHVybCwgZnVuY3Rpb24gKG1zZykgewogICAgICBpZiAobXNnLnR5cGUgPT09ICdyZXNwb25zZScpIHsKICAgICAgICBfdGhpcy5fb25SZXNwb25zZShtc2cpOwogICAgICB9CiAgICB9KTsKCiAgICBfdGhpcy5fc3luY09iai5vYnNlcnZlKGZ1bmN0aW9uIChldmVudCkgewogICAgICBjb25zb2xlLmxvZygnRGF0YU9iamVjdFJlcG9ydGVyLScgKyB1cmwgKyAnLVNFTkQ6ICcsIGV2ZW50KTsKICAgICAgX3RoaXMuX29uQ2hhbmdlKGV2ZW50KTsKICAgIH0pOwoKICAgIF90aGlzLl9zdWJzY3JpcHRpb25zID0ge307CiAgfQoKICAvKioNCiAgICogU3Vic2NyaXB0aW9ucyByZXF1ZXN0ZWQgYW5kIGFjY2VwdGVkIHRvIHRoaXMgcmVwb3J0ZXINCiAgICogQHR5cGUge09iamVjdDxIeXBlcnR5VVJMLCBTeW5jU3Vic2NyaXB0aW9uPn0NCiAgICovCgogIF9jcmVhdGVDbGFzcyhEYXRhT2JqZWN0UmVwb3J0ZXIsIFt7CiAgICBrZXk6ICdvblN1YnNjcmlwdGlvbicsCgogICAgLyoqDQogICAgICogU2V0dXAgdGhlIGNhbGxiYWNrIHRvIHByb2Nlc3Mgc3Vic2NyaWJlIGFuZCB1bnN1YnNjcmliZSBub3RpZmljYXRpb25zDQogICAgICogQHBhcmFtIHtmdW5jdGlvbihldmVudDogTXNnRXZlbnQpfSBjYWxsYmFjaw0KICAgICAqLwogICAgdmFsdWU6IGZ1bmN0aW9uIG9uU3Vic2NyaXB0aW9uKGNhbGxiYWNrKSB7CiAgICAgIHRoaXMuX29uU3Vic2NyaXB0aW9uSGFuZGxlciA9IGNhbGxiYWNrOwogICAgfQoKICAgIC8qKg0KICAgICAqIFNldHVwIHRoZSBjYWxsYmFjayB0byBwcm9jZXNzIHJlc3BvbnNlIG5vdGlmaWNhdGlvbnMgb2YgdGhlIGNyZWF0ZSdzDQogICAgICogQHBhcmFtIHtmdW5jdGlvbihldmVudDogTXNnRXZlbnQpfSBjYWxsYmFjaw0KICAgICAqLwogIH0sIHsKICAgIGtleTogJ29uUmVzcG9uc2UnLAogICAgdmFsdWU6IGZ1bmN0aW9uIG9uUmVzcG9uc2UoY2FsbGJhY2spIHsKICAgICAgdGhpcy5fb25SZXNwb25zZUhhbmRsZXIgPSBjYWxsYmFjazsKICAgIH0KICB9LCB7CiAgICBrZXk6ICdfb25Gb3J3YXJkJywKICAgIHZhbHVlOiBmdW5jdGlvbiBfb25Gb3J3YXJkKG1zZykgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgY29uc29sZS5sb2coJ0RhdGFPYmplY3RSZXBvcnRlci1SQ1Y6ICcsIG1zZyk7CiAgICAgIHN3aXRjaCAobXNnLmJvZHkudHlwZSkgewogICAgICAgIGNhc2UgJ3N1YnNjcmliZSc6CiAgICAgICAgICBfdGhpcy5fb25TdWJzY3JpYmUobXNnKTticmVhazsKICAgICAgICBjYXNlICd1bnN1YnNjcmliZSc6CiAgICAgICAgICBfdGhpcy5fb25VblN1YnNjcmliZShtc2cpO2JyZWFrOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAnX29uU3Vic2NyaWJlJywKICAgIHZhbHVlOiBmdW5jdGlvbiBfb25TdWJzY3JpYmUobXNnKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgIHZhciBoeXBlcnR5VXJsID0gbXNnLmJvZHkuZnJvbTsKCiAgICAgIHZhciBldmVudCA9IHsKICAgICAgICB0eXBlOiBtc2cuYm9keS50eXBlLAogICAgICAgIHVybDogaHlwZXJ0eVVybCwKCiAgICAgICAgYWNjZXB0OiBmdW5jdGlvbiBhY2NlcHQoKSB7CiAgICAgICAgICAvL2NyZWF0ZSBuZXcgc3Vic2NyaXB0aW9uCiAgICAgICAgICB2YXIgc3ViID0geyB1cmw6IGh5cGVydHlVcmwsIHN0YXR1czogJ29uJyB9OwogICAgICAgICAgX3RoaXMuX3N1YnNjcmlwdGlvbnNbaHlwZXJ0eVVybF0gPSBzdWI7CgogICAgICAgICAgLy9zZW5kIG9rIHJlc3BvbnNlIG1lc3NhZ2UKICAgICAgICAgIF90aGlzLl9idXMucG9zdE1lc3NhZ2UoewogICAgICAgICAgICBpZDogbXNnLmlkLCB0eXBlOiAncmVzcG9uc2UnLCBmcm9tOiBtc2cudG8sIHRvOiBtc2cuZnJvbSwKICAgICAgICAgICAgYm9keTogeyBjb2RlOiAyMDAsIHNjaGVtYTogX3RoaXMuX3NjaGVtYSwgdmVyc2lvbjogX3RoaXMuX3ZlcnNpb24sIHZhbHVlOiAoMCwgX3V0aWxzVXRpbHNKcy5kZWVwQ2xvbmUpKF90aGlzLmRhdGEpIH0KICAgICAgICAgIH0pOwoKICAgICAgICAgIHJldHVybiBzdWI7CiAgICAgICAgfSwKCiAgICAgICAgcmVqZWN0OiBmdW5jdGlvbiByZWplY3QocmVhc29uKSB7CiAgICAgICAgICAvL3NlbmQgcmVqZWN0IHJlc3BvbnNlIG1lc3NhZ2UKICAgICAgICAgIF90aGlzLl9idXMucG9zdE1lc3NhZ2UoewogICAgICAgICAgICBpZDogbXNnLmlkLCB0eXBlOiAncmVzcG9uc2UnLCBmcm9tOiBtc2cudG8sIHRvOiBtc2cuZnJvbSwKICAgICAgICAgICAgYm9keTogeyBjb2RlOiA0MDMsIGRlc2M6IHJlYXNvbiB9CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH07CgogICAgICBpZiAoX3RoaXMuX29uU3Vic2NyaXB0aW9uSGFuZGxlcikgewogICAgICAgIGNvbnNvbGUubG9nKCdTVUJTQ1JJUFRJT04tRVZFTlQ6ICcsIGV2ZW50KTsKICAgICAgICBfdGhpcy5fb25TdWJzY3JpcHRpb25IYW5kbGVyKGV2ZW50KTsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogJ19vblVuU3Vic2NyaWJlJywKICAgIHZhbHVlOiBmdW5jdGlvbiBfb25VblN1YnNjcmliZShtc2cpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgdmFyIGh5cGVydHlVcmwgPSBtc2cuYm9keS5mcm9tOwoKICAgICAgdmFyIHN1YiA9IF90aGlzLl9zdWJzY3JpcHRpb25zW2h5cGVydHlVcmxdOwogICAgICBkZWxldGUgX3RoaXMuX3N1YnNjcmlwdGlvbnNbaHlwZXJ0eVVybF07CgogICAgICB2YXIgZXZlbnQgPSB7CiAgICAgICAgdHlwZTogbXNnLmJvZHkudHlwZSwKICAgICAgICB1cmw6IGh5cGVydHlVcmwsCiAgICAgICAgb2JqZWN0OiBzdWIKICAgICAgfTsKCiAgICAgIGlmIChfdGhpcy5fb25TdWJzY3JpcHRpb25IYW5kbGVyKSB7CiAgICAgICAgY29uc29sZS5sb2coJ1VOLVNVQlNDUklQVElPTi1FVkVOVDogJywgZXZlbnQpOwogICAgICAgIF90aGlzLl9vblN1YnNjcmlwdGlvbkhhbmRsZXIoZXZlbnQpOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAnX29uUmVzcG9uc2UnLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9vblJlc3BvbnNlKG1zZykgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgdmFyIGV2ZW50ID0gewogICAgICAgIHR5cGU6IG1zZy50eXBlLAogICAgICAgIHVybDogbXNnLmZyb20sCiAgICAgICAgY29kZTogbXNnLmJvZHkuY29kZQogICAgICB9OwoKICAgICAgaWYgKF90aGlzLl9vblJlc3BvbnNlSGFuZGxlcikgewogICAgICAgIGNvbnNvbGUubG9nKCdSRVNQT05TRS1FVkVOVDogJywgZXZlbnQpOwogICAgICAgIF90aGlzLl9vblJlc3BvbnNlSGFuZGxlcihldmVudCk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICdzdWJzY3JpcHRpb25zJywKICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICByZXR1cm4gdGhpcy5fc3Vic2NyaXB0aW9uczsKICAgIH0KICB9XSk7CgogIHJldHVybiBEYXRhT2JqZWN0UmVwb3J0ZXI7Cn0pKF9EYXRhT2JqZWN0M1snZGVmYXVsdCddIC8qIGltcGxlbWVudHMgU3luY1N0YXR1cyAqLyk7CgpleHBvcnRzWydkZWZhdWx0J10gPSBEYXRhT2JqZWN0UmVwb3J0ZXI7Cm1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1snZGVmYXVsdCddOwoKfSx7Ii4uL3V0aWxzL3V0aWxzLmpzIjoxMDQsIi4vRGF0YU9iamVjdCI6OTYsImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jbGFzcy1jYWxsLWNoZWNrIjo5LCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY3JlYXRlLWNsYXNzIjoxMSwiYmFiZWwtcnVudGltZS9oZWxwZXJzL2dldCI6MTMsImJhYmVsLXJ1bnRpbWUvaGVscGVycy9pbmhlcml0cyI6MTQsImJhYmVsLXJ1bnRpbWUvaGVscGVycy9pbnRlcm9wLXJlcXVpcmUtZGVmYXVsdCI6MTV9XSwxMDA6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewovKioNCiAqIEBhY2Nlc3MgcHJpdmF0ZQ0KICovCid1c2Ugc3RyaWN0JzsKCnZhciBfY3JlYXRlQ2xhc3MgPSByZXF1aXJlKCdiYWJlbC1ydW50aW1lL2hlbHBlcnMvY3JlYXRlLWNsYXNzJylbJ2RlZmF1bHQnXTsKCnZhciBfY2xhc3NDYWxsQ2hlY2sgPSByZXF1aXJlKCdiYWJlbC1ydW50aW1lL2hlbHBlcnMvY2xhc3MtY2FsbC1jaGVjaycpWydkZWZhdWx0J107CgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7CiAgdmFsdWU6IHRydWUKfSk7Cgp2YXIgRGF0YVByb3Zpc2lvbmFsID0gKGZ1bmN0aW9uICgpIHsKICAvKiBwcml2YXRlDQogIF9jaGlsZHJlbkxpc3RlbmVyczogW01zZ0xpc3RlbmVyXQ0KICBfbGlzdGVuZXI6IE1zZ0xpc3RlbmVyDQogICAgX2NoYW5nZXM6IFtdDQogICovCgogIGZ1bmN0aW9uIERhdGFQcm92aXNpb25hbChvd25lciwgdXJsLCBidXMsIGNoaWxkcmVuKSB7CiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgRGF0YVByb3Zpc2lvbmFsKTsKCiAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgIF90aGlzLl9jaGFuZ2VzID0gW107CiAgICBfdGhpcy5fY2hpbGRyZW4gPSBjaGlsZHJlbjsKICAgIF90aGlzLl9jaGlsZHJlbkxpc3RlbmVycyA9IFtdOwoKICAgIF90aGlzLl9saXN0ZW5lciA9IGJ1cy5hZGRMaXN0ZW5lcih1cmwsIGZ1bmN0aW9uIChtc2cpIHsKICAgICAgY29uc29sZS5sb2coJ0RhdGFQcm92aXNpb25hbC0nICsgdXJsICsgJy1SQ1Y6ICcsIG1zZyk7CiAgICAgIF90aGlzLl9jaGFuZ2VzLnB1c2gobXNnKTsKICAgIH0pOwoKICAgIC8qaWYgKGNoaWxkcmVuKSB7DQogICAgICBsZXQgY2hpbGRCYXNlVVJMID0gdXJsICsgJy9jaGlsZHJlbi8nOw0KICAgICAgY2hpbGRyZW4uZm9yRWFjaCgoY2hpbGQpID0+IHsNCiAgICAgICAgbGV0IGNoaWxkVVJMID0gY2hpbGRCYXNlVVJMICsgY2hpbGQ7DQogICAgICAgIGxldCBsaXN0ZW5lciA9IGJ1cy5hZGRMaXN0ZW5lcihjaGlsZFVSTCwgKG1zZykgPT4gew0KICAgICAgICAgIC8vaWdub3JlIG1zZyBzZW50IGJ5IGhpbXNlbGYNCiAgICAgICAgICBpZiAobXNnLmZyb20gIT09IG93bmVyKSB7DQogICAgICAgICAgICBjb25zb2xlLmxvZyhtc2cpOw0KICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgICAgICAgX3RoaXMuX2NoaWxkcmVuTGlzdGVuZXJzLnB1c2gobGlzdGVuZXIpOw0KICAgICAgfSk7DQogICAgfSovCiAgfQoKICBfY3JlYXRlQ2xhc3MoRGF0YVByb3Zpc2lvbmFsLCBbewogICAga2V5OiAnYXBwbHknLAogICAgdmFsdWU6IGZ1bmN0aW9uIGFwcGx5KG9ic2VydmVyKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgIF90aGlzLl9jaGFuZ2VzLmZvckVhY2goZnVuY3Rpb24gKGNoYW5nZSkgewogICAgICAgIG9ic2VydmVyLl9jaGFuZ2VPYmplY3Qob2JzZXJ2ZXIuX3N5bmNPYmosIGNoYW5nZSk7CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogJ3JlbGVhc2UnLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbGVhc2UoKSB7CiAgICAgIHRoaXMuX2xpc3RlbmVyLnJlbW92ZSgpOwoKICAgICAgLyp0aGlzLl9jaGlsZHJlbkxpc3RlbmVycy5mb3JFYWNoKChsaXN0ZW5lcikgPT4gew0KICAgICAgICBsaXN0ZW5lci5yZW1vdmUoKTsNCiAgICAgIH0pOyovCiAgICB9CiAgfSwgewogICAga2V5OiAnY2hpbGRyZW4nLAogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgIHJldHVybiB0aGlzLl9jaGlsZHJlbjsKICAgIH0KICB9XSk7CgogIHJldHVybiBEYXRhUHJvdmlzaW9uYWw7Cn0pKCk7CgpleHBvcnRzWydkZWZhdWx0J10gPSBEYXRhUHJvdmlzaW9uYWw7Cm1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1snZGVmYXVsdCddOwoKfSx7ImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jbGFzcy1jYWxsLWNoZWNrIjo5LCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY3JlYXRlLWNsYXNzIjoxMX1dLDEwMTpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Cid1c2Ugc3RyaWN0JzsKCnZhciBfY3JlYXRlQ2xhc3MgPSByZXF1aXJlKCdiYWJlbC1ydW50aW1lL2hlbHBlcnMvY3JlYXRlLWNsYXNzJylbJ2RlZmF1bHQnXTsKCnZhciBfY2xhc3NDYWxsQ2hlY2sgPSByZXF1aXJlKCdiYWJlbC1ydW50aW1lL2hlbHBlcnMvY2xhc3MtY2FsbC1jaGVjaycpWydkZWZhdWx0J107Cgp2YXIgX09iamVjdCRrZXlzID0gcmVxdWlyZSgnYmFiZWwtcnVudGltZS9jb3JlLWpzL29iamVjdC9rZXlzJylbJ2RlZmF1bHQnXTsKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsKICB2YWx1ZTogdHJ1ZQp9KTsKCnZhciBfdXRpbHNVdGlsc0pzID0gcmVxdWlyZSgnLi4vdXRpbHMvdXRpbHMuanMnKTsKCi8qKg0KICogQGFjY2VzcyBwcml2YXRlDQogKi8KCnZhciBTeW5jT2JqZWN0ID0gKGZ1bmN0aW9uICgpIHsKICAvKiBwcml2YXRlDQogICAgX2RhdGE6IGFueTsNCiAgICBfb2JzZXJ2ZXJzOiAoKGV2ZW50OiBDaGFuZ2VFdmVudCkgPT4gdm9pZClbXQ0KICAqLwoKICBmdW5jdGlvbiBTeW5jT2JqZWN0KGluaXRpYWxEYXRhKSB7CiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgU3luY09iamVjdCk7CgogICAgdmFyIF90aGlzID0gdGhpczsKCiAgICBfdGhpcy5fb2JzZXJ2ZXJzID0gW107CiAgICBfdGhpcy5fZmlsdGVycyA9IHt9OwoKICAgIGlmIChpbml0aWFsRGF0YSkgewogICAgICBfdGhpcy5fZGF0YSA9ICgwLCBfdXRpbHNVdGlsc0pzLmRlZXBDbG9uZSkoaW5pdGlhbERhdGEpOwogICAgfSBlbHNlIHsKICAgICAgX3RoaXMuX2RhdGEgPSB7fTsKICAgIH0KCiAgICBfdGhpcy5faW50ZXJuYWxPYnNlcnZlKG5ldyBQYXRoKCksIF90aGlzLl9kYXRhKTsKICB9CgogIC8vZHluYW1pYyBwYXRoIGZvciBBcnJheSBpbmRleC4uLgoKICBfY3JlYXRlQ2xhc3MoU3luY09iamVjdCwgW3sKICAgIGtleTogJ29ic2VydmUnLAogICAgdmFsdWU6IGZ1bmN0aW9uIG9ic2VydmUoY2FsbGJhY2spIHsKICAgICAgdGhpcy5fb2JzZXJ2ZXJzLnB1c2goY2FsbGJhY2spOwogICAgfQogIH0sIHsKICAgIGtleTogJ2ZpbmQnLAogICAgdmFsdWU6IGZ1bmN0aW9uIGZpbmQocGF0aCkgewogICAgICB2YXIgbGlzdCA9IHBhdGguc3BsaXQoJy4nKTsKCiAgICAgIHJldHVybiB0aGlzLl9maW5kV2l0aFNwbGl0KGxpc3QpOwogICAgfQogIH0sIHsKICAgIGtleTogJ2ZpbmRCZWZvcmUnLAogICAgdmFsdWU6IGZ1bmN0aW9uIGZpbmRCZWZvcmUocGF0aCkgewogICAgICB2YXIgcmVzdWx0ID0ge307CiAgICAgIHZhciBsaXN0ID0gcGF0aC5zcGxpdCgnLicpOwogICAgICByZXN1bHQubGFzdCA9IGxpc3QucG9wKCk7CiAgICAgIHJlc3VsdC5vYmogPSB0aGlzLl9maW5kV2l0aFNwbGl0KGxpc3QpOwoKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICB9LCB7CiAgICBrZXk6ICdfZmluZFdpdGhTcGxpdCcsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2ZpbmRXaXRoU3BsaXQobGlzdCkgewogICAgICB2YXIgb2JqID0gdGhpcy5fZGF0YTsKICAgICAgbGlzdC5mb3JFYWNoKGZ1bmN0aW9uICh2YWx1ZSkgewogICAgICAgIG9iaiA9IG9ialt2YWx1ZV07CiAgICAgIH0pOwoKICAgICAgcmV0dXJuIG9iajsKICAgIH0KICB9LCB7CiAgICBrZXk6ICdfZmlyZUV2ZW50JywKICAgIHZhbHVlOiBmdW5jdGlvbiBfZmlyZUV2ZW50KGV2ZW50KSB7CiAgICAgIHRoaXMuX29ic2VydmVycy5mb3JFYWNoKGZ1bmN0aW9uIChjYWxsYmFjaykgewogICAgICAgIGNhbGxiYWNrKGV2ZW50KTsKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAnX2lzT2JzZXJ2YWJsZScsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2lzT2JzZXJ2YWJsZShvYmopIHsKICAgICAgaWYgKG9iai5jb25zdHJ1Y3RvciA9PT0gT2JqZWN0IHx8IG9iai5jb25zdHJ1Y3RvciA9PT0gQXJyYXkpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQoKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogIH0sIHsKICAgIGtleTogJ19pbnRlcm5hbE9ic2VydmUnLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9pbnRlcm5hbE9ic2VydmUocGF0aCwgb2JqKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICBpZiAoX3RoaXMuX2lzT2JzZXJ2YWJsZShvYmopKSB7CiAgICAgICAgdmFyIGhhbmRsZXIgPSBmdW5jdGlvbiBoYW5kbGVyKGNoYW5nZXMpIHsKICAgICAgICAgIF90aGlzLl9vbkNoYW5nZXMocGF0aCwgY2hhbmdlcyk7CiAgICAgICAgfTsKCiAgICAgICAgaWYgKG9iai5jb25zdHJ1Y3RvciA9PT0gT2JqZWN0KSB7CiAgICAgICAgICBPYmplY3Qub2JzZXJ2ZShvYmosIGhhbmRsZXIpOwogICAgICAgICAgZm9yICh2YXIgcHJvcCBpbiBvYmopIHsKICAgICAgICAgICAgaWYgKF90aGlzLl9pc09ic2VydmFibGUob2JqW3Byb3BdKSkgewogICAgICAgICAgICAgIF90aGlzLl9pbnRlcm5hbE9ic2VydmUocGF0aFsnbmV3J10ocHJvcCksIG9ialtwcm9wXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKG9iai5jb25zdHJ1Y3RvciA9PT0gQXJyYXkpIHsKICAgICAgICAgIEFycmF5Lm9ic2VydmUob2JqLCBoYW5kbGVyKTsKICAgICAgICAgIGZvciAodmFyIHByb3AgaW4gb2JqKSB7CiAgICAgICAgICAgIGlmIChfdGhpcy5faXNPYnNlcnZhYmxlKG9ialtwcm9wXSkpIHsKICAgICAgICAgICAgICB2YXIgbnAgPSBwYXRoWyduZXcnXShuZXcgQXJyYXlJbmRleChvYmpbcHJvcF0sIHByb3ApKTsKICAgICAgICAgICAgICBfdGhpcy5faW50ZXJuYWxPYnNlcnZlKG5wLCBvYmpbcHJvcF0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAnX29uQ2hhbmdlcycsCiAgICB2YWx1ZTogZnVuY3Rpb24gX29uQ2hhbmdlcyhwYXRoLCBjaGFuZ2VzKSB7CiAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgICAgZm9yICh2YXIgaSBpbiBjaGFuZ2VzKSB7CiAgICAgICAgdmFyIG9iaiA9IGNoYW5nZXNbaV0ub2JqZWN0OwogICAgICAgIHZhciBvYmpUeXBlID0gdW5kZWZpbmVkOwoKICAgICAgICBpZiAob2JqLmNvbnN0cnVjdG9yID09PSBPYmplY3QpIHsKICAgICAgICAgIG9ialR5cGUgPSBPYmplY3RUeXBlLk9CSkVDVDsKICAgICAgICB9CgogICAgICAgIGlmIChvYmouY29uc3RydWN0b3IgPT09IEFycmF5KSB7CiAgICAgICAgICBvYmpUeXBlID0gT2JqZWN0VHlwZS5BUlJBWTsKICAgICAgICB9CgogICAgICAgIGlmIChjaGFuZ2VzW2ldLnR5cGUgPT09ICdzcGxpY2UnKSB7CiAgICAgICAgICAoZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgaWR4ID0gY2hhbmdlc1tpXS5pbmRleDsKICAgICAgICAgICAgdmFyIGZpZWxkID0gcGF0aFsnbmV3J10oJycgKyBpZHgpOwogICAgICAgICAgICB2YXIgZmllbGRTdHJpbmcgPSBmaWVsZC50b1N0cmluZygpOwoKICAgICAgICAgICAgdmFyIHJlbW92ZVNpemUgPSBjaGFuZ2VzW2ldLnJlbW92ZWQubGVuZ3RoOwogICAgICAgICAgICBpZiAocmVtb3ZlU2l6ZSAhPT0gMCkgewogICAgICAgICAgICAgIHZhciByZW1vdmVWYWx1ZXMgPSBjaGFuZ2VzW2ldLnJlbW92ZWQ7CiAgICAgICAgICAgICAgcmVtb3ZlVmFsdWVzLmZvckVhY2goZnVuY3Rpb24gKHZhbHVlLCBpbmRleCkgewogICAgICAgICAgICAgICAgaWYgKF90aGlzMi5faXNPYnNlcnZhYmxlKHZhbHVlKSkgewogICAgICAgICAgICAgICAgICBwYXRoLnJlbW92ZUluZGV4KGlkeCArIGluZGV4KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgX3RoaXMyLl9maXJlRXZlbnQoewogICAgICAgICAgICAgICAgY1R5cGU6IENoYW5nZVR5cGUuUkVNT1ZFLAogICAgICAgICAgICAgICAgb1R5cGU6IG9ialR5cGUsCiAgICAgICAgICAgICAgICBmaWVsZDogZmllbGRTdHJpbmcsCiAgICAgICAgICAgICAgICBkYXRhOiByZW1vdmVTaXplCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBhZGRTaXplID0gY2hhbmdlc1tpXS5hZGRlZENvdW50OwogICAgICAgICAgICBpZiAoYWRkU2l6ZSAhPT0gMCkgewogICAgICAgICAgICAgIHZhciBhZGRWYWx1ZXMgPSBvYmouc2xpY2UoaWR4LCBpZHggKyBhZGRTaXplKTsKICAgICAgICAgICAgICBhZGRWYWx1ZXMuZm9yRWFjaChmdW5jdGlvbiAodmFsdWUsIGluZGV4KSB7CiAgICAgICAgICAgICAgICBpZiAoX3RoaXMyLl9pc09ic2VydmFibGUodmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgIHZhciBucCA9IHBhdGhbJ25ldyddKG5ldyBBcnJheUluZGV4KHZhbHVlLCBpZHggKyBpbmRleCkpOwogICAgICAgICAgICAgICAgICBfdGhpczIuX2ludGVybmFsT2JzZXJ2ZShucCwgdmFsdWUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBfdGhpczIuX2ZpcmVFdmVudCh7CiAgICAgICAgICAgICAgICBjVHlwZTogQ2hhbmdlVHlwZS5BREQsCiAgICAgICAgICAgICAgICBvVHlwZTogb2JqVHlwZSwKICAgICAgICAgICAgICAgIGZpZWxkOiBmaWVsZFN0cmluZywKICAgICAgICAgICAgICAgIGRhdGE6ICgwLCBfdXRpbHNVdGlsc0pzLmRlZXBDbG9uZSkoYWRkVmFsdWVzKQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvL3JlLWRlZmluZSBwYXRocy4uLgogICAgICAgICAgICBpZiAoaWR4ICE9PSBvYmoubGVuZ3RoIC0gMSkgewogICAgICAgICAgICAgIHBhdGgucmVJbmRleEZyb20ob2JqKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSkoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdmFyIGZpZWxkID0gcGF0aFsnbmV3J10oY2hhbmdlc1tpXS5uYW1lKTsKICAgICAgICAgIHZhciBmaWVsZFN0cmluZyA9IGZpZWxkLnRvU3RyaW5nKCk7CgogICAgICAgICAgaWYgKGZpZWxkU3RyaW5nLmluZGV4T2YoJ1N5bWJvbCcpICE9PSAtMSkgewogICAgICAgICAgICAvL2hhY2sgZm9yIFBoYW50b21KUzIKICAgICAgICAgICAgLy9jb25zb2xlLmxvZygnU1lNQk9MOiAnLCBjaGFuZ2VzW2ldKTsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CgogICAgICAgICAgLy9sZXQgb2xkVmFsdWUgPSBjaGFuZ2VzW2ldLm9sZFZhbHVlOwogICAgICAgICAgdmFyIG5ld1ZhbHVlID0gb2JqW2NoYW5nZXNbaV0ubmFtZV07CiAgICAgICAgICBpZiAoY2hhbmdlc1tpXS50eXBlID09PSAndXBkYXRlJykgewogICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoewogICAgICAgICAgICAgIGNUeXBlOiBDaGFuZ2VUeXBlLlVQREFURSwKICAgICAgICAgICAgICBvVHlwZTogb2JqVHlwZSwKICAgICAgICAgICAgICBmaWVsZDogZmllbGRTdHJpbmcsCiAgICAgICAgICAgICAgZGF0YTogKDAsIF91dGlsc1V0aWxzSnMuZGVlcENsb25lKShuZXdWYWx1ZSkKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGNoYW5nZXNbaV0udHlwZSA9PT0gJ2FkZCcpIHsKICAgICAgICAgICAgdGhpcy5faW50ZXJuYWxPYnNlcnZlKGZpZWxkLCBuZXdWYWx1ZSk7CiAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudCh7CiAgICAgICAgICAgICAgY1R5cGU6IENoYW5nZVR5cGUuQURELAogICAgICAgICAgICAgIG9UeXBlOiBvYmpUeXBlLAogICAgICAgICAgICAgIGZpZWxkOiBmaWVsZFN0cmluZywKICAgICAgICAgICAgICBkYXRhOiAoMCwgX3V0aWxzVXRpbHNKcy5kZWVwQ2xvbmUpKG5ld1ZhbHVlKQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoY2hhbmdlc1tpXS50eXBlID09PSAnZGVsZXRlJykgewogICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoewogICAgICAgICAgICAgIGNUeXBlOiBDaGFuZ2VUeXBlLlJFTU9WRSwKICAgICAgICAgICAgICBvVHlwZTogb2JqVHlwZSwKICAgICAgICAgICAgICBmaWVsZDogZmllbGRTdHJpbmcKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAnZGF0YScsCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2RhdGE7CiAgICB9CiAgfV0pOwoKICByZXR1cm4gU3luY09iamVjdDsKfSkoKTsKCnZhciBQYXRoID0gKGZ1bmN0aW9uICgpIHsKICBmdW5jdGlvbiBQYXRoKCkgewogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFBhdGgpOwoKICAgIHRoaXMuX3BhdGggPSBbXTsKICAgIHRoaXMuX29ic2VydmFibGVzID0ge307IC8vPGluZGV4OkFycmF5SW5kZXg+CiAgfQoKICBfY3JlYXRlQ2xhc3MoUGF0aCwgW3sKICAgIGtleTogJ3JlbW92ZUluZGV4JywKICAgIHZhbHVlOiBmdW5jdGlvbiByZW1vdmVJbmRleChpZHgpIHsKICAgICAgLy9jb25zb2xlLmxvZygnUkVNT1ZFLVBBVEggJyArIGlkeCk7CiAgICAgIGRlbGV0ZSB0aGlzLl9vYnNlcnZhYmxlc1tpZHhdOwogICAgfQogIH0sIHsKICAgIGtleTogJ3JlSW5kZXhGcm9tJywKICAgIHZhbHVlOiBmdW5jdGlvbiByZUluZGV4RnJvbShhcnJheSkgewogICAgICB2YXIgX3RoaXMzID0gdGhpczsKCiAgICAgIF9PYmplY3Qka2V5cyh0aGlzLl9vYnNlcnZhYmxlcykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgdmFyIGFycmF5SW5kZXggPSBfdGhpczMuX29ic2VydmFibGVzW2tleV07CiAgICAgICAgdmFyIGlkeCA9IGFycmF5LmluZGV4T2YoYXJyYXlJbmRleC5vYmopOwogICAgICAgIGlmIChhcnJheUluZGV4LmlkeCAhPSBpZHgpIHsKICAgICAgICAgIC8vY29uc29sZS5sb2coJ1JFLUlOREVYOiAnICsga2V5ICsgJy0+JyArIGlkeCk7CiAgICAgICAgICBhcnJheUluZGV4LmlkeCA9IGlkeDsKICAgICAgICAgIGRlbGV0ZSBfdGhpczMuX29ic2VydmFibGVzW2tleV07CiAgICAgICAgICBfdGhpczMuX29ic2VydmFibGVzW2lkeF0gPSBhcnJheUluZGV4OwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAnbmV3JywKICAgIHZhbHVlOiBmdW5jdGlvbiBfbmV3KGlkeCkgewogICAgICBpZiAoaWR4LmNvbnN0cnVjdG9yID09IEFycmF5SW5kZXgpIHsKICAgICAgICAvL2NvbnNvbGUubG9nKCdQQVRILU9CU0VSVjogJywgaWR4KTsKICAgICAgICB0aGlzLl9vYnNlcnZhYmxlc1tpZHguaWR4XSA9IGlkeDsKICAgICAgfQoKICAgICAgdmFyIG5QYXRoID0gdGhpcy5jbG9uZSgpOwogICAgICBuUGF0aC5fcGF0aC5wdXNoKGlkeCk7CgogICAgICByZXR1cm4gblBhdGg7CiAgICB9CiAgfSwgewogICAga2V5OiAnY2xvbmUnLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNsb25lKCkgewogICAgICB2YXIgblBhdGggPSBuZXcgUGF0aCgpOwogICAgICB0aGlzLl9wYXRoLmZvckVhY2goZnVuY3Rpb24gKHZhbHVlKSB7CiAgICAgICAgblBhdGguX3BhdGgucHVzaCh2YWx1ZSk7CiAgICAgIH0pOwoKICAgICAgcmV0dXJuIG5QYXRoOwogICAgfQogIH0sIHsKICAgIGtleTogJ3RvU3RyaW5nJywKICAgIHZhbHVlOiBmdW5jdGlvbiB0b1N0cmluZygpIHsKICAgICAgLy9UT0RPOiBvcHRpbWl6ZSEhCiAgICAgIHZhciBzdHIgPSAnJzsKICAgICAgdGhpcy5fcGF0aC5mb3JFYWNoKGZ1bmN0aW9uICh2YWx1ZSwgaW5kZXgpIHsKICAgICAgICBpZiAoaW5kZXggPT09IDApIHsKICAgICAgICAgIHN0ciA9IHZhbHVlLnRvU3RyaW5nKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHN0ciArPSAnLicgKyB2YWx1ZS50b1N0cmluZygpOwogICAgICAgIH0KICAgICAgfSk7CgogICAgICByZXR1cm4gc3RyOwogICAgfQogIH1dKTsKCiAgcmV0dXJuIFBhdGg7Cn0pKCk7Cgp2YXIgQXJyYXlJbmRleCA9IChmdW5jdGlvbiAoKSB7CiAgZnVuY3Rpb24gQXJyYXlJbmRleChvYmosIGlkeCkgewogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEFycmF5SW5kZXgpOwoKICAgIHRoaXMub2JqID0gb2JqOwogICAgdGhpcy5pZHggPSBpZHg7CiAgfQoKICBfY3JlYXRlQ2xhc3MoQXJyYXlJbmRleCwgW3sKICAgIGtleTogJ3RvU3RyaW5nJywKICAgIHZhbHVlOiBmdW5jdGlvbiB0b1N0cmluZygpIHsKICAgICAgcmV0dXJuIHRoaXMuaWR4LnRvU3RyaW5nKCk7CiAgICB9CiAgfV0pOwoKICByZXR1cm4gQXJyYXlJbmRleDsKfSkoKTsKCnZhciBDaGFuZ2VUeXBlID0geyBVUERBVEU6ICd1cGRhdGUnLCBBREQ6ICdhZGQnLCBSRU1PVkU6ICdyZW1vdmUnIH07CmV4cG9ydHMuQ2hhbmdlVHlwZSA9IENoYW5nZVR5cGU7CnZhciBPYmplY3RUeXBlID0geyBPQkpFQ1Q6ICdvYmplY3QnLCBBUlJBWTogJ2FycmF5JyB9OwpleHBvcnRzLk9iamVjdFR5cGUgPSBPYmplY3RUeXBlOwpleHBvcnRzWydkZWZhdWx0J10gPSBTeW5jT2JqZWN0OwoKfSx7Ii4uL3V0aWxzL3V0aWxzLmpzIjoxMDQsImJhYmVsLXJ1bnRpbWUvY29yZS1qcy9vYmplY3Qva2V5cyI6NSwiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NsYXNzLWNhbGwtY2hlY2siOjksImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jcmVhdGUtY2xhc3MiOjExfV0sMTAyOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKJ3VzZSBzdHJpY3QnOwoKdmFyIF9jcmVhdGVDbGFzcyA9IHJlcXVpcmUoJ2JhYmVsLXJ1bnRpbWUvaGVscGVycy9jcmVhdGUtY2xhc3MnKVsnZGVmYXVsdCddOwoKdmFyIF9jbGFzc0NhbGxDaGVjayA9IHJlcXVpcmUoJ2JhYmVsLXJ1bnRpbWUvaGVscGVycy9jbGFzcy1jYWxsLWNoZWNrJylbJ2RlZmF1bHQnXTsKCnZhciBfUHJvbWlzZSA9IHJlcXVpcmUoJ2JhYmVsLXJ1bnRpbWUvY29yZS1qcy9wcm9taXNlJylbJ2RlZmF1bHQnXTsKCnZhciBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0ID0gcmVxdWlyZSgnYmFiZWwtcnVudGltZS9oZWxwZXJzL2ludGVyb3AtcmVxdWlyZS1kZWZhdWx0JylbJ2RlZmF1bHQnXTsKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsKICB2YWx1ZTogdHJ1ZQp9KTsKCnZhciBfRGF0YU9iamVjdFJlcG9ydGVyID0gcmVxdWlyZSgnLi9EYXRhT2JqZWN0UmVwb3J0ZXInKTsKCnZhciBfRGF0YU9iamVjdFJlcG9ydGVyMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX0RhdGFPYmplY3RSZXBvcnRlcik7Cgp2YXIgX0RhdGFPYmplY3RPYnNlcnZlciA9IHJlcXVpcmUoJy4vRGF0YU9iamVjdE9ic2VydmVyJyk7Cgp2YXIgX0RhdGFPYmplY3RPYnNlcnZlcjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9EYXRhT2JqZWN0T2JzZXJ2ZXIpOwoKdmFyIF9EYXRhUHJvdmlzaW9uYWwgPSByZXF1aXJlKCcuL0RhdGFQcm92aXNpb25hbCcpOwoKdmFyIF9EYXRhUHJvdmlzaW9uYWwyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfRGF0YVByb3Zpc2lvbmFsKTsKCi8qKg0KICogVGhlIG1haW4gY2xhc3MgZm9yIHRoZSBzeW5jaGVyIHBhY2thZ2UuDQogKiBUaGUgU3luY2hlciBpcyBhIHNpbmdsZXRvbiBjbGFzcyBwZXIgSHlwZXJ0eS9VUkwgYW5kIGl0IGlzIHRoZSBvd25lciBvZiBhbGwgY3JlYXRlZCBEYXRhIFN5bmMgT2JqZWN0cyBhY2NvcmRpbmcgdG8gdGhlIFJlcG9ydGVyIC0gT2JzZXJ2ZXIgcGF0dGVybi4NCiAqIE1haW4gZnVuY3Rpb25hbGl0eSBpcyB0byBjcmVhdGUgcmVwb3J0ZXJzIGFuZCB0byBzdWJzY3JpYmUgdG8gZXhpc3Rpbmcgb25lcy4NCiAqLwoKdmFyIFN5bmNoZXIgPSAoZnVuY3Rpb24gKCkgewogIC8qIHByaXZhdGUNCiAgX293bmVyOiBVUkwNCiAgX2J1czogTWluaUJ1cw0KICAgIF9zdWJVUkw6IFVSTA0KICAgIF9yZXBvcnRlcnM6IDx1cmw6IERhdGFPYmplY3RSZXBvcnRlcj4NCiAgX29ic2VydmVyczogPHVybDogRGF0YU9iamVjdE9ic2VydmVyPg0KICBfcHJvdmlzaW9uYWxzOiA8dXJsOiBEYXRhUHJvdmlzaW9uYWw+DQogICAgLS0tLWV2ZW50IGhhbmRsZXJzLS0tLQ0KICBfb25Ob3RpZmljYXRpb25IYW5kbGVyOiAoZXZlbnQpID0+IHZvaWQNCiAgKi8KCiAgLyoqDQogICAqIENvbnN0cnVjdG9yIHRoYXQgc2hvdWxkIGJlIHVzZWQgYnkgdGhlIEh5cGVydHkgb3duZXINCiAgICogQHBhcmFtIHtIeXBlcnR5VVJMfSBvd25lciAtIEh5cGVydHkgVVJMIG93bmVyLiBBbiBVUkwgYWxsb2NhdGVkIGJ5IHRoZSBydW50aW1lIHRoYXQgdW5pcXVlbHkgaWRlbnRpZmllcyB0aGUgSHlwZXJ0eS4NCiAgICogQHBhcmFtIHtNaW5pQnVzfSBidXMgLSBBbiBpbnN0YW5jZSBvZiB0aGUgTWluaUJ1cyBwcm92aWRlZCBpbiB0aGUgc2FuZGJveC4gV2hlbiBhbiBvYmplY3QgKFJlcG9ydGVyIG9yIE9ic2VydmVkKSBpcyBjcmVhdGVkLCB0aGUgU3luY2hlck1hbmFnZXIgd2lsbCBhZGQgYSBsaXN0ZW5lciBpbiB0aGUgTWluaUJ1cyB0byByZWNlaXZlL3NlbmQgTWVzc2FnZXMgb2YgdGhhdCBvYmplY3QuDQogICAqIEBwYXJhbSB7SlNPTn0gY29uZmlnIC0gQ29uZmlndXJhdGlvbiBkYXRhLiBUaGUgb25seSByZXF1aXJlZCBmaWVsZCBmb3Igbm93IGlzIHRoZSBydW50aW1lVVJMLg0KICAgKi8KCiAgZnVuY3Rpb24gU3luY2hlcihvd25lciwgYnVzLCBjb25maWcpIHsKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBTeW5jaGVyKTsKCiAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgIF90aGlzLl9vd25lciA9IG93bmVyOwogICAgX3RoaXMuX2J1cyA9IGJ1czsKCiAgICBfdGhpcy5fc3ViVVJMID0gY29uZmlnLnJ1bnRpbWVVUkwgKyAnL3NtJzsKCiAgICBfdGhpcy5fcmVwb3J0ZXJzID0ge307CiAgICBfdGhpcy5fb2JzZXJ2ZXJzID0ge307CiAgICBfdGhpcy5fcHJvdmlzaW9uYWxzID0ge307CgogICAgYnVzLmFkZExpc3RlbmVyKG93bmVyLCBmdW5jdGlvbiAobXNnKSB7CiAgICAgIGNvbnNvbGUubG9nKCdTeW5jaGVyLVJDVjogJywgbXNnKTsKICAgICAgc3dpdGNoIChtc2cudHlwZSkgewogICAgICAgIGNhc2UgJ2ZvcndhcmQnOgogICAgICAgICAgX3RoaXMuX29uRm9yd2FyZChtc2cpO2JyZWFrOwogICAgICAgIGNhc2UgJ2NyZWF0ZSc6CiAgICAgICAgICBfdGhpcy5fb25SZW1vdGVDcmVhdGUobXNnKTticmVhazsKICAgICAgfQogICAgfSk7CiAgfQoKICAvKioNCiAgICogVGhlIG93bmVyIG9mIHRoZSBTeW5jaGVyIGFuZCBhbGwgY3JlYXRlZCByZXBvcnRlcnMuDQogICAqIEB0eXBlIHtIeXBlcnR5VVJMfQ0KICAgKi8KCiAgX2NyZWF0ZUNsYXNzKFN5bmNoZXIsIFt7CiAgICBrZXk6ICdjcmVhdGUnLAoKICAgIC8qKg0KICAgICAqIFJlcXVlc3QgYSBEYXRhT2JqZWN0UmVwb3J0ZXIgY3JlYXRpb24uIFRoZSBVUkwgd2lsbCBiZSBiZSByZXF1ZXN0ZWQgYnkgdGhlIGFsbG9jYXRpb24gbWVjaGFuaXNtLg0KICAgICAqIEBwYXJhbSAge1NjaGVtYVVSTH0gc2NoZW1hIC0gVVJMIG9mIHRoZSBvYmplY3QgZGVzY3JpcHRvcg0KICAgICAqIEBwYXJhbSAge0h5cGVydHlVUkxbXX0gb2JzZXJ2ZXJzIC0gTGlzdCBvZiBoeXBlcnRpZXMgdGhhdCBhcmUgcHJlLWF1dGhvcml6ZWQgZm9yIHN1YnNjcmlwdGlvbg0KICAgICAqIEBwYXJhbSAge0pTT059IGluaXRpYWxEYXRhIC0gSW5pdGlhbCBkYXRhIG9mIHRoZSByZXBvcnRlcg0KICAgICAqIEByZXR1cm4ge1Byb21pc2U8RGF0YU9iamVjdFJlcG9ydGVyPn0gUmV0dXJuIFByb21pc2UgdG8gYSBuZXcgUmVwb3J0ZXIuIFRoZSByZXBvcnRlciBjYW4gYmUgYWNjZXB0ZWQgb3IgcmVqZWN0ZWQgYnkgdGhlIFBFUA0KICAgICAqLwogICAgdmFsdWU6IGZ1bmN0aW9uIGNyZWF0ZShzY2hlbWEsIG9ic2VydmVycywgaW5pdGlhbERhdGEpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIHZhciByZXF1ZXN0TXNnID0gewogICAgICAgIHR5cGU6ICdjcmVhdGUnLCBmcm9tOiBfdGhpcy5fb3duZXIsIHRvOiBfdGhpcy5fc3ViVVJMLAogICAgICAgIGJvZHk6IHsgc2NoZW1hOiBzY2hlbWEsIHZhbHVlOiBpbml0aWFsRGF0YSwgYXV0aG9yaXNlOiBvYnNlcnZlcnMgfQogICAgICB9OwoKICAgICAgcmV0dXJuIG5ldyBfUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgLy9yZXF1ZXN0IGNyZWF0ZSB0byB0aGUgQWxsb2NhdGlvbiBzeXN0ZW0/IENhbiBiZSByZWplY3RlZCBieSB0aGUgUG9saWN5RW5naW5lLgogICAgICAgIF90aGlzLl9idXMucG9zdE1lc3NhZ2UocmVxdWVzdE1zZywgZnVuY3Rpb24gKHJlcGx5KSB7CiAgICAgICAgICBjb25zb2xlLmxvZygnY3JlYXRlLXJlc3BvbnNlOiAnLCByZXBseSk7CiAgICAgICAgICBpZiAocmVwbHkuYm9keS5jb2RlID09PSAyMDApIHsKICAgICAgICAgICAgdmFyIG9ialVSTCA9IHJlcGx5LmJvZHkucmVzb3VyY2U7CgogICAgICAgICAgICAvL3JlcG9ydGVyIGNyZWF0aW9uIGFjY2VwdGVkCiAgICAgICAgICAgIHZhciBuZXdPYmogPSBuZXcgX0RhdGFPYmplY3RSZXBvcnRlcjJbJ2RlZmF1bHQnXShfdGhpcy5fb3duZXIsIG9ialVSTCwgc2NoZW1hLCBfdGhpcy5fYnVzLCAnb24nLCBpbml0aWFsRGF0YSwgcmVwbHkuYm9keS5jaGlsZHJlblJlc291cmNlcyk7CiAgICAgICAgICAgIF90aGlzLl9yZXBvcnRlcnNbb2JqVVJMXSA9IG5ld09iajsKCiAgICAgICAgICAgIHJlc29sdmUobmV3T2JqKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vcmVwb3J0ZXIgY3JlYXRpb24gcmVqZWN0ZWQKICAgICAgICAgICAgcmVqZWN0KHJlcGx5LmJvZHkuZGVzYyk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQoKICAgIC8qKg0KICAgICAqIFJlcXVlc3QgYSBzdWJzY3JpcHRpb24gdG8gYW4gZXhpc3RlbnQgb2JqZWN0Lg0KICAgICAqIEBwYXJhbSB7U2NoZW1hVVJMfSBzY2hlbWEgLSBVUkwgb2YgdGhlIG9iamVjdCBkZXNjcmlwdG9yDQogICAgICogQHBhcmFtIHtPYmplY3RVUkx9IG9ialVSTCAtIEFkZHJlc3Mgb2YgdGhlIGV4aXN0ZW50IHJlcG9ydGVyIG9iamVjdA0KICAgICAqIEByZXR1cm4ge1Byb21pc2U8RGF0YU9iamVjdE9ic2VydmVyPn0gUmV0dXJuIFByb21pc2UgdG8gYSBuZXcgb2JzZXJ2ZXIuDQogICAgICovCiAgfSwgewogICAga2V5OiAnc3Vic2NyaWJlJywKICAgIHZhbHVlOiBmdW5jdGlvbiBzdWJzY3JpYmUoc2NoZW1hLCBvYmpVUkwpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIC8vVE9ETzogdmFsaWRhdGUgaWYgc3Vic2NyaXB0aW9uIGFscmVhZHkgZXhpc3RzID8KICAgICAgdmFyIHN1YnNjcmliZU1zZyA9IHsKICAgICAgICB0eXBlOiAnc3Vic2NyaWJlJywgZnJvbTogX3RoaXMuX293bmVyLCB0bzogX3RoaXMuX3N1YlVSTCwKICAgICAgICBib2R5OiB7IHNjaGVtYTogc2NoZW1hLCByZXNvdXJjZTogb2JqVVJMIH0KICAgICAgfTsKCiAgICAgIHJldHVybiBuZXcgX1Byb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgIC8vcmVxdWVzdCBzdWJzY3JpcHRpb24KICAgICAgICBfdGhpcy5fYnVzLnBvc3RNZXNzYWdlKHN1YnNjcmliZU1zZywgZnVuY3Rpb24gKHJlcGx5KSB7CiAgICAgICAgICBjb25zb2xlLmxvZygnc3Vic2NyaWJlLXJlc3BvbnNlOiAnLCByZXBseSk7CiAgICAgICAgICB2YXIgbmV3UHJvdmlzaW9uYWwgPSBfdGhpcy5fcHJvdmlzaW9uYWxzW29ialVSTF07CiAgICAgICAgICBkZWxldGUgX3RoaXMuX3Byb3Zpc2lvbmFsc1tvYmpVUkxdOwogICAgICAgICAgaWYgKG5ld1Byb3Zpc2lvbmFsKSBuZXdQcm92aXNpb25hbC5yZWxlYXNlKCk7CgogICAgICAgICAgaWYgKHJlcGx5LmJvZHkuY29kZSA8IDIwMCkgewogICAgICAgICAgICBuZXdQcm92aXNpb25hbCA9IG5ldyBfRGF0YVByb3Zpc2lvbmFsMlsnZGVmYXVsdCddKF90aGlzLl9vd25lciwgb2JqVVJMLCBfdGhpcy5fYnVzLCByZXBseS5ib2R5LmNoaWxkcmVuUmVzb3VyY2VzKTsKICAgICAgICAgICAgX3RoaXMuX3Byb3Zpc2lvbmFsc1tvYmpVUkxdID0gbmV3UHJvdmlzaW9uYWw7CiAgICAgICAgICB9IGVsc2UgaWYgKHJlcGx5LmJvZHkuY29kZSA9PT0gMjAwKSB7CiAgICAgICAgICAgIHZhciBuZXdPYmogPSBuZXcgX0RhdGFPYmplY3RPYnNlcnZlcjJbJ2RlZmF1bHQnXShfdGhpcy5fb3duZXIsIG9ialVSTCwgc2NoZW1hLCBfdGhpcy5fYnVzLCAnb24nLCByZXBseS5ib2R5LnZhbHVlLCBuZXdQcm92aXNpb25hbC5jaGlsZHJlbiwgcmVwbHkuYm9keS52ZXJzaW9uKTsKCiAgICAgICAgICAgIHJlc29sdmUobmV3T2JqKTsKICAgICAgICAgICAgbmV3UHJvdmlzaW9uYWwuYXBwbHkobmV3T2JqKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJlamVjdChyZXBseS5ib2R5LmRlc2MpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0KCiAgICAvKioNCiAgICAgKiBTZXR1cCB0aGUgY2FsbGJhY2sgdG8gcHJvY2VzcyBjcmVhdGUgYW5kIGRlbGV0ZSBldmVudHMgb2YgcmVtb3ZlIFJlcG9ydGVyIG9iamVjdHMuDQogICAgICogVGhpcyBpcyByZWxlYXRlZCB0byB0aGUgbWVzc2FnZW5zIHNlbnQgYnkgY3JlYXRlIHRvIHRoZSBvYnNlcnZlcnMgSHlwZXJ0eSBhcnJheS4NCiAgICAgKiBAcGFyYW0ge2Z1bmN0aW9uKGV2ZW50OiBNc2dFdmVudCl9IGNhbGxiYWNrDQogICAgICovCiAgfSwgewogICAga2V5OiAnb25Ob3RpZmljYXRpb24nLAogICAgdmFsdWU6IGZ1bmN0aW9uIG9uTm90aWZpY2F0aW9uKGNhbGxiYWNrKSB7CiAgICAgIHRoaXMuX29uTm90aWZpY2F0aW9uSGFuZGxlciA9IGNhbGxiYWNrOwogICAgfQogIH0sIHsKICAgIGtleTogJ19vbkZvcndhcmQnLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9vbkZvcndhcmQobXNnKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICB2YXIgcmVwb3J0ZXIgPSBfdGhpcy5fcmVwb3J0ZXJzW21zZy5ib2R5LnRvXTsKICAgICAgcmVwb3J0ZXIuX29uRm9yd2FyZChtc2cpOwogICAgfQogIH0sIHsKICAgIGtleTogJ19vblJlbW90ZUNyZWF0ZScsCiAgICB2YWx1ZTogZnVuY3Rpb24gX29uUmVtb3RlQ3JlYXRlKG1zZykgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgLy9yZW1vdmUgIi9zdWJzY3JpcHRpb24iIGZyb20gdGhlIFVSTAogICAgICB2YXIgcmVzb3VyY2UgPSBtc2cuZnJvbS5zbGljZSgwLCAtMTMpOwoKICAgICAgdmFyIGV2ZW50ID0gewogICAgICAgIHR5cGU6IG1zZy50eXBlLAogICAgICAgIGZyb206IG1zZy5ib2R5LnNvdXJjZSwKICAgICAgICB1cmw6IHJlc291cmNlLAogICAgICAgIHNjaGVtYTogbXNnLmJvZHkuc2NoZW1hLAogICAgICAgIHZhbHVlOiBtc2cuYm9keS52YWx1ZSwKICAgICAgICBpZGVudGl0eTogbXNnLmJvZHkuaWRUb2tlbiwKCiAgICAgICAgYWNrOiBmdW5jdGlvbiBhY2sodHlwZSkgewogICAgICAgICAgdmFyIGxUeXBlID0gMjAwOwogICAgICAgICAgaWYgKHR5cGUpIHsKICAgICAgICAgICAgbFR5cGUgPSB0eXBlOwogICAgICAgICAgfQoKICAgICAgICAgIC8vc2VuZCBhY2sgcmVzcG9uc2UgbWVzc2FnZQogICAgICAgICAgX3RoaXMuX2J1cy5wb3N0TWVzc2FnZSh7CiAgICAgICAgICAgIGlkOiBtc2cuaWQsIHR5cGU6ICdyZXNwb25zZScsIGZyb206IG1zZy50bywgdG86IG1zZy5mcm9tLAogICAgICAgICAgICBib2R5OiB7IGNvZGU6IGxUeXBlIH0KICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfTsKCiAgICAgIGlmIChfdGhpcy5fb25Ob3RpZmljYXRpb25IYW5kbGVyKSB7CiAgICAgICAgY29uc29sZS5sb2coJ05PVElGSUNBVElPTi1FVkVOVDogJywgZXZlbnQpOwogICAgICAgIF90aGlzLl9vbk5vdGlmaWNhdGlvbkhhbmRsZXIoZXZlbnQpOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAnb3duZXInLAogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgIHJldHVybiB0aGlzLl9vd25lcjsKICAgIH0KCiAgICAvKioNCiAgICAgKiBBbGwgb3duZWQgcmVwb3J0ZXJzLCB0aGUgb25lcyB0aGF0IHdlcmUgY3JlYXRlZCBieSBhIGNyZWF0ZQ0KICAgICAqIEB0eXBlIHtPYmplY3Q8VVJMLCBEYXRhT2JqZWN0UmVwb3J0ZXI+fQ0KICAgICAqLwogIH0sIHsKICAgIGtleTogJ3JlcG9ydGVycycsCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgcmV0dXJuIHRoaXMuX3JlcG9ydGVyczsKICAgIH0KCiAgICAvKioNCiAgICAgKiBBbGwgb3duZWQgb2JzZXJ2ZXJzLCB0aGUgb25lcyB0aGF0IHdlcmUgY3JlYXRlZCBieSBhIGxvY2FsIHN1YnNjcmlwdGlvbg0KICAgICAqIEB0eXBlIHtPYmplY3Q8VVJMLCBEYXRhT2JqZWN0T2JzZXJ2ZXI+fQ0KICAgICAqLwogIH0sIHsKICAgIGtleTogJ29ic2VydmVycycsCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgcmV0dXJuIHRoaXMuX29ic2VydmVyczsKICAgIH0KICB9XSk7CgogIHJldHVybiBTeW5jaGVyOwp9KSgpOwoKZXhwb3J0c1snZGVmYXVsdCddID0gU3luY2hlcjsKbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWydkZWZhdWx0J107Cgp9LHsiLi9EYXRhT2JqZWN0T2JzZXJ2ZXIiOjk4LCIuL0RhdGFPYmplY3RSZXBvcnRlciI6OTksIi4vRGF0YVByb3Zpc2lvbmFsIjoxMDAsImJhYmVsLXJ1bnRpbWUvY29yZS1qcy9wcm9taXNlIjo3LCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY2xhc3MtY2FsbC1jaGVjayI6OSwiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NyZWF0ZS1jbGFzcyI6MTEsImJhYmVsLXJ1bnRpbWUvaGVscGVycy9pbnRlcm9wLXJlcXVpcmUtZGVmYXVsdCI6MTV9XSwxMDM6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewovKioNCiAqIEV2ZW50RW1pdHRlcg0KICogQWxsIGNsYXNzZXMgd2hpY2ggZXh0ZW5kcyB0aGlzLCBjYW4gaGF2ZSBhZGRFdmVudExpc3RlbmVyIGFuZCB0cmlnZ2VyIGV2ZW50czsNCiAqLwoidXNlIHN0cmljdCI7Cgp2YXIgX2NyZWF0ZUNsYXNzID0gcmVxdWlyZSgiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NyZWF0ZS1jbGFzcyIpWyJkZWZhdWx0Il07Cgp2YXIgX2NsYXNzQ2FsbENoZWNrID0gcmVxdWlyZSgiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NsYXNzLWNhbGwtY2hlY2siKVsiZGVmYXVsdCJdOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwoKdmFyIEV2ZW50RW1pdHRlciA9IChmdW5jdGlvbiAoKSB7CiAgZnVuY3Rpb24gRXZlbnRFbWl0dGVyKCkgewogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEV2ZW50RW1pdHRlcik7CiAgfQoKICBfY3JlYXRlQ2xhc3MoRXZlbnRFbWl0dGVyLCBbewogICAga2V5OiAiYWRkRXZlbnRMaXN0ZW5lciIsCgogICAgLyoqDQogICAgICogYWRkRXZlbnRMaXN0ZW5lciBsaXN0ZW4gZm9yIGFuIGV2ZW50VHlwZQ0KICAgICAqIEBwYXJhbSAge3N0cmluZ30gICAgICAgICBldmVudFR5cGUgLSBsaXN0ZW5pbmcgZm9yIHRoaXMgdHlwZSBvZiBldmVudA0KICAgICAqIEBwYXJhbSAge0Z1bmN0aW9ufSAgICAgICBjYiAgICAgICAgLSBjYWxsYmFjayBmdW5jdGlvbiB3aWxsIGJlIGV4ZWN1dGVkIHdoZW4gdGhlIGV2ZW50IGl0IGlzIGludm9rZWQNCiAgICAgKi8KICAgIHZhbHVlOiBmdW5jdGlvbiBhZGRFdmVudExpc3RlbmVyKGV2ZW50VHlwZSwgY2IpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgX3RoaXNbZXZlbnRUeXBlXSA9IGNiOwogICAgfQoKICAgIC8qKg0KICAgICAqIEludm9rZSB0aGUgZXZlbnRUeXBlDQogICAgICogQHBhcmFtICB7c3RyaW5nfSBldmVudFR5cGUgLSBldmVudCB3aWxsIGJlIGludm9rZWQNCiAgICAgKiBAcGFyYW0gIHtvYmplY3R9IHBhcmFtcyAtIHBhcmFtZXRlcnMgd2lsbCBiZSBwYXNzZWQgdG8gdGhlIGFkZEV2ZW50TGlzdGVuZXINCiAgICAgKi8KICB9LCB7CiAgICBrZXk6ICJ0cmlnZ2VyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiB0cmlnZ2VyKGV2ZW50VHlwZSwgcGFyYW1zKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICBpZiAoX3RoaXNbZXZlbnRUeXBlXSkgewogICAgICAgIF90aGlzW2V2ZW50VHlwZV0ocGFyYW1zKTsKICAgICAgfQogICAgfQogIH1dKTsKCiAgcmV0dXJuIEV2ZW50RW1pdHRlcjsKfSkoKTsKCmV4cG9ydHNbImRlZmF1bHQiXSA9IEV2ZW50RW1pdHRlcjsKbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWyJkZWZhdWx0Il07Cgp9LHsiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NsYXNzLWNhbGwtY2hlY2siOjksImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jcmVhdGUtY2xhc3MiOjExfV0sMTA0OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKLyoqDQogKiBTdXBwb3J0IG1vZHVsZSB3aXRoIHNvbWUgZnVuY3Rpb25zIHdpbGwgYmUgdXNlZnVsDQogKiBAbW9kdWxlIHV0aWxzDQogKi8KCi8qKg0KICogQHR5cGVkZWYgZGl2aWRlVVJMDQogKiBAdHlwZSBPYmplY3QNCiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSB0eXBlIFRoZSB0eXBlIG9mIFVSTA0KICogQHByb3BlcnR5IHtzdHJpbmd9IGRvbWFpbiBUaGUgZG9tYWluIG9mIFVSTA0KICogQHByb3BlcnR5IHtzdHJpbmd9IGlkZW50aXR5IFRoZSBpZGVudGl0eSBvZiBVUkwNCiAqLwoKLyoqDQogKiBEaXZpZGUgYW4gdXJsIGluIHR5cGUsIGRvbWFpbiBhbmQgaWRlbnRpdHkNCiAqIEBwYXJhbSAge1VSTC5VUkx9IHVybCAtIHVybCBhZGRyZXNzDQogKiBAcmV0dXJuIHtkaXZpZGVVUkx9IHRoZSByZXN1bHQgb2YgZGl2aWRlVVJMDQogKi8KJ3VzZSBzdHJpY3QnOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLmRpdmlkZVVSTCA9IGRpdmlkZVVSTDsKZXhwb3J0cy5kZWVwQ2xvbmUgPSBkZWVwQ2xvbmU7CgpmdW5jdGlvbiBkaXZpZGVVUkwodXJsKSB7CgogIC8vIGxldCByZSA9IC8oW2EtekEtWi1dKik/OlwvXC8oPzpcLik/KFstYS16QS1aMC05QDolLl9cK34jPV17MiwyNTZ9XC5bYS16XXsyLDZ9XGIpKihcL1tcL1xkXHdcLi1dKikqKD86W1w/XSkqKC4rKSovZ2k7CiAgdmFyIHJlID0gLyhbYS16QS1aLV0qKTpcL1wvKD86XC4pPyhbLWEtekEtWjAtOUA6JS5fXCt+Iz1dezIsMjU2fSkoWy1hLXpBLVowLTlAOiUuX1wrfiM9XC9dKikvZ2k7CiAgdmFyIHN1YnN0ID0gJyQxLCQyLCQzJzsKICB2YXIgcGFydHMgPSB1cmwucmVwbGFjZShyZSwgc3Vic3QpLnNwbGl0KCcsJyk7CiAgdmFyIHJlc3VsdCA9IHsKICAgIHR5cGU6IHBhcnRzWzBdLAogICAgZG9tYWluOiBwYXJ0c1sxXSwKICAgIGlkZW50aXR5OiBwYXJ0c1syXQogIH07CgogIHJldHVybiByZXN1bHQ7Cn0KCi8qKg0KICogTWFrZSBhIENPUFkgb2YgdGhlIG9yaWdpbmFsIGRhdGENCiAqIEBwYXJhbSAge09iamVjdH0gIG9iaiAtIG9iamVjdCB0byBiZSBjbG9uZWQNCiAqIEByZXR1cm4ge09iamVjdH0NCiAqLwoKZnVuY3Rpb24gZGVlcENsb25lKG9iaikgewogIC8vVE9ETzogc2ltcGxlIGJ1dCBpbmVmZmljaWVudCBKU09OIGRlZXAgY2xvbmUuLi4KICBpZiAob2JqKSByZXR1cm4gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShvYmopKTsKfQoKfSx7fV19LHt9LFs5Ml0pKDkyKQp9KTs=",
      "sourceCodeClassname": "HypertyConnector",
      "encoding": "base64",
      "signature": ""
    },
    "cguid": 1,
    "type": "Hyperties",
    "version": "0.1",
    "description": "Description of HypertyConnector",
    "objectName": "HypertyConnector",
    "sourcePackageURL": "/sourcePackage",
    "language": "javascript",
    "signature": "",
    "messageSchemas": "",
    "dataObjects": [],
    "accessControlPolicy": "somePolicy"
  }
}