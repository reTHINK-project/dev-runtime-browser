{"version":3,"sources":["node_modules/browser-pack/_prelude.js","src/admin/IdentitiesGUI.js"],"names":[],"mappings":"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","file":"identities-gui.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","// jshint browser:true, jquery: true\n\nclass IdentitiesGUI {\n\n  constructor(guiURL, idmURL, messageBus) {\n    //if (!identityModule) throw Error('Identity Module not set!');\n    if (!messageBus) throw Error('Message Bus not set!');\n    let _this = this;\n    _this._guiURL = guiURL;\n    _this._idmURL = idmURL;\n    _this._messageBus = messageBus;\n\n    _this.callIdentityModuleFunc('deployGUI', {}).then(() => {\n      _this.resultURL  = undefined;\n\n      _this._messageBus.addListener(guiURL, msg => {\n        let identityInfo = msg.body.value;\n        let funcName = msg.body.method;\n        let value;\n\n        if (funcName === 'openPopup') {\n          let urlreceived = msg.body.params.urlreceived;\n          _this.openPopup(urlreceived).then((returnedValue) => {\n            let value = {type: 'execute', value: returnedValue, code: 200};\n            let replyMsg = {id: msg.id, type: 'response', to: msg.from, from: msg.to, body: value};\n            _this._messageBus.postMessage(replyMsg);\n          });\n          return; // this avoids getting stuck in the identities page\n        }\n\n        // unhide the config page with the identity GUI\n        document.getElementsByTagName('body')[0].style = 'background-color:white;';\n        parent.postMessage({ body: { method: 'showAdminPage' }, to: 'runtime:gui-manager' }, '*');\n        $('.admin-page').removeClass('hide');\n        _this.showIdentitiesGUI(msg.body.value).then((identityInfo) => {\n          let replyMsg;\n\n          //hide config page with the identity GUI\n          parent.postMessage({ body: { method: 'hideAdminPage' }, to: 'runtime:gui-manager' }, '*');\n          $('.admin-page').addClass('hide');\n          document.getElementsByTagName('body')[0].style = 'background-color:transparent';\n          $('.identities-section').addClass('hide');\n          $('.policies-section').addClass('hide');\n\n          switch (identityInfo.type) {\n            case 'idp':\n              value = { type: 'idp', value: identityInfo.value, code: 200 };\n              replyMsg = { id: msg.id, type: 'response', to: msg.from, from: msg.to, body: value };\n              _this._messageBus.postMessage(replyMsg);\n              break;\n\n            case 'identity':\n              value = { type: 'identity', value: identityInfo.value, code: 200 };\n              replyMsg = { id: msg.id, type: 'response', to: msg.from, from: msg.to, body: value };\n              _this._messageBus.postMessage(replyMsg);\n              break;\n\n            default:\n              value = { type: 'error', value: 'Error on identity GUI', code: 400 };\n              replyMsg = { id: msg.id, type: 'response', to: msg.from, from: msg.to, body: value };\n              _this._messageBus.postMessage(replyMsg);\n          }\n        });\n      });\n\n      $('.identities-page-show').on('click', function () {\n        //TODO call a IdM method that requests the identities\n        _this.showIdentitiesGUI();\n      });\n    });\n  }\n\n  callIdentityModuleFunc(methodName, parameters) {\n    let _this = this;\n    let message;\n\n    return new Promise((resolve, reject) => {\n      message = { type: 'execute', to: _this._idmURL, from: _this._guiURL,\n        body: { resource: 'identity', method: methodName, params: parameters }, };\n      _this._messageBus.postMessage(message, (res) => {\n        let result = res.body.value;\n        resolve(result);\n      });\n    });\n  }\n\n  openPopup(urlreceived) {\n\n    return new Promise((resolve, reject) => {\n\n      let win = window.open(urlreceived, 'openIDrequest', 'width=800, height=600');\n      if (window.cordova) {\n        win.addEventListener('loadstart', function(e) {\n          let url = e.url;\n          let code = /\\&code=(.+)$/.exec(url);\n          let error = /\\&error=(.+)$/.exec(url);\n\n          if (code || error) {\n            win.close();\n            resolve(url);\n          }\n        });\n      } else {\n        let pollTimer = setInterval(function() {\n          try {\n            if (win.closed) {\n              reject('Some error occured when trying to get identity.');\n              clearInterval(pollTimer);\n            }\n\n            if (win.document.URL.indexOf('id_token') !== -1 || win.document.URL.indexOf(location.origin) !== -1) {\n              window.clearInterval(pollTimer);\n              let url =   win.document.URL;\n\n              win.close();\n              resolve(url);\n            }\n          } catch (e) {\n            //console.log(e);\n          }\n        }, 500);\n      }\n    });\n  }\n\n  showIdentitiesGUI(receivedInfo) {\n    let _this = this;\n\n    return new Promise((resolve, reject) => {\n\n      let identityInfo;\n      let toRemoveID;\n\n      _this._checkReceivedInfo(receivedInfo).then((resultObject) => {\n        identityInfo = resultObject.identityInfo;\n        toRemoveID = resultObject.toRemoveID;\n\n        $('.policies-section').addClass('hide');\n        $('.identities-section').removeClass('hide');\n\n        _this.showMyIdentities(identityInfo.identities, toRemoveID).then((identity) => {\n          console.log('chosen identity: ', identity);\n          resolve({type: 'identity', value: identity});\n        });\n\n        let callback = (value) => {\n          console.log('chosen identity: ', value);\n          resolve({type: 'identity', value: value});\n        };\n\n        let idps = [];\n        let idpsObjects = identityInfo.idps;\n\n        idpsObjects.forEach(function(entry) {\n          if(entry.type && entry.type == 'idToken') {\n            idps.push(entry.domain);\n          }\n        });\n\n        $('#idproviders').html(_this._getList(idps));\n        $('#idproviders').off();\n        $('#idproviders').on('click', (event) => _this.obtainNewIdentity(event, callback, toRemoveID));\n        //$('.back').on('click', (event) => _this.goHome());\n        $('.identities-reset').off();\n        $('.identities-reset').on('click', (event) => _this._resetIdentities(callback));\n      });\n    });\n  }\n\n  _checkReceivedInfo(receivedInfo) {\n    let _this = this;\n    return new Promise((resolve, reject) => {\n      let identityInfo, toRemoveID;\n      if (receivedInfo) {\n        identityInfo = receivedInfo;\n        toRemoveID = false;\n        resolve({identityInfo: identityInfo, toRemoveID:toRemoveID});\n      } else {\n        toRemoveID = true;\n        _this.callIdentityModuleFunc('getIdentitiesToChoose', {}).then((result) => {\n          resolve({identityInfo: result, toRemoveID: toRemoveID});\n        });\n      }\n    });\n  }\n\n  showMyIdentities(emails, toRemoveID) {\n    let _this = this;\n\n    return new Promise((resolve, reject) => {\n\n      // let identities = _this.identityModule.getIdentities();\n      let identities = [];\n\n      for (let i in emails) {\n        let domain = emails[i].split('@');\n        identities.push({ email: emails[i], domain: domain[1] });\n      }\n\n      let myIdentities = document.getElementById('my-ids');\n      myIdentities.innerHTML = '';\n\n      let table = _this.createTable();\n\n      let tbody = document.createElement('tbody');\n      let numIdentities = identities.length;\n      for (let i = 0; i < numIdentities; i++) {\n        let tr = _this.createTableRow(identities[i], toRemoveID);\n        tbody.appendChild(tr);\n      }\n\n      table.appendChild(tbody);\n      myIdentities.appendChild(table);\n\n      let callback = (identity) => {\n        resolve(identity);\n      };\n\n      if (!toRemoveID) {\n        $('.clickable-cell').on('click', (event) => _this.changeID(event, callback));\n      }\n\n      $('.remove-id').on('click', (event) => _this.removeID(emails));\n\n    });\n  }\n\n  createTable() {\n    let table = document.createElement('table');\n    table.className = 'centered';\n    let thead = document.createElement('thead');\n    let tr = document.createElement('tr');\n    let thEmail = document.createElement('th');\n    thEmail.textContent = 'Email';\n    tr.appendChild(thEmail);\n    thead.appendChild(tr);\n    table.appendChild(thead);\n    return table;\n  }\n\n  createTableRow(identity, toRemoveID) {\n    let tr = document.createElement('tr');\n\n    let td = document.createElement('td');\n    td.textContent = identity.email;\n    td.className = 'clickable-cell';\n    td.style = 'cursor: pointer';\n    tr.appendChild(td);\n\n    td = document.createElement('td');\n\n    if (toRemoveID) {\n      let btn = document.createElement('button');\n      btn.textContent = 'Remove';\n      btn.className = 'remove-id waves-effect waves-light btn';\n      td.appendChild(btn);\n    }\n\n    tr.appendChild(td);\n\n    return tr;\n  }\n\n  changeID(event, callback) {\n    let _this = this;\n\n    let idToUse = event.target.innerText;\n\n    //TODO improve later.\n    //prevents when the users selects an hyperty, exit the identity page and\n    //goes again to the identity page, from selecting \"settings\" button as identity.\n    if (idToUse !== 'settings') {\n\n      callback(idToUse);\n      return idToUse;\n    }\n  }\n\n  removeID(event, emails) {\n    let _this = this;\n    let row = event.target.parentNode.parentNode;\n    let idToRemove = row.children[0].textContent;\n    let domain = row.children[1].textContent;\n\n    _this.callIdentityModuleFunc('unregisterIdentity', { email: idToRemove }).then(() => {\n      let numEmails = emails.length;\n      for (let i = 0; i < numEmails; i++) {\n        if (emails[i].email === idToRemove) {\n          emails.splice(i, 1);\n          break;\n        }\n      }\n\n      // -------------------------------------------------------------------------//\n      _this.showMyIdentities(emails, true);\n    });\n\n    //_this.identityModule.unregisterIdentity(idToRemove);\n\n  }\n\n  obtainNewIdentity(event, callback, toRemoveID) {\n    let _this = this;\n    let idProvider = event.target.textContent;\n    let idProvider2 = event.target.text;\n\n    _this.callIdentityModuleFunc('generateRSAKeyPair', {}).then((keyPair) => {\n      let publicKey = btoa(keyPair.public);\n\n      _this.callIdentityModuleFunc('sendGenerateMessage',\n        { contents: publicKey, origin: 'origin', usernameHint: undefined,\n        idpDomain: idProvider, }).then((value) => {\n        console.log('receivedURL: ' + value.loginUrl.substring(0, 20) + '...');\n\n        let url = value.loginUrl;\n        let finalURL;\n\n        //check if the receivedURL contains the redirect field and replace it\n        if (url.indexOf('redirect_uri') !== -1) {\n          let firstPart = url.substring(0, url.indexOf('redirect_uri'));\n          let secondAuxPart = url.substring(url.indexOf('redirect_uri'), url.length);\n\n          let secondPart = secondAuxPart.substring(secondAuxPart.indexOf('&'), url.length);\n\n          //check if the reddirect field is the last field of the URL\n          if (secondPart.indexOf('&') !== -1) {\n            finalURL = firstPart + 'redirect_uri=' + location.origin + secondPart;\n          } else {\n            finalURL = firstPart + 'redirect_uri=' + location.origin;\n          }\n        }\n\n        _this.resultURL = finalURL || url;\n\n        $('.login-idp').html('<p>Chosen IDP: ' + idProvider + '</p>');\n        $('.login').removeClass('hide');\n        $('.login-btn').off();\n        $('.login-btn').on('click', (event) => {\n          $('.login').addClass('hide');\n          _this._authenticateUser(keyPair, publicKey, value, 'origin', idProvider).then((email) => {\n            callback(email);\n            _this.showIdentitiesGUI();\n          });\n        });\n      });\n    }).catch(err => console.log('obtanin new identity', err));\n\n  }\n\n  _getList(items) {\n    let list = '';\n    let numItems = items.length;\n\n    for (let i = 0; i < numItems; i++) {\n      list += '<li class=\"divider\"></li>';\n      list += '<li><a class=\"center-align\">' + items[i] + '</a></li>';\n    }\n\n    return list;\n  }\n\n  _authenticateUser(keyPair, publicKey, value, origin, idProvider) {\n    let _this = this;\n    let url = _this.resultURL;\n\n    return new Promise((resolve, reject) => {\n\n      _this.openPopup(url).then((identity) => {\n\n        _this.callIdentityModuleFunc('sendGenerateMessage',\n          { contents: publicKey, origin: origin, usernameHint: identity, idpDomain: idProvider }).then((result) => {\n\n          if (result) {\n\n           //_this.identityModule.storeIdentity(result, keyPair).then((value) => {\n           _this.callIdentityModuleFunc('storeIdentity', {result: result, keyPair: keyPair}).then((value) => {\n             resolve(value.userProfile.username);\n           }, (err) => {\n             reject(err);\n           });\n\n          } else {\n           reject('error on obtaining identity information');\n          }\n\n          });\n         }, (err) => {\n           reject(err);\n      });\n    });\n  }\n\n_resetIdentities() {\n  console.log('_resetIdentities');\n}\n\n\n}\n\nexport default IdentitiesGUI;\n"],"preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvYWRtaW4vSWRlbnRpdGllc0dVSS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7Ozs7QUNBQTs7SUFFTSxhO0FBRUoseUJBQVksTUFBWixFQUFvQixNQUFwQixFQUE0QixVQUE1QixFQUF3QztBQUFBOztBQUN0QztBQUNBLFFBQUksQ0FBQyxVQUFMLEVBQWlCLE1BQU0sTUFBTSxzQkFBTixDQUFOO0FBQ2pCLFFBQUksUUFBUSxJQUFaO0FBQ0EsVUFBTSxPQUFOLEdBQWdCLE1BQWhCO0FBQ0EsVUFBTSxPQUFOLEdBQWdCLE1BQWhCO0FBQ0EsVUFBTSxXQUFOLEdBQW9CLFVBQXBCOztBQUVBLFVBQU0sc0JBQU4sQ0FBNkIsV0FBN0IsRUFBMEMsRUFBMUMsRUFBOEMsSUFBOUMsQ0FBbUQsWUFBTTtBQUN2RCxZQUFNLFNBQU4sR0FBbUIsU0FBbkI7O0FBRUEsWUFBTSxXQUFOLENBQWtCLFdBQWxCLENBQThCLE1BQTlCLEVBQXNDLGVBQU87QUFDM0MsWUFBSSxlQUFlLElBQUksSUFBSixDQUFTLEtBQTVCO0FBQ0EsWUFBSSxXQUFXLElBQUksSUFBSixDQUFTLE1BQXhCO0FBQ0EsWUFBSSxjQUFKOztBQUVBLFlBQUksYUFBYSxXQUFqQixFQUE4QjtBQUM1QixjQUFJLGNBQWMsSUFBSSxJQUFKLENBQVMsTUFBVCxDQUFnQixXQUFsQztBQUNBLGdCQUFNLFNBQU4sQ0FBZ0IsV0FBaEIsRUFBNkIsSUFBN0IsQ0FBa0MsVUFBQyxhQUFELEVBQW1CO0FBQ25ELGdCQUFJLFFBQVEsRUFBQyxNQUFNLFNBQVAsRUFBa0IsT0FBTyxhQUF6QixFQUF3QyxNQUFNLEdBQTlDLEVBQVo7QUFDQSxnQkFBSSxXQUFXLEVBQUMsSUFBSSxJQUFJLEVBQVQsRUFBYSxNQUFNLFVBQW5CLEVBQStCLElBQUksSUFBSSxJQUF2QyxFQUE2QyxNQUFNLElBQUksRUFBdkQsRUFBMkQsTUFBTSxL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QUFDQSxvQkFBTSxzQkFBTixDQUE2QixlQUE3QixFQUE4QyxFQUFDLFFBQVEsTUFBVCxFQUFpQixTQUFTLE9BQTFCLEVBQTlDLEVBQWtGLElBQWxGLENBQXVGLFVBQUMsS0FBRCxFQUFXO0FBQ2hHLHdCQUFRLE1BQU0sV0FBTixDQUFrQixRQUExQjtBQUNELGVBRkQsRUFFRyxVQUFDLEdBQUQsRUFBUztBQUNWLHVCQUFPLEdBQVA7QUFDRCxlQUpEO0FBTUEsYUFURCxNQVNPO0FBQ04scUJBQU8seUNBQVA7QUFDQTtBQUVBLFdBaEJIO0FBaUJFLFNBbkJKLEVBbUJNLFVBQUMsR0FBRCxFQUFTO0FBQ1YsaUJBQU8sR0FBUDtBQUNKLFNBckJEO0FBc0JELE9BeEJNLENBQVA7QUF5QkQ7Ozt1Q0FFZ0I7QUFDakIsY0FBUSxHQUFSLENBQVksa0JBQVo7QUFDRDs7Ozs7O2tCQUtjLGEiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiLy8ganNoaW50IGJyb3dzZXI6dHJ1ZSwganF1ZXJ5OiB0cnVlXG5cbmNsYXNzIElkZW50aXRpZXNHVUkge1xuXG4gIGNvbnN0cnVjdG9yKGd1aVVSTCwgaWRtVVJMLCBtZXNzYWdlQnVzKSB7XG4gICAgLy9pZiAoIWlkZW50aXR5TW9kdWxlKSB0aHJvdyBFcnJvcignSWRlbnRpdHkgTW9kdWxlIG5vdCBzZXQhJyk7XG4gICAgaWYgKCFtZXNzYWdlQnVzKSB0aHJvdyBFcnJvcignTWVzc2FnZSBCdXMgbm90IHNldCEnKTtcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xuICAgIF90aGlzLl9ndWlVUkwgPSBndWlVUkw7XG4gICAgX3RoaXMuX2lkbVVSTCA9IGlkbVVSTDtcbiAgICBfdGhpcy5fbWVzc2FnZUJ1cyA9IG1lc3NhZ2VCdXM7XG5cbiAgICBfdGhpcy5jYWxsSWRlbnRpdHlNb2R1bGVGdW5jKCdkZXBsb3lHVUknLCB7fSkudGhlbigoKSA9PiB7XG4gICAgICBfdGhpcy5yZXN1bHRVUkwgID0gdW5kZWZpbmVkO1xuXG4gICAgICBfdGhpcy5fbWVzc2FnZUJ1cy5hZGRMaXN0ZW5lcihndWlVUkwsIG1zZyA9PiB7XG4gICAgICAgIGxldCBpZGVudGl0eUluZm8gPSBtc2cuYm9keS52YWx1ZTtcbiAgICAgICAgbGV0IGZ1bmNOYW1lID0gbXNnLmJvZHkubWV0aG9kO1xuICAgICAgICBsZXQgdmFsdWU7XG5cbiAgICAgICAgaWYgKGZ1bmNOYW1lID09PSAnb3BlblBvcHVwJykge1xuICAgICAgICAgIGxldCB1cmxyZWNlaXZlZCA9IG1zZy5ib2R5LnBhcmFtcy51cmxyZWNlaXZlZDtcbiAgICAgICAgICBfdGhpcy5vcGVuUG9wdXAodXJscmVjZWl2ZWQpLnRoZW4oKHJldHVybmVkVmFsdWUpID0+IHtcbiAgICAgICAgICAgIGxldCB2YWx1ZSA9IHt0eXBlOiAnZXhlY3V0ZScsIHZhbHVlOiByZXR1cm5lZFZhbHVlLCBjb2RlOiAyMDB9O1xuICAgICAgICAgICAgbGV0IHJlcGx5TXNnID0ge2lkOiBtc2cuaWQsIHR5cGU6ICdyZXNwb25zZScsIHRvOiBtc2cuZnJvbSwgZnJvbTogbXNnLnRvLCBib2R5OiB2YWx1ZX07XG4gICAgICAgICAgICBfdGhpcy5fbWVzc2FnZUJ1cy5wb3N0TWVzc2FnZShyZXBseU1zZyk7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgcmV0dXJuOyAvLyB0aGlzIGF2b2lkcyBnZXR0aW5nIHN0dWNrIGluIHRoZSBpZGVudGl0aWVzIHBhZ2VcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHVuaGlkZSB0aGUgY29uZmlnIHBhZ2Ugd2l0aCB0aGUgaWRlbnRpdHkgR1VJXG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdib2R5JylbMF0uc3R5bGUgPSAnYmFja2dyb3VuZC1jb2xvcjp3aGl0ZTsnO1xuICAgICAgICBwYXJlbnQucG9zdE1lc3NhZ2UoeyBib2R5OiB7IG1ldGhvZDogJ3Nob3dBZG1pblBhZ2UnIH0sIHRvOiAncnVudGltZTpndWktbWFuYWdlcicgfSwgJyonKTtcbiAgICAgICAgJCgnLmFkbWluLXBhZ2UnKS5yZW1vdmVDbGFzcygnaGlkZScpO1xuICAgICAgICBfdGhpcy5zaG93SWRlbnRpdGllc0dVSShtc2cuYm9keS52YWx1ZSkudGhlbigoaWRlbnRpdHlJbmZvKSA9PiB7XG4gICAgICAgICAgbGV0IHJlcGx5TXNnO1xuXG4gICAgICAgICAgLy9oaWRlIGNvbmZpZyBwYWdlIHdpdGggdGhlIGlkZW50aXR5IEdVSVxuICAgICAgICAgIHBhcmVudC5wb3N0TWVzc2FnZSh7IGJvZHk6IHsgbWV0aG9kOiAnaGlkZUFkbWluUGFnZScgfSwgdG86ICdydW50aW1lOmd1aS1tYW5hZ2VyJyB9LCAnKicpO1xuICAgICAgICAgICQoJy5hZG1pbi1wYWdlJykuYWRkQ2xhc3MoJ2hpZGUnKTtcbiAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnYm9keScpWzBdLnN0eWxlID0gJ2JhY2tncm91bmQtY29sb3I6dHJhbnNwYXJlbnQnO1xuICAgICAgICAgICQoJy5pZGVudGl0aWVzLXNlY3Rpb24nKS5hZGRDbGFzcygnaGlkZScpO1xuICAgICAgICAgICQoJy5wb2xpY2llcy1zZWN0aW9uJykuYWRkQ2xhc3MoJ2hpZGUnKTtcblxuICAgICAgICAgIHN3aXRjaCAoaWRlbnRpdHlJbmZvLnR5cGUpIHtcbiAgICAgICAgICAgIGNhc2UgJ2lkcCc6XG4gICAgICAgICAgICAgIHZhbHVlID0geyB0eXBlOiAnaWRwJywgdmFsdWU6IGlkZW50aXR5SW5mby52YWx1ZSwgY29kZTogMjAwIH07XG4gICAgICAgICAgICAgIHJlcGx5TXNnID0geyBpZDogbXNnLmlkLCB0eXBlOiAncmVzcG9uc2UnLCB0bzogbXNnLmZyb20sIGZyb206IG1zZy50bywgYm9keTogdmFsdWUgfTtcbiAgICAgICAgICAgICAgX3RoaXMuX21lc3NhZ2VCdXMucG9zdE1lc3NhZ2UocmVwbHlNc2cpO1xuICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSAnaWRlbnRpdHknOlxuICAgICAgICAgICAgICB2YWx1ZSA9IHsgdHlwZTogJ2lkZW50aXR5JywgdmFsdWU6IGlkZW50aXR5SW5mby52YWx1ZSwgY29kZTogMjAwIH07XG4gICAgICAgICAgICAgIHJlcGx5TXNnID0geyBpZDogbXNnLmlkLCB0eXBlOiAncmVzcG9uc2UnLCB0bzogbXNnLmZyb20sIGZyb206IG1zZy50bywgYm9keTogdmFsdWUgfTtcbiAgICAgICAgICAgICAgX3RoaXMuX21lc3NhZ2VCdXMucG9zdE1lc3NhZ2UocmVwbHlNc2cpO1xuICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgdmFsdWUgPSB7IHR5cGU6ICdlcnJvcicsIHZhbHVlOiAnRXJyb3Igb24gaWRlbnRpdHkgR1VJJywgY29kZTogNDAwIH07XG4gICAgICAgICAgICAgIHJlcGx5TXNnID0geyBpZDogbXNnLmlkLCB0eXBlOiAncmVzcG9uc2UnLCB0bzogbXNnLmZyb20sIGZyb206IG1zZy50bywgYm9keTogdmFsdWUgfTtcbiAgICAgICAgICAgICAgX3RoaXMuX21lc3NhZ2VCdXMucG9zdE1lc3NhZ2UocmVwbHlNc2cpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9KTtcblxuICAgICAgJCgnLmlkZW50aXRpZXMtcGFnZS1zaG93Jykub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAvL1RPRE8gY2FsbCBhIElkTSBtZXRob2QgdGhhdCByZXF1ZXN0cyB0aGUgaWRlbnRpdGllc1xuICAgICAgICBfdGhpcy5zaG93SWRlbnRpdGllc0dVSSgpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICBjYWxsSWRlbnRpdHlNb2R1bGVGdW5jKG1ldGhvZE5hbWUsIHBhcmFtZXRlcnMpIHtcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xuICAgIGxldCBtZXNzYWdlO1xuXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIG1lc3NhZ2UgPSB7IHR5cGU6ICdleGVjdXRlJywgdG86IF90aGlzLl9pZG1VUkwsIGZyb206IF90aGlzLl9ndWlVUkwsXG4gICAgICAgIGJvZHk6IHsgcmVzb3VyY2U6ICdpZGVudGl0eScsIG1ldGhvZDogbWV0aG9kTmFtZSwgcGFyYW1zOiBwYXJhbWV0ZXJzIH0sIH07XG4gICAgICBfdGhpcy5fbWVzc2FnZUJ1cy5wb3N0TWVzc2FnZShtZXNzYWdlLCAocmVzKSA9PiB7XG4gICAgICAgIGxldCByZXN1bHQgPSByZXMuYm9keS52YWx1ZTtcbiAgICAgICAgcmVzb2x2ZShyZXN1bHQpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICBvcGVuUG9wdXAodXJscmVjZWl2ZWQpIHtcblxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG5cbiAgICAgIGxldCB3aW4gPSB3aW5kb3cub3Blbih1cmxyZWNlaXZlZCwgJ29wZW5JRHJlcXVlc3QnLCAnd2lkdGg9ODAwLCBoZWlnaHQ9NjAwJyk7XG4gICAgICBpZiAod2luZG93LmNvcmRvdmEpIHtcbiAgICAgICAgd2luLmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWRzdGFydCcsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICBsZXQgdXJsID0gZS51cmw7XG4gICAgICAgICAgbGV0IGNvZGUgPSAvXFwmY29kZT0oLispJC8uZXhlYyh1cmwpO1xuICAgICAgICAgIGxldCBlcnJvciA9IC9cXCZlcnJvcj0oLispJC8uZXhlYyh1cmwpO1xuXG4gICAgICAgICAgaWYgKGNvZGUgfHwgZXJyb3IpIHtcbiAgICAgICAgICAgIHdpbi5jbG9zZSgpO1xuICAgICAgICAgICAgcmVzb2x2ZSh1cmwpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBsZXQgcG9sbFRpbWVyID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGlmICh3aW4uY2xvc2VkKSB7XG4gICAgICAgICAgICAgIHJlamVjdCgnU29tZSBlcnJvciBvY2N1cmVkIHdoZW4gdHJ5aW5nIHRvIGdldCBpZGVudGl0eS4nKTtcbiAgICAgICAgICAgICAgY2xlYXJJbnRlcnZhbChwb2xsVGltZXIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAod2luLmRvY3VtZW50LlVSTC5pbmRleE9mKCdpZF90b2tlbicpICE9PSAtMSB8fCB3aW4uZG9jdW1lbnQuVVJMLmluZGV4T2YobG9jYXRpb24ub3JpZ2luKSAhPT0gLTEpIHtcbiAgICAgICAgICAgICAgd2luZG93LmNsZWFySW50ZXJ2YWwocG9sbFRpbWVyKTtcbiAgICAgICAgICAgICAgbGV0IHVybCA9ICAgd2luLmRvY3VtZW50LlVSTDtcblxuICAgICAgICAgICAgICB3aW4uY2xvc2UoKTtcbiAgICAgICAgICAgICAgcmVzb2x2ZSh1cmwpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIC8vY29uc29sZS5sb2coZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9LCA1MDApO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgc2hvd0lkZW50aXRpZXNHVUkocmVjZWl2ZWRJbmZvKSB7XG4gICAgbGV0IF90aGlzID0gdGhpcztcblxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG5cbiAgICAgIGxldCBpZGVudGl0eUluZm87XG4gICAgICBsZXQgdG9SZW1vdmVJRDtcblxuICAgICAgX3RoaXMuX2NoZWNrUmVjZWl2ZWRJbmZvKHJlY2VpdmVkSW5mbykudGhlbigocmVzdWx0T2JqZWN0KSA9PiB7XG4gICAgICAgIGlkZW50aXR5SW5mbyA9IHJlc3VsdE9iamVjdC5pZGVudGl0eUluZm87XG4gICAgICAgIHRvUmVtb3ZlSUQgPSByZXN1bHRPYmplY3QudG9SZW1vdmVJRDtcblxuICAgICAgICAkKCcucG9saWNpZXMtc2VjdGlvbicpLmFkZENsYXNzKCdoaWRlJyk7XG4gICAgICAgICQoJy5pZGVudGl0aWVzLXNlY3Rpb24nKS5yZW1vdmVDbGFzcygnaGlkZScpO1xuXG4gICAgICAgIF90aGlzLnNob3dNeUlkZW50aXRpZXMoaWRlbnRpdHlJbmZvLmlkZW50aXRpZXMsIHRvUmVtb3ZlSUQpLnRoZW4oKGlkZW50aXR5KSA9PiB7XG4gICAgICAgICAgY29uc29sZS5sb2coJ2Nob3NlbiBpZGVudGl0eTogJywgaWRlbnRpdHkpO1xuICAgICAgICAgIHJlc29sdmUoe3R5cGU6ICdpZGVudGl0eScsIHZhbHVlOiBpZGVudGl0eX0pO1xuICAgICAgICB9KTtcblxuICAgICAgICBsZXQgY2FsbGJhY2sgPSAodmFsdWUpID0+IHtcbiAgICAgICAgICBjb25zb2xlLmxvZygnY2hvc2VuIGlkZW50aXR5OiAnLCB2YWx1ZSk7XG4gICAgICAgICAgcmVzb2x2ZSh7dHlwZTogJ2lkZW50aXR5JywgdmFsdWU6IHZhbHVlfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgbGV0IGlkcHMgPSBbXTtcbiAgICAgICAgbGV0IGlkcHNPYmplY3RzID0gaWRlbnRpdHlJbmZvLmlkcHM7XG5cbiAgICAgICAgaWRwc09iamVjdHMuZm9yRWFjaChmdW5jdGlvbihlbnRyeSkge1xuICAgICAgICAgIGlmKGVudHJ5LnR5cGUgJiYgZW50cnkudHlwZSA9PSAnaWRUb2tlbicpIHtcbiAgICAgICAgICAgIGlkcHMucHVzaChlbnRyeS5kb21haW4pO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgJCgnI2lkcHJvdmlkZXJzJykuaHRtbChfdGhpcy5fZ2V0TGlzdChpZHBzKSk7XG4gICAgICAgICQoJyNpZHByb3ZpZGVycycpLm9mZigpO1xuICAgICAgICAkKCcjaWRwcm92aWRlcnMnKS5vbignY2xpY2snLCAoZXZlbnQpID0+IF90aGlzLm9idGFpbk5ld0lkZW50aXR5KGV2ZW50LCBjYWxsYmFjaywgdG9SZW1vdmVJRCkpO1xuICAgICAgICAvLyQoJy5iYWNrJykub24oJ2NsaWNrJywgKGV2ZW50KSA9PiBfdGhpcy5nb0hvbWUoKSk7XG4gICAgICAgICQoJy5pZGVudGl0aWVzLXJlc2V0Jykub2ZmKCk7XG4gICAgICAgICQoJy5pZGVudGl0aWVzLXJlc2V0Jykub24oJ2NsaWNrJywgKGV2ZW50KSA9PiBfdGhpcy5fcmVzZXRJZGVudGl0aWVzKGNhbGxiYWNrKSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIF9jaGVja1JlY2VpdmVkSW5mbyhyZWNlaXZlZEluZm8pIHtcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICBsZXQgaWRlbnRpdHlJbmZvLCB0b1JlbW92ZUlEO1xuICAgICAgaWYgKHJlY2VpdmVkSW5mbykge1xuICAgICAgICBpZGVudGl0eUluZm8gPSByZWNlaXZlZEluZm87XG4gICAgICAgIHRvUmVtb3ZlSUQgPSBmYWxzZTtcbiAgICAgICAgcmVzb2x2ZSh7aWRlbnRpdHlJbmZvOiBpZGVudGl0eUluZm8sIHRvUmVtb3ZlSUQ6dG9SZW1vdmVJRH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdG9SZW1vdmVJRCA9IHRydWU7XG4gICAgICAgIF90aGlzLmNhbGxJZGVudGl0eU1vZHVsZUZ1bmMoJ2dldElkZW50aXRpZXNUb0Nob29zZScsIHt9KS50aGVuKChyZXN1bHQpID0+IHtcbiAgICAgICAgICByZXNvbHZlKHtpZGVudGl0eUluZm86IHJlc3VsdCwgdG9SZW1vdmVJRDogdG9SZW1vdmVJRH0pO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIHNob3dNeUlkZW50aXRpZXMoZW1haWxzLCB0b1JlbW92ZUlEKSB7XG4gICAgbGV0IF90aGlzID0gdGhpcztcblxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG5cbiAgICAgIC8vIGxldCBpZGVudGl0aWVzID0gX3RoaXMuaWRlbnRpdHlNb2R1bGUuZ2V0SWRlbnRpdGllcygpO1xuICAgICAgbGV0IGlkZW50aXRpZXMgPSBbXTtcblxuICAgICAgZm9yIChsZXQgaSBpbiBlbWFpbHMpIHtcbiAgICAgICAgbGV0IGRvbWFpbiA9IGVtYWlsc1tpXS5zcGxpdCgnQCcpO1xuICAgICAgICBpZGVudGl0aWVzLnB1c2goeyBlbWFpbDogZW1haWxzW2ldLCBkb21haW46IGRvbWFpblsxXSB9KTtcbiAgICAgIH1cblxuICAgICAgbGV0IG15SWRlbnRpdGllcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdteS1pZHMnKTtcbiAgICAgIG15SWRlbnRpdGllcy5pbm5lckhUTUwgPSAnJztcblxuICAgICAgbGV0IHRhYmxlID0gX3RoaXMuY3JlYXRlVGFibGUoKTtcblxuICAgICAgbGV0IHRib2R5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGJvZHknKTtcbiAgICAgIGxldCBudW1JZGVudGl0aWVzID0gaWRlbnRpdGllcy5sZW5ndGg7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bUlkZW50aXRpZXM7IGkrKykge1xuICAgICAgICBsZXQgdHIgPSBfdGhpcy5jcmVhdGVUYWJsZVJvdyhpZGVudGl0aWVzW2ldLCB0b1JlbW92ZUlEKTtcbiAgICAgICAgdGJvZHkuYXBwZW5kQ2hpbGQodHIpO1xuICAgICAgfVxuXG4gICAgICB0YWJsZS5hcHBlbmRDaGlsZCh0Ym9keSk7XG4gICAgICBteUlkZW50aXRpZXMuYXBwZW5kQ2hpbGQodGFibGUpO1xuXG4gICAgICBsZXQgY2FsbGJhY2sgPSAoaWRlbnRpdHkpID0+IHtcbiAgICAgICAgcmVzb2x2ZShpZGVudGl0eSk7XG4gICAgICB9O1xuXG4gICAgICBpZiAoIXRvUmVtb3ZlSUQpIHtcbiAgICAgICAgJCgnLmNsaWNrYWJsZS1jZWxsJykub24oJ2NsaWNrJywgKGV2ZW50KSA9PiBfdGhpcy5jaGFuZ2VJRChldmVudCwgY2FsbGJhY2spKTtcbiAgICAgIH1cblxuICAgICAgJCgnLnJlbW92ZS1pZCcpLm9uKCdjbGljaycsIChldmVudCkgPT4gX3RoaXMucmVtb3ZlSUQoZW1haWxzKSk7XG5cbiAgICB9KTtcbiAgfVxuXG4gIGNyZWF0ZVRhYmxlKCkge1xuICAgIGxldCB0YWJsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RhYmxlJyk7XG4gICAgdGFibGUuY2xhc3NOYW1lID0gJ2NlbnRlcmVkJztcbiAgICBsZXQgdGhlYWQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0aGVhZCcpO1xuICAgIGxldCB0ciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RyJyk7XG4gICAgbGV0IHRoRW1haWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0aCcpO1xuICAgIHRoRW1haWwudGV4dENvbnRlbnQgPSAnRW1haWwnO1xuICAgIHRyLmFwcGVuZENoaWxkKHRoRW1haWwpO1xuICAgIHRoZWFkLmFwcGVuZENoaWxkKHRyKTtcbiAgICB0YWJsZS5hcHBlbmRDaGlsZCh0aGVhZCk7XG4gICAgcmV0dXJuIHRhYmxlO1xuICB9XG5cbiAgY3JlYXRlVGFibGVSb3coaWRlbnRpdHksIHRvUmVtb3ZlSUQpIHtcbiAgICBsZXQgdHIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0cicpO1xuXG4gICAgbGV0IHRkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGQnKTtcbiAgICB0ZC50ZXh0Q29udGVudCA9IGlkZW50aXR5LmVtYWlsO1xuICAgIHRkLmNsYXNzTmFtZSA9ICdjbGlja2FibGUtY2VsbCc7XG4gICAgdGQuc3R5bGUgPSAnY3Vyc29yOiBwb2ludGVyJztcbiAgICB0ci5hcHBlbmRDaGlsZCh0ZCk7XG5cbiAgICB0ZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7XG5cbiAgICBpZiAodG9SZW1vdmVJRCkge1xuICAgICAgbGV0IGJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpO1xuICAgICAgYnRuLnRleHRDb250ZW50ID0gJ1JlbW92ZSc7XG4gICAgICBidG4uY2xhc3NOYW1lID0gJ3JlbW92ZS1pZCB3YXZlcy1lZmZlY3Qgd2F2ZXMtbGlnaHQgYnRuJztcbiAgICAgIHRkLmFwcGVuZENoaWxkKGJ0bik7XG4gICAgfVxuXG4gICAgdHIuYXBwZW5kQ2hpbGQodGQpO1xuXG4gICAgcmV0dXJuIHRyO1xuICB9XG5cbiAgY2hhbmdlSUQoZXZlbnQsIGNhbGxiYWNrKSB7XG4gICAgbGV0IF90aGlzID0gdGhpcztcblxuICAgIGxldCBpZFRvVXNlID0gZXZlbnQudGFyZ2V0LmlubmVyVGV4dDtcblxuICAgIC8vVE9ETyBpbXByb3ZlIGxhdGVyLlxuICAgIC8vcHJldmVudHMgd2hlbiB0aGUgdXNlcnMgc2VsZWN0cyBhbiBoeXBlcnR5LCBleGl0IHRoZSBpZGVudGl0eSBwYWdlIGFuZFxuICAgIC8vZ29lcyBhZ2FpbiB0byB0aGUgaWRlbnRpdHkgcGFnZSwgZnJvbSBzZWxlY3RpbmcgXCJzZXR0aW5nc1wiIGJ1dHRvbiBhcyBpZGVudGl0eS5cbiAgICBpZiAoaWRUb1VzZSAhPT0gJ3NldHRpbmdzJykge1xuXG4gICAgICBjYWxsYmFjayhpZFRvVXNlKTtcbiAgICAgIHJldHVybiBpZFRvVXNlO1xuICAgIH1cbiAgfVxuXG4gIHJlbW92ZUlEKGV2ZW50LCBlbWFpbHMpIHtcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xuICAgIGxldCByb3cgPSBldmVudC50YXJnZXQucGFyZW50Tm9kZS5wYXJlbnROb2RlO1xuICAgIGxldCBpZFRvUmVtb3ZlID0gcm93LmNoaWxkcmVuWzBdLnRleHRDb250ZW50O1xuICAgIGxldCBkb21haW4gPSByb3cuY2hpbGRyZW5bMV0udGV4dENvbnRlbnQ7XG5cbiAgICBfdGhpcy5jYWxsSWRlbnRpdHlNb2R1bGVGdW5jKCd1bnJlZ2lzdGVySWRlbnRpdHknLCB7IGVtYWlsOiBpZFRvUmVtb3ZlIH0pLnRoZW4oKCkgPT4ge1xuICAgICAgbGV0IG51bUVtYWlscyA9IGVtYWlscy5sZW5ndGg7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bUVtYWlsczsgaSsrKSB7XG4gICAgICAgIGlmIChlbWFpbHNbaV0uZW1haWwgPT09IGlkVG9SZW1vdmUpIHtcbiAgICAgICAgICBlbWFpbHMuc3BsaWNlKGksIDEpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0vL1xuICAgICAgX3RoaXMuc2hvd015SWRlbnRpdGllcyhlbWFpbHMsIHRydWUpO1xuICAgIH0pO1xuXG4gICAgLy9fdGhpcy5pZGVudGl0eU1vZHVsZS51bnJlZ2lzdGVySWRlbnRpdHkoaWRUb1JlbW92ZSk7XG5cbiAgfVxuXG4gIG9idGFpbk5ld0lkZW50aXR5KGV2ZW50LCBjYWxsYmFjaywgdG9SZW1vdmVJRCkge1xuICAgIGxldCBfdGhpcyA9IHRoaXM7XG4gICAgbGV0IGlkUHJvdmlkZXIgPSBldmVudC50YXJnZXQudGV4dENvbnRlbnQ7XG4gICAgbGV0IGlkUHJvdmlkZXIyID0gZXZlbnQudGFyZ2V0LnRleHQ7XG5cbiAgICBfdGhpcy5jYWxsSWRlbnRpdHlNb2R1bGVGdW5jKCdnZW5lcmF0ZVJTQUtleVBhaXInLCB7fSkudGhlbigoa2V5UGFpcikgPT4ge1xuICAgICAgbGV0IHB1YmxpY0tleSA9IGJ0b2Eoa2V5UGFpci5wdWJsaWMpO1xuXG4gICAgICBfdGhpcy5jYWxsSWRlbnRpdHlNb2R1bGVGdW5jKCdzZW5kR2VuZXJhdGVNZXNzYWdlJyxcbiAgICAgICAgeyBjb250ZW50czogcHVibGljS2V5LCBvcmlnaW46ICdvcmlnaW4nLCB1c2VybmFtZUhpbnQ6IHVuZGVmaW5lZCxcbiAgICAgICAgaWRwRG9tYWluOiBpZFByb3ZpZGVyLCB9KS50aGVuKCh2YWx1ZSkgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZygncmVjZWl2ZWRVUkw6ICcgKyB2YWx1ZS5sb2dpblVybC5zdWJzdHJpbmcoMCwgMjApICsgJy4uLicpO1xuXG4gICAgICAgIGxldCB1cmwgPSB2YWx1ZS5sb2dpblVybDtcbiAgICAgICAgbGV0IGZpbmFsVVJMO1xuXG4gICAgICAgIC8vY2hlY2sgaWYgdGhlIHJlY2VpdmVkVVJMIGNvbnRhaW5zIHRoZSByZWRpcmVjdCBmaWVsZCBhbmQgcmVwbGFjZSBpdFxuICAgICAgICBpZiAodXJsLmluZGV4T2YoJ3JlZGlyZWN0X3VyaScpICE9PSAtMSkge1xuICAgICAgICAgIGxldCBmaXJzdFBhcnQgPSB1cmwuc3Vic3RyaW5nKDAsIHVybC5pbmRleE9mKCdyZWRpcmVjdF91cmknKSk7XG4gICAgICAgICAgbGV0IHNlY29uZEF1eFBhcnQgPSB1cmwuc3Vic3RyaW5nKHVybC5pbmRleE9mKCdyZWRpcmVjdF91cmknKSwgdXJsLmxlbmd0aCk7XG5cbiAgICAgICAgICBsZXQgc2Vjb25kUGFydCA9IHNlY29uZEF1eFBhcnQuc3Vic3RyaW5nKHNlY29uZEF1eFBhcnQuaW5kZXhPZignJicpLCB1cmwubGVuZ3RoKTtcblxuICAgICAgICAgIC8vY2hlY2sgaWYgdGhlIHJlZGRpcmVjdCBmaWVsZCBpcyB0aGUgbGFzdCBmaWVsZCBvZiB0aGUgVVJMXG4gICAgICAgICAgaWYgKHNlY29uZFBhcnQuaW5kZXhPZignJicpICE9PSAtMSkge1xuICAgICAgICAgICAgZmluYWxVUkwgPSBmaXJzdFBhcnQgKyAncmVkaXJlY3RfdXJpPScgKyBsb2NhdGlvbi5vcmlnaW4gKyBzZWNvbmRQYXJ0O1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBmaW5hbFVSTCA9IGZpcnN0UGFydCArICdyZWRpcmVjdF91cmk9JyArIGxvY2F0aW9uLm9yaWdpbjtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBfdGhpcy5yZXN1bHRVUkwgPSBmaW5hbFVSTCB8fCB1cmw7XG5cbiAgICAgICAgJCgnLmxvZ2luLWlkcCcpLmh0bWwoJzxwPkNob3NlbiBJRFA6ICcgKyBpZFByb3ZpZGVyICsgJzwvcD4nKTtcbiAgICAgICAgJCgnLmxvZ2luJykucmVtb3ZlQ2xhc3MoJ2hpZGUnKTtcbiAgICAgICAgJCgnLmxvZ2luLWJ0bicpLm9mZigpO1xuICAgICAgICAkKCcubG9naW4tYnRuJykub24oJ2NsaWNrJywgKGV2ZW50KSA9PiB7XG4gICAgICAgICAgJCgnLmxvZ2luJykuYWRkQ2xhc3MoJ2hpZGUnKTtcbiAgICAgICAgICBfdGhpcy5fYXV0aGVudGljYXRlVXNlcihrZXlQYWlyLCBwdWJsaWNLZXksIHZhbHVlLCAnb3JpZ2luJywgaWRQcm92aWRlcikudGhlbigoZW1haWwpID0+IHtcbiAgICAgICAgICAgIGNhbGxiYWNrKGVtYWlsKTtcbiAgICAgICAgICAgIF90aGlzLnNob3dJZGVudGl0aWVzR1VJKCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSkuY2F0Y2goZXJyID0+IGNvbnNvbGUubG9nKCdvYnRhbmluIG5ldyBpZGVudGl0eScsIGVycikpO1xuXG4gIH1cblxuICBfZ2V0TGlzdChpdGVtcykge1xuICAgIGxldCBsaXN0ID0gJyc7XG4gICAgbGV0IG51bUl0ZW1zID0gaXRlbXMubGVuZ3RoO1xuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1JdGVtczsgaSsrKSB7XG4gICAgICBsaXN0ICs9ICc8bGkgY2xhc3M9XCJkaXZpZGVyXCI+PC9saT4nO1xuICAgICAgbGlzdCArPSAnPGxpPjxhIGNsYXNzPVwiY2VudGVyLWFsaWduXCI+JyArIGl0ZW1zW2ldICsgJzwvYT48L2xpPic7XG4gICAgfVxuXG4gICAgcmV0dXJuIGxpc3Q7XG4gIH1cblxuICBfYXV0aGVudGljYXRlVXNlcihrZXlQYWlyLCBwdWJsaWNLZXksIHZhbHVlLCBvcmlnaW4sIGlkUHJvdmlkZXIpIHtcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xuICAgIGxldCB1cmwgPSBfdGhpcy5yZXN1bHRVUkw7XG5cbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuXG4gICAgICBfdGhpcy5vcGVuUG9wdXAodXJsKS50aGVuKChpZGVudGl0eSkgPT4ge1xuXG4gICAgICAgIF90aGlzLmNhbGxJZGVudGl0eU1vZHVsZUZ1bmMoJ3NlbmRHZW5lcmF0ZU1lc3NhZ2UnLFxuICAgICAgICAgIHsgY29udGVudHM6IHB1YmxpY0tleSwgb3JpZ2luOiBvcmlnaW4sIHVzZXJuYW1lSGludDogaWRlbnRpdHksIGlkcERvbWFpbjogaWRQcm92aWRlciB9KS50aGVuKChyZXN1bHQpID0+IHtcblxuICAgICAgICAgIGlmIChyZXN1bHQpIHtcblxuICAgICAgICAgICAvL190aGlzLmlkZW50aXR5TW9kdWxlLnN0b3JlSWRlbnRpdHkocmVzdWx0LCBrZXlQYWlyKS50aGVuKCh2YWx1ZSkgPT4ge1xuICAgICAgICAgICBfdGhpcy5jYWxsSWRlbnRpdHlNb2R1bGVGdW5jKCdzdG9yZUlkZW50aXR5Jywge3Jlc3VsdDogcmVzdWx0LCBrZXlQYWlyOiBrZXlQYWlyfSkudGhlbigodmFsdWUpID0+IHtcbiAgICAgICAgICAgICByZXNvbHZlKHZhbHVlLnVzZXJQcm9maWxlLnVzZXJuYW1lKTtcbiAgICAgICAgICAgfSwgKGVycikgPT4ge1xuICAgICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICAgICB9KTtcblxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgIHJlamVjdCgnZXJyb3Igb24gb2J0YWluaW5nIGlkZW50aXR5IGluZm9ybWF0aW9uJyk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgfSk7XG4gICAgICAgICB9LCAoZXJyKSA9PiB7XG4gICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuX3Jlc2V0SWRlbnRpdGllcygpIHtcbiAgY29uc29sZS5sb2coJ19yZXNldElkZW50aXRpZXMnKTtcbn1cblxuXG59XG5cbmV4cG9ydCBkZWZhdWx0IElkZW50aXRpZXNHVUk7XG4iXX0="}