{"version":3,"sources":["node_modules/browser-pack/_prelude.js","src/admin/IdentitiesGUI.js"],"names":[],"mappings":"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","file":"identities-gui.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","// jshint browser:true, jquery: true\r\n\r\nclass IdentitiesGUI {\r\n\r\n  constructor(guiURL, idmURL, messageBus) {\r\n    console.log('IdentitiesGUI', this);\r\n    //if (!identityModule) throw Error('Identity Module not set!');\r\n    if (!messageBus) throw Error('Message Bus not set!');\r\n    let _this = this;\r\n    _this._guiURL = guiURL;\r\n    _this._idmURL = idmURL;\r\n    _this._messageBus = messageBus;\r\n    _this._alreadyReLogin = false;\r\n    _this._alreadyLogin = false;\r\n\r\n    this.callIdentityModuleFunc('deployGUI', {}).then((result) => {\r\n      return this._buildDrawer();\r\n    }).then((result) => {\r\n      console.log('READY:', result);\r\n    });\r\n\r\n    this.isLogged = false;\r\n\r\n    const drawerEl = document.querySelector('.mdc-temporary-drawer');\r\n    const MDCTemporaryDrawer = mdc.drawer.MDCTemporaryDrawer;\r\n    const drawer = new MDCTemporaryDrawer(drawerEl);\r\n\r\n    this._drawerEl = drawerEl;\r\n    this._drawer = drawer;\r\n\r\n    document.querySelector('.settings-btn').addEventListener('click', function() {\r\n      drawer.open = true;\r\n    });\r\n\r\n    drawerEl.addEventListener('MDCTemporaryDrawer:open', () => {\r\n      console.log('Received MDCTemporaryDrawer:open');\r\n      this._isDrawerOpen = true;\r\n      parent.postMessage({ body: { method: 'showAdminPage' }, to: 'runtime:gui-manager' }, '*');\r\n    });\r\n\r\n    drawerEl.addEventListener('MDCTemporaryDrawer:close', () => {\r\n      console.log('Received MDCTemporaryDrawer:close');\r\n      this._isDrawerOpen = false;\r\n      parent.postMessage({ body: { method: 'hideAdminPage' }, to: 'runtime:gui-manager' }, '*');\r\n    });\r\n\r\n  }\r\n\r\n  logOut() {\r\n    let _this = this;\r\n    console.log('IdentitiesGUI: logging out');\r\n    return new Promise((resolve, reject) => {\r\n\r\n      console.log('Building drawer');\r\n      _this._buildDrawer();\r\n\r\n      resolve('Gui reset');\r\n\r\n\r\n    });\r\n  }\r\n\r\n  _buildDrawer() {\r\n\r\n    const guiURL = this._guiURL;\r\n\r\n    this._messageBus.addListener(guiURL, msg => {\r\n\r\n      const funcName = msg.body.method;\r\n\r\n      if (msg.type !== 'response') {\r\n\r\n\r\n        if (!this.isLogged) {\r\n\r\n          const clickClose = new MouseEvent('click');\r\n          document.querySelector('.settings-btn').dispatchEvent(clickClose);\r\n\r\n        }\r\n\r\n      }\r\n\r\n      if (funcName === 'openPopup') {\r\n\r\n        this.openPopup().then(() => {\r\n\r\n          let urlreceived = msg.body.params.urlreceived;\r\n          this.openPopup(urlreceived).then((returnedValue) => {\r\n            let value = {type: 'execute', value: returnedValue, code: 200};\r\n            let replyMsg = {id: msg.id, type: 'response', to: msg.from, from: msg.to, body: value};\r\n            this._messageBus.postMessage(replyMsg);\r\n          });\r\n\r\n        });\r\n\r\n        return;\r\n\r\n      }\r\n\r\n      const callback = (identityInfo) => {\r\n\r\n        this.isLogged = true;\r\n\r\n        this._buildMessage(msg, identityInfo);\r\n\r\n      };\r\n\r\n      this.callback = callback;\r\n\r\n      this._getIdentities(callback, true);\r\n\r\n    });\r\n\r\n    this._getIdentities();\r\n\r\n  }\r\n\r\n  _buildMessage(msg, identityInfo) {\r\n    let replyMsg;\r\n    let value;\r\n\r\n    const from = msg ? msg.from : this._guiURL;\r\n    const to = msg ? msg.to : this._idmURL;\r\n\r\n    console.log('chosen identity: ', identityInfo);\r\n\r\n    switch (identityInfo.type) {\r\n      case 'idp':\r\n        value = { type: 'idp', value: identityInfo.value, code: 200 };\r\n        break;\r\n\r\n      case 'identity':\r\n        value = { type: 'identity', value: identityInfo.value, code: 200 };\r\n        break;\r\n\r\n      default:\r\n        value = { type: 'error', value: 'Error on identity GUI', code: 400 };\r\n    }\r\n\r\n    replyMsg = {id: msg.id, type: 'response', to: from, from: to, body: value };\r\n\r\n    this._messageBus.postMessage(replyMsg);\r\n  }\r\n\r\n  _getIdentities(callback, oPenDrawer) {\r\n\r\n    return this.callIdentityModuleFunc('getIdentitiesToChoose', {}).then((resultObject) => {\r\n      if (callback) {\r\n        return Promise.all([this.showIdps(resultObject.idps, callback), this.showDefaultIdentity(resultObject.defaultIdentity), this.showIdentities(resultObject, callback, oPenDrawer)]);\r\n      } else {\r\n        return Promise.all([this.showIdps(resultObject.idps), this.showDefaultIdentity(resultObject.defaultIdentity), this.showIdentities(resultObject)]);\r\n      }\r\n    });\r\n\r\n  }\r\n\r\n  // _openDrawer() {\r\n\r\n  //   let _this = this;\r\n  //   const guiURL = _this._guiURL;\r\n\r\n  //   _this.resultURL  = undefined;\r\n\r\n  //   _this._messageBus.addListener(guiURL, msg => {\r\n  //     let identityInfo = msg.body.value;\r\n  //     let funcName = msg.body.method;\r\n  //     let value;\r\n  //     console.log('[IdentitiesGUI] received msg: ', msg);\r\n\r\n  //     _this.showIdentitiesGUI(msg.body.value).then((identityInfo) => {\r\n\r\n  //       let replyMsg;\r\n  //       console.log('[IdentitiesGUI] identityInfo from GUI: ', identityInfo);\r\n\r\n  //       //hide config page with the identity GUI\r\n  //       parent.postMessage({ body: { method: 'hideAdminPage' }, to: 'runtime:gui-manager' }, '*');\r\n  //       $('.admin-page').addClass('hide');\r\n\r\n  //       // document.getElementsByTagName('body')[0].style = 'background-color:transparent';\r\n  //       $('.identities-section').addClass('hide');\r\n  //       $('.policies-section').addClass('hide');\r\n\r\n  //       switch (identityInfo.type) {\r\n  //         case 'idp':\r\n  //           value = { type: 'idp', value: identityInfo.value, code: 200 };\r\n  //           replyMsg = { id: msg.id, type: 'response', to: msg.from, from: msg.to, body: value };\r\n  //           _this._messageBus.postMessage(replyMsg);\r\n  //           break;\r\n\r\n  //         case 'identity':\r\n  //           value = { type: 'identity', value: identityInfo.value, code: 200 };\r\n  //           replyMsg = { id: msg.id, type: 'response', to: msg.from, from: msg.to, body: value };\r\n  //           _this._messageBus.postMessage(replyMsg);\r\n  //           break;\r\n\r\n  //         default:\r\n  //           value = { type: 'error', value: 'Error on identity GUI', code: 400 };\r\n  //           replyMsg = { id: msg.id, type: 'response', to: msg.from, from: msg.to, body: value };\r\n  //           _this._messageBus.postMessage(replyMsg);\r\n  //       }\r\n  //     });\r\n\r\n  //     if (funcName === 'openPopup') {\r\n  //       let urlreceived = msg.body.params.urlreceived;\r\n  //       _this.openPopup(urlreceived).then((returnedValue) => {\r\n  //         let value = {type: 'execute', value: returnedValue, code: 200};\r\n  //         let replyMsg = {id: msg.id, type: 'response', to: msg.from, from: msg.to, body: value};\r\n  //         _this._messageBus.postMessage(replyMsg);\r\n  //       });\r\n  //       return; // this avoids getting stuck in the identities page\r\n  //     }\r\n\r\n  //     // unhide the config page with the identity GUI\r\n  //     // document.getElementsByTagName('body')[0].style = 'background-color:white;';\r\n  //     parent.postMessage({ body: { method: 'showAdminPage' }, to: 'runtime:gui-manager' }, '*');\r\n\r\n  //     const clickOpen = new MouseEvent('click');\r\n  //     document.querySelector('.settings-btn').dispatchEvent(clickOpen);\r\n\r\n  //     $('.admin-page').removeClass('hide');\r\n\r\n  //   });\r\n  // }\r\n\r\n  callIdentityModuleFunc(methodName, parameters) {\r\n    let _this = this;\r\n\r\n    return new Promise((resolve, reject) => {\r\n      const message = { type: 'execute', to: _this._idmURL, from: _this._guiURL,\r\n        body: { resource: 'identity', method: methodName, params: parameters }};\r\n\r\n      this._messageBus.postMessage(message, (res) => {\r\n        let result = res.body.value;\r\n        resolve(result);\r\n      });\r\n\r\n    });\r\n  }\r\n\r\n  openPopup(urlreceived) {\r\n\r\n    return new Promise((resolve, reject) => {\r\n\r\n      let win;\r\n      if (!urlreceived) {\r\n        win = window.open('', 'openIDrequest', 'location=1,status=1');\r\n        this.win = win;\r\n        resolve();\r\n      } else {\r\n        win = this.win;\r\n        win.location.href = urlreceived;\r\n      }\r\n\r\n      // let win = window.open(urlreceived, 'openIDrequest', 'location=1,status=1,scrollbars=1');\r\n      if (window.cordova) {\r\n        win.addEventListener('loadstart', function(e) {\r\n          let url = e.url;\r\n          let code = /\\&code=(.+)$/.exec(url);\r\n          let error = /\\&error=(.+)$/.exec(url);\r\n\r\n          if (code || error) {\r\n            win.close();\r\n            return resolve(url);\r\n          } else {\r\n            return reject('openPopup error 1 - should not happen');\r\n          }\r\n        });\r\n      } else {\r\n\r\n        let pollTimer = setInterval(function() {\r\n          try {\r\n            if (win.closed) {\r\n              clearInterval(pollTimer);\r\n\r\n              // return reject('Some error occured when trying to get identity.');\r\n            }\r\n\r\n            if ((win.document.URL.indexOf('access_token') !== -1 || win.document.URL.indexOf('code') !== -1) && win.document.URL.indexOf(location.origin) !== -1) {\r\n              window.clearInterval(pollTimer);\r\n              let url =   win.document.URL;\r\n\r\n              resolve(url);\r\n              return win.close();\r\n            }\r\n          } catch (e) {\r\n            //return reject('openPopup error 2 - should not happen');\r\n            // console.log(e);\r\n          }\r\n\r\n        }, 500);\r\n      }\r\n\r\n    });\r\n  }\r\n\r\n  // showIdentitiesGUI(receivedInfo) {\r\n  //   let _this = this;\r\n\r\n  //   return new Promise((resolve, reject) => {\r\n  //     console.log('[IdentitiesGUI.showIdentitiesGUI] receivedInfo: ', receivedInfo);\r\n\r\n  //     let identityInfo;\r\n  //     let toRemoveID;\r\n\r\n  //     let callback = (value) => {\r\n  //       console.log('chosen identity: ', value);\r\n\r\n  //       const clickClose = new MouseEvent('click');\r\n  //       document.querySelector('.settings-btn').dispatchEvent(clickClose);\r\n\r\n  //       resolve({type: 'identity', value: value});\r\n  //     };\r\n\r\n  //     _this._checkReceivedInfo(receivedInfo).then((resultObject) => {\r\n  //       identityInfo = resultObject.identityInfo;\r\n  //       toRemoveID = resultObject.toRemoveID;\r\n\r\n  //       $('.policies-section').addClass('hide');\r\n  //       $('.identities-section').removeClass('hide');\r\n\r\n  //       _this.showIdps(receivedInfo.idps, callback);\r\n\r\n  //       _this.showIdentities(identityInfo.identities, toRemoveID).then((identity) => {\r\n  //         console.log('chosen identity: ', identity);\r\n  //         resolve({type: 'identity', value: identity});\r\n  //       });\r\n\r\n  //       let idps = [];\r\n  //       let idpsObjects = identityInfo.idps;\r\n\r\n  //       idpsObjects.forEach(function(entry) {\r\n  //         if(entry.type && entry.type == 'idToken') {\r\n  //           idps.push(entry.domain);\r\n  //         }\r\n  //       });\r\n\r\n  //       $('#idproviders').html(_this._getList(idps));\r\n  //       $('#idproviders').off();\r\n  //       // $('#idproviders').on('click', (event) => _this.obtainNewIdentity(event, callback, toRemoveID));\r\n  //       //$('.back').on('click', (event) => _this.goHome());\r\n  //       $('.identities-reset').off();\r\n  //       // $('.identities-reset').on('click', (event) => _this._resetIdentities(callback));\r\n  //     });\r\n  //   });\r\n  // }\r\n\r\n  _checkReceivedInfo(receivedInfo) {\r\n    let _this = this;\r\n    return new Promise((resolve, reject) => {\r\n\r\n      let identityInfo;\r\n      let toRemoveID;\r\n\r\n      if (receivedInfo) {\r\n        identityInfo = receivedInfo;\r\n        toRemoveID = false;\r\n        resolve({identityInfo: identityInfo, toRemoveID: toRemoveID});\r\n      } else {\r\n        toRemoveID = true;\r\n        _this.callIdentityModuleFunc('getIdentitiesToChoose', {}).then((result) => {\r\n          resolve({identityInfo: result, toRemoveID: toRemoveID});\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n  showIdps(idps) {\r\n\r\n    console.log('[IdentitiesGUI.showIdps] : ', idps);\r\n\r\n    let idpsListEl = document.getElementById('idps-list');\r\n\r\n    const clickEvent = (event) => {\r\n      const el = event.currentTarget;\r\n      const idp = el.getAttribute('data-idp');\r\n\r\n      this.loginWithIDP(idp).then((result) => {\r\n        // console.log('value here: ', result.value);\r\n        // result.value = result.value.userURL\r\n\r\n        if (this.callback) {\r\n          this.callback(result);\r\n        }\r\n\r\n      });\r\n    };\r\n\r\n    idps.forEach((key) => {\r\n\r\n      let linkEl = document.getElementById('link-' + key.domain);\r\n\r\n      if (!linkEl) {\r\n        linkEl = document.createElement('a');\r\n        linkEl.setAttribute('id', 'link-' + key.domain);\r\n        linkEl.setAttribute('data-idp', key.domain);\r\n        linkEl.classList = 'mdc-list-item link-' + key.domain;\r\n        linkEl.href = '#';\r\n\r\n        const linkElText = document.createTextNode(key.domain);\r\n\r\n        let name = key.domain;\r\n        if (name.indexOf('.') !== -1) {\r\n          name = name.substring(0, name.indexOf('.'));\r\n        } else {\r\n          name = 'question';\r\n        }\r\n\r\n        const imgEl = document.createElement('img');\r\n        imgEl.classList = 'mdc-list-item__start-detail';\r\n        imgEl.src = './assets/' + name + '.svg';\r\n        imgEl.width = 30;\r\n        imgEl.height = 30;\r\n\r\n        imgEl.onerror = (e) => { e.srcElement.src = './assets/question.svg'; };\r\n\r\n        linkEl.appendChild(imgEl);\r\n        linkEl.appendChild(linkElText);\r\n\r\n        idpsListEl.appendChild(linkEl);\r\n      } else {\r\n        linkEl.removeEventListener('click', clickEvent);\r\n      }\r\n\r\n      linkEl.addEventListener('click', clickEvent);\r\n\r\n    });\r\n\r\n  }\r\n\r\n  showDefaultIdentity(identity) {\r\n\r\n    if (identity) {\r\n\r\n      this.isLogged = true;\r\n\r\n      const header = document.querySelector('.mdc-list--avatar-list');\r\n\r\n      let itemEl = document.getElementById('item-' + identity.userProfile.userURL);\r\n\r\n      if (!itemEl) {\r\n\r\n        itemEl = document.createElement('li');\r\n        itemEl.id = 'item-' + identity.userProfile.userURL;\r\n        itemEl.classList = 'mdc-list-item item-' + identity.userProfile.userURL;\r\n        itemEl.setAttribute('data-userURL', identity.userProfile.userURL);\r\n\r\n        const profileImage = document.createElement('img');\r\n        profileImage.classList = 'mdc-list-item__start-detail';\r\n        profileImage.width = 56;\r\n        profileImage.height = 56;\r\n        profileImage.alt = identity.userProfile.name;\r\n        profileImage.src = identity.userProfile.picture;\r\n        itemEl.appendChild(profileImage);\r\n\r\n        const text1 = document.createElement('span');\r\n        text1.classList = 'name mdc-list-item__text';\r\n        text1.textContent = identity.userProfile.name;\r\n\r\n        const text2 = document.createElement('span');\r\n        text2.classList = 'email mdc-list-item__secondary-text';\r\n        text2.textContent = identity.userProfile.email;\r\n\r\n        text1.appendChild(text2);\r\n        itemEl.appendChild(text1);\r\n        header.appendChild(itemEl);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  showIdentities(iDs, callback, oPenDrawer = false) {\r\n\r\n    return new Promise((resolve, reject) => {\r\n\r\n      console.log('[IdentitiesGUI.showMyIdentities] : ', iDs.identities, iDs.defaultIdentity);\r\n\r\n      const identities = iDs.identities;\r\n      const current = iDs.defaultIdentity ? iDs.defaultIdentity.userURL : '';\r\n\r\n      let activeIdentities = document.getElementById('active-identities');\r\n\r\n      Object.keys(identities).forEach((key) => {\r\n\r\n        const exist = document.getElementById('link-' + key);\r\n        if (exist) { return; }\r\n\r\n        const linkEl = document.createElement('a');\r\n        linkEl.href = '#';\r\n        linkEl.id = 'link-' + key;\r\n        linkEl.classList = 'mdc-list-item';\r\n        linkEl.setAttribute('data-userURL', key);\r\n\r\n        if (key === current) {\r\n          linkEl.classList += ' mdc-temporary-drawer--selected';\r\n        }\r\n\r\n        linkEl.addEventListener('click', (event) => {\r\n\r\n          event.preventDefault();\r\n\r\n          const el = event.currentTarget;\r\n          const userURL = el.getAttribute('data-userURL');\r\n\r\n          console.log('userURL:', userURL, callback, el);\r\n\r\n          if (callback) {\r\n            callback(userURL);\r\n          }\r\n\r\n        });\r\n\r\n        const profileImage = document.createElement('img');\r\n        profileImage.classList = 'mdc-list-item__start-detail';\r\n        profileImage.width = 40;\r\n        profileImage.height = 40;\r\n        profileImage.alt = identities[key].userProfile.name;\r\n        profileImage.src = identities[key].userProfile.picture;\r\n        profileImage.onerror = (e) => { e.srcElement.src = './assets/question.svg'; };\r\n\r\n        const text1 = document.createElement('span');\r\n        text1.classList = 'name mdc-list-item__text';\r\n        text1.textContent = identities[key].userProfile.name;\r\n\r\n        const text2 = document.createElement('span');\r\n        text2.classList = 'email mdc-list-item__secondary-text';\r\n        text2.textContent = identities[key].userProfile.email;\r\n\r\n        text1.appendChild(text2);\r\n\r\n        linkEl.appendChild(profileImage);\r\n        linkEl.appendChild(text1);\r\n\r\n        activeIdentities.appendChild(linkEl);\r\n\r\n      });\r\n\r\n      if (oPenDrawer && (!this._alreadyReLogin)) {\r\n        this._drawer.open = true\r\n      }\r\n\r\n      if (oPenDrawer && (!this._alreadyReLogin) && (!this._alreadyLogin)) {\r\n        this._alreadyReLogin = true;\r\n        parent.postMessage({ body: { method: 'tokenExpired' }, to: 'runtime:gui-manager' }, '*');\r\n      }\r\n\r\n\r\n\r\n\r\n/*\r\n      if (Object.keys(identities).length === 1) {\r\n\r\n        if (callback) {\r\n          callback({type: 'identity', value: current});\r\n        }\r\n\r\n        return resolve({type: 'identity', value: current});\r\n      }*/\r\n\r\n\r\n      // let callback = (identity) => {\r\n      //   resolve(identity);\r\n      // };\r\n\r\n      // if (!toRemoveID) {\r\n      //   $('.clickable-cell').on('click', (event) => _this.changeID(event, callback));\r\n      // }\r\n\r\n      // $('.remove-id').on('click', (event) => _this.removeID(iDs));\r\n\r\n    });\r\n  }\r\n\r\n  removeID(event, emails) {\r\n    let _this = this;\r\n    let row = event.target.parentNode.parentNode;\r\n    let idToRemove = row.children[0].textContent;\r\n    let domain = row.children[1].textContent;\r\n\r\n    _this.callIdentityModuleFunc('unregisterIdentity', { email: idToRemove }).then(() => {\r\n      let numEmails = emails.length;\r\n      for (let i = 0; i < numEmails; i++) {\r\n        if (emails[i].email === idToRemove) {\r\n          emails.splice(i, 1);\r\n          break;\r\n        }\r\n      }\r\n\r\n      // -------------------------------------------------------------------------//\r\n      _this.showIdentities(emails, true);\r\n    });\r\n\r\n    //_this.identityModule.unregisterIdentity(idToRemove);\r\n\r\n  }\r\n\r\n  authorise(idp, resource) {\r\n\r\n\r\n    return this.openPopup()\r\n      .then((res) => {\r\n        const data = { scope: resource, idpDomain: idp };\r\n        return this.callIdentityModuleFunc('getAccessTokenAuthorisationEndpoint', data);\r\n      })\r\n      .then((value) => {\r\n        console.log('[IdentitiesGUI.authorise] receivedURL from idp Proxy: ' + value);\r\n\r\n        return this.openPopup(value);\r\n      }).then((result) => {\r\n\r\n        console.log('[IdentitiesGUI.authorise.openPopup.result]', result);\r\n\r\n        // resource as array\r\n\r\n\r\n        const data = { resources: [resource], idpDomain: idp, login: result };\r\n        return this.callIdentityModuleFunc('getAccessToken', data);\r\n      }).then((result) => {\r\n\r\n        console.log('[IdentitiesGUI.authorise.getAccessToken.result]', result);\r\n        return this.callIdentityModuleFunc('addAccessToken', result);\r\n      }).then((value) => {\r\n        this._drawer.open = false;\r\n        return value;\r\n      });\r\n\r\n  }\r\n\r\n  loginWithIDP(idp) {\r\n\r\n\r\n    let _publicKey;\r\n\r\n    return this.openPopup()\r\n      .then((result) => {\r\n        return this.callIdentityModuleFunc('getMyPublicKey', {});\r\n      }).then((publicKey) => {\r\n        _publicKey = publicKey;\r\n        const data = { contents: publicKey, origin: 'origin', usernameHint: undefined, idpDomain: idp };\r\n        return this.callIdentityModuleFunc('sendGenerateMessage', data);\r\n      })\r\n      .then((value) => {\r\n        console.log('[IdentitiesGUI.obtainNewIdentity] receivedURL from idp Proxy: ' + value.loginUrl.substring(0, 20) + '...');\r\n\r\n        let url = value.loginUrl;\r\n        let finalURL;\r\n\r\n        //check if the receivedURL contains the redirect field and replace it\r\n        if (url.indexOf('redirect_uri') !== -1) {\r\n          let firstPart = url.substring(0, url.indexOf('redirect_uri'));\r\n          let secondAuxPart = url.substring(url.indexOf('redirect_uri'), url.length);\r\n\r\n          let secondPart = secondAuxPart.substring(secondAuxPart.indexOf('&'), url.length);\r\n\r\n          //check if the reddirect field is the last field of the URL\r\n          if (secondPart.indexOf('&') !== -1) {\r\n            finalURL = firstPart + 'redirect_uri=' + location.origin + secondPart;\r\n          } else {\r\n            finalURL = firstPart + 'redirect_uri=' + location.origin;\r\n          }\r\n        }\r\n\r\n        this.resultURL = finalURL || url;\r\n\r\n        console.log('[IdentitiesGUI.openPopup]', this.resultURL);\r\n        return this.openPopup(this.resultURL);\r\n      }).then((identity) => {\r\n\r\n        console.log('[IdentitiesGUI.openPopup.result]', identity);\r\n\r\n        const data = { contents: _publicKey, origin: 'origin', usernameHint: identity, idpDomain: idp };\r\n        return this.callIdentityModuleFunc('sendGenerateMessage', data);\r\n      }).then((result) => {\r\n\r\n        console.log('[IdentitiesGUI.sendGenerateMessage.result]', result);\r\n        return this.callIdentityModuleFunc('addAssertion', result);\r\n      }).then((value) => {\r\n\r\n        this._drawer.open = false;\r\n        const userURL = {type: 'identity', value: value.userProfile.userURL};\r\n        // const userIdentity = {type: 'identity', value: value.userProfile};\r\n\r\n        console.log('[IdentitiesGUI.loginWithIDP final]', value);\r\n        this._alreadyLogin = true;\r\n        return userURL;\r\n        // return userIdentity;\r\n      });\r\n\r\n  }\r\n\r\n  // obtainNewIdentity(event, callback, toRemoveID) {\r\n  //   let _this = this;\r\n  //   let idProvider = event.target.textContent;\r\n  //   let idProvider2 = event.target.text;\r\n\r\n  //   _this.callIdentityModuleFunc('getMyPublicKey', {}).then((publicKey) => {\r\n  //     // let publicKey = btoa(keyPair.public);\r\n\r\n  //     _this.callIdentityModuleFunc('sendGenerateMessage',\r\n  //       { contents: publicKey, origin: 'origin', usernameHint: undefined, idpDomain: idProvider, }).then((value) => {\r\n  //       console.log('[IdentitiesGUI.obtainNewIdentity] receivedURL from idp Proxy: ' + value.loginUrl.substring(0, 20) + '...');\r\n\r\n  //       let url = value.loginUrl;\r\n  //       let finalURL;\r\n\r\n  //       //check if the receivedURL contains the redirect field and replace it\r\n  //       if (url.indexOf('redirect_uri') !== -1) {\r\n  //         let firstPart = url.substring(0, url.indexOf('redirect_uri'));\r\n  //         let secondAuxPart = url.substring(url.indexOf('redirect_uri'), url.length);\r\n\r\n  //         let secondPart = secondAuxPart.substring(secondAuxPart.indexOf('&'), url.length);\r\n\r\n  //         //check if the reddirect field is the last field of the URL\r\n  //         if (secondPart.indexOf('&') !== -1) {\r\n  //           finalURL = firstPart + 'redirect_uri=' + location.origin + secondPart;\r\n  //         } else {\r\n  //           finalURL = firstPart + 'redirect_uri=' + location.origin;\r\n  //         }\r\n  //       }\r\n\r\n  //       _this.resultURL = finalURL || url;\r\n\r\n  //       $('.login-idp').html('<p>Chosen IDP: ' + idProvider + '</p>');\r\n  //       $('.login').removeClass('hide');\r\n  //       $('.login-btn').off();\r\n  //       $('.login-btn').on('click', (event) => {\r\n  //         $('.login').addClass('hide');\r\n  //         // _this._authenticateUser(publicKey, value, 'origin', idProvider).then((email) => {\r\n  //         //   callback(email);\r\n  //         //   _this.showIdentitiesGUI();\r\n  //         // });\r\n  //       });\r\n  //     });\r\n  //   }).catch(err => console.log('obtanin new identity', err));\r\n\r\n  // }\r\n\r\n  _getList(items) {\r\n    let list = '';\r\n    let numItems = items.length;\r\n\r\n    for (let i = 0; i < numItems; i++) {\r\n      list += '<li class=\"divider\"></li>';\r\n      list += '<li><a class=\"center-align\">' + items[i] + '</a></li>';\r\n    }\r\n\r\n    return list;\r\n  }\r\n\r\n  _authenticateUser(publicKey, value, origin, idProvider) {\r\n    let _this = this;\r\n    let url = _this.resultURL;\r\n\r\n    return new Promise((resolve, reject) => {\r\n\r\n      _this.openPopup(url).then((identity) => {\r\n\r\n        _this.callIdentityModuleFunc('sendGenerateMessage',\r\n          { contents: publicKey, origin: origin, usernameHint: identity, idpDomain: idProvider }).then((result) => {\r\n\r\n          if (result) {\r\n\r\n            //_this.identityModule.storeIdentity(result, keyPair).then((value) => {\r\n            _this.callIdentityModuleFunc('addAssertion', result).then((value) => {\r\n              resolve(value.userProfile.userURL);\r\n            }, (err) => {\r\n              reject(err);\r\n            });\r\n\r\n          } else {\r\n            reject('error on obtaining identity information');\r\n          }\r\n\r\n        });\r\n      }, (err) => {\r\n        reject(err);\r\n      });\r\n    });\r\n  }\r\n\r\n  _resetIdentities() {\r\n    console.log('_resetIdentities');\r\n  }\r\n\r\n\r\n}\r\n\r\nexport default IdentitiesGUI;\r\n"],"preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvYWRtaW4vSWRlbnRpdGllc0dVSS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7Ozs7QUNBQTs7SUFFTSxhO0FBRUoseUJBQVksTUFBWixFQUFvQixNQUFwQixFQUE0QixVQUE1QixFQUF3QztBQUFBOztBQUFBOztBQUN0QyxZQUFRLEdBQVIsQ0FBWSxlQUFaLEVBQTZCLElBQTdCO0FBQ0E7QUFDQSxRQUFJLENBQUMsVUFBTCxFQUFpQixNQUFNLE1BQU0sc0JBQU4sQ0FBTjtBQUNqQixRQUFJLFFBQVEsSUFBWjtBQUNBLFVBQU0sT0FBTixHQUFnQixNQUFoQjtBQUNBLFVBQU0sT0FBTixHQUFnQixNQUFoQjtBQUNBLFVBQU0sV0FBTixHQUFvQixVQUFwQjtBQUNBLFVBQU0sZUFBTixHQUF3QixLQUF4QjtBQUNBLFVBQU0sYUFBTixHQUFzQixLQUF0Qjs7QUFFQSxTQUFLLHNCQUFMLENBQTRCLFdBQTVCLEVBQXlDLEVBQXpDLEVBQTZDLElBQTdDLENBQWtELFVBQUMsTUFBRCxFQUFZO0FBQzVELGFBQU8sT0FBSyxZQUFMLEVBQVA7QUFDRCxLQUZELEVBRUcsSUFGSCxDQUVRLFVBQUMsTUFBRCxFQUFZO0FBQ2xCLGNBQVEsR0FBUixDQUFZLFFBQVosRUFBc0IsTUFBdEI7QUFDRCxLQUpEOztBQU1BLFNBQUssUUFBTCxHQUFnQixLQUFoQjs7QUFFQSxRQUFNLFdBQVcsU0FBUyxhQUFULENBQXVCLHVCQUF2QixDQUFqQjtBQUNBLFFBQU0scUJBQXFCLElBQUksTUFBSixDQUFXLGtCQUF0QztBQUNBLFFBQU0sU0FBUyxJQUFJLGtCQUFKLENBQXVCLFFBQXZCLENBQWY7O0FBRUEsU0FBSyxTQUFMLEdBQWlCLFFBQWpCO0FBQ0EsU0FBSyxPQUFMLEdBQWUsTUFBZjs7QUFFQSxhQUFTLGFBQVQsQ0FBdUIsZUFBdkIsRUFBd0MsZ0JBQXhDLENBQXlELE9BQXpELEVB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bUJHLFVBQUMsR0FBRCxFQUFTO0FBQ1YsaUJBQU8sR0FBUDtBQUNELFNBckJEO0FBc0JELE9BeEJNLENBQVA7QUF5QkQ7Ozt1Q0FFa0I7QUFDakIsY0FBUSxHQUFSLENBQVksa0JBQVo7QUFDRDs7Ozs7O2tCQUtZLGEiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiLy8ganNoaW50IGJyb3dzZXI6dHJ1ZSwganF1ZXJ5OiB0cnVlXHJcblxyXG5jbGFzcyBJZGVudGl0aWVzR1VJIHtcclxuXHJcbiAgY29uc3RydWN0b3IoZ3VpVVJMLCBpZG1VUkwsIG1lc3NhZ2VCdXMpIHtcclxuICAgIGNvbnNvbGUubG9nKCdJZGVudGl0aWVzR1VJJywgdGhpcyk7XHJcbiAgICAvL2lmICghaWRlbnRpdHlNb2R1bGUpIHRocm93IEVycm9yKCdJZGVudGl0eSBNb2R1bGUgbm90IHNldCEnKTtcclxuICAgIGlmICghbWVzc2FnZUJ1cykgdGhyb3cgRXJyb3IoJ01lc3NhZ2UgQnVzIG5vdCBzZXQhJyk7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgX3RoaXMuX2d1aVVSTCA9IGd1aVVSTDtcclxuICAgIF90aGlzLl9pZG1VUkwgPSBpZG1VUkw7XHJcbiAgICBfdGhpcy5fbWVzc2FnZUJ1cyA9IG1lc3NhZ2VCdXM7XHJcbiAgICBfdGhpcy5fYWxyZWFkeVJlTG9naW4gPSBmYWxzZTtcclxuICAgIF90aGlzLl9hbHJlYWR5TG9naW4gPSBmYWxzZTtcclxuXHJcbiAgICB0aGlzLmNhbGxJZGVudGl0eU1vZHVsZUZ1bmMoJ2RlcGxveUdVSScsIHt9KS50aGVuKChyZXN1bHQpID0+IHtcclxuICAgICAgcmV0dXJuIHRoaXMuX2J1aWxkRHJhd2VyKCk7XHJcbiAgICB9KS50aGVuKChyZXN1bHQpID0+IHtcclxuICAgICAgY29uc29sZS5sb2coJ1JFQURZOicsIHJlc3VsdCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICB0aGlzLmlzTG9nZ2VkID0gZmFsc2U7XHJcblxyXG4gICAgY29uc3QgZHJhd2VyRWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubWRjLXRlbXBvcmFyeS1kcmF3ZXInKTtcclxuICAgIGNvbnN0IE1EQ1RlbXBvcmFyeURyYXdlciA9IG1kYy5kcmF3ZXIuTURDVGVtcG9yYXJ5RHJhd2VyO1xyXG4gICAgY29uc3QgZHJhd2VyID0gbmV3IE1EQ1RlbXBvcmFyeURyYXdlcihkcmF3ZXJFbCk7XHJcblxyXG4gICAgdGhpcy5fZHJhd2VyRWwgPSBkcmF3ZXJFbDtcclxuICAgIHRoaXMuX2RyYXdlciA9IGRyYXdlcjtcclxuXHJcbiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2V0dGluZ3MtYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbigpIHtcclxuICAgICAgZHJhd2VyLm9wZW4gPSB0cnVlO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZHJhd2VyRWwuYWRkRXZlbnRMaXN0ZW5lcignTURDVGVtcG9yYXJ5RHJhd2VyOm9wZW4nLCAoKSA9PiB7XHJcbiAgICAgIGNvbnNvbGUubG9nKCdSZWNlaXZlZCBNRENUZW1wb3JhcnlEcmF3ZXI6b3BlbicpO1xyXG4gICAgICB0aGlzLl9pc0RyYXdlck9wZW4gPSB0cnVlO1xyXG4gICAgICBwYXJlbnQucG9zdE1lc3NhZ2UoeyBib2R5OiB7IG1ldGhvZDogJ3Nob3dBZG1pblBhZ2UnIH0sIHRvOiAncnVudGltZTpndWktbWFuYWdlcicgfSwgJyonKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGRyYXdlckVsLmFkZEV2ZW50TGlzdGVuZXIoJ01EQ1RlbXBvcmFyeURyYXdlcjpjbG9zZScsICgpID0+IHtcclxuICAgICAgY29uc29sZS5sb2coJ1JlY2VpdmVkIE1EQ1RlbXBvcmFyeURyYXdlcjpjbG9zZScpO1xyXG4gICAgICB0aGlzLl9pc0RyYXdlck9wZW4gPSBmYWxzZTtcclxuICAgICAgcGFyZW50LnBvc3RNZXNzYWdlKHsgYm9keTogeyBtZXRob2Q6ICdoaWRlQWRtaW5QYWdlJyB9LCB0bzogJ3J1bnRpbWU6Z3VpLW1hbmFnZXInIH0sICcqJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgfVxyXG5cclxuICBsb2dPdXQoKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgY29uc29sZS5sb2coJ0lkZW50aXRpZXNHVUk6IGxvZ2dpbmcgb3V0Jyk7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG5cclxuICAgICAgY29uc29sZS5sb2coJ0J1aWxkaW5nIGRyYXdlcicpO1xyXG4gICAgICBfdGhpcy5fYnVpbGREcmF3ZXIoKTtcclxuXHJcbiAgICAgIHJlc29sdmUoJ0d1aSByZXNldCcpO1xyXG5cclxuXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIF9idWlsZERyYXdlcigpIHtcclxuXHJcbiAgICBjb25zdCBndWlVUkwgPSB0aGlzLl9ndWlVUkw7XHJcblxyXG4gICAgdGhpcy5fbWVzc2FnZUJ1cy5hZGRMaXN0ZW5lcihndWlVUkwsIG1zZyA9PiB7XHJcblxyXG4gICAgICBjb25zdCBmdW5jTmFtZSA9IG1zZy5ib2R5Lm1ldGhvZDtcclxuXHJcbiAgICAgIGlmIChtc2cudHlwZSAhPT0gJ3Jlc3BvbnNlJykge1xyXG5cclxuXHJcbiAgICAgICAgaWYgKCF0aGlzLmlzTG9nZ2VkKSB7XHJcblxyXG4gICAgICAgICAgY29uc3QgY2xpY2tDbG9zZSA9IG5ldyBNb3VzZUV2ZW50KCdjbGljaycpO1xyXG4gICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNldHRpbmdzLWJ0bicpLmRpc3BhdGNoRXZlbnQoY2xpY2tDbG9zZSk7XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmIChmdW5jTmFtZSA9PT0gJ29wZW5Qb3B1cCcpIHtcclxuXHJcbiAgICAgICAgdGhpcy5vcGVuUG9wdXAoKS50aGVuKCgpID0+IHtcclxuXHJcbiAgICAgICAgICBsZXQgdXJscmVjZWl2ZWQgPSBtc2cuYm9keS5wYXJhbXMudXJscmVjZWl2ZWQ7XHJcbiAgICAgICAgICB0aGlzLm9wZW5Qb3B1cCh1cmxyZWNlaXZlZCkudGhlbigocmV0dXJuZWRWYWx1ZSkgPT4ge1xyXG4gICAgICAgICAgICBsZXQgdmFsdWUgPSB7dHlwZTogJ2V4ZWN1dGUnLCB2YWx1ZTogcmV0dXJuZWRWYWx1ZSwgY29kZTogMjAwfTtcclxuICAgICAgICAgICAgbGV0IHJlcGx5TXNnID0ge2lkOiBtc2cuaWQsIHR5cGU6ICdyZXNwb25zZScsIHRvOiBtc2cuZnJvbSwgZnJvbTogbXNnLnRvLCBib2R5OiB2YWx1ZX07XHJcbiAgICAgICAgICAgIHRoaXMuX21lc3NhZ2VCdXMucG9zdE1lc3NhZ2UocmVwbHlNc2cpO1xyXG4gICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICByZXR1cm47XHJcblxyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCBjYWxsYmFjayA9IChpZGVudGl0eUluZm8pID0+IHtcclxuXHJcbiAgICAgICAgdGhpcy5pc0xvZ2dlZCA9IHRydWU7XHJcblxyXG4gICAgICAgIHRoaXMuX2J1aWxkTWVzc2FnZShtc2csIGlkZW50aXR5SW5mbyk7XHJcblxyXG4gICAgICB9O1xyXG5cclxuICAgICAgdGhpcy5jYWxsYmFjayA9IGNhbGxiYWNrO1xyXG5cclxuICAgICAgdGhpcy5fZ2V0SWRlbnRpdGllcyhjYWxsYmFjaywgdHJ1ZSk7XHJcblxyXG4gICAgfSk7XHJcblxyXG4gICAgdGhpcy5fZ2V0SWRlbnRpdGllcygpO1xyXG5cclxuICB9XHJcblxyXG4gIF9idWlsZE1lc3NhZ2UobXNnLCBpZGVudGl0eUluZm8pIHtcclxuICAgIGxldCByZXBseU1zZztcclxuICAgIGxldCB2YWx1ZTtcclxuXHJcbiAgICBjb25zdCBmcm9tID0gbXNnID8gbXNnLmZyb20gOiB0aGlzLl9ndWlVUkw7XHJcbiAgICBjb25zdCB0byA9IG1zZyA/IG1zZy50byA6IHRoaXMuX2lkbVVSTDtcclxuXHJcbiAgICBjb25zb2xlLmxvZygnY2hvc2VuIGlkZW50aXR5OiAnLCBpZGVudGl0eUluZm8pO1xyXG5cclxuICAgIHN3aXRjaCAoaWRlbnRpdHlJbmZvLnR5cGUpIHtcclxuICAgICAgY2FzZSAnaWRwJzpcclxuICAgICAgICB2YWx1ZSA9IHsgdHlwZTogJ2lkcCcsIHZhbHVlOiBpZGVudGl0eUluZm8udmFsdWUsIGNvZGU6IDIwMCB9O1xyXG4gICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgY2FzZSAnaWRlbnRpdHknOlxyXG4gICAgICAgIHZhbHVlID0geyB0eXBlOiAnaWRlbnRpdHknLCB2YWx1ZTogaWRlbnRpdHlJbmZvLnZhbHVlLCBjb2RlOiAyMDAgfTtcclxuICAgICAgICBicmVhaztcclxuXHJcbiAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgdmFsdWUgPSB7IHR5cGU6ICdlcnJvcicsIHZhbHVlOiAnRXJyb3Igb24gaWRlbnRpdHkgR1VJJywgY29kZTogNDAwIH07XHJcbiAgICB9XHJcblxyXG4gICAgcmVwbHlNc2cgPSB7aWQ6IG1zZy5pZCwgdHlwZTogJ3Jlc3BvbnNlJywgdG86IGZyb20sIGZyb206IHRvLCBib2R5OiB2YWx1ZSB9O1xyXG5cclxuICAgIHRoaXMuX21lc3NhZ2VCdXMucG9zdE1lc3NhZ2UocmVwbHlNc2cpO1xyXG4gIH1cclxuXHJcbiAgX2dldElkZW50aXRpZXMoY2FsbGJhY2ssIG9QZW5EcmF3ZXIpIHtcclxuXHJcbiAgICByZXR1cm4gdGhpcy5jYWxsSWRlbnRpdHlNb2R1bGVGdW5jKCdnZXRJZGVudGl0aWVzVG9DaG9vc2UnLCB7fSkudGhlbigocmVzdWx0T2JqZWN0KSA9PiB7XHJcbiAgICAgIGlmIChjYWxsYmFjaykge1xyXG4gICAgICAgIHJldHVybiBQcm9taXNlLmFsbChbdGhpcy5zaG93SWRwcyhyZXN1bHRPYmplY3QuaWRwcywgY2FsbGJhY2spLCB0aGlzLnNob3dEZWZhdWx0SWRlbnRpdHkocmVzdWx0T2JqZWN0LmRlZmF1bHRJZGVudGl0eSksIHRoaXMuc2hvd0lkZW50aXRpZXMocmVzdWx0T2JqZWN0LCBjYWxsYmFjaywgb1BlbkRyYXdlcildKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5hbGwoW3RoaXMuc2hvd0lkcHMocmVzdWx0T2JqZWN0LmlkcHMpLCB0aGlzLnNob3dEZWZhdWx0SWRlbnRpdHkocmVzdWx0T2JqZWN0LmRlZmF1bHRJZGVudGl0eSksIHRoaXMuc2hvd0lkZW50aXRpZXMocmVzdWx0T2JqZWN0KV0pO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgfVxyXG5cclxuICAvLyBfb3BlbkRyYXdlcigpIHtcclxuXHJcbiAgLy8gICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gIC8vICAgY29uc3QgZ3VpVVJMID0gX3RoaXMuX2d1aVVSTDtcclxuXHJcbiAgLy8gICBfdGhpcy5yZXN1bHRVUkwgID0gdW5kZWZpbmVkO1xyXG5cclxuICAvLyAgIF90aGlzLl9tZXNzYWdlQnVzLmFkZExpc3RlbmVyKGd1aVVSTCwgbXNnID0+IHtcclxuICAvLyAgICAgbGV0IGlkZW50aXR5SW5mbyA9IG1zZy5ib2R5LnZhbHVlO1xyXG4gIC8vICAgICBsZXQgZnVuY05hbWUgPSBtc2cuYm9keS5tZXRob2Q7XHJcbiAgLy8gICAgIGxldCB2YWx1ZTtcclxuICAvLyAgICAgY29uc29sZS5sb2coJ1tJZGVudGl0aWVzR1VJXSByZWNlaXZlZCBtc2c6ICcsIG1zZyk7XHJcblxyXG4gIC8vICAgICBfdGhpcy5zaG93SWRlbnRpdGllc0dVSShtc2cuYm9keS52YWx1ZSkudGhlbigoaWRlbnRpdHlJbmZvKSA9PiB7XHJcblxyXG4gIC8vICAgICAgIGxldCByZXBseU1zZztcclxuICAvLyAgICAgICBjb25zb2xlLmxvZygnW0lkZW50aXRpZXNHVUldIGlkZW50aXR5SW5mbyBmcm9tIEdVSTogJywgaWRlbnRpdHlJbmZvKTtcclxuXHJcbiAgLy8gICAgICAgLy9oaWRlIGNvbmZpZyBwYWdlIHdpdGggdGhlIGlkZW50aXR5IEdVSVxyXG4gIC8vICAgICAgIHBhcmVudC5wb3N0TWVzc2FnZSh7IGJvZHk6IHsgbWV0aG9kOiAnaGlkZUFkbWluUGFnZScgfSwgdG86ICdydW50aW1lOmd1aS1tYW5hZ2VyJyB9LCAnKicpO1xyXG4gIC8vICAgICAgICQoJy5hZG1pbi1wYWdlJykuYWRkQ2xhc3MoJ2hpZGUnKTtcclxuXHJcbiAgLy8gICAgICAgLy8gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2JvZHknKVswXS5zdHlsZSA9ICdiYWNrZ3JvdW5kLWNvbG9yOnRyYW5zcGFyZW50JztcclxuICAvLyAgICAgICAkKCcuaWRlbnRpdGllcy1zZWN0aW9uJykuYWRkQ2xhc3MoJ2hpZGUnKTtcclxuICAvLyAgICAgICAkKCcucG9saWNpZXMtc2VjdGlvbicpLmFkZENsYXNzKCdoaWRlJyk7XHJcblxyXG4gIC8vICAgICAgIHN3aXRjaCAoaWRlbnRpdHlJbmZvLnR5cGUpIHtcclxuICAvLyAgICAgICAgIGNhc2UgJ2lkcCc6XHJcbiAgLy8gICAgICAgICAgIHZhbHVlID0geyB0eXBlOiAnaWRwJywgdmFsdWU6IGlkZW50aXR5SW5mby52YWx1ZSwgY29kZTogMjAwIH07XHJcbiAgLy8gICAgICAgICAgIHJlcGx5TXNnID0geyBpZDogbXNnLmlkLCB0eXBlOiAncmVzcG9uc2UnLCB0bzogbXNnLmZyb20sIGZyb206IG1zZy50bywgYm9keTogdmFsdWUgfTtcclxuICAvLyAgICAgICAgICAgX3RoaXMuX21lc3NhZ2VCdXMucG9zdE1lc3NhZ2UocmVwbHlNc2cpO1xyXG4gIC8vICAgICAgICAgICBicmVhaztcclxuXHJcbiAgLy8gICAgICAgICBjYXNlICdpZGVudGl0eSc6XHJcbiAgLy8gICAgICAgICAgIHZhbHVlID0geyB0eXBlOiAnaWRlbnRpdHknLCB2YWx1ZTogaWRlbnRpdHlJbmZvLnZhbHVlLCBjb2RlOiAyMDAgfTtcclxuICAvLyAgICAgICAgICAgcmVwbHlNc2cgPSB7IGlkOiBtc2cuaWQsIHR5cGU6ICdyZXNwb25zZScsIHRvOiBtc2cuZnJvbSwgZnJvbTogbXNnLnRvLCBib2R5OiB2YWx1ZSB9O1xyXG4gIC8vICAgICAgICAgICBfdGhpcy5fbWVzc2FnZUJ1cy5wb3N0TWVzc2FnZShyZXBseU1zZyk7XHJcbiAgLy8gICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAvLyAgICAgICAgIGRlZmF1bHQ6XHJcbiAgLy8gICAgICAgICAgIHZhbHVlID0geyB0eXBlOiAnZXJyb3InLCB2YWx1ZTogJ0Vycm9yIG9uIGlkZW50aXR5IEdVSScsIGNvZGU6IDQwMCB9O1xyXG4gIC8vICAgICAgICAgICByZXBseU1zZyA9IHsgaWQ6IG1zZy5pZCwgdHlwZTogJ3Jlc3BvbnNlJywgdG86IG1zZy5mcm9tLCBmcm9tOiBtc2cudG8sIGJvZHk6IHZhbHVlIH07XHJcbiAgLy8gICAgICAgICAgIF90aGlzLl9tZXNzYWdlQnVzLnBvc3RNZXNzYWdlKHJlcGx5TXNnKTtcclxuICAvLyAgICAgICB9XHJcbiAgLy8gICAgIH0pO1xyXG5cclxuICAvLyAgICAgaWYgKGZ1bmNOYW1lID09PSAnb3BlblBvcHVwJykge1xyXG4gIC8vICAgICAgIGxldCB1cmxyZWNlaXZlZCA9IG1zZy5ib2R5LnBhcmFtcy51cmxyZWNlaXZlZDtcclxuICAvLyAgICAgICBfdGhpcy5vcGVuUG9wdXAodXJscmVjZWl2ZWQpLnRoZW4oKHJldHVybmVkVmFsdWUpID0+IHtcclxuICAvLyAgICAgICAgIGxldCB2YWx1ZSA9IHt0eXBlOiAnZXhlY3V0ZScsIHZhbHVlOiByZXR1cm5lZFZhbHVlLCBjb2RlOiAyMDB9O1xyXG4gIC8vICAgICAgICAgbGV0IHJlcGx5TXNnID0ge2lkOiBtc2cuaWQsIHR5cGU6ICdyZXNwb25zZScsIHRvOiBtc2cuZnJvbSwgZnJvbTogbXNnLnRvLCBib2R5OiB2YWx1ZX07XHJcbiAgLy8gICAgICAgICBfdGhpcy5fbWVzc2FnZUJ1cy5wb3N0TWVzc2FnZShyZXBseU1zZyk7XHJcbiAgLy8gICAgICAgfSk7XHJcbiAgLy8gICAgICAgcmV0dXJuOyAvLyB0aGlzIGF2b2lkcyBnZXR0aW5nIHN0dWNrIGluIHRoZSBpZGVudGl0aWVzIHBhZ2VcclxuICAvLyAgICAgfVxyXG5cclxuICAvLyAgICAgLy8gdW5oaWRlIHRoZSBjb25maWcgcGFnZSB3aXRoIHRoZSBpZGVudGl0eSBHVUlcclxuICAvLyAgICAgLy8gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2JvZHknKVswXS5zdHlsZSA9ICdiYWNrZ3JvdW5kLWNvbG9yOndoaXRlOyc7XHJcbiAgLy8gICAgIHBhcmVudC5wb3N0TWVzc2FnZSh7IGJvZHk6IHsgbWV0aG9kOiAnc2hvd0FkbWluUGFnZScgfSwgdG86ICdydW50aW1lOmd1aS1tYW5hZ2VyJyB9LCAnKicpO1xyXG5cclxuICAvLyAgICAgY29uc3QgY2xpY2tPcGVuID0gbmV3IE1vdXNlRXZlbnQoJ2NsaWNrJyk7XHJcbiAgLy8gICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zZXR0aW5ncy1idG4nKS5kaXNwYXRjaEV2ZW50KGNsaWNrT3Blbik7XHJcblxyXG4gIC8vICAgICAkKCcuYWRtaW4tcGFnZScpLnJlbW92ZUNsYXNzKCdoaWRlJyk7XHJcblxyXG4gIC8vICAgfSk7XHJcbiAgLy8gfVxyXG5cclxuICBjYWxsSWRlbnRpdHlNb2R1bGVGdW5jKG1ldGhvZE5hbWUsIHBhcmFtZXRlcnMpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgY29uc3QgbWVzc2FnZSA9IHsgdHlwZTogJ2V4ZWN1dGUnLCB0bzogX3RoaXMuX2lkbVVSTCwgZnJvbTogX3RoaXMuX2d1aVVSTCxcclxuICAgICAgICBib2R5OiB7IHJlc291cmNlOiAnaWRlbnRpdHknLCBtZXRob2Q6IG1ldGhvZE5hbWUsIHBhcmFtczogcGFyYW1ldGVycyB9fTtcclxuXHJcbiAgICAgIHRoaXMuX21lc3NhZ2VCdXMucG9zdE1lc3NhZ2UobWVzc2FnZSwgKHJlcykgPT4ge1xyXG4gICAgICAgIGxldCByZXN1bHQgPSByZXMuYm9keS52YWx1ZTtcclxuICAgICAgICByZXNvbHZlKHJlc3VsdCk7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgb3BlblBvcHVwKHVybHJlY2VpdmVkKSB7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuXHJcbiAgICAgIGxldCB3aW47XHJcbiAgICAgIGlmICghdXJscmVjZWl2ZWQpIHtcclxuICAgICAgICB3aW4gPSB3aW5kb3cub3BlbignJywgJ29wZW5JRHJlcXVlc3QnLCAnbG9jYXRpb249MSxzdGF0dXM9MScpO1xyXG4gICAgICAgIHRoaXMud2luID0gd2luO1xyXG4gICAgICAgIHJlc29sdmUoKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB3aW4gPSB0aGlzLndpbjtcclxuICAgICAgICB3aW4ubG9jYXRpb24uaHJlZiA9IHVybHJlY2VpdmVkO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBsZXQgd2luID0gd2luZG93Lm9wZW4odXJscmVjZWl2ZWQsICdvcGVuSURyZXF1ZXN0JywgJ2xvY2F0aW9uPTEsc3RhdHVzPTEsc2Nyb2xsYmFycz0xJyk7XHJcbiAgICAgIGlmICh3aW5kb3cuY29yZG92YSkge1xyXG4gICAgICAgIHdpbi5hZGRFdmVudExpc3RlbmVyKCdsb2Fkc3RhcnQnLCBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICBsZXQgdXJsID0gZS51cmw7XHJcbiAgICAgICAgICBsZXQgY29kZSA9IC9cXCZjb2RlPSguKykkLy5leGVjKHVybCk7XHJcbiAgICAgICAgICBsZXQgZXJyb3IgPSAvXFwmZXJyb3I9KC4rKSQvLmV4ZWModXJsKTtcclxuXHJcbiAgICAgICAgICBpZiAoY29kZSB8fCBlcnJvcikge1xyXG4gICAgICAgICAgICB3aW4uY2xvc2UoKTtcclxuICAgICAgICAgICAgcmV0dXJuIHJlc29sdmUodXJsKTtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZWplY3QoJ29wZW5Qb3B1cCBlcnJvciAxIC0gc2hvdWxkIG5vdCBoYXBwZW4nKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgfSBlbHNlIHtcclxuXHJcbiAgICAgICAgbGV0IHBvbGxUaW1lciA9IHNldEludGVydmFsKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgaWYgKHdpbi5jbG9zZWQpIHtcclxuICAgICAgICAgICAgICBjbGVhckludGVydmFsKHBvbGxUaW1lcik7XHJcblxyXG4gICAgICAgICAgICAgIC8vIHJldHVybiByZWplY3QoJ1NvbWUgZXJyb3Igb2NjdXJlZCB3aGVuIHRyeWluZyB0byBnZXQgaWRlbnRpdHkuJyk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICgod2luLmRvY3VtZW50LlVSTC5pbmRleE9mKCdhY2Nlc3NfdG9rZW4nKSAhPT0gLTEgfHwgd2luLmRvY3VtZW50LlVSTC5pbmRleE9mKCdjb2RlJykgIT09IC0xKSAmJiB3aW4uZG9jdW1lbnQuVVJMLmluZGV4T2YobG9jYXRpb24ub3JpZ2luKSAhPT0gLTEpIHtcclxuICAgICAgICAgICAgICB3aW5kb3cuY2xlYXJJbnRlcnZhbChwb2xsVGltZXIpO1xyXG4gICAgICAgICAgICAgIGxldCB1cmwgPSAgIHdpbi5kb2N1bWVudC5VUkw7XHJcblxyXG4gICAgICAgICAgICAgIHJlc29sdmUodXJsKTtcclxuICAgICAgICAgICAgICByZXR1cm4gd2luLmNsb3NlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgLy9yZXR1cm4gcmVqZWN0KCdvcGVuUG9wdXAgZXJyb3IgMiAtIHNob3VsZCBub3QgaGFwcGVuJyk7XHJcbiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGUpO1xyXG4gICAgICAgICAgfVxyXG5cclxuICAgICAgICB9LCA1MDApO1xyXG4gICAgICB9XHJcblxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvLyBzaG93SWRlbnRpdGllc0dVSShyZWNlaXZlZEluZm8pIHtcclxuICAvLyAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gIC8vICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAvLyAgICAgY29uc29sZS5sb2coJ1tJZGVudGl0aWVzR1VJLnNob3dJZGVudGl0aWVzR1VJXSByZWNlaXZlZEluZm86ICcsIHJlY2VpdmVkSW5mbyk7XHJcblxyXG4gIC8vICAgICBsZXQgaWRlbnRpdHlJbmZvO1xyXG4gIC8vICAgICBsZXQgdG9SZW1vdmVJRDtcclxuXHJcbiAgLy8gICAgIGxldCBjYWxsYmFjayA9ICh2YWx1ZSkgPT4ge1xyXG4gIC8vICAgICAgIGNvbnNvbGUubG9nKCdjaG9zZW4gaWRlbnRpdHk6ICcsIHZhbHVlKTtcclxuXHJcbiAgLy8gICAgICAgY29uc3QgY2xpY2tDbG9zZSA9IG5ldyBNb3VzZUV2ZW50KCdjbGljaycpO1xyXG4gIC8vICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zZXR0aW5ncy1idG4nKS5kaXNwYXRjaEV2ZW50KGNsaWNrQ2xvc2UpO1xyXG5cclxuICAvLyAgICAgICByZXNvbHZlKHt0eXBlOiAnaWRlbnRpdHknLCB2YWx1ZTogdmFsdWV9KTtcclxuICAvLyAgICAgfTtcclxuXHJcbiAgLy8gICAgIF90aGlzLl9jaGVja1JlY2VpdmVkSW5mbyhyZWNlaXZlZEluZm8pLnRoZW4oKHJlc3VsdE9iamVjdCkgPT4ge1xyXG4gIC8vICAgICAgIGlkZW50aXR5SW5mbyA9IHJlc3VsdE9iamVjdC5pZGVudGl0eUluZm87XHJcbiAgLy8gICAgICAgdG9SZW1vdmVJRCA9IHJlc3VsdE9iamVjdC50b1JlbW92ZUlEO1xyXG5cclxuICAvLyAgICAgICAkKCcucG9saWNpZXMtc2VjdGlvbicpLmFkZENsYXNzKCdoaWRlJyk7XHJcbiAgLy8gICAgICAgJCgnLmlkZW50aXRpZXMtc2VjdGlvbicpLnJlbW92ZUNsYXNzKCdoaWRlJyk7XHJcblxyXG4gIC8vICAgICAgIF90aGlzLnNob3dJZHBzKHJlY2VpdmVkSW5mby5pZHBzLCBjYWxsYmFjayk7XHJcblxyXG4gIC8vICAgICAgIF90aGlzLnNob3dJZGVudGl0aWVzKGlkZW50aXR5SW5mby5pZGVudGl0aWVzLCB0b1JlbW92ZUlEKS50aGVuKChpZGVudGl0eSkgPT4ge1xyXG4gIC8vICAgICAgICAgY29uc29sZS5sb2coJ2Nob3NlbiBpZGVudGl0eTogJywgaWRlbnRpdHkpO1xyXG4gIC8vICAgICAgICAgcmVzb2x2ZSh7dHlwZTogJ2lkZW50aXR5JywgdmFsdWU6IGlkZW50aXR5fSk7XHJcbiAgLy8gICAgICAgfSk7XHJcblxyXG4gIC8vICAgICAgIGxldCBpZHBzID0gW107XHJcbiAgLy8gICAgICAgbGV0IGlkcHNPYmplY3RzID0gaWRlbnRpdHlJbmZvLmlkcHM7XHJcblxyXG4gIC8vICAgICAgIGlkcHNPYmplY3RzLmZvckVhY2goZnVuY3Rpb24oZW50cnkpIHtcclxuICAvLyAgICAgICAgIGlmKGVudHJ5LnR5cGUgJiYgZW50cnkudHlwZSA9PSAnaWRUb2tlbicpIHtcclxuICAvLyAgICAgICAgICAgaWRwcy5wdXNoKGVudHJ5LmRvbWFpbik7XHJcbiAgLy8gICAgICAgICB9XHJcbiAgLy8gICAgICAgfSk7XHJcblxyXG4gIC8vICAgICAgICQoJyNpZHByb3ZpZGVycycpLmh0bWwoX3RoaXMuX2dldExpc3QoaWRwcykpO1xyXG4gIC8vICAgICAgICQoJyNpZHByb3ZpZGVycycpLm9mZigpO1xyXG4gIC8vICAgICAgIC8vICQoJyNpZHByb3ZpZGVycycpLm9uKCdjbGljaycsIChldmVudCkgPT4gX3RoaXMub2J0YWluTmV3SWRlbnRpdHkoZXZlbnQsIGNhbGxiYWNrLCB0b1JlbW92ZUlEKSk7XHJcbiAgLy8gICAgICAgLy8kKCcuYmFjaycpLm9uKCdjbGljaycsIChldmVudCkgPT4gX3RoaXMuZ29Ib21lKCkpO1xyXG4gIC8vICAgICAgICQoJy5pZGVudGl0aWVzLXJlc2V0Jykub2ZmKCk7XHJcbiAgLy8gICAgICAgLy8gJCgnLmlkZW50aXRpZXMtcmVzZXQnKS5vbignY2xpY2snLCAoZXZlbnQpID0+IF90aGlzLl9yZXNldElkZW50aXRpZXMoY2FsbGJhY2spKTtcclxuICAvLyAgICAgfSk7XHJcbiAgLy8gICB9KTtcclxuICAvLyB9XHJcblxyXG4gIF9jaGVja1JlY2VpdmVkSW5mbyhyZWNlaXZlZEluZm8pIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG5cclxuICAgICAgbGV0IGlkZW50aXR5SW5mbztcclxuICAgICAgbGV0IHRvUmVtb3ZlSUQ7XHJcblxyXG4gICAgICBpZiAocmVjZWl2ZWRJbmZvKSB7XHJcbiAgICAgICAgaWRlbnRpdHlJbmZvID0gcmVjZWl2ZWRJbmZvO1xyXG4gICAgICAgIHRvUmVtb3ZlSUQgPSBmYWxzZTtcclxuICAgICAgICByZXNvbHZlKHtpZGVudGl0eUluZm86IGlkZW50aXR5SW5mbywgdG9SZW1vdmVJRDogdG9SZW1vdmVJRH0pO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRvUmVtb3ZlSUQgPSB0cnVlO1xyXG4gICAgICAgIF90aGlzLmNhbGxJZGVudGl0eU1vZHVsZUZ1bmMoJ2dldElkZW50aXRpZXNUb0Nob29zZScsIHt9KS50aGVuKChyZXN1bHQpID0+IHtcclxuICAgICAgICAgIHJlc29sdmUoe2lkZW50aXR5SW5mbzogcmVzdWx0LCB0b1JlbW92ZUlEOiB0b1JlbW92ZUlEfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgc2hvd0lkcHMoaWRwcykge1xyXG5cclxuICAgIGNvbnNvbGUubG9nKCdbSWRlbnRpdGllc0dVSS5zaG93SWRwc10gOiAnLCBpZHBzKTtcclxuXHJcbiAgICBsZXQgaWRwc0xpc3RFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpZHBzLWxpc3QnKTtcclxuXHJcbiAgICBjb25zdCBjbGlja0V2ZW50ID0gKGV2ZW50KSA9PiB7XHJcbiAgICAgIGNvbnN0IGVsID0gZXZlbnQuY3VycmVudFRhcmdldDtcclxuICAgICAgY29uc3QgaWRwID0gZWwuZ2V0QXR0cmlidXRlKCdkYXRhLWlkcCcpO1xyXG5cclxuICAgICAgdGhpcy5sb2dpbldpdGhJRFAoaWRwKS50aGVuKChyZXN1bHQpID0+IHtcclxuICAgICAgICAvLyBjb25zb2xlLmxvZygndmFsdWUgaGVyZTogJywgcmVzdWx0LnZhbHVlKTtcclxuICAgICAgICAvLyByZXN1bHQudmFsdWUgPSByZXN1bHQudmFsdWUudXNlclVSTFxyXG5cclxuICAgICAgICBpZiAodGhpcy5jYWxsYmFjaykge1xyXG4gICAgICAgICAgdGhpcy5jYWxsYmFjayhyZXN1bHQpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgIH0pO1xyXG4gICAgfTtcclxuXHJcbiAgICBpZHBzLmZvckVhY2goKGtleSkgPT4ge1xyXG5cclxuICAgICAgbGV0IGxpbmtFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsaW5rLScgKyBrZXkuZG9tYWluKTtcclxuXHJcbiAgICAgIGlmICghbGlua0VsKSB7XHJcbiAgICAgICAgbGlua0VsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpO1xyXG4gICAgICAgIGxpbmtFbC5zZXRBdHRyaWJ1dGUoJ2lkJywgJ2xpbmstJyArIGtleS5kb21haW4pO1xyXG4gICAgICAgIGxpbmtFbC5zZXRBdHRyaWJ1dGUoJ2RhdGEtaWRwJywga2V5LmRvbWFpbik7XHJcbiAgICAgICAgbGlua0VsLmNsYXNzTGlzdCA9ICdtZGMtbGlzdC1pdGVtIGxpbmstJyArIGtleS5kb21haW47XHJcbiAgICAgICAgbGlua0VsLmhyZWYgPSAnIyc7XHJcblxyXG4gICAgICAgIGNvbnN0IGxpbmtFbFRleHQgPSBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShrZXkuZG9tYWluKTtcclxuXHJcbiAgICAgICAgbGV0IG5hbWUgPSBrZXkuZG9tYWluO1xyXG4gICAgICAgIGlmIChuYW1lLmluZGV4T2YoJy4nKSAhPT0gLTEpIHtcclxuICAgICAgICAgIG5hbWUgPSBuYW1lLnN1YnN0cmluZygwLCBuYW1lLmluZGV4T2YoJy4nKSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIG5hbWUgPSAncXVlc3Rpb24nO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgaW1nRWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTtcclxuICAgICAgICBpbWdFbC5jbGFzc0xpc3QgPSAnbWRjLWxpc3QtaXRlbV9fc3RhcnQtZGV0YWlsJztcclxuICAgICAgICBpbWdFbC5zcmMgPSAnLi9hc3NldHMvJyArIG5hbWUgKyAnLnN2Zyc7XHJcbiAgICAgICAgaW1nRWwud2lkdGggPSAzMDtcclxuICAgICAgICBpbWdFbC5oZWlnaHQgPSAzMDtcclxuXHJcbiAgICAgICAgaW1nRWwub25lcnJvciA9IChlKSA9PiB7IGUuc3JjRWxlbWVudC5zcmMgPSAnLi9hc3NldHMvcXVlc3Rpb24uc3ZnJzsgfTtcclxuXHJcbiAgICAgICAgbGlua0VsLmFwcGVuZENoaWxkKGltZ0VsKTtcclxuICAgICAgICBsaW5rRWwuYXBwZW5kQ2hpbGQobGlua0VsVGV4dCk7XHJcblxyXG4gICAgICAgIGlkcHNMaXN0RWwuYXBwZW5kQ2hpbGQobGlua0VsKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBsaW5rRWwucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCBjbGlja0V2ZW50KTtcclxuICAgICAgfVxyXG5cclxuICAgICAgbGlua0VsLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgY2xpY2tFdmVudCk7XHJcblxyXG4gICAgfSk7XHJcblxyXG4gIH1cclxuXHJcbiAgc2hvd0RlZmF1bHRJZGVudGl0eShpZGVudGl0eSkge1xyXG5cclxuICAgIGlmIChpZGVudGl0eSkge1xyXG5cclxuICAgICAgdGhpcy5pc0xvZ2dlZCA9IHRydWU7XHJcblxyXG4gICAgICBjb25zdCBoZWFkZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubWRjLWxpc3QtLWF2YXRhci1saXN0Jyk7XHJcblxyXG4gICAgICBsZXQgaXRlbUVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2l0ZW0tJyArIGlkZW50aXR5LnVzZXJQcm9maWxlLnVzZXJVUkwpO1xyXG5cclxuICAgICAgaWYgKCFpdGVtRWwpIHtcclxuXHJcbiAgICAgICAgaXRlbUVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcclxuICAgICAgICBpdGVtRWwuaWQgPSAnaXRlbS0nICsgaWRlbnRpdHkudXNlclByb2ZpbGUudXNlclVSTDtcclxuICAgICAgICBpdGVtRWwuY2xhc3NMaXN0ID0gJ21kYy1saXN0LWl0ZW0gaXRlbS0nICsgaWRlbnRpdHkudXNlclByb2ZpbGUudXNlclVSTDtcclxuICAgICAgICBpdGVtRWwuc2V0QXR0cmlidXRlKCdkYXRhLXVzZXJVUkwnLCBpZGVudGl0eS51c2VyUHJvZmlsZS51c2VyVVJMKTtcclxuXHJcbiAgICAgICAgY29uc3QgcHJvZmlsZUltYWdlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW1nJyk7XHJcbiAgICAgICAgcHJvZmlsZUltYWdlLmNsYXNzTGlzdCA9ICdtZGMtbGlzdC1pdGVtX19zdGFydC1kZXRhaWwnO1xyXG4gICAgICAgIHByb2ZpbGVJbWFnZS53aWR0aCA9IDU2O1xyXG4gICAgICAgIHByb2ZpbGVJbWFnZS5oZWlnaHQgPSA1NjtcclxuICAgICAgICBwcm9maWxlSW1hZ2UuYWx0ID0gaWRlbnRpdHkudXNlclByb2ZpbGUubmFtZTtcclxuICAgICAgICBwcm9maWxlSW1hZ2Uuc3JjID0gaWRlbnRpdHkudXNlclByb2ZpbGUucGljdHVyZTtcclxuICAgICAgICBpdGVtRWwuYXBwZW5kQ2hpbGQocHJvZmlsZUltYWdlKTtcclxuXHJcbiAgICAgICAgY29uc3QgdGV4dDEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7XHJcbiAgICAgICAgdGV4dDEuY2xhc3NMaXN0ID0gJ25hbWUgbWRjLWxpc3QtaXRlbV9fdGV4dCc7XHJcbiAgICAgICAgdGV4dDEudGV4dENvbnRlbnQgPSBpZGVudGl0eS51c2VyUHJvZmlsZS5uYW1lO1xyXG5cclxuICAgICAgICBjb25zdCB0ZXh0MiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcclxuICAgICAgICB0ZXh0Mi5jbGFzc0xpc3QgPSAnZW1haWwgbWRjLWxpc3QtaXRlbV9fc2Vjb25kYXJ5LXRleHQnO1xyXG4gICAgICAgIHRleHQyLnRleHRDb250ZW50ID0gaWRlbnRpdHkudXNlclByb2ZpbGUuZW1haWw7XHJcblxyXG4gICAgICAgIHRleHQxLmFwcGVuZENoaWxkKHRleHQyKTtcclxuICAgICAgICBpdGVtRWwuYXBwZW5kQ2hpbGQodGV4dDEpO1xyXG4gICAgICAgIGhlYWRlci5hcHBlbmRDaGlsZChpdGVtRWwpO1xyXG5cclxuICAgICAgfVxyXG5cclxuICAgIH1cclxuXHJcbiAgfVxyXG5cclxuICBzaG93SWRlbnRpdGllcyhpRHMsIGNhbGxiYWNrLCBvUGVuRHJhd2VyID0gZmFsc2UpIHtcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG5cclxuICAgICAgY29uc29sZS5sb2coJ1tJZGVudGl0aWVzR1VJLnNob3dNeUlkZW50aXRpZXNdIDogJywgaURzLmlkZW50aXRpZXMsIGlEcy5kZWZhdWx0SWRlbnRpdHkpO1xyXG5cclxuICAgICAgY29uc3QgaWRlbnRpdGllcyA9IGlEcy5pZGVudGl0aWVzO1xyXG4gICAgICBjb25zdCBjdXJyZW50ID0gaURzLmRlZmF1bHRJZGVudGl0eSA/IGlEcy5kZWZhdWx0SWRlbnRpdHkudXNlclVSTCA6ICcnO1xyXG5cclxuICAgICAgbGV0IGFjdGl2ZUlkZW50aXRpZXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWN0aXZlLWlkZW50aXRpZXMnKTtcclxuXHJcbiAgICAgIE9iamVjdC5rZXlzKGlkZW50aXRpZXMpLmZvckVhY2goKGtleSkgPT4ge1xyXG5cclxuICAgICAgICBjb25zdCBleGlzdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsaW5rLScgKyBrZXkpO1xyXG4gICAgICAgIGlmIChleGlzdCkgeyByZXR1cm47IH1cclxuXHJcbiAgICAgICAgY29uc3QgbGlua0VsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpO1xyXG4gICAgICAgIGxpbmtFbC5ocmVmID0gJyMnO1xyXG4gICAgICAgIGxpbmtFbC5pZCA9ICdsaW5rLScgKyBrZXk7XHJcbiAgICAgICAgbGlua0VsLmNsYXNzTGlzdCA9ICdtZGMtbGlzdC1pdGVtJztcclxuICAgICAgICBsaW5rRWwuc2V0QXR0cmlidXRlKCdkYXRhLXVzZXJVUkwnLCBrZXkpO1xyXG5cclxuICAgICAgICBpZiAoa2V5ID09PSBjdXJyZW50KSB7XHJcbiAgICAgICAgICBsaW5rRWwuY2xhc3NMaXN0ICs9ICcgbWRjLXRlbXBvcmFyeS1kcmF3ZXItLXNlbGVjdGVkJztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxpbmtFbC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChldmVudCkgPT4ge1xyXG5cclxuICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG4gICAgICAgICAgY29uc3QgZWwgPSBldmVudC5jdXJyZW50VGFyZ2V0O1xyXG4gICAgICAgICAgY29uc3QgdXNlclVSTCA9IGVsLmdldEF0dHJpYnV0ZSgnZGF0YS11c2VyVVJMJyk7XHJcblxyXG4gICAgICAgICAgY29uc29sZS5sb2coJ3VzZXJVUkw6JywgdXNlclVSTCwgY2FsbGJhY2ssIGVsKTtcclxuXHJcbiAgICAgICAgICBpZiAoY2FsbGJhY2spIHtcclxuICAgICAgICAgICAgY2FsbGJhY2sodXNlclVSTCk7XHJcbiAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBjb25zdCBwcm9maWxlSW1hZ2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTtcclxuICAgICAgICBwcm9maWxlSW1hZ2UuY2xhc3NMaXN0ID0gJ21kYy1saXN0LWl0ZW1fX3N0YXJ0LWRldGFpbCc7XHJcbiAgICAgICAgcHJvZmlsZUltYWdlLndpZHRoID0gNDA7XHJcbiAgICAgICAgcHJvZmlsZUltYWdlLmhlaWdodCA9IDQwO1xyXG4gICAgICAgIHByb2ZpbGVJbWFnZS5hbHQgPSBpZGVudGl0aWVzW2tleV0udXNlclByb2ZpbGUubmFtZTtcclxuICAgICAgICBwcm9maWxlSW1hZ2Uuc3JjID0gaWRlbnRpdGllc1trZXldLnVzZXJQcm9maWxlLnBpY3R1cmU7XHJcbiAgICAgICAgcHJvZmlsZUltYWdlLm9uZXJyb3IgPSAoZSkgPT4geyBlLnNyY0VsZW1lbnQuc3JjID0gJy4vYXNzZXRzL3F1ZXN0aW9uLnN2Zyc7IH07XHJcblxyXG4gICAgICAgIGNvbnN0IHRleHQxID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xyXG4gICAgICAgIHRleHQxLmNsYXNzTGlzdCA9ICduYW1lIG1kYy1saXN0LWl0ZW1fX3RleHQnO1xyXG4gICAgICAgIHRleHQxLnRleHRDb250ZW50ID0gaWRlbnRpdGllc1trZXldLnVzZXJQcm9maWxlLm5hbWU7XHJcblxyXG4gICAgICAgIGNvbnN0IHRleHQyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xyXG4gICAgICAgIHRleHQyLmNsYXNzTGlzdCA9ICdlbWFpbCBtZGMtbGlzdC1pdGVtX19zZWNvbmRhcnktdGV4dCc7XHJcbiAgICAgICAgdGV4dDIudGV4dENvbnRlbnQgPSBpZGVudGl0aWVzW2tleV0udXNlclByb2ZpbGUuZW1haWw7XHJcblxyXG4gICAgICAgIHRleHQxLmFwcGVuZENoaWxkKHRleHQyKTtcclxuXHJcbiAgICAgICAgbGlua0VsLmFwcGVuZENoaWxkKHByb2ZpbGVJbWFnZSk7XHJcbiAgICAgICAgbGlua0VsLmFwcGVuZENoaWxkKHRleHQxKTtcclxuXHJcbiAgICAgICAgYWN0aXZlSWRlbnRpdGllcy5hcHBlbmRDaGlsZChsaW5rRWwpO1xyXG5cclxuICAgICAgfSk7XHJcblxyXG4gICAgICBpZiAob1BlbkRyYXdlciAmJiAoIXRoaXMuX2FscmVhZHlSZUxvZ2luKSkge1xyXG4gICAgICAgIHRoaXMuX2RyYXdlci5vcGVuID0gdHJ1ZVxyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAob1BlbkRyYXdlciAmJiAoIXRoaXMuX2FscmVhZHlSZUxvZ2luKSAmJiAoIXRoaXMuX2FscmVhZHlMb2dpbikpIHtcclxuICAgICAgICB0aGlzLl9hbHJlYWR5UmVMb2dpbiA9IHRydWU7XHJcbiAgICAgICAgcGFyZW50LnBvc3RNZXNzYWdlKHsgYm9keTogeyBtZXRob2Q6ICd0b2tlbkV4cGlyZWQnIH0sIHRvOiAncnVudGltZTpndWktbWFuYWdlcicgfSwgJyonKTtcclxuICAgICAgfVxyXG5cclxuXHJcblxyXG5cclxuLypcclxuICAgICAgaWYgKE9iamVjdC5rZXlzKGlkZW50aXRpZXMpLmxlbmd0aCA9PT0gMSkge1xyXG5cclxuICAgICAgICBpZiAoY2FsbGJhY2spIHtcclxuICAgICAgICAgIGNhbGxiYWNrKHt0eXBlOiAnaWRlbnRpdHknLCB2YWx1ZTogY3VycmVudH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHJlc29sdmUoe3R5cGU6ICdpZGVudGl0eScsIHZhbHVlOiBjdXJyZW50fSk7XHJcbiAgICAgIH0qL1xyXG5cclxuXHJcbiAgICAgIC8vIGxldCBjYWxsYmFjayA9IChpZGVudGl0eSkgPT4ge1xyXG4gICAgICAvLyAgIHJlc29sdmUoaWRlbnRpdHkpO1xyXG4gICAgICAvLyB9O1xyXG5cclxuICAgICAgLy8gaWYgKCF0b1JlbW92ZUlEKSB7XHJcbiAgICAgIC8vICAgJCgnLmNsaWNrYWJsZS1jZWxsJykub24oJ2NsaWNrJywgKGV2ZW50KSA9PiBfdGhpcy5jaGFuZ2VJRChldmVudCwgY2FsbGJhY2spKTtcclxuICAgICAgLy8gfVxyXG5cclxuICAgICAgLy8gJCgnLnJlbW92ZS1pZCcpLm9uKCdjbGljaycsIChldmVudCkgPT4gX3RoaXMucmVtb3ZlSUQoaURzKSk7XHJcblxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICByZW1vdmVJRChldmVudCwgZW1haWxzKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgbGV0IHJvdyA9IGV2ZW50LnRhcmdldC5wYXJlbnROb2RlLnBhcmVudE5vZGU7XHJcbiAgICBsZXQgaWRUb1JlbW92ZSA9IHJvdy5jaGlsZHJlblswXS50ZXh0Q29udGVudDtcclxuICAgIGxldCBkb21haW4gPSByb3cuY2hpbGRyZW5bMV0udGV4dENvbnRlbnQ7XHJcblxyXG4gICAgX3RoaXMuY2FsbElkZW50aXR5TW9kdWxlRnVuYygndW5yZWdpc3RlcklkZW50aXR5JywgeyBlbWFpbDogaWRUb1JlbW92ZSB9KS50aGVuKCgpID0+IHtcclxuICAgICAgbGV0IG51bUVtYWlscyA9IGVtYWlscy5sZW5ndGg7XHJcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtRW1haWxzOyBpKyspIHtcclxuICAgICAgICBpZiAoZW1haWxzW2ldLmVtYWlsID09PSBpZFRvUmVtb3ZlKSB7XHJcbiAgICAgICAgICBlbWFpbHMuc3BsaWNlKGksIDEpO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLy9cclxuICAgICAgX3RoaXMuc2hvd0lkZW50aXRpZXMoZW1haWxzLCB0cnVlKTtcclxuICAgIH0pO1xyXG5cclxuICAgIC8vX3RoaXMuaWRlbnRpdHlNb2R1bGUudW5yZWdpc3RlcklkZW50aXR5KGlkVG9SZW1vdmUpO1xyXG5cclxuICB9XHJcblxyXG4gIGF1dGhvcmlzZShpZHAsIHJlc291cmNlKSB7XHJcblxyXG5cclxuICAgIHJldHVybiB0aGlzLm9wZW5Qb3B1cCgpXHJcbiAgICAgIC50aGVuKChyZXMpID0+IHtcclxuICAgICAgICBjb25zdCBkYXRhID0geyBzY29wZTogcmVzb3VyY2UsIGlkcERvbWFpbjogaWRwIH07XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2FsbElkZW50aXR5TW9kdWxlRnVuYygnZ2V0QWNjZXNzVG9rZW5BdXRob3Jpc2F0aW9uRW5kcG9pbnQnLCBkYXRhKTtcclxuICAgICAgfSlcclxuICAgICAgLnRoZW4oKHZhbHVlKSA9PiB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ1tJZGVudGl0aWVzR1VJLmF1dGhvcmlzZV0gcmVjZWl2ZWRVUkwgZnJvbSBpZHAgUHJveHk6ICcgKyB2YWx1ZSk7XHJcblxyXG4gICAgICAgIHJldHVybiB0aGlzLm9wZW5Qb3B1cCh2YWx1ZSk7XHJcbiAgICAgIH0pLnRoZW4oKHJlc3VsdCkgPT4ge1xyXG5cclxuICAgICAgICBjb25zb2xlLmxvZygnW0lkZW50aXRpZXNHVUkuYXV0aG9yaXNlLm9wZW5Qb3B1cC5yZXN1bHRdJywgcmVzdWx0KTtcclxuXHJcbiAgICAgICAgLy8gcmVzb3VyY2UgYXMgYXJyYXlcclxuXHJcblxyXG4gICAgICAgIGNvbnN0IGRhdGEgPSB7IHJlc291cmNlczogW3Jlc291cmNlXSwgaWRwRG9tYWluOiBpZHAsIGxvZ2luOiByZXN1bHQgfTtcclxuICAgICAgICByZXR1cm4gdGhpcy5jYWxsSWRlbnRpdHlNb2R1bGVGdW5jKCdnZXRBY2Nlc3NUb2tlbicsIGRhdGEpO1xyXG4gICAgICB9KS50aGVuKChyZXN1bHQpID0+IHtcclxuXHJcbiAgICAgICAgY29uc29sZS5sb2coJ1tJZGVudGl0aWVzR1VJLmF1dGhvcmlzZS5nZXRBY2Nlc3NUb2tlbi5yZXN1bHRdJywgcmVzdWx0KTtcclxuICAgICAgICByZXR1cm4gdGhpcy5jYWxsSWRlbnRpdHlNb2R1bGVGdW5jKCdhZGRBY2Nlc3NUb2tlbicsIHJlc3VsdCk7XHJcbiAgICAgIH0pLnRoZW4oKHZhbHVlKSA9PiB7XHJcbiAgICAgICAgdGhpcy5fZHJhd2VyLm9wZW4gPSBmYWxzZTtcclxuICAgICAgICByZXR1cm4gdmFsdWU7XHJcbiAgICAgIH0pO1xyXG5cclxuICB9XHJcblxyXG4gIGxvZ2luV2l0aElEUChpZHApIHtcclxuXHJcblxyXG4gICAgbGV0IF9wdWJsaWNLZXk7XHJcblxyXG4gICAgcmV0dXJuIHRoaXMub3BlblBvcHVwKClcclxuICAgICAgLnRoZW4oKHJlc3VsdCkgPT4ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNhbGxJZGVudGl0eU1vZHVsZUZ1bmMoJ2dldE15UHVibGljS2V5Jywge30pO1xyXG4gICAgICB9KS50aGVuKChwdWJsaWNLZXkpID0+IHtcclxuICAgICAgICBfcHVibGljS2V5ID0gcHVibGljS2V5O1xyXG4gICAgICAgIGNvbnN0IGRhdGEgPSB7IGNvbnRlbnRzOiBwdWJsaWNLZXksIG9yaWdpbjogJ29yaWdpbicsIHVzZXJuYW1lSGludDogdW5kZWZpbmVkLCBpZHBEb21haW46IGlkcCB9O1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNhbGxJZGVudGl0eU1vZHVsZUZ1bmMoJ3NlbmRHZW5lcmF0ZU1lc3NhZ2UnLCBkYXRhKTtcclxuICAgICAgfSlcclxuICAgICAgLnRoZW4oKHZhbHVlKSA9PiB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ1tJZGVudGl0aWVzR1VJLm9idGFpbk5ld0lkZW50aXR5XSByZWNlaXZlZFVSTCBmcm9tIGlkcCBQcm94eTogJyArIHZhbHVlLmxvZ2luVXJsLnN1YnN0cmluZygwLCAyMCkgKyAnLi4uJyk7XHJcblxyXG4gICAgICAgIGxldCB1cmwgPSB2YWx1ZS5sb2dpblVybDtcclxuICAgICAgICBsZXQgZmluYWxVUkw7XHJcblxyXG4gICAgICAgIC8vY2hlY2sgaWYgdGhlIHJlY2VpdmVkVVJMIGNvbnRhaW5zIHRoZSByZWRpcmVjdCBmaWVsZCBhbmQgcmVwbGFjZSBpdFxyXG4gICAgICAgIGlmICh1cmwuaW5kZXhPZigncmVkaXJlY3RfdXJpJykgIT09IC0xKSB7XHJcbiAgICAgICAgICBsZXQgZmlyc3RQYXJ0ID0gdXJsLnN1YnN0cmluZygwLCB1cmwuaW5kZXhPZigncmVkaXJlY3RfdXJpJykpO1xyXG4gICAgICAgICAgbGV0IHNlY29uZEF1eFBhcnQgPSB1cmwuc3Vic3RyaW5nKHVybC5pbmRleE9mKCdyZWRpcmVjdF91cmknKSwgdXJsLmxlbmd0aCk7XHJcblxyXG4gICAgICAgICAgbGV0IHNlY29uZFBhcnQgPSBzZWNvbmRBdXhQYXJ0LnN1YnN0cmluZyhzZWNvbmRBdXhQYXJ0LmluZGV4T2YoJyYnKSwgdXJsLmxlbmd0aCk7XHJcblxyXG4gICAgICAgICAgLy9jaGVjayBpZiB0aGUgcmVkZGlyZWN0IGZpZWxkIGlzIHRoZSBsYXN0IGZpZWxkIG9mIHRoZSBVUkxcclxuICAgICAgICAgIGlmIChzZWNvbmRQYXJ0LmluZGV4T2YoJyYnKSAhPT0gLTEpIHtcclxuICAgICAgICAgICAgZmluYWxVUkwgPSBmaXJzdFBhcnQgKyAncmVkaXJlY3RfdXJpPScgKyBsb2NhdGlvbi5vcmlnaW4gKyBzZWNvbmRQYXJ0O1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgZmluYWxVUkwgPSBmaXJzdFBhcnQgKyAncmVkaXJlY3RfdXJpPScgKyBsb2NhdGlvbi5vcmlnaW47XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLnJlc3VsdFVSTCA9IGZpbmFsVVJMIHx8IHVybDtcclxuXHJcbiAgICAgICAgY29uc29sZS5sb2coJ1tJZGVudGl0aWVzR1VJLm9wZW5Qb3B1cF0nLCB0aGlzLnJlc3VsdFVSTCk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMub3BlblBvcHVwKHRoaXMucmVzdWx0VVJMKTtcclxuICAgICAgfSkudGhlbigoaWRlbnRpdHkpID0+IHtcclxuXHJcbiAgICAgICAgY29uc29sZS5sb2coJ1tJZGVudGl0aWVzR1VJLm9wZW5Qb3B1cC5yZXN1bHRdJywgaWRlbnRpdHkpO1xyXG5cclxuICAgICAgICBjb25zdCBkYXRhID0geyBjb250ZW50czogX3B1YmxpY0tleSwgb3JpZ2luOiAnb3JpZ2luJywgdXNlcm5hbWVIaW50OiBpZGVudGl0eSwgaWRwRG9tYWluOiBpZHAgfTtcclxuICAgICAgICByZXR1cm4gdGhpcy5jYWxsSWRlbnRpdHlNb2R1bGVGdW5jKCdzZW5kR2VuZXJhdGVNZXNzYWdlJywgZGF0YSk7XHJcbiAgICAgIH0pLnRoZW4oKHJlc3VsdCkgPT4ge1xyXG5cclxuICAgICAgICBjb25zb2xlLmxvZygnW0lkZW50aXRpZXNHVUkuc2VuZEdlbmVyYXRlTWVzc2FnZS5yZXN1bHRdJywgcmVzdWx0KTtcclxuICAgICAgICByZXR1cm4gdGhpcy5jYWxsSWRlbnRpdHlNb2R1bGVGdW5jKCdhZGRBc3NlcnRpb24nLCByZXN1bHQpO1xyXG4gICAgICB9KS50aGVuKCh2YWx1ZSkgPT4ge1xyXG5cclxuICAgICAgICB0aGlzLl9kcmF3ZXIub3BlbiA9IGZhbHNlO1xyXG4gICAgICAgIGNvbnN0IHVzZXJVUkwgPSB7dHlwZTogJ2lkZW50aXR5JywgdmFsdWU6IHZhbHVlLnVzZXJQcm9maWxlLnVzZXJVUkx9O1xyXG4gICAgICAgIC8vIGNvbnN0IHVzZXJJZGVudGl0eSA9IHt0eXBlOiAnaWRlbnRpdHknLCB2YWx1ZTogdmFsdWUudXNlclByb2ZpbGV9O1xyXG5cclxuICAgICAgICBjb25zb2xlLmxvZygnW0lkZW50aXRpZXNHVUkubG9naW5XaXRoSURQIGZpbmFsXScsIHZhbHVlKTtcclxuICAgICAgICB0aGlzLl9hbHJlYWR5TG9naW4gPSB0cnVlO1xyXG4gICAgICAgIHJldHVybiB1c2VyVVJMO1xyXG4gICAgICAgIC8vIHJldHVybiB1c2VySWRlbnRpdHk7XHJcbiAgICAgIH0pO1xyXG5cclxuICB9XHJcblxyXG4gIC8vIG9idGFpbk5ld0lkZW50aXR5KGV2ZW50LCBjYWxsYmFjaywgdG9SZW1vdmVJRCkge1xyXG4gIC8vICAgbGV0IF90aGlzID0gdGhpcztcclxuICAvLyAgIGxldCBpZFByb3ZpZGVyID0gZXZlbnQudGFyZ2V0LnRleHRDb250ZW50O1xyXG4gIC8vICAgbGV0IGlkUHJvdmlkZXIyID0gZXZlbnQudGFyZ2V0LnRleHQ7XHJcblxyXG4gIC8vICAgX3RoaXMuY2FsbElkZW50aXR5TW9kdWxlRnVuYygnZ2V0TXlQdWJsaWNLZXknLCB7fSkudGhlbigocHVibGljS2V5KSA9PiB7XHJcbiAgLy8gICAgIC8vIGxldCBwdWJsaWNLZXkgPSBidG9hKGtleVBhaXIucHVibGljKTtcclxuXHJcbiAgLy8gICAgIF90aGlzLmNhbGxJZGVudGl0eU1vZHVsZUZ1bmMoJ3NlbmRHZW5lcmF0ZU1lc3NhZ2UnLFxyXG4gIC8vICAgICAgIHsgY29udGVudHM6IHB1YmxpY0tleSwgb3JpZ2luOiAnb3JpZ2luJywgdXNlcm5hbWVIaW50OiB1bmRlZmluZWQsIGlkcERvbWFpbjogaWRQcm92aWRlciwgfSkudGhlbigodmFsdWUpID0+IHtcclxuICAvLyAgICAgICBjb25zb2xlLmxvZygnW0lkZW50aXRpZXNHVUkub2J0YWluTmV3SWRlbnRpdHldIHJlY2VpdmVkVVJMIGZyb20gaWRwIFByb3h5OiAnICsgdmFsdWUubG9naW5Vcmwuc3Vic3RyaW5nKDAsIDIwKSArICcuLi4nKTtcclxuXHJcbiAgLy8gICAgICAgbGV0IHVybCA9IHZhbHVlLmxvZ2luVXJsO1xyXG4gIC8vICAgICAgIGxldCBmaW5hbFVSTDtcclxuXHJcbiAgLy8gICAgICAgLy9jaGVjayBpZiB0aGUgcmVjZWl2ZWRVUkwgY29udGFpbnMgdGhlIHJlZGlyZWN0IGZpZWxkIGFuZCByZXBsYWNlIGl0XHJcbiAgLy8gICAgICAgaWYgKHVybC5pbmRleE9mKCdyZWRpcmVjdF91cmknKSAhPT0gLTEpIHtcclxuICAvLyAgICAgICAgIGxldCBmaXJzdFBhcnQgPSB1cmwuc3Vic3RyaW5nKDAsIHVybC5pbmRleE9mKCdyZWRpcmVjdF91cmknKSk7XHJcbiAgLy8gICAgICAgICBsZXQgc2Vjb25kQXV4UGFydCA9IHVybC5zdWJzdHJpbmcodXJsLmluZGV4T2YoJ3JlZGlyZWN0X3VyaScpLCB1cmwubGVuZ3RoKTtcclxuXHJcbiAgLy8gICAgICAgICBsZXQgc2Vjb25kUGFydCA9IHNlY29uZEF1eFBhcnQuc3Vic3RyaW5nKHNlY29uZEF1eFBhcnQuaW5kZXhPZignJicpLCB1cmwubGVuZ3RoKTtcclxuXHJcbiAgLy8gICAgICAgICAvL2NoZWNrIGlmIHRoZSByZWRkaXJlY3QgZmllbGQgaXMgdGhlIGxhc3QgZmllbGQgb2YgdGhlIFVSTFxyXG4gIC8vICAgICAgICAgaWYgKHNlY29uZFBhcnQuaW5kZXhPZignJicpICE9PSAtMSkge1xyXG4gIC8vICAgICAgICAgICBmaW5hbFVSTCA9IGZpcnN0UGFydCArICdyZWRpcmVjdF91cmk9JyArIGxvY2F0aW9uLm9yaWdpbiArIHNlY29uZFBhcnQ7XHJcbiAgLy8gICAgICAgICB9IGVsc2Uge1xyXG4gIC8vICAgICAgICAgICBmaW5hbFVSTCA9IGZpcnN0UGFydCArICdyZWRpcmVjdF91cmk9JyArIGxvY2F0aW9uLm9yaWdpbjtcclxuICAvLyAgICAgICAgIH1cclxuICAvLyAgICAgICB9XHJcblxyXG4gIC8vICAgICAgIF90aGlzLnJlc3VsdFVSTCA9IGZpbmFsVVJMIHx8IHVybDtcclxuXHJcbiAgLy8gICAgICAgJCgnLmxvZ2luLWlkcCcpLmh0bWwoJzxwPkNob3NlbiBJRFA6ICcgKyBpZFByb3ZpZGVyICsgJzwvcD4nKTtcclxuICAvLyAgICAgICAkKCcubG9naW4nKS5yZW1vdmVDbGFzcygnaGlkZScpO1xyXG4gIC8vICAgICAgICQoJy5sb2dpbi1idG4nKS5vZmYoKTtcclxuICAvLyAgICAgICAkKCcubG9naW4tYnRuJykub24oJ2NsaWNrJywgKGV2ZW50KSA9PiB7XHJcbiAgLy8gICAgICAgICAkKCcubG9naW4nKS5hZGRDbGFzcygnaGlkZScpO1xyXG4gIC8vICAgICAgICAgLy8gX3RoaXMuX2F1dGhlbnRpY2F0ZVVzZXIocHVibGljS2V5LCB2YWx1ZSwgJ29yaWdpbicsIGlkUHJvdmlkZXIpLnRoZW4oKGVtYWlsKSA9PiB7XHJcbiAgLy8gICAgICAgICAvLyAgIGNhbGxiYWNrKGVtYWlsKTtcclxuICAvLyAgICAgICAgIC8vICAgX3RoaXMuc2hvd0lkZW50aXRpZXNHVUkoKTtcclxuICAvLyAgICAgICAgIC8vIH0pO1xyXG4gIC8vICAgICAgIH0pO1xyXG4gIC8vICAgICB9KTtcclxuICAvLyAgIH0pLmNhdGNoKGVyciA9PiBjb25zb2xlLmxvZygnb2J0YW5pbiBuZXcgaWRlbnRpdHknLCBlcnIpKTtcclxuXHJcbiAgLy8gfVxyXG5cclxuICBfZ2V0TGlzdChpdGVtcykge1xyXG4gICAgbGV0IGxpc3QgPSAnJztcclxuICAgIGxldCBudW1JdGVtcyA9IGl0ZW1zLmxlbmd0aDtcclxuXHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bUl0ZW1zOyBpKyspIHtcclxuICAgICAgbGlzdCArPSAnPGxpIGNsYXNzPVwiZGl2aWRlclwiPjwvbGk+JztcclxuICAgICAgbGlzdCArPSAnPGxpPjxhIGNsYXNzPVwiY2VudGVyLWFsaWduXCI+JyArIGl0ZW1zW2ldICsgJzwvYT48L2xpPic7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGxpc3Q7XHJcbiAgfVxyXG5cclxuICBfYXV0aGVudGljYXRlVXNlcihwdWJsaWNLZXksIHZhbHVlLCBvcmlnaW4sIGlkUHJvdmlkZXIpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcbiAgICBsZXQgdXJsID0gX3RoaXMucmVzdWx0VVJMO1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcblxyXG4gICAgICBfdGhpcy5vcGVuUG9wdXAodXJsKS50aGVuKChpZGVudGl0eSkgPT4ge1xyXG5cclxuICAgICAgICBfdGhpcy5jYWxsSWRlbnRpdHlNb2R1bGVGdW5jKCdzZW5kR2VuZXJhdGVNZXNzYWdlJyxcclxuICAgICAgICAgIHsgY29udGVudHM6IHB1YmxpY0tleSwgb3JpZ2luOiBvcmlnaW4sIHVzZXJuYW1lSGludDogaWRlbnRpdHksIGlkcERvbWFpbjogaWRQcm92aWRlciB9KS50aGVuKChyZXN1bHQpID0+IHtcclxuXHJcbiAgICAgICAgICBpZiAocmVzdWx0KSB7XHJcblxyXG4gICAgICAgICAgICAvL190aGlzLmlkZW50aXR5TW9kdWxlLnN0b3JlSWRlbnRpdHkocmVzdWx0LCBrZXlQYWlyKS50aGVuKCh2YWx1ZSkgPT4ge1xyXG4gICAgICAgICAgICBfdGhpcy5jYWxsSWRlbnRpdHlNb2R1bGVGdW5jKCdhZGRBc3NlcnRpb24nLCByZXN1bHQpLnRoZW4oKHZhbHVlKSA9PiB7XHJcbiAgICAgICAgICAgICAgcmVzb2x2ZSh2YWx1ZS51c2VyUHJvZmlsZS51c2VyVVJMKTtcclxuICAgICAgICAgICAgfSwgKGVycikgPT4ge1xyXG4gICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZWplY3QoJ2Vycm9yIG9uIG9idGFpbmluZyBpZGVudGl0eSBpbmZvcm1hdGlvbicpO1xyXG4gICAgICAgICAgfVxyXG5cclxuICAgICAgICB9KTtcclxuICAgICAgfSwgKGVycikgPT4ge1xyXG4gICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgX3Jlc2V0SWRlbnRpdGllcygpIHtcclxuICAgIGNvbnNvbGUubG9nKCdfcmVzZXRJZGVudGl0aWVzJyk7XHJcbiAgfVxyXG5cclxuXHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IElkZW50aXRpZXNHVUk7XHJcbiJdfQ=="}