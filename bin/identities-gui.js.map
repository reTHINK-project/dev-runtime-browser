{"version":3,"sources":["node_modules/browser-pack/_prelude.js","node_modules/events/events.js","src/admin/IdentitiesGUI.js"],"names":[],"mappings":"AAAA;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;AC9SA;;;;AAEA;;IAEM,a;AAEJ,yBAAY,MAAZ,EAAoB,MAApB,EAA4B,UAA5B,EAAwC;AAAA;;AAAA;;AACtC;AACA,QAAI,CAAC,UAAL,EAAiB,MAAM,MAAM,sBAAN,CAAN;AACjB,QAAI,QAAQ,IAAZ;AACA,UAAM,OAAN,GAAgB,MAAhB;AACA,UAAM,OAAN,GAAgB,MAAhB;AACA,UAAM,WAAN,GAAoB,UAApB;;AAEA,QAAM,WAAW,SAAS,aAAT,CAAuB,uBAAvB,CAAjB;AACA,QAAM,qBAAqB,IAAI,MAAJ,CAAW,kBAAtC;AACA,QAAM,SAAS,IAAI,kBAAJ,CAAuB,QAAvB,CAAf;;AAEA,SAAK,SAAL,GAAiB,QAAjB;;AAEA,aAAS,aAAT,CAAuB,eAAvB,EAAwC,gBAAxC,CAAyD,OAAzD,EAAkE,YAAW;AAC3E,aAAO,IAAP,GAAc,IAAd;AACD,KAFD;;AAIA,aAAS,gBAAT,CAA0B,yBAA1B,EAAqD,YAAM;AACzD,cAAQ,GAAR,CAAY,kCAAZ;;AAEA,aAAK,WAAL;AACD,KAJD;;AAMA,aAAS,gBAAT,CAA0B,0BAA1B,EAAsD,YAAM;AAC1D,cAAQ,GAAR,CAAY,mCAAZ;;AAEA,aAAO,WAAP,CAAmB,EAAE,MAAM,EAAE,QAAQ,eAAV,EAAR,EAAqC,IAAI,qBAAzC,EAAnB,EAAqF,GAArF;AAED,KALD;AAOD;;;;kCAEa;;AAEZ,UAAI,QAAQ,IAAZ;AACA,UAAM,SAAS,MAAM,OAArB;;AAGA,YAAM,iBAAN,CAAwB,IAAI,IAAJ,CAAS,KAAjC,EAAwC,IAAxC,CAA6C,UAAC,YAAD,EAAkB;AAC7D,YAAI,iBAAJ;AACA,gBAAQ,GAAR,CAAY,yCAAZ,EAAuD,YAAvD;;AAEA;AACA,eAAO,WAAP,CAAmB,EAAE,MAAM,EAAE,QAAQ,eAAV,EAAR,EAAqC,IAAI,qBAAzC,EAAnB,EAAqF,GAArF;AACA,UAAE,aAAF,EAAiB,QAAjB,CAA0B,MAA1B;;AAEA;AACA,UAAE,qBAAF,EAAyB,QAAzB,CAAkC,MAAlC;AACA,UAAE,mBAAF,EAAuB,QAAvB,CAAgC,MAAhC;;AAEA,gBAAQ,aAAa,IAArB;AACE,eAAK,KAAL;AACE,oBAAQ,EAAE,MAAM,KAAR,EAAe,OAAO,aAAa,KAAnC,EAA0C,MAAM,GAAhD,EAAR;AACA,uBAAW,EAAE,IAAI,IAAI,EAAV,EAAc,MAAM,UAApB,EAAgC,IAAI,IAAI,IAAxC,EAA8C,MAAM,IAAI,EAAxD,EAA4D,MAAM,KAAlE,EAAX;AACA,kBAAM,WAAN,CAAkB,WAAlB,CAA8B,QAA9B;AACA;;AAEF,eAAK,UAAL;AACE,oBAAQ,EAAE,MAAM,UAAR,EAAoB,OAAO,aAAa,KAAxC,EAA+C,MAAM,GAArD,EAAR;AACA,uBAAW,EAAE,IAAI,IAAI,EAAV,EAAc,MAAM,UAApB,EAAgC,IAAI,IAAI,IAAxC,EAA8C,MAAM,IAAI,EAAxD,EAA4D,MAAM,KAAlE,EAAX;AACA,kBAAM,WAAN,CAAkB,WAAlB,CAA8B,QAA9B;AACA;;AAEF;AACE,oBAAQ,EAAE,MAAM,OAAR,EAAiB,OAAO,uBAAxB,EAAiD,MAAM,GAAvD,EAAR;AACA,uBAAW,EAAE,IAAI,IAAI,EAAV,EAAc,MAAM,UAApB,EAAgC,IAAI,IAAI,IAAxC,EAA8C,MAAM,IAAI,EAAxD,EAA4D,MAAM,KAAlE,EAAX;AACA,kBAAM,WAAN,CAAkB,WAAlB,CAA8B,QAA9B;AAhBJ;AAkBD,OA9BD;;AAgCA,YAAM,sBAAN,CAA6B,WAA7B,EAA0C,EAA1C,EAA8C,IAA9C,CAAmD,YAAM;AACvD,cAAM,SAAN,GAAmB,SAAnB;;AAEA,cAAM,WAAN,CAAkB,WAAlB,CAA8B,MAA9B,EAAsC,eAAO;;AAE3C,cAAI,eAAe,IAAI,IAAJ,CAAS,KAA5B;AACA,cAAI,WAAW,IAAI,IAAJ,CAAS,MAAxB;AACA,cAAI,cAAJ;AACA,kBAAQ,GAAR,CAAY,gCAAZ,EAA8C,GAA9C;;AAEA,cAAI,aAAa,WAAjB,EAA8B;AAC5B,gBAAI,cAAc,IAAI,IAAJ,CAAS,MAAT,CAAgB,WAAlC;AACA,kBAAM,SAAN,CAAgB,WAAhB,EAA6B,IAA7B,CAAkC,UAAC,aAAD,EAAmB;AACnD,kBAAI,QAAQ,EAAC,MAAM,SAAP,EAAkB,OAAO,aAAzB,EAAwC,MAAM,GAA9C,EAAZ;AACA,kBAAI,WAAW,EAAC,IAAI,IAAI,EAAT,EAAa,MAAM,UAAnB,EAA+B,IAAI,IAAI,IAAvC,EAA6C,MAAM,IAAI,EAAvD,EAA2D,MAAM,KAAjE,EAAf;AACA,oBAAM,WAAN,CAAkB,WAAlB,CAA8B,QAA9B;AACD,aAJD;AAKA,mBAP4B,CAOpB;AACT;;AAED;AACA;AACA,iBAAO,WAAP,CAAmB,EAAE,MAAM,EAAE,QAAQ,eAAV,EAAR,EAAqC,IAAI,qBAAzC,EAAnB,EAAqF,GAArF;;AAEA,cAAM,YAAY,IAAI,UAAJ,CAAe,OAAf,CAAlB;AACA,mBAAS,aAAT,CAAuB,eAAvB,EAAwC,aAAxC,CAAsD,SAAtD;;AAEA,YAAE,aAAF,EAAiB,WAAjB,CAA6B,MAA7B;AAED,SA1BD;AA4BD,OA/BD;AAiCD;;;2CAEsB,U,EAAY,U,EAAY;AAAA;;AAC7C,UAAI,QAAQ,IAAZ;;AAEA,aAAO,IAAI,OAAJ,CAAY,UAAC,OAAD,EAAU,MAAV,EAAqB;AACtC,YAAM,UAAU,EAAE,MAAM,SAAR,EAAmB,IAAI,MAAM,OAA7B,EAAsC,MAAM,MAAM,OAAlD;AACd,gBAAM,EAAE,UAAU,UAAZ,EAAwB,QAAQ,UAAhC,EAA4C,QAAQ,UAApD,EADQ,EAAhB;;AAGA,eAAK,WAAL,CAAiB,WAAjB,CAA6B,OAA7B,EAAsC,UAAC,GAAD,EAAS;AAC7C,cAAI,SAAS,IAAI,IAAJ,CAAS,KAAtB;AACA,kBAAQ,MAAR;AACD,SAHD;AAKD,OATM,CAAP;AAUD;;;8BAES,W,EAAa;;AAErB,aAAO,IAAI,OAAJ,CAAY,UAAC,OAAD,EAAU,MAAV,EAAqB;;AAEtC,YAAI,MAAM,OAAO,IAAP,CAAY,WAAZ,EAAyB,eAAzB,EAA0C,uBAA1C,CAAV;AACA,YAAI,OAAO,OAAX,EAAoB;AAClB,cAAI,gBAAJ,CAAqB,WAArB,EAAkC,UAAS,CAAT,EAAY;AAC5C,gBAAI,MAAM,EAAE,GAAZ;AACA,gBAAI,OAAO,eAAe,IAAf,CAAoB,GAApB,CAAX;AACA,gBAAI,QAAQ,gBAAgB,IAAhB,CAAqB,GAArB,CAAZ;;AAEA,gBAAI,QAAQ,KAAZ,EAAmB;AACjB,kBAAI,KAAJ;AACA,qBAAO,QAAQ,GAAR,CAAP;AACD,aAHD,MAGO;AACL,qBAAO,OAAO,uCAAP,CAAP;AACD;AACF,WAXD;AAYD,SAbD,MAaO;;AAEL,cAAI,YAAY,YAAY,YAAW;AACrC,gBAAI;AACF,kBAAI,IAAI,MAAR,EAAgB;AACd,8BAAc,SAAd;AACA,uBAAO,OAAO,iDAAP,CAAP;AACD;;AAED,kBAAI,CAAC,IAAI,QAAJ,CAAa,GAAb,CAAiB,OAAjB,CAAyB,cAAzB,MAA6C,CAAC,CAA9C,IAAmD,IAAI,QAAJ,CAAa,GAAb,CAAiB,OAAjB,CAAyB,MAAzB,MAAqC,CAAC,CAA1F,KAAgG,IAAI,QAAJ,CAAa,GAAb,CAAiB,OAAjB,CAAyB,SAAS,MAAlC,MAA8C,CAAC,CAAnJ,EAAsJ;AACpJ,uBAAO,aAAP,CAAqB,SAArB;AACA,oBAAI,MAAQ,IAAI,QAAJ,CAAa,GAAzB;;AAEA,oBAAI,KAAJ;AACA,uBAAO,QAAQ,GAAR,CAAP;AACD;AACF,aAbD,CAaE,OAAO,CAAP,EAAU;AACV;AACA,sBAAQ,GAAR,CAAY,CAAZ;AACD;AAEF,WAnBe,EAmBb,GAnBa,CAAhB;AAoBD;AAEF,OAxCM,CAAP;AAyCD;;;sCAEiB,Y,EAAc;AAC9B,UAAI,QAAQ,IAAZ;;AAEA,aAAO,IAAI,OAAJ,CAAY,UAAC,OAAD,EAAU,MAAV,EAAqB;AACtC,gBAAQ,GAAR,CAAY,kDAAZ,EAAgE,YAAhE;;AAEA,YAAI,qBAAJ;AACA,YAAI,mBAAJ;;AAEA,YAAI,WAAW,SAAX,QAAW,CAAC,KAAD,EAAW;AACxB,kBAAQ,GAAR,CAAY,mBAAZ,EAAiC,KAAjC;;AAEA,cAAM,aAAa,IAAI,UAAJ,CAAe,OAAf,CAAnB;AACA,mBAAS,aAAT,CAAuB,eAAvB,EAAwC,aAAxC,CAAsD,UAAtD;;AAEA,kBAAQ,EAAC,MAAM,UAAP,EAAmB,OAAO,KAA1B,EAAR;AACD,SAPD;;AASA,cAAM,kBAAN,CAAyB,YAAzB,EAAuC,IAAvC,CAA4C,UAAC,YAAD,EAAkB;AAC5D,yBAAe,aAAa,YAA5B;AACA,uBAAa,aAAa,UAA1B;;AAEA,YAAE,mBAAF,EAAuB,QAAvB,CAAgC,MAAhC;AACA,YAAE,qBAAF,EAAyB,WAAzB,CAAqC,MAArC;;AAEA,gBAAM,QAAN,CAAe,aAAa,IAA5B,EAAkC,QAAlC;;AAEA,gBAAM,gBAAN,CAAuB,aAAa,UAApC,EAAgD,UAAhD,EAA4D,IAA5D,CAAiE,UAAC,QAAD,EAAc;AAC7E,oBAAQ,GAAR,CAAY,mBAAZ,EAAiC,QAAjC;AACA,oBAAQ,EAAC,MAAM,UAAP,EAAmB,OAAO,QAA1B,EAAR;AACD,WAHD;;AAKA,cAAI,OAAO,EAAX;AACA,cAAI,cAAc,aAAa,IAA/B;;AAEA,sBAAY,OAAZ,CAAoB,UAAS,KAAT,EAAgB;AAClC,gBAAG,MAAM,IAAN,IAAc,MAAM,IAAN,IAAc,SAA/B,EAA0C;AACxC,mBAAK,IAAL,CAAU,MAAM,MAAhB;AACD;AACF,WAJD;;AAMA,YAAE,cAAF,EAAkB,IAAlB,CAAuB,MAAM,QAAN,CAAe,IAAf,CAAvB;AACA,YAAE,cAAF,EAAkB,GAAlB;AACA,YAAE,cAAF,EAAkB,EAAlB,CAAqB,OAArB,EAA8B,UAAC,KAAD;AAAA,mBAAW,MAAM,iBAAN,CAAwB,KAAxB,EAA+B,QAA/B,EAAyC,UAAzC,CAAX;AAAA,WAA9B;AACA;AACA,YAAE,mBAAF,EAAuB,GAAvB;AACA,YAAE,mBAAF,EAAuB,EAAvB,CAA0B,OAA1B,EAAmC,UAAC,KAAD;AAAA,mBAAW,MAAM,gBAAN,CAAuB,QAAvB,CAAX;AAAA,WAAnC;AACD,SA7BD;AA8BD,OA7CM,CAAP;AA8CD;;;uCAEkB,Y,EAAc;AAC/B,UAAI,QAAQ,IAAZ;AACA,aAAO,IAAI,OAAJ,CAAY,UAAC,OAAD,EAAU,MAAV,EAAqB;AACtC,YAAI,qBAAJ;AAAA,YAAkB,mBAAlB;AACA,YAAI,YAAJ,EAAkB;AAChB,yBAAe,YAAf;AACA,uBAAa,KAAb;AACA,kBAAQ,EAAC,cAAc,YAAf,EAA6B,YAAY,UAAzC,EAAR;AACD,SAJD,MAIO;AACL,uBAAa,IAAb;AACA,gBAAM,sBAAN,CAA6B,uBAA7B,EAAsD,EAAtD,EAA0D,IAA1D,CAA+D,UAAC,MAAD,EAAY;AACzE,oBAAQ,EAAC,cAAc,MAAf,EAAuB,YAAY,UAAnC,EAAR;AACD,WAFD;AAGD;AACF,OAZM,CAAP;AAaD;;;6BAEQ,I,EAAM,Q,EAAU;AAAA;;AAEvB,UAAI,WAAW,SAAS,cAAT,CAAwB,WAAxB,CAAf;;AAEA,WAAK,OAAL,CAAa,UAAC,GAAD,EAAS;;AAEpB,YAAM,SAAS,SAAS,aAAT,CAAuB,GAAvB,CAAf;AACA,eAAO,YAAP,CAAoB,UAApB,EAAgC,IAAI,MAApC;AACA,eAAO,SAAP,GAAmB,eAAnB;AACA,eAAO,IAAP,GAAc,GAAd;;AAEA,eAAO,gBAAP,CAAwB,OAAxB,EAAiC,UAAC,KAAD,EAAW;;AAE1C,gBAAM,cAAN;;AAEA,cAAM,KAAK,MAAM,aAAjB;AACA,cAAM,MAAM,GAAG,YAAH,CAAgB,UAAhB,CAAZ;;AAEA,iBAAK,YAAL,CAAkB,GAAlB,EAAuB,QAAvB;AAED,SATD;;AAWA,YAAM,aAAa,SAAS,cAAT,CAAwB,IAAI,MAA5B,CAAnB;;AAEA,YAAM,SAAS,SAAS,aAAT,CAAuB,GAAvB,CAAf;AACA,eAAO,SAAP,GAAmB,4CAAnB;AACA,eAAO,YAAP,CAAoB,aAApB,EAAmC,IAAnC;AACA,eAAO,WAAP,GAAqB,OAArB;;AAEA,eAAO,WAAP,CAAmB,MAAnB;AACA,eAAO,WAAP,CAAmB,UAAnB;;AAEA,iBAAS,WAAT,CAAqB,MAArB;AACD,OA7BD;AA+BD;;;qCAEgB,G,EAAK,U,EAAY;AAChC,UAAI,QAAQ,IAAZ;;AAEA;;AAEA,aAAO,IAAI,OAAJ,CAAY,UAAC,OAAD,EAAU,MAAV,EAAqB;;AAEtC,gBAAQ,GAAR,CAAY,qCAAZ,EAAmD,GAAnD;;AAEA,YAAI,aAAa,EAAjB;;AAEA,aAAK,IAAI,CAAT,IAAc,GAAd,EAAmB;AACjB,cAAI,SAAS,IAAI,CAAJ,EAAO,KAAP,CAAa,KAAb,CAAb;;AAEA,cAAI,aAAa,OAAO,CAAP,EAAU,KAAV,CAAgB,GAAhB,EAAqB,CAArB,CAAjB;AACA,cAAI,SAAS,IAAI,CAAJ,EAAO,OAAP,CAAe,MAAM,UAArB,EAAiC,EAAjC,CAAb;AACA,qBAAW,IAAX,CAAgB,EAAE,SAAS,IAAI,CAAJ,CAAX,EAAmB,QAAQ,MAA3B,EAAhB;AACD;;AAED,YAAI,mBAAmB,SAAS,cAAT,CAAwB,mBAAxB,CAAvB;;AAEA,mBAAW,OAAX,CAAmB,UAAC,GAAD,EAAS;;AAE1B,cAAM,SAAS,SAAS,aAAT,CAAuB,GAAvB,CAAf;AACA,iBAAO,SAAP,GAAmB,eAAnB;AACA,iBAAO,IAAP,GAAc,GAAd;;AAEA,cAAM,aAAa,SAAS,cAAT,CAAwB,IAAI,OAA5B,CAAnB;;AAEA,cAAM,SAAS,SAAS,aAAT,CAAuB,GAAvB,CAAf;AACA,iBAAO,SAAP,GAAmB,4CAAnB;AACA,iBAAO,YAAP,CAAoB,aAApB,EAAmC,IAAnC;AACA,iBAAO,WAAP,GAAqB,OAArB;;AAEA,iBAAO,WAAP,CAAmB,MAAnB;AACA,iBAAO,WAAP,CAAmB,UAAnB;;AAEA,2BAAiB,WAAjB,CAA6B,MAA7B;AAED,SAlBD;;AAoBA,YAAI,WAAW,MAAX,KAAsB,CAA1B,EAA6B;AAC3B,iBAAO,QAAQ,WAAW,CAAX,EAAc,OAAtB,CAAP;AACD;;AAED,YAAI,WAAW,MAAX,GAAoB,CAAxB,EAA2B;AACzB,cAAM,YAAY,IAAI,UAAJ,CAAe,OAAf,CAAlB;AACA,mBAAS,aAAT,CAAuB,eAAvB,EAAwC,aAAxC,CAAsD,SAAtD;AACD;;AAED,YAAI,WAAW,SAAX,QAAW,CAAC,QAAD,EAAc;AAC3B,kBAAQ,QAAR;AACD,SAFD;;AAIA,YAAI,CAAC,UAAL,EAAiB;AACf,YAAE,iBAAF,EAAqB,EAArB,CAAwB,OAAxB,EAAiC,UAAC,KAAD;AAAA,mBAAW,MAAM,QAAN,CAAe,KAAf,EAAsB,QAAtB,CAAX;AAAA,WAAjC;AACD;;AAED,UAAE,YAAF,EAAgB,EAAhB,CAAmB,OAAnB,EAA4B,UAAC,KAAD;AAAA,iBAAW,MAAM,QAAN,CAAe,GAAf,CAAX;AAAA,SAA5B;AAED,OAvDM,CAAP;AAwDD;;;6BAEQ,K,EAAO,M,EAAQ;AACtB,UAAI,QAAQ,IAAZ;AACA,UAAI,MAAM,MAAM,MAAN,CAAa,UAAb,CAAwB,UAAlC;AACA,UAAI,aAAa,IAAI,QAAJ,CAAa,CAAb,EAAgB,WAAjC;AACA,UAAI,SAAS,IAAI,QAAJ,CAAa,CAAb,EAAgB,WAA7B;;AAEA,YAAM,sBAAN,CAA6B,oBAA7B,EAAmD,EAAE,OAAO,UAAT,EAAnD,EAA0E,IAA1E,CAA+E,YAAM;AACnF,YAAI,YAAY,OAAO,MAAvB;AACA,aAAK,IAAI,IAAI,CAAb,EAAgB,IAAI,SAApB,EAA+B,GAA/B,EAAoC;AAClC,cAAI,OAAO,CAAP,EAAU,KAAV,KAAoB,UAAxB,EAAoC;AAClC,mBAAO,MAAP,CAAc,CAAd,EAAiB,CAAjB;AACA;AACD;AACF;;AAED;AACA,cAAM,gBAAN,CAAuB,MAAvB,EAA+B,IAA/B;AACD,OAXD;;AAaA;AAED;;;iCAEY,U,EAAY,Q,EAAU;AAAA;;AAEjC,cAAQ,GAAR,CAAY,UAAZ;;AAEA,UAAI,mBAAJ;AACA,WAAK,sBAAL,CAA4B,gBAA5B,EAA8C,EAA9C,EACG,IADH,CACQ,UAAC,SAAD,EAAe;AACnB,qBAAa,SAAb;AACA,YAAM,OAAO,EAAE,UAAU,SAAZ,EAAuB,QAAQ,QAA/B,EAAyC,cAAc,SAAvD,EAAkE,WAAW,UAA7E,EAAb;AACA,eAAO,OAAK,sBAAL,CAA4B,qBAA5B,EAAmD,IAAnD,CAAP;AACD,OALH,EAMG,IANH,CAMQ,UAAC,KAAD,EAAW;AACf,gBAAQ,GAAR,CAAY,mEAAmE,MAAM,QAAN,CAAe,SAAf,CAAyB,CAAzB,EAA4B,EAA5B,CAAnE,GAAqG,KAAjH;;AAEA,YAAI,MAAM,MAAM,QAAhB;AACA,YAAI,iBAAJ;;AAEA;AACA,YAAI,IAAI,OAAJ,CAAY,cAAZ,MAAgC,CAAC,CAArC,EAAwC;AACtC,cAAI,YAAY,IAAI,SAAJ,CAAc,CAAd,EAAiB,IAAI,OAAJ,CAAY,cAAZ,CAAjB,CAAhB;AACA,cAAI,gBAAgB,IAAI,SAAJ,CAAc,IAAI,OAAJ,CAAY,cAAZ,CAAd,EAA2C,IAAI,MAA/C,CAApB;;AAEA,cAAI,aAAa,cAAc,SAAd,CAAwB,cAAc,OAAd,CAAsB,GAAtB,CAAxB,EAAoD,IAAI,MAAxD,CAAjB;;AAEA;AACA,cAAI,WAAW,OAAX,CAAmB,GAAnB,MAA4B,CAAC,CAAjC,EAAoC;AAClC,uBAAW,YAAY,eAAZ,GAA8B,SAAS,MAAvC,GAAgD,UAA3D;AACD,WAFD,MAEO;AACL,uBAAW,YAAY,eAAZ,GAA8B,SAAS,MAAlD;AACD;AACF;;AAED,eAAK,SAAL,GAAiB,YAAY,GAA7B;;AAEA,gBAAQ,GAAR,CAAY,OAAZ,EAAqB,OAAK,SAA1B;;AAEA,eAAO,OAAK,iBAAL,CAAuB,UAAvB,EAAmC,KAAnC,EAA0C,QAA1C,EAAoD,UAApD,CAAP;AACD,OAhCH,EAgCK,IAhCL,CAgCU,UAAC,KAAD,EAAW;AACjB,gBAAQ,GAAR,CAAY,OAAZ,EAAqB,KAArB;AACA,iBAAS,KAAT;AACD,OAnCH;AAqCD;;;sCAEiB,K,EAAO,Q,EAAU,U,EAAY;AAC7C,UAAI,QAAQ,IAAZ;AACA,UAAI,aAAa,MAAM,MAAN,CAAa,WAA9B;AACA,UAAI,cAAc,MAAM,MAAN,CAAa,IAA/B;;AAEA,YAAM,sBAAN,CAA6B,gBAA7B,EAA+C,EAA/C,EAAmD,IAAnD,CAAwD,UAAC,SAAD,EAAe;AAC3E;;AAEM,cAAM,sBAAN,CAA6B,qBAA7B,EACE,EAAE,UAAU,SAAZ,EAAuB,QAAQ,QAA/B,EAAyC,cAAc,SAAvD;AACA,qBAAW,UADX,EADF,EAE4B,IAF5B,CAEiC,UAAC,KAAD,EAAW;AAC1C,kBAAQ,GAAR,CAAY,mEAAmE,MAAM,QAAN,CAAe,SAAf,CAAyB,CAAzB,EAA4B,EAA5B,CAAnE,GAAqG,KAAjH;;AAEA,cAAI,MAAM,MAAM,QAAhB;AACA,cAAI,iBAAJ;;AAEA;AACA,cAAI,IAAI,OAAJ,CAAY,cAAZ,MAAgC,CAAC,CAArC,EAAwC;AACtC,gBAAI,YAAY,IAAI,SAAJ,CAAc,CAAd,EAAiB,IAAI,OAAJ,CAAY,cAAZ,CAAjB,CAAhB;AACA,gBAAI,gBAAgB,IAAI,SAAJ,CAAc,IAAI,OAAJ,CAAY,cAAZ,CAAd,EAA2C,IAAI,MAA/C,CAApB;;AAEA,gBAAI,aAAa,cAAc,SAAd,CAAwB,cAAc,OAAd,CAAsB,GAAtB,CAAxB,EAAoD,IAAI,MAAxD,CAAjB;;AAEA;AACA,gBAAI,WAAW,OAAX,CAAmB,GAAnB,MAA4B,CAAC,CAAjC,EAAoC;AAClC,yBAAW,YAAY,eAAZ,GAA8B,SAAS,MAAvC,GAAgD,UAA3D;AACD,aAFD,MAEO;AACL,yBAAW,YAAY,eAAZ,GAA8B,SAAS,MAAlD;AACD;AACF;;AAED,gBAAM,SAAN,GAAkB,YAAY,GAA9B;;AAEA,YAAE,YAAF,EAAgB,IAAhB,CAAqB,oBAAoB,UAApB,GAAiC,MAAtD;AACA,YAAE,QAAF,EAAY,WAAZ,CAAwB,MAAxB;AACA,YAAE,YAAF,EAAgB,GAAhB;AACA,YAAE,YAAF,EAAgB,EAAhB,CAAmB,OAAnB,EAA4B,UAAC,KAAD,EAAW;AACrC,cAAE,QAAF,EAAY,QAAZ,CAAqB,MAArB;AACA,kBAAM,iBAAN,CAAwB,SAAxB,EAAmC,KAAnC,EAA0C,QAA1C,EAAoD,UAApD,EAAgE,IAAhE,CAAqE,UAAC,KAAD,EAAW;AAC9E,uBAAS,KAAT;AACA,oBAAM,iBAAN;AACD,aAHD;AAID,WAND;AAOD,SAnCD;AAoCD,OAvCD,EAuCG,KAvCH,CAuCS;AAAA,eAAO,QAAQ,GAAR,CAAY,sBAAZ,EAAoC,GAApC,CAAP;AAAA,OAvCT;AAyCD;;;6BAEQ,K,EAAO;AACd,UAAI,OAAO,EAAX;AACA,UAAI,WAAW,MAAM,MAArB;;AAEA,WAAK,IAAI,IAAI,CAAb,EAAgB,IAAI,QAApB,EAA8B,GAA9B,EAAmC;AACjC,gBAAQ,2BAAR;AACA,gBAAQ,iCAAiC,MAAM,CAAN,CAAjC,GAA4C,WAApD;AACD;;AAED,aAAO,IAAP;AACD;;;sCAEiB,S,EAAW,K,EAAO,M,EAAQ,U,EAAY;AACtD,UAAI,QAAQ,IAAZ;AACA,UAAI,MAAM,MAAM,SAAhB;;AAEA,aAAO,IAAI,OAAJ,CAAY,UAAC,OAAD,EAAU,MAAV,EAAqB;;AAEtC,cAAM,SAAN,CAAgB,GAAhB,EAAqB,IAArB,CAA0B,UAAC,QAAD,EAAc;;AAEtC,gBAAM,sBAAN,CAA6B,qBAA7B,EACE,EAAE,UAAU,SAAZ,EAAuB,QAAQ,MAA/B,EAAuC,cAAc,QAArD,EAA+D,WAAW,UAA1E,EADF,EAC0F,IAD1F,CAC+F,UAAC,MAAD,EAAY;;AAEzG,gBAAI,MAAJ,EAAY;;AAEX;AACA,oBAAM,sBAAN,CAA6B,cAA7B,EAA6C,MAA7C,EAAqD,IAArD,CAA0D,UAAC,KAAD,EAAW;AACnE,wBAAQ,MAAM,WAAN,CAAkB,OAA1B;AACD,eAFD,EAEG,UAAC,GAAD,EAAS;AACV,uBAAO,GAAP;AACD,eAJD;AAMA,aATD,MASO;AACN,qBAAO,yCAAP;AACA;AAEA,WAhBH;AAiBE,SAnBJ,EAmBM,UAAC,GAAD,EAAS;AACV,iBAAO,GAAP;AACJ,SArBD;AAsBD,OAxBM,CAAP;AAyBD;;;uCAEgB;AACjB,cAAQ,GAAR,CAAY,kBAAZ;AACD;;;;;;kBAKc,a","file":"identities-gui.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nfunction EventEmitter() {\n  this._events = this._events || {};\n  this._maxListeners = this._maxListeners || undefined;\n}\nmodule.exports = EventEmitter;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nEventEmitter.defaultMaxListeners = 10;\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function(n) {\n  if (!isNumber(n) || n < 0 || isNaN(n))\n    throw TypeError('n must be a positive number');\n  this._maxListeners = n;\n  return this;\n};\n\nEventEmitter.prototype.emit = function(type) {\n  var er, handler, len, args, i, listeners;\n\n  if (!this._events)\n    this._events = {};\n\n  // If there is no 'error' event listener then throw.\n  if (type === 'error') {\n    if (!this._events.error ||\n        (isObject(this._events.error) && !this._events.error.length)) {\n      er = arguments[1];\n      if (er instanceof Error) {\n        throw er; // Unhandled 'error' event\n      } else {\n        // At least give some kind of context to the user\n        var err = new Error('Uncaught, unspecified \"error\" event. (' + er + ')');\n        err.context = er;\n        throw err;\n      }\n    }\n  }\n\n  handler = this._events[type];\n\n  if (isUndefined(handler))\n    return false;\n\n  if (isFunction(handler)) {\n    switch (arguments.length) {\n      // fast cases\n      case 1:\n        handler.call(this);\n        break;\n      case 2:\n        handler.call(this, arguments[1]);\n        break;\n      case 3:\n        handler.call(this, arguments[1], arguments[2]);\n        break;\n      // slower\n      default:\n        args = Array.prototype.slice.call(arguments, 1);\n        handler.apply(this, args);\n    }\n  } else if (isObject(handler)) {\n    args = Array.prototype.slice.call(arguments, 1);\n    listeners = handler.slice();\n    len = listeners.length;\n    for (i = 0; i < len; i++)\n      listeners[i].apply(this, args);\n  }\n\n  return true;\n};\n\nEventEmitter.prototype.addListener = function(type, listener) {\n  var m;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events)\n    this._events = {};\n\n  // To avoid recursion in the case that type === \"newListener\"! Before\n  // adding it to the listeners, first emit \"newListener\".\n  if (this._events.newListener)\n    this.emit('newListener', type,\n              isFunction(listener.listener) ?\n              listener.listener : listener);\n\n  if (!this._events[type])\n    // Optimize the case of one listener. Don't need the extra array object.\n    this._events[type] = listener;\n  else if (isObject(this._events[type]))\n    // If we've already got an array, just append.\n    this._events[type].push(listener);\n  else\n    // Adding the second element, need to change to array.\n    this._events[type] = [this._events[type], listener];\n\n  // Check for listener leak\n  if (isObject(this._events[type]) && !this._events[type].warned) {\n    if (!isUndefined(this._maxListeners)) {\n      m = this._maxListeners;\n    } else {\n      m = EventEmitter.defaultMaxListeners;\n    }\n\n    if (m && m > 0 && this._events[type].length > m) {\n      this._events[type].warned = true;\n      console.error('(node) warning: possible EventEmitter memory ' +\n                    'leak detected. %d listeners added. ' +\n                    'Use emitter.setMaxListeners() to increase limit.',\n                    this._events[type].length);\n      if (typeof console.trace === 'function') {\n        // not supported in IE 10\n        console.trace();\n      }\n    }\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.once = function(type, listener) {\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  var fired = false;\n\n  function g() {\n    this.removeListener(type, g);\n\n    if (!fired) {\n      fired = true;\n      listener.apply(this, arguments);\n    }\n  }\n\n  g.listener = listener;\n  this.on(type, g);\n\n  return this;\n};\n\n// emits a 'removeListener' event iff the listener was removed\nEventEmitter.prototype.removeListener = function(type, listener) {\n  var list, position, length, i;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events || !this._events[type])\n    return this;\n\n  list = this._events[type];\n  length = list.length;\n  position = -1;\n\n  if (list === listener ||\n      (isFunction(list.listener) && list.listener === listener)) {\n    delete this._events[type];\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n\n  } else if (isObject(list)) {\n    for (i = length; i-- > 0;) {\n      if (list[i] === listener ||\n          (list[i].listener && list[i].listener === listener)) {\n        position = i;\n        break;\n      }\n    }\n\n    if (position < 0)\n      return this;\n\n    if (list.length === 1) {\n      list.length = 0;\n      delete this._events[type];\n    } else {\n      list.splice(position, 1);\n    }\n\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.removeAllListeners = function(type) {\n  var key, listeners;\n\n  if (!this._events)\n    return this;\n\n  // not listening for removeListener, no need to emit\n  if (!this._events.removeListener) {\n    if (arguments.length === 0)\n      this._events = {};\n    else if (this._events[type])\n      delete this._events[type];\n    return this;\n  }\n\n  // emit removeListener for all listeners on all events\n  if (arguments.length === 0) {\n    for (key in this._events) {\n      if (key === 'removeListener') continue;\n      this.removeAllListeners(key);\n    }\n    this.removeAllListeners('removeListener');\n    this._events = {};\n    return this;\n  }\n\n  listeners = this._events[type];\n\n  if (isFunction(listeners)) {\n    this.removeListener(type, listeners);\n  } else if (listeners) {\n    // LIFO order\n    while (listeners.length)\n      this.removeListener(type, listeners[listeners.length - 1]);\n  }\n  delete this._events[type];\n\n  return this;\n};\n\nEventEmitter.prototype.listeners = function(type) {\n  var ret;\n  if (!this._events || !this._events[type])\n    ret = [];\n  else if (isFunction(this._events[type]))\n    ret = [this._events[type]];\n  else\n    ret = this._events[type].slice();\n  return ret;\n};\n\nEventEmitter.prototype.listenerCount = function(type) {\n  if (this._events) {\n    var evlistener = this._events[type];\n\n    if (isFunction(evlistener))\n      return 1;\n    else if (evlistener)\n      return evlistener.length;\n  }\n  return 0;\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  return emitter.listenerCount(type);\n};\n\nfunction isFunction(arg) {\n  return typeof arg === 'function';\n}\n\nfunction isNumber(arg) {\n  return typeof arg === 'number';\n}\n\nfunction isObject(arg) {\n  return typeof arg === 'object' && arg !== null;\n}\n\nfunction isUndefined(arg) {\n  return arg === void 0;\n}\n","import { EventEmitter } from \"events\";\n\n// jshint browser:true, jquery: true\n\nclass IdentitiesGUI {\n\n  constructor(guiURL, idmURL, messageBus) {\n    //if (!identityModule) throw Error('Identity Module not set!');\n    if (!messageBus) throw Error('Message Bus not set!');\n    let _this = this;\n    _this._guiURL = guiURL;\n    _this._idmURL = idmURL;\n    _this._messageBus = messageBus;\n\n    const drawerEl = document.querySelector('.mdc-temporary-drawer');\n    const MDCTemporaryDrawer = mdc.drawer.MDCTemporaryDrawer;\n    const drawer = new MDCTemporaryDrawer(drawerEl);\n\n    this._drawerEl = drawerEl;\n\n    document.querySelector('.settings-btn').addEventListener('click', function() {\n      drawer.open = true;\n    });\n\n    drawerEl.addEventListener('MDCTemporaryDrawer:open', () => {\n      console.log('Received MDCTemporaryDrawer:open');\n\n      this._openDrawer();\n    });\n\n    drawerEl.addEventListener('MDCTemporaryDrawer:close', () => {\n      console.log('Received MDCTemporaryDrawer:close');\n\n      parent.postMessage({ body: { method: 'hideAdminPage' }, to: 'runtime:gui-manager' }, '*');\n\n    });\n\n  }\n\n  _openDrawer() {\n\n    let _this = this;\n    const guiURL = _this._guiURL;\n\n\n    _this.showIdentitiesGUI(msg.body.value).then((identityInfo) => {\n      let replyMsg;\n      console.log('[IdentitiesGUI] identityInfo from GUI: ', identityInfo);\n\n      //hide config page with the identity GUI\n      parent.postMessage({ body: { method: 'hideAdminPage' }, to: 'runtime:gui-manager' }, '*');\n      $('.admin-page').addClass('hide');\n\n      // document.getElementsByTagName('body')[0].style = 'background-color:transparent';\n      $('.identities-section').addClass('hide');\n      $('.policies-section').addClass('hide');\n\n      switch (identityInfo.type) {\n        case 'idp':\n          value = { type: 'idp', value: identityInfo.value, code: 200 };\n          replyMsg = { id: msg.id, type: 'response', to: msg.from, from: msg.to, body: value };\n          _this._messageBus.postMessage(replyMsg);\n          break;\n\n        case 'identity':\n          value = { type: 'identity', value: identityInfo.value, code: 200 };\n          replyMsg = { id: msg.id, type: 'response', to: msg.from, from: msg.to, body: value };\n          _this._messageBus.postMessage(replyMsg);\n          break;\n\n        default:\n          value = { type: 'error', value: 'Error on identity GUI', code: 400 };\n          replyMsg = { id: msg.id, type: 'response', to: msg.from, from: msg.to, body: value };\n          _this._messageBus.postMessage(replyMsg);\n      }\n    });\n\n    _this.callIdentityModuleFunc('deployGUI', {}).then(() => {\n      _this.resultURL  = undefined;\n\n      _this._messageBus.addListener(guiURL, msg => {\n\n        let identityInfo = msg.body.value;\n        let funcName = msg.body.method;\n        let value;\n        console.log('[IdentitiesGUI] received msg: ', msg);\n\n        if (funcName === 'openPopup') {\n          let urlreceived = msg.body.params.urlreceived;\n          _this.openPopup(urlreceived).then((returnedValue) => {\n            let value = {type: 'execute', value: returnedValue, code: 200};\n            let replyMsg = {id: msg.id, type: 'response', to: msg.from, from: msg.to, body: value};\n            _this._messageBus.postMessage(replyMsg);\n          });\n          return; // this avoids getting stuck in the identities page\n        }\n\n        // unhide the config page with the identity GUI\n        // document.getElementsByTagName('body')[0].style = 'background-color:white;';\n        parent.postMessage({ body: { method: 'showAdminPage' }, to: 'runtime:gui-manager' }, '*');\n\n        const clickOpen = new MouseEvent('click');\n        document.querySelector('.settings-btn').dispatchEvent(clickOpen);\n\n        $('.admin-page').removeClass('hide');\n\n      });\n\n    });\n\n  }\n\n  callIdentityModuleFunc(methodName, parameters) {\n    let _this = this;\n\n    return new Promise((resolve, reject) => {\n      const message = { type: 'execute', to: _this._idmURL, from: _this._guiURL,\n        body: { resource: 'identity', method: methodName, params: parameters }};\n\n      this._messageBus.postMessage(message, (res) => {\n        let result = res.body.value;\n        resolve(result);\n      });\n\n    });\n  }\n\n  openPopup(urlreceived) {\n\n    return new Promise((resolve, reject) => {\n\n      let win = window.open(urlreceived, 'openIDrequest', 'width=800, height=600');\n      if (window.cordova) {\n        win.addEventListener('loadstart', function(e) {\n          let url = e.url;\n          let code = /\\&code=(.+)$/.exec(url);\n          let error = /\\&error=(.+)$/.exec(url);\n\n          if (code || error) {\n            win.close();\n            return resolve(url);\n          } else {\n            return reject('openPopup error 1 - should not happen');\n          }\n        });\n      } else {\n\n        let pollTimer = setInterval(function() {\n          try {\n            if (win.closed) {\n              clearInterval(pollTimer);\n              return reject('Some error occured when trying to get identity.');\n            }\n\n            if ((win.document.URL.indexOf('access_token') !== -1 || win.document.URL.indexOf('code') !== -1) && win.document.URL.indexOf(location.origin) !== -1) {\n              window.clearInterval(pollTimer);\n              let url =   win.document.URL;\n\n              win.close();\n              return resolve(url);\n            }\n          } catch (e) {\n            //return reject('openPopup error 2 - should not happen');\n            console.log(e);\n          }\n\n        }, 500);\n      }\n\n    });\n  }\n\n  showIdentitiesGUI(receivedInfo) {\n    let _this = this;\n\n    return new Promise((resolve, reject) => {\n      console.log('[IdentitiesGUI.showIdentitiesGUI] receivedInfo: ', receivedInfo);\n\n      let identityInfo;\n      let toRemoveID;\n\n      let callback = (value) => {\n        console.log('chosen identity: ', value);\n\n        const clickClose = new MouseEvent('click');\n        document.querySelector('.settings-btn').dispatchEvent(clickClose);\n\n        resolve({type: 'identity', value: value});\n      };\n\n      _this._checkReceivedInfo(receivedInfo).then((resultObject) => {\n        identityInfo = resultObject.identityInfo;\n        toRemoveID = resultObject.toRemoveID;\n\n        $('.policies-section').addClass('hide');\n        $('.identities-section').removeClass('hide');\n\n        _this.showIdps(receivedInfo.idps, callback);\n\n        _this.showMyIdentities(identityInfo.identities, toRemoveID).then((identity) => {\n          console.log('chosen identity: ', identity);\n          resolve({type: 'identity', value: identity});\n        });\n\n        let idps = [];\n        let idpsObjects = identityInfo.idps;\n\n        idpsObjects.forEach(function(entry) {\n          if(entry.type && entry.type == 'idToken') {\n            idps.push(entry.domain);\n          }\n        });\n\n        $('#idproviders').html(_this._getList(idps));\n        $('#idproviders').off();\n        $('#idproviders').on('click', (event) => _this.obtainNewIdentity(event, callback, toRemoveID));\n        //$('.back').on('click', (event) => _this.goHome());\n        $('.identities-reset').off();\n        $('.identities-reset').on('click', (event) => _this._resetIdentities(callback));\n      });\n    });\n  }\n\n  _checkReceivedInfo(receivedInfo) {\n    let _this = this;\n    return new Promise((resolve, reject) => {\n      let identityInfo, toRemoveID;\n      if (receivedInfo) {\n        identityInfo = receivedInfo;\n        toRemoveID = false;\n        resolve({identityInfo: identityInfo, toRemoveID: toRemoveID});\n      } else {\n        toRemoveID = true;\n        _this.callIdentityModuleFunc('getIdentitiesToChoose', {}).then((result) => {\n          resolve({identityInfo: result, toRemoveID: toRemoveID});\n        });\n      }\n    });\n  }\n\n  showIdps(idps, callback) {\n\n    let idpsList = document.getElementById('idps-list');\n\n    idps.forEach((key) => {\n\n      const linkEl = document.createElement('a');\n      linkEl.setAttribute('data-idp', key.domain);\n      linkEl.classList = 'mdc-list-item';\n      linkEl.href = '#';\n\n      linkEl.addEventListener('click', (event) => {\n\n        event.preventDefault();\n\n        const el = event.currentTarget;\n        const idp = el.getAttribute('data-idp');\n\n        this.loginWithIDP(idp, callback);\n\n      });\n\n      const linkElText = document.createTextNode(key.domain);\n\n      const iconEl = document.createElement('i');\n      iconEl.classList = 'material-icons mdc-list-item__start-detail';\n      iconEl.setAttribute('aria-hidden', true);\n      iconEl.textContent = 'inbox';\n\n      linkEl.appendChild(iconEl);\n      linkEl.appendChild(linkElText);\n\n      idpsList.appendChild(linkEl);\n    });\n\n  }\n\n  showMyIdentities(iDs, toRemoveID) {\n    let _this = this;\n\n    // TODO: iDs should be replaced by user urls\n\n    return new Promise((resolve, reject) => {\n\n      console.log('[IdentitiesGUI.showMyIdentities] : ', iDs);\n\n      let identities = [];\n\n      for (let i in iDs) {\n        let split1 = iDs[i].split('://');\n\n        let identifier = split1[1].split('/')[1];\n        let domain = iDs[i].replace('/' + identifier, '');\n        identities.push({ userURL: iDs[i], domain: domain });\n      }\n\n      let activeIdentities = document.getElementById('active-identities');\n\n      identities.forEach((key) => {\n\n        const linkEl = document.createElement('a');\n        linkEl.classList = 'mdc-list-item';\n        linkEl.href = '#';\n\n        const linkElText = document.createTextNode(key.userURL);\n\n        const iconEl = document.createElement('i');\n        iconEl.classList = 'material-icons mdc-list-item__start-detail';\n        iconEl.setAttribute('aria-hidden', true);\n        iconEl.textContent = 'inbox';\n\n        linkEl.appendChild(iconEl);\n        linkEl.appendChild(linkElText);\n\n        activeIdentities.appendChild(linkEl);\n\n      });\n\n      if (identities.length === 1) {\n        return resolve(identities[0].userURL);\n      }\n\n      if (identities.length > 1) {\n        const clickOpen = new MouseEvent('click');\n        document.querySelector('.settings-btn').dispatchEvent(clickOpen);\n      }\n\n      let callback = (identity) => {\n        resolve(identity);\n      };\n\n      if (!toRemoveID) {\n        $('.clickable-cell').on('click', (event) => _this.changeID(event, callback));\n      }\n\n      $('.remove-id').on('click', (event) => _this.removeID(iDs));\n\n    });\n  }\n\n  removeID(event, emails) {\n    let _this = this;\n    let row = event.target.parentNode.parentNode;\n    let idToRemove = row.children[0].textContent;\n    let domain = row.children[1].textContent;\n\n    _this.callIdentityModuleFunc('unregisterIdentity', { email: idToRemove }).then(() => {\n      let numEmails = emails.length;\n      for (let i = 0; i < numEmails; i++) {\n        if (emails[i].email === idToRemove) {\n          emails.splice(i, 1);\n          break;\n        }\n      }\n\n      // -------------------------------------------------------------------------//\n      _this.showMyIdentities(emails, true);\n    });\n\n    //_this.identityModule.unregisterIdentity(idToRemove);\n\n  }\n\n  loginWithIDP(idProvider, callback) {\n\n    console.log(idProvider);\n\n    let _publicKey;\n    this.callIdentityModuleFunc('getMyPublicKey', {})\n      .then((publicKey) => {\n        _publicKey = publicKey;\n        const data = { contents: publicKey, origin: 'origin', usernameHint: undefined, idpDomain: idProvider };\n        return this.callIdentityModuleFunc('sendGenerateMessage', data);\n      })\n      .then((value) => {\n        console.log('[IdentitiesGUI.obtainNewIdentity] receivedURL from idp Proxy: ' + value.loginUrl.substring(0, 20) + '...');\n\n        let url = value.loginUrl;\n        let finalURL;\n\n        //check if the receivedURL contains the redirect field and replace it\n        if (url.indexOf('redirect_uri') !== -1) {\n          let firstPart = url.substring(0, url.indexOf('redirect_uri'));\n          let secondAuxPart = url.substring(url.indexOf('redirect_uri'), url.length);\n\n          let secondPart = secondAuxPart.substring(secondAuxPart.indexOf('&'), url.length);\n\n          //check if the reddirect field is the last field of the URL\n          if (secondPart.indexOf('&') !== -1) {\n            finalURL = firstPart + 'redirect_uri=' + location.origin + secondPart;\n          } else {\n            finalURL = firstPart + 'redirect_uri=' + location.origin;\n          }\n        }\n\n        this.resultURL = finalURL || url;\n\n        console.log('AQUI:', this.resultURL);\n\n        return this._authenticateUser(_publicKey, value, 'origin', idProvider);\n      }).then((email) => {\n        console.log('AQUI:', email);\n        callback(email);\n      });\n\n  }\n\n  obtainNewIdentity(event, callback, toRemoveID) {\n    let _this = this;\n    let idProvider = event.target.textContent;\n    let idProvider2 = event.target.text;\n\n    _this.callIdentityModuleFunc('getMyPublicKey', {}).then((publicKey) => {\n//      let publicKey = btoa(keyPair.public);\n\n      _this.callIdentityModuleFunc('sendGenerateMessage',\n        { contents: publicKey, origin: 'origin', usernameHint: undefined,\n        idpDomain: idProvider, }).then((value) => {\n        console.log('[IdentitiesGUI.obtainNewIdentity] receivedURL from idp Proxy: ' + value.loginUrl.substring(0, 20) + '...');\n\n        let url = value.loginUrl;\n        let finalURL;\n\n        //check if the receivedURL contains the redirect field and replace it\n        if (url.indexOf('redirect_uri') !== -1) {\n          let firstPart = url.substring(0, url.indexOf('redirect_uri'));\n          let secondAuxPart = url.substring(url.indexOf('redirect_uri'), url.length);\n\n          let secondPart = secondAuxPart.substring(secondAuxPart.indexOf('&'), url.length);\n\n          //check if the reddirect field is the last field of the URL\n          if (secondPart.indexOf('&') !== -1) {\n            finalURL = firstPart + 'redirect_uri=' + location.origin + secondPart;\n          } else {\n            finalURL = firstPart + 'redirect_uri=' + location.origin;\n          }\n        }\n\n        _this.resultURL = finalURL || url;\n\n        $('.login-idp').html('<p>Chosen IDP: ' + idProvider + '</p>');\n        $('.login').removeClass('hide');\n        $('.login-btn').off();\n        $('.login-btn').on('click', (event) => {\n          $('.login').addClass('hide');\n          _this._authenticateUser(publicKey, value, 'origin', idProvider).then((email) => {\n            callback(email);\n            _this.showIdentitiesGUI();\n          });\n        });\n      });\n    }).catch(err => console.log('obtanin new identity', err));\n\n  }\n\n  _getList(items) {\n    let list = '';\n    let numItems = items.length;\n\n    for (let i = 0; i < numItems; i++) {\n      list += '<li class=\"divider\"></li>';\n      list += '<li><a class=\"center-align\">' + items[i] + '</a></li>';\n    }\n\n    return list;\n  }\n\n  _authenticateUser(publicKey, value, origin, idProvider) {\n    let _this = this;\n    let url = _this.resultURL;\n\n    return new Promise((resolve, reject) => {\n\n      _this.openPopup(url).then((identity) => {\n\n        _this.callIdentityModuleFunc('sendGenerateMessage',\n          { contents: publicKey, origin: origin, usernameHint: identity, idpDomain: idProvider }).then((result) => {\n\n          if (result) {\n\n           //_this.identityModule.storeIdentity(result, keyPair).then((value) => {\n           _this.callIdentityModuleFunc('addAssertion', result).then((value) => {\n             resolve(value.userProfile.userURL);\n           }, (err) => {\n             reject(err);\n           });\n\n          } else {\n           reject('error on obtaining identity information');\n          }\n\n          });\n         }, (err) => {\n           reject(err);\n      });\n    });\n  }\n\n_resetIdentities() {\n  console.log('_resetIdentities');\n}\n\n\n}\n\nexport default IdentitiesGUI;\n"],"preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJub2RlX21vZHVsZXMvZXZlbnRzL2V2ZW50cy5qcyIsInNyYy9hZG1pbi9JZGVudGl0aWVzR1VJLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7O0FDOVNBOzs7O0FBRUE7O0lBRU0sYTtBQUVKLHlCQUFZLE1BQVosRUFBb0IsTUFBcEIsRUFBNEIsVUFBNUIsRUFBd0M7QUFBQTs7QUFBQTs7QUFDdEM7QUFDQSxRQUFJLENBQUMsVUFBTCxFQUFpQixNQUFNLE1BQU0s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QUFDLE9BQUQsRUFBVSxNQUFWLEVBQXFCOztBQUV0QyxjQUFNLFNBQU4sQ0FBZ0IsR0FBaEIsRUFBcUIsSUFBckIsQ0FBMEIsVUFBQyxRQUFELEVBQWM7O0FBRXRDLGdCQUFNLHNCQUFOLENBQTZCLHFCQUE3QixFQUNFLEVBQUUsVUFBVSxTQUFaLEVBQXVCLFFBQVEsTUFBL0IsRUFBdUMsY0FBYyxRQUFyRCxFQUErRCxXQUFXLFVBQTFFLEVBREYsRUFDMEYsSUFEMUYsQ0FDK0YsVUFBQyxNQUFELEVBQVk7O0FBRXpHLGdCQUFJLE1BQUosRUFBWTs7QUFFWDtBQUNBLG9CQUFNLHNCQUFOLENBQTZCLGNBQTdCLEVBQTZDLE1BQTdDLEVBQXFELElBQXJELENBQTBELFVBQUMsS0FBRCxFQUFXO0FBQ25FLHdCQUFRLE1BQU0sV0FBTixDQUFrQixPQUExQjtBQUNELGVBRkQsRUFFRyxVQUFDLEdBQUQsRUFBUztBQUNWLHVCQUFPLEdBQVA7QUFDRCxlQUpEO0FBTUEsYUFURCxNQVNPO0FBQ04scUJBQU8seUNBQVA7QUFDQTtBQUVBLFdBaEJIO0FBaUJFLFNBbkJKLEVBbUJNLFVBQUMsR0FBRCxFQUFTO0FBQ1YsaUJBQU8sR0FBUDtBQUNKLFNBckJEO0FBc0JELE9BeEJNLENBQVA7QUF5QkQ7Ozt1Q0FFZ0I7QUFDakIsY0FBUSxHQUFSLENBQVksa0JBQVo7QUFDRDs7Ozs7O2tCQUtjLGEiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiLy8gQ29weXJpZ2h0IEpveWVudCwgSW5jLiBhbmQgb3RoZXIgTm9kZSBjb250cmlidXRvcnMuXG4vL1xuLy8gUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGFcbi8vIGNvcHkgb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGVcbi8vIFwiU29mdHdhcmVcIiksIHRvIGRlYWwgaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZ1xuLy8gd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHMgdG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLFxuLy8gZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGwgY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdFxuLy8gcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpcyBmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlXG4vLyBmb2xsb3dpbmcgY29uZGl0aW9uczpcbi8vXG4vLyBUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZFxuLy8gaW4gYWxsIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuXG4vL1xuLy8gVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTU1xuLy8gT1IgSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRlxuLy8gTUVSQ0hBTlRBQklMSVRZLCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTlxuLy8gTk8gRVZFTlQgU0hBTEwgVEhFIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sXG4vLyBEQU1BR0VTIE9SIE9USEVSIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1Jcbi8vIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLCBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEVcbi8vIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTiBUSEUgU09GVFdBUkUuXG5cbmZ1bmN0aW9uIEV2ZW50RW1pdHRlcigpIHtcbiAgdGhpcy5fZXZlbnRzID0gdGhpcy5fZXZlbnRzIHx8IHt9O1xuICB0aGlzLl9tYXhMaXN0ZW5lcnMgPSB0aGlzLl9tYXhMaXN0ZW5lcnMgfHwgdW5kZWZpbmVkO1xufVxubW9kdWxlLmV4cG9ydHMgPSBFdmVudEVtaXR0ZXI7XG5cbi8vIEJhY2t3YXJkcy1jb21wYXQgd2l0aCBub2RlIDAuMTAueFxuRXZlbnRFbWl0dGVyLkV2ZW50RW1pdHRlciA9IEV2ZW50RW1pdHRlcjtcblxuRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5fZXZlbnRzID0gdW5kZWZpbmVkO1xuRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5fbWF4TGlzdGVuZXJzID0gdW5kZWZpbmVkO1xuXG4vLyBCeSBkZWZhdWx0IEV2ZW50RW1pdHRlcnMgd2lsbCBwcmludCBhIHdhcm5pbmcgaWYgbW9yZSB0aGFuIDEwIGxpc3RlbmVycyBhcmVcbi8vIGFkZGVkIHRvIGl0LiBUaGlzIGlzIGEgdXNlZnVsIGRlZmF1bHQgd2hpY2ggaGVscHMgZmluZGluZyBtZW1vcnkgbGVha3MuXG5FdmVudEVtaXR0ZXIuZGVmYXVsdE1heExpc3RlbmVycyA9IDEwO1xuXG4vLyBPYnZpb3VzbHkgbm90IGFsbCBFbWl0dGVycyBzaG91bGQgYmUgbGltaXRlZCB0byAxMC4gVGhpcyBmdW5jdGlvbiBhbGxvd3Ncbi8vIHRoYXQgdG8gYmUgaW5jcmVhc2VkLiBTZXQgdG8gemVybyBmb3IgdW5saW1pdGVkLlxuRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5zZXRNYXhMaXN0ZW5lcnMgPSBmdW5jdGlvbihuKSB7XG4gIGlmICghaXNOdW1iZXIobikgfHwgbiA8IDAgfHwgaXNOYU4obikpXG4gICAgdGhyb3cgVHlwZUVycm9yKCduIG11c3QgYmUgYSBwb3NpdGl2ZSBudW1iZXInKTtcbiAgdGhpcy5fbWF4TGlzdGVuZXJzID0gbjtcbiAgcmV0dXJuIHRoaXM7XG59O1xuXG5FdmVudEVtaXR0ZXIucHJvdG90eXBlLmVtaXQgPSBmdW5jdGlvbih0eXBlKSB7XG4gIHZhciBlciwgaGFuZGxlciwgbGVuLCBhcmdzLCBpLCBsaXN0ZW5lcnM7XG5cbiAgaWYgKCF0aGlzLl9ldmVudHMpXG4gICAgdGhpcy5fZXZlbnRzID0ge307XG5cbiAgLy8gSWYgdGhlcmUgaXMgbm8gJ2Vycm9yJyBldmVudCBsaXN0ZW5lciB0aGVuIHRocm93LlxuICBpZiAodHlwZSA9PT0gJ2Vycm9yJykge1xuICAgIGlmICghdGhpcy5fZXZlbnRzLmVycm9yIHx8XG4gICAgICAgIChpc09iamVjdCh0aGlzLl9ldmVudHMuZXJyb3IpICYmICF0aGlzLl9ldmVudHMuZXJyb3IubGVuZ3RoKSkge1xuICAgICAgZXIgPSBhcmd1bWVudHNbMV07XG4gICAgICBpZiAoZXIgaW5zdGFuY2VvZiBFcnJvcikge1xuICAgICAgICB0aHJvdyBlcjsgLy8gVW5oYW5kbGVkICdlcnJvcicgZXZlbnRcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIEF0IGxlYXN0IGdpdmUgc29tZSBraW5kIG9mIGNvbnRleHQgdG8gdGhlIHVzZXJcbiAgICAgICAgdmFyIGVyciA9IG5ldyBFcnJvcignVW5jYXVnaHQsIHVuc3BlY2lmaWVkIFwiZXJyb3JcIiBldmVudC4gKCcgKyBlciArICcpJyk7XG4gICAgICAgIGVyci5jb250ZXh0ID0gZXI7XG4gICAgICAgIHRocm93IGVycjtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBoYW5kbGVyID0gdGhpcy5fZXZlbnRzW3R5cGVdO1xuXG4gIGlmIChpc1VuZGVmaW5lZChoYW5kbGVyKSlcbiAgICByZXR1cm4gZmFsc2U7XG5cbiAgaWYgKGlzRnVuY3Rpb24oaGFuZGxlcikpIHtcbiAgICBzd2l0Y2ggKGFyZ3VtZW50cy5sZW5ndGgpIHtcbiAgICAgIC8vIGZhc3QgY2FzZXNcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgaGFuZGxlci5jYWxsKHRoaXMpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgaGFuZGxlci5jYWxsKHRoaXMsIGFyZ3VtZW50c1sxXSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAzOlxuICAgICAgICBoYW5kbGVyLmNhbGwodGhpcywgYXJndW1lbnRzWzFdLCBhcmd1bWVudHNbMl0pO1xuICAgICAgICBicmVhaztcbiAgICAgIC8vIHNsb3dlclxuICAgICAgZGVmYXVsdDpcbiAgICAgICAgYXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMSk7XG4gICAgICAgIGhhbmRsZXIuYXBwbHkodGhpcywgYXJncyk7XG4gICAgfVxuICB9IGVsc2UgaWYgKGlzT2JqZWN0KGhhbmRsZXIpKSB7XG4gICAgYXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMSk7XG4gICAgbGlzdGVuZXJzID0gaGFuZGxlci5zbGljZSgpO1xuICAgIGxlbiA9IGxpc3RlbmVycy5sZW5ndGg7XG4gICAgZm9yIChpID0gMDsgaSA8IGxlbjsgaSsrKVxuICAgICAgbGlzdGVuZXJzW2ldLmFwcGx5KHRoaXMsIGFyZ3MpO1xuICB9XG5cbiAgcmV0dXJuIHRydWU7XG59O1xuXG5FdmVudEVtaXR0ZXIucHJvdG90eXBlLmFkZExpc3RlbmVyID0gZnVuY3Rpb24odHlwZSwgbGlzdGVuZXIpIHtcbiAgdmFyIG07XG5cbiAgaWYgKCFpc0Z1bmN0aW9uKGxpc3RlbmVyKSlcbiAgICB0aHJvdyBUeXBlRXJyb3IoJ2xpc3RlbmVyIG11c3QgYmUgYSBmdW5jdGlvbicpO1xuXG4gIGlmICghdGhpcy5fZXZlbnRzKVxuICAgIHRoaXMuX2V2ZW50cyA9IHt9O1xuXG4gIC8vIFRvIGF2b2lkIHJlY3Vyc2lvbiBpbiB0aGUgY2FzZSB0aGF0IHR5cGUgPT09IFwibmV3TGlzdGVuZXJcIiEgQmVmb3JlXG4gIC8vIGFkZGluZyBpdCB0byB0aGUgbGlzdGVuZXJzLCBmaXJzdCBlbWl0IFwibmV3TGlzdGVuZXJcIi5cbiAgaWYgKHRoaXMuX2V2ZW50cy5uZXdMaXN0ZW5lcilcbiAgICB0aGlzLmVtaXQoJ25ld0xpc3RlbmVyJywgdHlwZSxcbiAgICAgICAgICAgICAgaXNGdW5jdGlvbihsaXN0ZW5lci5saXN0ZW5lcikgP1xuICAgICAgICAgICAgICBsaXN0ZW5lci5saXN0ZW5lciA6IGxpc3RlbmVyKTtcblxuICBpZiAoIXRoaXMuX2V2ZW50c1t0eXBlXSlcbiAgICAvLyBPcHRpbWl6ZSB0aGUgY2FzZSBvZiBvbmUgbGlzdGVuZXIuIERvbid0IG5lZWQgdGhlIGV4dHJhIGFycmF5IG9iamVjdC5cbiAgICB0aGlzLl9ldmVudHNbdHlwZV0gPSBsaXN0ZW5lcjtcbiAgZWxzZSBpZiAoaXNPYmplY3QodGhpcy5fZXZlbnRzW3R5cGVdKSlcbiAgICAvLyBJZiB3ZSd2ZSBhbHJlYWR5IGdvdCBhbiBhcnJheSwganVzdCBhcHBlbmQuXG4gICAgdGhpcy5fZXZlbnRzW3R5cGVdLnB1c2gobGlzdGVuZXIpO1xuICBlbHNlXG4gICAgLy8gQWRkaW5nIHRoZSBzZWNvbmQgZWxlbWVudCwgbmVlZCB0byBjaGFuZ2UgdG8gYXJyYXkuXG4gICAgdGhpcy5fZXZlbnRzW3R5cGVdID0gW3RoaXMuX2V2ZW50c1t0eXBlXSwgbGlzdGVuZXJdO1xuXG4gIC8vIENoZWNrIGZvciBsaXN0ZW5lciBsZWFrXG4gIGlmIChpc09iamVjdCh0aGlzLl9ldmVudHNbdHlwZV0pICYmICF0aGlzLl9ldmVudHNbdHlwZV0ud2FybmVkKSB7XG4gICAgaWYgKCFpc1VuZGVmaW5lZCh0aGlzLl9tYXhMaXN0ZW5lcnMpKSB7XG4gICAgICBtID0gdGhpcy5fbWF4TGlzdGVuZXJzO1xuICAgIH0gZWxzZSB7XG4gICAgICBtID0gRXZlbnRFbWl0dGVyLmRlZmF1bHRNYXhMaXN0ZW5lcnM7XG4gICAgfVxuXG4gICAgaWYgKG0gJiYgbSA+IDAgJiYgdGhpcy5fZXZlbnRzW3R5cGVdLmxlbmd0aCA+IG0pIHtcbiAgICAgIHRoaXMuX2V2ZW50c1t0eXBlXS53YXJuZWQgPSB0cnVlO1xuICAgICAgY29uc29sZS5lcnJvcignKG5vZGUpIHdhcm5pbmc6IHBvc3NpYmxlIEV2ZW50RW1pdHRlciBtZW1vcnkgJyArXG4gICAgICAgICAgICAgICAgICAgICdsZWFrIGRldGVjdGVkLiAlZCBsaXN0ZW5lcnMgYWRkZWQuICcgK1xuICAgICAgICAgICAgICAgICAgICAnVXNlIGVtaXR0ZXIuc2V0TWF4TGlzdGVuZXJzKCkgdG8gaW5jcmVhc2UgbGltaXQuJyxcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZXZlbnRzW3R5cGVdLmxlbmd0aCk7XG4gICAgICBpZiAodHlwZW9mIGNvbnNvbGUudHJhY2UgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgLy8gbm90IHN1cHBvcnRlZCBpbiBJRSAxMFxuICAgICAgICBjb25zb2xlLnRyYWNlKCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHRoaXM7XG59O1xuXG5FdmVudEVtaXR0ZXIucHJvdG90eXBlLm9uID0gRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5hZGRMaXN0ZW5lcjtcblxuRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5vbmNlID0gZnVuY3Rpb24odHlwZSwgbGlzdGVuZXIpIHtcbiAgaWYgKCFpc0Z1bmN0aW9uKGxpc3RlbmVyKSlcbiAgICB0aHJvdyBUeXBlRXJyb3IoJ2xpc3RlbmVyIG11c3QgYmUgYSBmdW5jdGlvbicpO1xuXG4gIHZhciBmaXJlZCA9IGZhbHNlO1xuXG4gIGZ1bmN0aW9uIGcoKSB7XG4gICAgdGhpcy5yZW1vdmVMaXN0ZW5lcih0eXBlLCBnKTtcblxuICAgIGlmICghZmlyZWQpIHtcbiAgICAgIGZpcmVkID0gdHJ1ZTtcbiAgICAgIGxpc3RlbmVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgfVxuICB9XG5cbiAgZy5saXN0ZW5lciA9IGxpc3RlbmVyO1xuICB0aGlzLm9uKHR5cGUsIGcpO1xuXG4gIHJldHVybiB0aGlzO1xufTtcblxuLy8gZW1pdHMgYSAncmVtb3ZlTGlzdGVuZXInIGV2ZW50IGlmZiB0aGUgbGlzdGVuZXIgd2FzIHJlbW92ZWRcbkV2ZW50RW1pdHRlci5wcm90b3R5cGUucmVtb3ZlTGlzdGVuZXIgPSBmdW5jdGlvbih0eXBlLCBsaXN0ZW5lcikge1xuICB2YXIgbGlzdCwgcG9zaXRpb24sIGxlbmd0aCwgaTtcblxuICBpZiAoIWlzRnVuY3Rpb24obGlzdGVuZXIpKVxuICAgIHRocm93IFR5cGVFcnJvcignbGlzdGVuZXIgbXVzdCBiZSBhIGZ1bmN0aW9uJyk7XG5cbiAgaWYgKCF0aGlzLl9ldmVudHMgfHwgIXRoaXMuX2V2ZW50c1t0eXBlXSlcbiAgICByZXR1cm4gdGhpcztcblxuICBsaXN0ID0gdGhpcy5fZXZlbnRzW3R5cGVdO1xuICBsZW5ndGggPSBsaXN0Lmxlbmd0aDtcbiAgcG9zaXRpb24gPSAtMTtcblxuICBpZiAobGlzdCA9PT0gbGlzdGVuZXIgfHxcbiAgICAgIChpc0Z1bmN0aW9uKGxpc3QubGlzdGVuZXIpICYmIGxpc3QubGlzdGVuZXIgPT09IGxpc3RlbmVyKSkge1xuICAgIGRlbGV0ZSB0aGlzLl9ldmVudHNbdHlwZV07XG4gICAgaWYgKHRoaXMuX2V2ZW50cy5yZW1vdmVMaXN0ZW5lcilcbiAgICAgIHRoaXMuZW1pdCgncmVtb3ZlTGlzdGVuZXInLCB0eXBlLCBsaXN0ZW5lcik7XG5cbiAgfSBlbHNlIGlmIChpc09iamVjdChsaXN0KSkge1xuICAgIGZvciAoaSA9IGxlbmd0aDsgaS0tID4gMDspIHtcbiAgICAgIGlmIChsaXN0W2ldID09PSBsaXN0ZW5lciB8fFxuICAgICAgICAgIChsaXN0W2ldLmxpc3RlbmVyICYmIGxpc3RbaV0ubGlzdGVuZXIgPT09IGxpc3RlbmVyKSkge1xuICAgICAgICBwb3NpdGlvbiA9IGk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChwb3NpdGlvbiA8IDApXG4gICAgICByZXR1cm4gdGhpcztcblxuICAgIGlmIChsaXN0Lmxlbmd0aCA9PT0gMSkge1xuICAgICAgbGlzdC5sZW5ndGggPSAwO1xuICAgICAgZGVsZXRlIHRoaXMuX2V2ZW50c1t0eXBlXTtcbiAgICB9IGVsc2Uge1xuICAgICAgbGlzdC5zcGxpY2UocG9zaXRpb24sIDEpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLl9ldmVudHMucmVtb3ZlTGlzdGVuZXIpXG4gICAgICB0aGlzLmVtaXQoJ3JlbW92ZUxpc3RlbmVyJywgdHlwZSwgbGlzdGVuZXIpO1xuICB9XG5cbiAgcmV0dXJuIHRoaXM7XG59O1xuXG5FdmVudEVtaXR0ZXIucHJvdG90eXBlLnJlbW92ZUFsbExpc3RlbmVycyA9IGZ1bmN0aW9uKHR5cGUpIHtcbiAgdmFyIGtleSwgbGlzdGVuZXJzO1xuXG4gIGlmICghdGhpcy5fZXZlbnRzKVxuICAgIHJldHVybiB0aGlzO1xuXG4gIC8vIG5vdCBsaXN0ZW5pbmcgZm9yIHJlbW92ZUxpc3RlbmVyLCBubyBuZWVkIHRvIGVtaXRcbiAgaWYgKCF0aGlzLl9ldmVudHMucmVtb3ZlTGlzdGVuZXIpIHtcbiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMClcbiAgICAgIHRoaXMuX2V2ZW50cyA9IHt9O1xuICAgIGVsc2UgaWYgKHRoaXMuX2V2ZW50c1t0eXBlXSlcbiAgICAgIGRlbGV0ZSB0aGlzLl9ldmVudHNbdHlwZV07XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICAvLyBlbWl0IHJlbW92ZUxpc3RlbmVyIGZvciBhbGwgbGlzdGVuZXJzIG9uIGFsbCBldmVudHNcbiAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDApIHtcbiAgICBmb3IgKGtleSBpbiB0aGlzLl9ldmVudHMpIHtcbiAgICAgIGlmIChrZXkgPT09ICdyZW1vdmVMaXN0ZW5lcicpIGNvbnRpbnVlO1xuICAgICAgdGhpcy5yZW1vdmVBbGxMaXN0ZW5lcnMoa2V5KTtcbiAgICB9XG4gICAgdGhpcy5yZW1vdmVBbGxMaXN0ZW5lcnMoJ3JlbW92ZUxpc3RlbmVyJyk7XG4gICAgdGhpcy5fZXZlbnRzID0ge307XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBsaXN0ZW5lcnMgPSB0aGlzLl9ldmVudHNbdHlwZV07XG5cbiAgaWYgKGlzRnVuY3Rpb24obGlzdGVuZXJzKSkge1xuICAgIHRoaXMucmVtb3ZlTGlzdGVuZXIodHlwZSwgbGlzdGVuZXJzKTtcbiAgfSBlbHNlIGlmIChsaXN0ZW5lcnMpIHtcbiAgICAvLyBMSUZPIG9yZGVyXG4gICAgd2hpbGUgKGxpc3RlbmVycy5sZW5ndGgpXG4gICAgICB0aGlzLnJlbW92ZUxpc3RlbmVyKHR5cGUsIGxpc3RlbmVyc1tsaXN0ZW5lcnMubGVuZ3RoIC0gMV0pO1xuICB9XG4gIGRlbGV0ZSB0aGlzLl9ldmVudHNbdHlwZV07XG5cbiAgcmV0dXJuIHRoaXM7XG59O1xuXG5FdmVudEVtaXR0ZXIucHJvdG90eXBlLmxpc3RlbmVycyA9IGZ1bmN0aW9uKHR5cGUpIHtcbiAgdmFyIHJldDtcbiAgaWYgKCF0aGlzLl9ldmVudHMgfHwgIXRoaXMuX2V2ZW50c1t0eXBlXSlcbiAgICByZXQgPSBbXTtcbiAgZWxzZSBpZiAoaXNGdW5jdGlvbih0aGlzLl9ldmVudHNbdHlwZV0pKVxuICAgIHJldCA9IFt0aGlzLl9ldmVudHNbdHlwZV1dO1xuICBlbHNlXG4gICAgcmV0ID0gdGhpcy5fZXZlbnRzW3R5cGVdLnNsaWNlKCk7XG4gIHJldHVybiByZXQ7XG59O1xuXG5FdmVudEVtaXR0ZXIucHJvdG90eXBlLmxpc3RlbmVyQ291bnQgPSBmdW5jdGlvbih0eXBlKSB7XG4gIGlmICh0aGlzLl9ldmVudHMpIHtcbiAgICB2YXIgZXZsaXN0ZW5lciA9IHRoaXMuX2V2ZW50c1t0eXBlXTtcblxuICAgIGlmIChpc0Z1bmN0aW9uKGV2bGlzdGVuZXIpKVxuICAgICAgcmV0dXJuIDE7XG4gICAgZWxzZSBpZiAoZXZsaXN0ZW5lcilcbiAgICAgIHJldHVybiBldmxpc3RlbmVyLmxlbmd0aDtcbiAgfVxuICByZXR1cm4gMDtcbn07XG5cbkV2ZW50RW1pdHRlci5saXN0ZW5lckNvdW50ID0gZnVuY3Rpb24oZW1pdHRlciwgdHlwZSkge1xuICByZXR1cm4gZW1pdHRlci5saXN0ZW5lckNvdW50KHR5cGUpO1xufTtcblxuZnVuY3Rpb24gaXNGdW5jdGlvbihhcmcpIHtcbiAgcmV0dXJuIHR5cGVvZiBhcmcgPT09ICdmdW5jdGlvbic7XG59XG5cbmZ1bmN0aW9uIGlzTnVtYmVyKGFyZykge1xuICByZXR1cm4gdHlwZW9mIGFyZyA9PT0gJ251bWJlcic7XG59XG5cbmZ1bmN0aW9uIGlzT2JqZWN0KGFyZykge1xuICByZXR1cm4gdHlwZW9mIGFyZyA9PT0gJ29iamVjdCcgJiYgYXJnICE9PSBudWxsO1xufVxuXG5mdW5jdGlvbiBpc1VuZGVmaW5lZChhcmcpIHtcbiAgcmV0dXJuIGFyZyA9PT0gdm9pZCAwO1xufVxuIiwiaW1wb3J0IHsgRXZlbnRFbWl0dGVyIH0gZnJvbSBcImV2ZW50c1wiO1xuXG4vLyBqc2hpbnQgYnJvd3Nlcjp0cnVlLCBqcXVlcnk6IHRydWVcblxuY2xhc3MgSWRlbnRpdGllc0dVSSB7XG5cbiAgY29uc3RydWN0b3IoZ3VpVVJMLCBpZG1VUkwsIG1lc3NhZ2VCdXMpIHtcbiAgICAvL2lmICghaWRlbnRpdHlNb2R1bGUpIHRocm93IEVycm9yKCdJZGVudGl0eSBNb2R1bGUgbm90IHNldCEnKTtcbiAgICBpZiAoIW1lc3NhZ2VCdXMpIHRocm93IEVycm9yKCdNZXNzYWdlIEJ1cyBub3Qgc2V0IScpO1xuICAgIGxldCBfdGhpcyA9IHRoaXM7XG4gICAgX3RoaXMuX2d1aVVSTCA9IGd1aVVSTDtcbiAgICBfdGhpcy5faWRtVVJMID0gaWRtVVJMO1xuICAgIF90aGlzLl9tZXNzYWdlQnVzID0gbWVzc2FnZUJ1cztcblxuICAgIGNvbnN0IGRyYXdlckVsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1kYy10ZW1wb3JhcnktZHJhd2VyJyk7XG4gICAgY29uc3QgTURDVGVtcG9yYXJ5RHJhd2VyID0gbWRjLmRyYXdlci5NRENUZW1wb3JhcnlEcmF3ZXI7XG4gICAgY29uc3QgZHJhd2VyID0gbmV3IE1EQ1RlbXBvcmFyeURyYXdlcihkcmF3ZXJFbCk7XG5cbiAgICB0aGlzLl9kcmF3ZXJFbCA9IGRyYXdlckVsO1xuXG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNldHRpbmdzLWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG4gICAgICBkcmF3ZXIub3BlbiA9IHRydWU7XG4gICAgfSk7XG5cbiAgICBkcmF3ZXJFbC5hZGRFdmVudExpc3RlbmVyKCdNRENUZW1wb3JhcnlEcmF3ZXI6b3BlbicsICgpID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKCdSZWNlaXZlZCBNRENUZW1wb3JhcnlEcmF3ZXI6b3BlbicpO1xuXG4gICAgICB0aGlzLl9vcGVuRHJhd2VyKCk7XG4gICAgfSk7XG5cbiAgICBkcmF3ZXJFbC5hZGRFdmVudExpc3RlbmVyKCdNRENUZW1wb3JhcnlEcmF3ZXI6Y2xvc2UnLCAoKSA9PiB7XG4gICAgICBjb25zb2xlLmxvZygnUmVjZWl2ZWQgTURDVGVtcG9yYXJ5RHJhd2VyOmNsb3NlJyk7XG5cbiAgICAgIHBhcmVudC5wb3N0TWVzc2FnZSh7IGJvZHk6IHsgbWV0aG9kOiAnaGlkZUFkbWluUGFnZScgfSwgdG86ICdydW50aW1lOmd1aS1tYW5hZ2VyJyB9LCAnKicpO1xuXG4gICAgfSk7XG5cbiAgfVxuXG4gIF9vcGVuRHJhd2VyKCkge1xuXG4gICAgbGV0IF90aGlzID0gdGhpcztcbiAgICBjb25zdCBndWlVUkwgPSBfdGhpcy5fZ3VpVVJMO1xuXG5cbiAgICBfdGhpcy5zaG93SWRlbnRpdGllc0dVSShtc2cuYm9keS52YWx1ZSkudGhlbigoaWRlbnRpdHlJbmZvKSA9PiB7XG4gICAgICBsZXQgcmVwbHlNc2c7XG4gICAgICBjb25zb2xlLmxvZygnW0lkZW50aXRpZXNHVUldIGlkZW50aXR5SW5mbyBmcm9tIEdVSTogJywgaWRlbnRpdHlJbmZvKTtcblxuICAgICAgLy9oaWRlIGNvbmZpZyBwYWdlIHdpdGggdGhlIGlkZW50aXR5IEdVSVxuICAgICAgcGFyZW50LnBvc3RNZXNzYWdlKHsgYm9keTogeyBtZXRob2Q6ICdoaWRlQWRtaW5QYWdlJyB9LCB0bzogJ3J1bnRpbWU6Z3VpLW1hbmFnZXInIH0sICcqJyk7XG4gICAgICAkKCcuYWRtaW4tcGFnZScpLmFkZENsYXNzKCdoaWRlJyk7XG5cbiAgICAgIC8vIGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdib2R5JylbMF0uc3R5bGUgPSAnYmFja2dyb3VuZC1jb2xvcjp0cmFuc3BhcmVudCc7XG4gICAgICAkKCcuaWRlbnRpdGllcy1zZWN0aW9uJykuYWRkQ2xhc3MoJ2hpZGUnKTtcbiAgICAgICQoJy5wb2xpY2llcy1zZWN0aW9uJykuYWRkQ2xhc3MoJ2hpZGUnKTtcblxuICAgICAgc3dpdGNoIChpZGVudGl0eUluZm8udHlwZSkge1xuICAgICAgICBjYXNlICdpZHAnOlxuICAgICAgICAgIHZhbHVlID0geyB0eXBlOiAnaWRwJywgdmFsdWU6IGlkZW50aXR5SW5mby52YWx1ZSwgY29kZTogMjAwIH07XG4gICAgICAgICAgcmVwbHlNc2cgPSB7IGlkOiBtc2cuaWQsIHR5cGU6ICdyZXNwb25zZScsIHRvOiBtc2cuZnJvbSwgZnJvbTogbXNnLnRvLCBib2R5OiB2YWx1ZSB9O1xuICAgICAgICAgIF90aGlzLl9tZXNzYWdlQnVzLnBvc3RNZXNzYWdlKHJlcGx5TXNnKTtcbiAgICAgICAgICBicmVhaztcblxuICAgICAgICBjYXNlICdpZGVudGl0eSc6XG4gICAgICAgICAgdmFsdWUgPSB7IHR5cGU6ICdpZGVudGl0eScsIHZhbHVlOiBpZGVudGl0eUluZm8udmFsdWUsIGNvZGU6IDIwMCB9O1xuICAgICAgICAgIHJlcGx5TXNnID0geyBpZDogbXNnLmlkLCB0eXBlOiAncmVzcG9uc2UnLCB0bzogbXNnLmZyb20sIGZyb206IG1zZy50bywgYm9keTogdmFsdWUgfTtcbiAgICAgICAgICBfdGhpcy5fbWVzc2FnZUJ1cy5wb3N0TWVzc2FnZShyZXBseU1zZyk7XG4gICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICB2YWx1ZSA9IHsgdHlwZTogJ2Vycm9yJywgdmFsdWU6ICdFcnJvciBvbiBpZGVudGl0eSBHVUknLCBjb2RlOiA0MDAgfTtcbiAgICAgICAgICByZXBseU1zZyA9IHsgaWQ6IG1zZy5pZCwgdHlwZTogJ3Jlc3BvbnNlJywgdG86IG1zZy5mcm9tLCBmcm9tOiBtc2cudG8sIGJvZHk6IHZhbHVlIH07XG4gICAgICAgICAgX3RoaXMuX21lc3NhZ2VCdXMucG9zdE1lc3NhZ2UocmVwbHlNc2cpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgX3RoaXMuY2FsbElkZW50aXR5TW9kdWxlRnVuYygnZGVwbG95R1VJJywge30pLnRoZW4oKCkgPT4ge1xuICAgICAgX3RoaXMucmVzdWx0VVJMICA9IHVuZGVmaW5lZDtcblxuICAgICAgX3RoaXMuX21lc3NhZ2VCdXMuYWRkTGlzdGVuZXIoZ3VpVVJMLCBtc2cgPT4ge1xuXG4gICAgICAgIGxldCBpZGVudGl0eUluZm8gPSBtc2cuYm9keS52YWx1ZTtcbiAgICAgICAgbGV0IGZ1bmNOYW1lID0gbXNnLmJvZHkubWV0aG9kO1xuICAgICAgICBsZXQgdmFsdWU7XG4gICAgICAgIGNvbnNvbGUubG9nKCdbSWRlbnRpdGllc0dVSV0gcmVjZWl2ZWQgbXNnOiAnLCBtc2cpO1xuXG4gICAgICAgIGlmIChmdW5jTmFtZSA9PT0gJ29wZW5Qb3B1cCcpIHtcbiAgICAgICAgICBsZXQgdXJscmVjZWl2ZWQgPSBtc2cuYm9keS5wYXJhbXMudXJscmVjZWl2ZWQ7XG4gICAgICAgICAgX3RoaXMub3BlblBvcHVwKHVybHJlY2VpdmVkKS50aGVuKChyZXR1cm5lZFZhbHVlKSA9PiB7XG4gICAgICAgICAgICBsZXQgdmFsdWUgPSB7dHlwZTogJ2V4ZWN1dGUnLCB2YWx1ZTogcmV0dXJuZWRWYWx1ZSwgY29kZTogMjAwfTtcbiAgICAgICAgICAgIGxldCByZXBseU1zZyA9IHtpZDogbXNnLmlkLCB0eXBlOiAncmVzcG9uc2UnLCB0bzogbXNnLmZyb20sIGZyb206IG1zZy50bywgYm9keTogdmFsdWV9O1xuICAgICAgICAgICAgX3RoaXMuX21lc3NhZ2VCdXMucG9zdE1lc3NhZ2UocmVwbHlNc2cpO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIHJldHVybjsgLy8gdGhpcyBhdm9pZHMgZ2V0dGluZyBzdHVjayBpbiB0aGUgaWRlbnRpdGllcyBwYWdlXG4gICAgICAgIH1cblxuICAgICAgICAvLyB1bmhpZGUgdGhlIGNvbmZpZyBwYWdlIHdpdGggdGhlIGlkZW50aXR5IEdVSVxuICAgICAgICAvLyBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnYm9keScpWzBdLnN0eWxlID0gJ2JhY2tncm91bmQtY29sb3I6d2hpdGU7JztcbiAgICAgICAgcGFyZW50LnBvc3RNZXNzYWdlKHsgYm9keTogeyBtZXRob2Q6ICdzaG93QWRtaW5QYWdlJyB9LCB0bzogJ3J1bnRpbWU6Z3VpLW1hbmFnZXInIH0sICcqJyk7XG5cbiAgICAgICAgY29uc3QgY2xpY2tPcGVuID0gbmV3IE1vdXNlRXZlbnQoJ2NsaWNrJyk7XG4gICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zZXR0aW5ncy1idG4nKS5kaXNwYXRjaEV2ZW50KGNsaWNrT3Blbik7XG5cbiAgICAgICAgJCgnLmFkbWluLXBhZ2UnKS5yZW1vdmVDbGFzcygnaGlkZScpO1xuXG4gICAgICB9KTtcblxuICAgIH0pO1xuXG4gIH1cblxuICBjYWxsSWRlbnRpdHlNb2R1bGVGdW5jKG1ldGhvZE5hbWUsIHBhcmFtZXRlcnMpIHtcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xuXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIGNvbnN0IG1lc3NhZ2UgPSB7IHR5cGU6ICdleGVjdXRlJywgdG86IF90aGlzLl9pZG1VUkwsIGZyb206IF90aGlzLl9ndWlVUkwsXG4gICAgICAgIGJvZHk6IHsgcmVzb3VyY2U6ICdpZGVudGl0eScsIG1ldGhvZDogbWV0aG9kTmFtZSwgcGFyYW1zOiBwYXJhbWV0ZXJzIH19O1xuXG4gICAgICB0aGlzLl9tZXNzYWdlQnVzLnBvc3RNZXNzYWdlKG1lc3NhZ2UsIChyZXMpID0+IHtcbiAgICAgICAgbGV0IHJlc3VsdCA9IHJlcy5ib2R5LnZhbHVlO1xuICAgICAgICByZXNvbHZlKHJlc3VsdCk7XG4gICAgICB9KTtcblxuICAgIH0pO1xuICB9XG5cbiAgb3BlblBvcHVwKHVybHJlY2VpdmVkKSB7XG5cbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuXG4gICAgICBsZXQgd2luID0gd2luZG93Lm9wZW4odXJscmVjZWl2ZWQsICdvcGVuSURyZXF1ZXN0JywgJ3dpZHRoPTgwMCwgaGVpZ2h0PTYwMCcpO1xuICAgICAgaWYgKHdpbmRvdy5jb3Jkb3ZhKSB7XG4gICAgICAgIHdpbi5hZGRFdmVudExpc3RlbmVyKCdsb2Fkc3RhcnQnLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgbGV0IHVybCA9IGUudXJsO1xuICAgICAgICAgIGxldCBjb2RlID0gL1xcJmNvZGU9KC4rKSQvLmV4ZWModXJsKTtcbiAgICAgICAgICBsZXQgZXJyb3IgPSAvXFwmZXJyb3I9KC4rKSQvLmV4ZWModXJsKTtcblxuICAgICAgICAgIGlmIChjb2RlIHx8IGVycm9yKSB7XG4gICAgICAgICAgICB3aW4uY2xvc2UoKTtcbiAgICAgICAgICAgIHJldHVybiByZXNvbHZlKHVybCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiByZWplY3QoJ29wZW5Qb3B1cCBlcnJvciAxIC0gc2hvdWxkIG5vdCBoYXBwZW4nKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcblxuICAgICAgICBsZXQgcG9sbFRpbWVyID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGlmICh3aW4uY2xvc2VkKSB7XG4gICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwocG9sbFRpbWVyKTtcbiAgICAgICAgICAgICAgcmV0dXJuIHJlamVjdCgnU29tZSBlcnJvciBvY2N1cmVkIHdoZW4gdHJ5aW5nIHRvIGdldCBpZGVudGl0eS4nKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCh3aW4uZG9jdW1lbnQuVVJMLmluZGV4T2YoJ2FjY2Vzc190b2tlbicpICE9PSAtMSB8fCB3aW4uZG9jdW1lbnQuVVJMLmluZGV4T2YoJ2NvZGUnKSAhPT0gLTEpICYmIHdpbi5kb2N1bWVudC5VUkwuaW5kZXhPZihsb2NhdGlvbi5vcmlnaW4pICE9PSAtMSkge1xuICAgICAgICAgICAgICB3aW5kb3cuY2xlYXJJbnRlcnZhbChwb2xsVGltZXIpO1xuICAgICAgICAgICAgICBsZXQgdXJsID0gICB3aW4uZG9jdW1lbnQuVVJMO1xuXG4gICAgICAgICAgICAgIHdpbi5jbG9zZSgpO1xuICAgICAgICAgICAgICByZXR1cm4gcmVzb2x2ZSh1cmwpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIC8vcmV0dXJuIHJlamVjdCgnb3BlblBvcHVwIGVycm9yIDIgLSBzaG91bGQgbm90IGhhcHBlbicpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coZSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgIH0sIDUwMCk7XG4gICAgICB9XG5cbiAgICB9KTtcbiAgfVxuXG4gIHNob3dJZGVudGl0aWVzR1VJKHJlY2VpdmVkSW5mbykge1xuICAgIGxldCBfdGhpcyA9IHRoaXM7XG5cbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgY29uc29sZS5sb2coJ1tJZGVudGl0aWVzR1VJLnNob3dJZGVudGl0aWVzR1VJXSByZWNlaXZlZEluZm86ICcsIHJlY2VpdmVkSW5mbyk7XG5cbiAgICAgIGxldCBpZGVudGl0eUluZm87XG4gICAgICBsZXQgdG9SZW1vdmVJRDtcblxuICAgICAgbGV0IGNhbGxiYWNrID0gKHZhbHVlKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdjaG9zZW4gaWRlbnRpdHk6ICcsIHZhbHVlKTtcblxuICAgICAgICBjb25zdCBjbGlja0Nsb3NlID0gbmV3IE1vdXNlRXZlbnQoJ2NsaWNrJyk7XG4gICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zZXR0aW5ncy1idG4nKS5kaXNwYXRjaEV2ZW50KGNsaWNrQ2xvc2UpO1xuXG4gICAgICAgIHJlc29sdmUoe3R5cGU6ICdpZGVudGl0eScsIHZhbHVlOiB2YWx1ZX0pO1xuICAgICAgfTtcblxuICAgICAgX3RoaXMuX2NoZWNrUmVjZWl2ZWRJbmZvKHJlY2VpdmVkSW5mbykudGhlbigocmVzdWx0T2JqZWN0KSA9PiB7XG4gICAgICAgIGlkZW50aXR5SW5mbyA9IHJlc3VsdE9iamVjdC5pZGVudGl0eUluZm87XG4gICAgICAgIHRvUmVtb3ZlSUQgPSByZXN1bHRPYmplY3QudG9SZW1vdmVJRDtcblxuICAgICAgICAkKCcucG9saWNpZXMtc2VjdGlvbicpLmFkZENsYXNzKCdoaWRlJyk7XG4gICAgICAgICQoJy5pZGVudGl0aWVzLXNlY3Rpb24nKS5yZW1vdmVDbGFzcygnaGlkZScpO1xuXG4gICAgICAgIF90aGlzLnNob3dJZHBzKHJlY2VpdmVkSW5mby5pZHBzLCBjYWxsYmFjayk7XG5cbiAgICAgICAgX3RoaXMuc2hvd015SWRlbnRpdGllcyhpZGVudGl0eUluZm8uaWRlbnRpdGllcywgdG9SZW1vdmVJRCkudGhlbigoaWRlbnRpdHkpID0+IHtcbiAgICAgICAgICBjb25zb2xlLmxvZygnY2hvc2VuIGlkZW50aXR5OiAnLCBpZGVudGl0eSk7XG4gICAgICAgICAgcmVzb2x2ZSh7dHlwZTogJ2lkZW50aXR5JywgdmFsdWU6IGlkZW50aXR5fSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGxldCBpZHBzID0gW107XG4gICAgICAgIGxldCBpZHBzT2JqZWN0cyA9IGlkZW50aXR5SW5mby5pZHBzO1xuXG4gICAgICAgIGlkcHNPYmplY3RzLmZvckVhY2goZnVuY3Rpb24oZW50cnkpIHtcbiAgICAgICAgICBpZihlbnRyeS50eXBlICYmIGVudHJ5LnR5cGUgPT0gJ2lkVG9rZW4nKSB7XG4gICAgICAgICAgICBpZHBzLnB1c2goZW50cnkuZG9tYWluKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgICQoJyNpZHByb3ZpZGVycycpLmh0bWwoX3RoaXMuX2dldExpc3QoaWRwcykpO1xuICAgICAgICAkKCcjaWRwcm92aWRlcnMnKS5vZmYoKTtcbiAgICAgICAgJCgnI2lkcHJvdmlkZXJzJykub24oJ2NsaWNrJywgKGV2ZW50KSA9PiBfdGhpcy5vYnRhaW5OZXdJZGVudGl0eShldmVudCwgY2FsbGJhY2ssIHRvUmVtb3ZlSUQpKTtcbiAgICAgICAgLy8kKCcuYmFjaycpLm9uKCdjbGljaycsIChldmVudCkgPT4gX3RoaXMuZ29Ib21lKCkpO1xuICAgICAgICAkKCcuaWRlbnRpdGllcy1yZXNldCcpLm9mZigpO1xuICAgICAgICAkKCcuaWRlbnRpdGllcy1yZXNldCcpLm9uKCdjbGljaycsIChldmVudCkgPT4gX3RoaXMuX3Jlc2V0SWRlbnRpdGllcyhjYWxsYmFjaykpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICBfY2hlY2tSZWNlaXZlZEluZm8ocmVjZWl2ZWRJbmZvKSB7XG4gICAgbGV0IF90aGlzID0gdGhpcztcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgbGV0IGlkZW50aXR5SW5mbywgdG9SZW1vdmVJRDtcbiAgICAgIGlmIChyZWNlaXZlZEluZm8pIHtcbiAgICAgICAgaWRlbnRpdHlJbmZvID0gcmVjZWl2ZWRJbmZvO1xuICAgICAgICB0b1JlbW92ZUlEID0gZmFsc2U7XG4gICAgICAgIHJlc29sdmUoe2lkZW50aXR5SW5mbzogaWRlbnRpdHlJbmZvLCB0b1JlbW92ZUlEOiB0b1JlbW92ZUlEfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0b1JlbW92ZUlEID0gdHJ1ZTtcbiAgICAgICAgX3RoaXMuY2FsbElkZW50aXR5TW9kdWxlRnVuYygnZ2V0SWRlbnRpdGllc1RvQ2hvb3NlJywge30pLnRoZW4oKHJlc3VsdCkgPT4ge1xuICAgICAgICAgIHJlc29sdmUoe2lkZW50aXR5SW5mbzogcmVzdWx0LCB0b1JlbW92ZUlEOiB0b1JlbW92ZUlEfSk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgc2hvd0lkcHMoaWRwcywgY2FsbGJhY2spIHtcblxuICAgIGxldCBpZHBzTGlzdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpZHBzLWxpc3QnKTtcblxuICAgIGlkcHMuZm9yRWFjaCgoa2V5KSA9PiB7XG5cbiAgICAgIGNvbnN0IGxpbmtFbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTtcbiAgICAgIGxpbmtFbC5zZXRBdHRyaWJ1dGUoJ2RhdGEtaWRwJywga2V5LmRvbWFpbik7XG4gICAgICBsaW5rRWwuY2xhc3NMaXN0ID0gJ21kYy1saXN0LWl0ZW0nO1xuICAgICAgbGlua0VsLmhyZWYgPSAnIyc7XG5cbiAgICAgIGxpbmtFbC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChldmVudCkgPT4ge1xuXG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgY29uc3QgZWwgPSBldmVudC5jdXJyZW50VGFyZ2V0O1xuICAgICAgICBjb25zdCBpZHAgPSBlbC5nZXRBdHRyaWJ1dGUoJ2RhdGEtaWRwJyk7XG5cbiAgICAgICAgdGhpcy5sb2dpbldpdGhJRFAoaWRwLCBjYWxsYmFjayk7XG5cbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBsaW5rRWxUZXh0ID0gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoa2V5LmRvbWFpbik7XG5cbiAgICAgIGNvbnN0IGljb25FbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2knKTtcbiAgICAgIGljb25FbC5jbGFzc0xpc3QgPSAnbWF0ZXJpYWwtaWNvbnMgbWRjLWxpc3QtaXRlbV9fc3RhcnQtZGV0YWlsJztcbiAgICAgIGljb25FbC5zZXRBdHRyaWJ1dGUoJ2FyaWEtaGlkZGVuJywgdHJ1ZSk7XG4gICAgICBpY29uRWwudGV4dENvbnRlbnQgPSAnaW5ib3gnO1xuXG4gICAgICBsaW5rRWwuYXBwZW5kQ2hpbGQoaWNvbkVsKTtcbiAgICAgIGxpbmtFbC5hcHBlbmRDaGlsZChsaW5rRWxUZXh0KTtcblxuICAgICAgaWRwc0xpc3QuYXBwZW5kQ2hpbGQobGlua0VsKTtcbiAgICB9KTtcblxuICB9XG5cbiAgc2hvd015SWRlbnRpdGllcyhpRHMsIHRvUmVtb3ZlSUQpIHtcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xuXG4gICAgLy8gVE9ETzogaURzIHNob3VsZCBiZSByZXBsYWNlZCBieSB1c2VyIHVybHNcblxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG5cbiAgICAgIGNvbnNvbGUubG9nKCdbSWRlbnRpdGllc0dVSS5zaG93TXlJZGVudGl0aWVzXSA6ICcsIGlEcyk7XG5cbiAgICAgIGxldCBpZGVudGl0aWVzID0gW107XG5cbiAgICAgIGZvciAobGV0IGkgaW4gaURzKSB7XG4gICAgICAgIGxldCBzcGxpdDEgPSBpRHNbaV0uc3BsaXQoJzovLycpO1xuXG4gICAgICAgIGxldCBpZGVudGlmaWVyID0gc3BsaXQxWzFdLnNwbGl0KCcvJylbMV07XG4gICAgICAgIGxldCBkb21haW4gPSBpRHNbaV0ucmVwbGFjZSgnLycgKyBpZGVudGlmaWVyLCAnJyk7XG4gICAgICAgIGlkZW50aXRpZXMucHVzaCh7IHVzZXJVUkw6IGlEc1tpXSwgZG9tYWluOiBkb21haW4gfSk7XG4gICAgICB9XG5cbiAgICAgIGxldCBhY3RpdmVJZGVudGl0aWVzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FjdGl2ZS1pZGVudGl0aWVzJyk7XG5cbiAgICAgIGlkZW50aXRpZXMuZm9yRWFjaCgoa2V5KSA9PiB7XG5cbiAgICAgICAgY29uc3QgbGlua0VsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpO1xuICAgICAgICBsaW5rRWwuY2xhc3NMaXN0ID0gJ21kYy1saXN0LWl0ZW0nO1xuICAgICAgICBsaW5rRWwuaHJlZiA9ICcjJztcblxuICAgICAgICBjb25zdCBsaW5rRWxUZXh0ID0gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoa2V5LnVzZXJVUkwpO1xuXG4gICAgICAgIGNvbnN0IGljb25FbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2knKTtcbiAgICAgICAgaWNvbkVsLmNsYXNzTGlzdCA9ICdtYXRlcmlhbC1pY29ucyBtZGMtbGlzdC1pdGVtX19zdGFydC1kZXRhaWwnO1xuICAgICAgICBpY29uRWwuc2V0QXR0cmlidXRlKCdhcmlhLWhpZGRlbicsIHRydWUpO1xuICAgICAgICBpY29uRWwudGV4dENvbnRlbnQgPSAnaW5ib3gnO1xuXG4gICAgICAgIGxpbmtFbC5hcHBlbmRDaGlsZChpY29uRWwpO1xuICAgICAgICBsaW5rRWwuYXBwZW5kQ2hpbGQobGlua0VsVGV4dCk7XG5cbiAgICAgICAgYWN0aXZlSWRlbnRpdGllcy5hcHBlbmRDaGlsZChsaW5rRWwpO1xuXG4gICAgICB9KTtcblxuICAgICAgaWYgKGlkZW50aXRpZXMubGVuZ3RoID09PSAxKSB7XG4gICAgICAgIHJldHVybiByZXNvbHZlKGlkZW50aXRpZXNbMF0udXNlclVSTCk7XG4gICAgICB9XG5cbiAgICAgIGlmIChpZGVudGl0aWVzLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgY29uc3QgY2xpY2tPcGVuID0gbmV3IE1vdXNlRXZlbnQoJ2NsaWNrJyk7XG4gICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zZXR0aW5ncy1idG4nKS5kaXNwYXRjaEV2ZW50KGNsaWNrT3Blbik7XG4gICAgICB9XG5cbiAgICAgIGxldCBjYWxsYmFjayA9IChpZGVudGl0eSkgPT4ge1xuICAgICAgICByZXNvbHZlKGlkZW50aXR5KTtcbiAgICAgIH07XG5cbiAgICAgIGlmICghdG9SZW1vdmVJRCkge1xuICAgICAgICAkKCcuY2xpY2thYmxlLWNlbGwnKS5vbignY2xpY2snLCAoZXZlbnQpID0+IF90aGlzLmNoYW5nZUlEKGV2ZW50LCBjYWxsYmFjaykpO1xuICAgICAgfVxuXG4gICAgICAkKCcucmVtb3ZlLWlkJykub24oJ2NsaWNrJywgKGV2ZW50KSA9PiBfdGhpcy5yZW1vdmVJRChpRHMpKTtcblxuICAgIH0pO1xuICB9XG5cbiAgcmVtb3ZlSUQoZXZlbnQsIGVtYWlscykge1xuICAgIGxldCBfdGhpcyA9IHRoaXM7XG4gICAgbGV0IHJvdyA9IGV2ZW50LnRhcmdldC5wYXJlbnROb2RlLnBhcmVudE5vZGU7XG4gICAgbGV0IGlkVG9SZW1vdmUgPSByb3cuY2hpbGRyZW5bMF0udGV4dENvbnRlbnQ7XG4gICAgbGV0IGRvbWFpbiA9IHJvdy5jaGlsZHJlblsxXS50ZXh0Q29udGVudDtcblxuICAgIF90aGlzLmNhbGxJZGVudGl0eU1vZHVsZUZ1bmMoJ3VucmVnaXN0ZXJJZGVudGl0eScsIHsgZW1haWw6IGlkVG9SZW1vdmUgfSkudGhlbigoKSA9PiB7XG4gICAgICBsZXQgbnVtRW1haWxzID0gZW1haWxzLmxlbmd0aDtcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtRW1haWxzOyBpKyspIHtcbiAgICAgICAgaWYgKGVtYWlsc1tpXS5lbWFpbCA9PT0gaWRUb1JlbW92ZSkge1xuICAgICAgICAgIGVtYWlscy5zcGxpY2UoaSwgMSk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS8vXG4gICAgICBfdGhpcy5zaG93TXlJZGVudGl0aWVzKGVtYWlscywgdHJ1ZSk7XG4gICAgfSk7XG5cbiAgICAvL190aGlzLmlkZW50aXR5TW9kdWxlLnVucmVnaXN0ZXJJZGVudGl0eShpZFRvUmVtb3ZlKTtcblxuICB9XG5cbiAgbG9naW5XaXRoSURQKGlkUHJvdmlkZXIsIGNhbGxiYWNrKSB7XG5cbiAgICBjb25zb2xlLmxvZyhpZFByb3ZpZGVyKTtcblxuICAgIGxldCBfcHVibGljS2V5O1xuICAgIHRoaXMuY2FsbElkZW50aXR5TW9kdWxlRnVuYygnZ2V0TXlQdWJsaWNLZXknLCB7fSlcbiAgICAgIC50aGVuKChwdWJsaWNLZXkpID0+IHtcbiAgICAgICAgX3B1YmxpY0tleSA9IHB1YmxpY0tleTtcbiAgICAgICAgY29uc3QgZGF0YSA9IHsgY29udGVudHM6IHB1YmxpY0tleSwgb3JpZ2luOiAnb3JpZ2luJywgdXNlcm5hbWVIaW50OiB1bmRlZmluZWQsIGlkcERvbWFpbjogaWRQcm92aWRlciB9O1xuICAgICAgICByZXR1cm4gdGhpcy5jYWxsSWRlbnRpdHlNb2R1bGVGdW5jKCdzZW5kR2VuZXJhdGVNZXNzYWdlJywgZGF0YSk7XG4gICAgICB9KVxuICAgICAgLnRoZW4oKHZhbHVlKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdbSWRlbnRpdGllc0dVSS5vYnRhaW5OZXdJZGVudGl0eV0gcmVjZWl2ZWRVUkwgZnJvbSBpZHAgUHJveHk6ICcgKyB2YWx1ZS5sb2dpblVybC5zdWJzdHJpbmcoMCwgMjApICsgJy4uLicpO1xuXG4gICAgICAgIGxldCB1cmwgPSB2YWx1ZS5sb2dpblVybDtcbiAgICAgICAgbGV0IGZpbmFsVVJMO1xuXG4gICAgICAgIC8vY2hlY2sgaWYgdGhlIHJlY2VpdmVkVVJMIGNvbnRhaW5zIHRoZSByZWRpcmVjdCBmaWVsZCBhbmQgcmVwbGFjZSBpdFxuICAgICAgICBpZiAodXJsLmluZGV4T2YoJ3JlZGlyZWN0X3VyaScpICE9PSAtMSkge1xuICAgICAgICAgIGxldCBmaXJzdFBhcnQgPSB1cmwuc3Vic3RyaW5nKDAsIHVybC5pbmRleE9mKCdyZWRpcmVjdF91cmknKSk7XG4gICAgICAgICAgbGV0IHNlY29uZEF1eFBhcnQgPSB1cmwuc3Vic3RyaW5nKHVybC5pbmRleE9mKCdyZWRpcmVjdF91cmknKSwgdXJsLmxlbmd0aCk7XG5cbiAgICAgICAgICBsZXQgc2Vjb25kUGFydCA9IHNlY29uZEF1eFBhcnQuc3Vic3RyaW5nKHNlY29uZEF1eFBhcnQuaW5kZXhPZignJicpLCB1cmwubGVuZ3RoKTtcblxuICAgICAgICAgIC8vY2hlY2sgaWYgdGhlIHJlZGRpcmVjdCBmaWVsZCBpcyB0aGUgbGFzdCBmaWVsZCBvZiB0aGUgVVJMXG4gICAgICAgICAgaWYgKHNlY29uZFBhcnQuaW5kZXhPZignJicpICE9PSAtMSkge1xuICAgICAgICAgICAgZmluYWxVUkwgPSBmaXJzdFBhcnQgKyAncmVkaXJlY3RfdXJpPScgKyBsb2NhdGlvbi5vcmlnaW4gKyBzZWNvbmRQYXJ0O1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBmaW5hbFVSTCA9IGZpcnN0UGFydCArICdyZWRpcmVjdF91cmk9JyArIGxvY2F0aW9uLm9yaWdpbjtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnJlc3VsdFVSTCA9IGZpbmFsVVJMIHx8IHVybDtcblxuICAgICAgICBjb25zb2xlLmxvZygnQVFVSTonLCB0aGlzLnJlc3VsdFVSTCk7XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuX2F1dGhlbnRpY2F0ZVVzZXIoX3B1YmxpY0tleSwgdmFsdWUsICdvcmlnaW4nLCBpZFByb3ZpZGVyKTtcbiAgICAgIH0pLnRoZW4oKGVtYWlsKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdBUVVJOicsIGVtYWlsKTtcbiAgICAgICAgY2FsbGJhY2soZW1haWwpO1xuICAgICAgfSk7XG5cbiAgfVxuXG4gIG9idGFpbk5ld0lkZW50aXR5KGV2ZW50LCBjYWxsYmFjaywgdG9SZW1vdmVJRCkge1xuICAgIGxldCBfdGhpcyA9IHRoaXM7XG4gICAgbGV0IGlkUHJvdmlkZXIgPSBldmVudC50YXJnZXQudGV4dENvbnRlbnQ7XG4gICAgbGV0IGlkUHJvdmlkZXIyID0gZXZlbnQudGFyZ2V0LnRleHQ7XG5cbiAgICBfdGhpcy5jYWxsSWRlbnRpdHlNb2R1bGVGdW5jKCdnZXRNeVB1YmxpY0tleScsIHt9KS50aGVuKChwdWJsaWNLZXkpID0+IHtcbi8vICAgICAgbGV0IHB1YmxpY0tleSA9IGJ0b2Eoa2V5UGFpci5wdWJsaWMpO1xuXG4gICAgICBfdGhpcy5jYWxsSWRlbnRpdHlNb2R1bGVGdW5jKCdzZW5kR2VuZXJhdGVNZXNzYWdlJyxcbiAgICAgICAgeyBjb250ZW50czogcHVibGljS2V5LCBvcmlnaW46ICdvcmlnaW4nLCB1c2VybmFtZUhpbnQ6IHVuZGVmaW5lZCxcbiAgICAgICAgaWRwRG9tYWluOiBpZFByb3ZpZGVyLCB9KS50aGVuKCh2YWx1ZSkgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZygnW0lkZW50aXRpZXNHVUkub2J0YWluTmV3SWRlbnRpdHldIHJlY2VpdmVkVVJMIGZyb20gaWRwIFByb3h5OiAnICsgdmFsdWUubG9naW5Vcmwuc3Vic3RyaW5nKDAsIDIwKSArICcuLi4nKTtcblxuICAgICAgICBsZXQgdXJsID0gdmFsdWUubG9naW5Vcmw7XG4gICAgICAgIGxldCBmaW5hbFVSTDtcblxuICAgICAgICAvL2NoZWNrIGlmIHRoZSByZWNlaXZlZFVSTCBjb250YWlucyB0aGUgcmVkaXJlY3QgZmllbGQgYW5kIHJlcGxhY2UgaXRcbiAgICAgICAgaWYgKHVybC5pbmRleE9mKCdyZWRpcmVjdF91cmknKSAhPT0gLTEpIHtcbiAgICAgICAgICBsZXQgZmlyc3RQYXJ0ID0gdXJsLnN1YnN0cmluZygwLCB1cmwuaW5kZXhPZigncmVkaXJlY3RfdXJpJykpO1xuICAgICAgICAgIGxldCBzZWNvbmRBdXhQYXJ0ID0gdXJsLnN1YnN0cmluZyh1cmwuaW5kZXhPZigncmVkaXJlY3RfdXJpJyksIHVybC5sZW5ndGgpO1xuXG4gICAgICAgICAgbGV0IHNlY29uZFBhcnQgPSBzZWNvbmRBdXhQYXJ0LnN1YnN0cmluZyhzZWNvbmRBdXhQYXJ0LmluZGV4T2YoJyYnKSwgdXJsLmxlbmd0aCk7XG5cbiAgICAgICAgICAvL2NoZWNrIGlmIHRoZSByZWRkaXJlY3QgZmllbGQgaXMgdGhlIGxhc3QgZmllbGQgb2YgdGhlIFVSTFxuICAgICAgICAgIGlmIChzZWNvbmRQYXJ0LmluZGV4T2YoJyYnKSAhPT0gLTEpIHtcbiAgICAgICAgICAgIGZpbmFsVVJMID0gZmlyc3RQYXJ0ICsgJ3JlZGlyZWN0X3VyaT0nICsgbG9jYXRpb24ub3JpZ2luICsgc2Vjb25kUGFydDtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZmluYWxVUkwgPSBmaXJzdFBhcnQgKyAncmVkaXJlY3RfdXJpPScgKyBsb2NhdGlvbi5vcmlnaW47XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgX3RoaXMucmVzdWx0VVJMID0gZmluYWxVUkwgfHwgdXJsO1xuXG4gICAgICAgICQoJy5sb2dpbi1pZHAnKS5odG1sKCc8cD5DaG9zZW4gSURQOiAnICsgaWRQcm92aWRlciArICc8L3A+Jyk7XG4gICAgICAgICQoJy5sb2dpbicpLnJlbW92ZUNsYXNzKCdoaWRlJyk7XG4gICAgICAgICQoJy5sb2dpbi1idG4nKS5vZmYoKTtcbiAgICAgICAgJCgnLmxvZ2luLWJ0bicpLm9uKCdjbGljaycsIChldmVudCkgPT4ge1xuICAgICAgICAgICQoJy5sb2dpbicpLmFkZENsYXNzKCdoaWRlJyk7XG4gICAgICAgICAgX3RoaXMuX2F1dGhlbnRpY2F0ZVVzZXIocHVibGljS2V5LCB2YWx1ZSwgJ29yaWdpbicsIGlkUHJvdmlkZXIpLnRoZW4oKGVtYWlsKSA9PiB7XG4gICAgICAgICAgICBjYWxsYmFjayhlbWFpbCk7XG4gICAgICAgICAgICBfdGhpcy5zaG93SWRlbnRpdGllc0dVSSgpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH0pLmNhdGNoKGVyciA9PiBjb25zb2xlLmxvZygnb2J0YW5pbiBuZXcgaWRlbnRpdHknLCBlcnIpKTtcblxuICB9XG5cbiAgX2dldExpc3QoaXRlbXMpIHtcbiAgICBsZXQgbGlzdCA9ICcnO1xuICAgIGxldCBudW1JdGVtcyA9IGl0ZW1zLmxlbmd0aDtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtSXRlbXM7IGkrKykge1xuICAgICAgbGlzdCArPSAnPGxpIGNsYXNzPVwiZGl2aWRlclwiPjwvbGk+JztcbiAgICAgIGxpc3QgKz0gJzxsaT48YSBjbGFzcz1cImNlbnRlci1hbGlnblwiPicgKyBpdGVtc1tpXSArICc8L2E+PC9saT4nO1xuICAgIH1cblxuICAgIHJldHVybiBsaXN0O1xuICB9XG5cbiAgX2F1dGhlbnRpY2F0ZVVzZXIocHVibGljS2V5LCB2YWx1ZSwgb3JpZ2luLCBpZFByb3ZpZGVyKSB7XG4gICAgbGV0IF90aGlzID0gdGhpcztcbiAgICBsZXQgdXJsID0gX3RoaXMucmVzdWx0VVJMO1xuXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcblxuICAgICAgX3RoaXMub3BlblBvcHVwKHVybCkudGhlbigoaWRlbnRpdHkpID0+IHtcblxuICAgICAgICBfdGhpcy5jYWxsSWRlbnRpdHlNb2R1bGVGdW5jKCdzZW5kR2VuZXJhdGVNZXNzYWdlJyxcbiAgICAgICAgICB7IGNvbnRlbnRzOiBwdWJsaWNLZXksIG9yaWdpbjogb3JpZ2luLCB1c2VybmFtZUhpbnQ6IGlkZW50aXR5LCBpZHBEb21haW46IGlkUHJvdmlkZXIgfSkudGhlbigocmVzdWx0KSA9PiB7XG5cbiAgICAgICAgICBpZiAocmVzdWx0KSB7XG5cbiAgICAgICAgICAgLy9fdGhpcy5pZGVudGl0eU1vZHVsZS5zdG9yZUlkZW50aXR5KHJlc3VsdCwga2V5UGFpcikudGhlbigodmFsdWUpID0+IHtcbiAgICAgICAgICAgX3RoaXMuY2FsbElkZW50aXR5TW9kdWxlRnVuYygnYWRkQXNzZXJ0aW9uJywgcmVzdWx0KS50aGVuKCh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgIHJlc29sdmUodmFsdWUudXNlclByb2ZpbGUudXNlclVSTCk7XG4gICAgICAgICAgIH0sIChlcnIpID0+IHtcbiAgICAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICByZWplY3QoJ2Vycm9yIG9uIG9idGFpbmluZyBpZGVudGl0eSBpbmZvcm1hdGlvbicpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIH0pO1xuICAgICAgICAgfSwgKGVycikgPT4ge1xuICAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbl9yZXNldElkZW50aXRpZXMoKSB7XG4gIGNvbnNvbGUubG9nKCdfcmVzZXRJZGVudGl0aWVzJyk7XG59XG5cblxufVxuXG5leHBvcnQgZGVmYXVsdCBJZGVudGl0aWVzR1VJO1xuIl19"}